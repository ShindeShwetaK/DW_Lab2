[0m16:15:55.505316 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107db2c00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10896d850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10896d5e0>]}


============================== 16:15:55.508316 | d23b41f0-abf1-4138-8347-9c7c93a024a1 ==============================
[0m16:15:55.508316 [info ] [MainThread]: Running with dbt=1.8.7
[0m16:15:55.508665 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/gayatripatil/Documents/dwprojects/sjsu-data226/week8/airflow/lab', 'log_path': '/Users/gayatripatil/Documents/dwprojects/sjsu-data226/week8/airflow/lab/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m16:15:55.510476 [error] [MainThread]: Encountered an error:
Runtime Error
  Could not find profile named 'build_lab2'
[0m16:15:55.511913 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.050387207, "process_user_time": 0.630387, "process_kernel_time": 0.134386, "process_mem_max_rss": "93405184", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:15:55.512269 [debug] [MainThread]: Command `dbt run` failed at 16:15:55.512215 after 0.05 seconds
[0m16:15:55.512460 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10892e360>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087b4140>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10896d7c0>]}
[0m16:15:55.512642 [debug] [MainThread]: Flushing usage events
[0m16:16:32.330159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a96540>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064f1850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064f1610>]}


============================== 16:16:32.332658 | 5357b4ab-b41b-4cea-bdb9-41e31fb6d8db ==============================
[0m16:16:32.332658 [info ] [MainThread]: Running with dbt=1.8.7
[0m16:16:32.332937 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/gayatripatil/Documents/dwprojects/sjsu-data226/week8/airflow/lab/logs', 'version_check': 'True', 'profiles_dir': '/Users/gayatripatil/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m16:16:33.226499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5357b4ab-b41b-4cea-bdb9-41e31fb6d8db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a518d70>]}
[0m16:16:33.248032 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5357b4ab-b41b-4cea-bdb9-41e31fb6d8db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c9e15b0>]}
[0m16:16:33.248659 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m16:16:33.291750 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m16:16:33.292270 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m16:16:33.292457 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '5357b4ab-b41b-4cea-bdb9-41e31fb6d8db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107512630>]}
[0m16:16:33.934443 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5357b4ab-b41b-4cea-bdb9-41e31fb6d8db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f0d4230>]}
[0m16:16:34.024648 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5357b4ab-b41b-4cea-bdb9-41e31fb6d8db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e846b0>]}
[0m16:16:34.024927 [info ] [MainThread]: Found 2 models, 1 snapshot, 1 test, 2 sources, 459 macros
[0m16:16:34.025088 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5357b4ab-b41b-4cea-bdb9-41e31fb6d8db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1026cade0>]}
[0m16:16:34.025948 [info ] [MainThread]: 
[0m16:16:34.026219 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:16:34.026613 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m16:16:34.032481 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m16:16:34.032663 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m16:16:34.032787 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:16:34.596915 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m16:16:34.597465 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m16:16:34.597887 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_schemas
[0m16:16:34.598153 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m16:16:34.598483 [debug] [ThreadPool]: On list_dev: No close available on handle
[0m16:16:34.599094 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:16:34.599349 [debug] [MainThread]: Connection 'list_dev' was properly closed.
[0m16:16:34.599608 [info ] [MainThread]: 
[0m16:16:34.599896 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 0.57 seconds (0.57s).
[0m16:16:34.600314 [error] [MainThread]: Encountered an error:
Runtime Error
  Database error while listing schemas in database "dev"
  Database Error
    250001 (08001): Failed to connect to DB: rab26384.snowflakecomputing.com:443. Your free trial has ended and all of your virtual warehouses have been suspended. Add billing information in the Snowflake web UI to continue using the full set of Snowflake features.
[0m16:16:34.603362 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 2.3076825, "process_user_time": 1.647863, "process_kernel_time": 0.270774, "process_mem_max_rss": "172638208", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:16:34.603951 [debug] [MainThread]: Command `dbt run` failed at 16:16:34.603848 after 2.31 seconds
[0m16:16:34.604316 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f44c3e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f463650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105191130>]}
[0m16:16:34.604669 [debug] [MainThread]: Flushing usage events
[0m16:18:59.335686 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10817c770>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087cd850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087cd610>]}


============================== 16:18:59.338418 | 16248b5e-23c9-42d8-abc7-9286cefbfa0e ==============================
[0m16:18:59.338418 [info ] [MainThread]: Running with dbt=1.8.7
[0m16:18:59.338739 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/gayatripatil/.dbt', 'log_path': '/Users/gayatripatil/Documents/dwprojects/sjsu-data226/week8/airflow/lab/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m16:18:59.887179 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '16248b5e-23c9-42d8-abc7-9286cefbfa0e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bfd9dc0>]}
[0m16:18:59.910944 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '16248b5e-23c9-42d8-abc7-9286cefbfa0e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090549e0>]}
[0m16:18:59.911573 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m16:18:59.922143 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m16:18:59.973474 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m16:18:59.973801 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '16248b5e-23c9-42d8-abc7-9286cefbfa0e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d4bbf0>]}
[0m16:19:00.571068 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '16248b5e-23c9-42d8-abc7-9286cefbfa0e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c9fed50>]}
[0m16:19:00.619885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '16248b5e-23c9-42d8-abc7-9286cefbfa0e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cc2d460>]}
[0m16:19:00.620118 [info ] [MainThread]: Found 2 models, 1 snapshot, 1 test, 2 sources, 459 macros
[0m16:19:00.620271 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '16248b5e-23c9-42d8-abc7-9286cefbfa0e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c66adb0>]}
[0m16:19:00.621075 [info ] [MainThread]: 
[0m16:19:00.621338 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:19:00.621717 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m16:19:00.660586 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m16:19:00.660801 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m16:19:00.660938 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:19:01.365280 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.704 seconds
[0m16:19:01.369350 [debug] [ThreadPool]: On list_dev: Close
[0m16:19:01.499092 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_snapshot)
[0m16:19:01.509468 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m16:19:01.509837 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m16:19:01.510086 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:19:01.996733 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01b84f73-0004-26ba-0000-000262e75625
[0m16:19:01.997577 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m16:19:01.998126 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m16:19:01.998462 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m16:19:01.998876 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m16:19:02.135256 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m16:19:02.141749 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m16:19:02.142273 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m16:19:02.142633 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:19:02.735793 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.593 seconds
[0m16:19:02.740044 [debug] [ThreadPool]: On list_dev_stock: Close
[0m16:19:02.882765 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '16248b5e-23c9-42d8-abc7-9286cefbfa0e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c93b2f0>]}
[0m16:19:02.883924 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:19:02.884511 [info ] [MainThread]: 
[0m16:19:02.890785 [debug] [Thread-1 (]: Began running node model.build_lab2.stock_price_analysis
[0m16:19:02.891605 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now model.build_lab2.stock_price_analysis)
[0m16:19:02.892108 [debug] [Thread-1 (]: Began compiling node model.build_lab2.stock_price_analysis
[0m16:19:02.901166 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_lab2.stock_price_analysis"
[0m16:19:02.903028 [debug] [Thread-1 (]: Finished running node model.build_lab2.stock_price_analysis
[0m16:19:02.903798 [debug] [Thread-1 (]: Began running node model.build_lab2.macd_calculation
[0m16:19:02.904375 [info ] [Thread-1 (]: 1 of 1 START sql table model stock.macd_calculation ............................ [RUN]
[0m16:19:02.904777 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_lab2.stock_price_analysis, now model.build_lab2.macd_calculation)
[0m16:19:02.905102 [debug] [Thread-1 (]: Began compiling node model.build_lab2.macd_calculation
[0m16:19:02.925083 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_lab2.macd_calculation"
[0m16:19:02.925696 [debug] [Thread-1 (]: Began executing node model.build_lab2.macd_calculation
[0m16:19:02.943236 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_lab2.macd_calculation"
[0m16:19:02.944974 [debug] [Thread-1 (]: Using snowflake connection "model.build_lab2.macd_calculation"
[0m16:19:02.945262 [debug] [Thread-1 (]: On model.build_lab2.macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "model.build_lab2.macd_calculation"} */
create or replace transient table dev.stock.macd_calculation
         as
        (WITH  __dbt__cte__stock_price_analysis as (
WITH stock_data AS (
    SELECT
        *
    FROM dev.stock.stock_price_analysis
)

-- Now you can query the CTE
SELECT * FROM stock_data
), stock_data AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE,
        ROW_NUMBER() OVER (PARTITION BY SYMBOL ORDER BY DATE) AS rn
    FROM __dbt__cte__stock_price_analysis  -- Replace with the reference to your actual source table in DBT
),

-- Calculate 12-day EMA
ema_12 AS (
    SELECT
        SYMBOL,
        DATE,
        CLOSE AS EMA_12,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (12 + 1))) + (e.EMA_12 * (1 - (2.0 / (12 + 1)))) AS EMA_12,
        sd.rn
    FROM stock_data sd
    JOIN ema_12 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate 26-day EMA
ema_26 AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE AS EMA_26,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (26 + 1))) + (e.EMA_26 * (1 - (2.0 / (26 + 1)))) AS EMA_26,
        sd.rn
    FROM stock_data sd
    JOIN ema_26 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate MACD by subtracting 26-day EMA from 12-day EMA
macd_calculation AS (
    SELECT 
        e12.SYMBOL,
        e12.DATE,
        e12.EMA_12 - e26.EMA_26 AS MACD,
        e12.rn
    FROM ema_12 e12
    JOIN ema_26 e26 ON e12.SYMBOL = e26.SYMBOL AND e12.DATE = e26.DATE
),

-- Calculate 9-day EMA of MACD as Signal Line
signal_line AS (
    SELECT 
        SYMBOL,
        DATE,
        MACD,
        MACD AS Signal,
        rn
    FROM macd_calculation
    WHERE rn = 1

    UNION ALL

    SELECT 
        mc.SYMBOL,
        mc.DATE,
        mc.MACD,
        (mc.MACD * (2.0 / (9 + 1))) + (sl.Signal * (1 - (2.0 / (9 + 1)))) AS Signal,
        mc.rn
    FROM macd_calculation mc
    JOIN signal_line sl ON mc.SYMBOL = sl.SYMBOL AND mc.rn = sl.rn + 1
)

-- Final output
SELECT 
    SYMBOL,
    DATE,
    MACD,
    Signal,
    MACD - Signal AS Histogram
FROM signal_line
ORDER BY SYMBOL, DATE
        );
[0m16:19:02.945523 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:19:04.671546 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.725 seconds
[0m16:19:04.698696 [debug] [Thread-1 (]: On model.build_lab2.macd_calculation: Close
[0m16:19:04.872094 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '16248b5e-23c9-42d8-abc7-9286cefbfa0e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c5f1970>]}
[0m16:19:04.873085 [info ] [Thread-1 (]: 1 of 1 OK created sql table model stock.macd_calculation ....................... [[32mSUCCESS 1[0m in 1.97s]
[0m16:19:04.873843 [debug] [Thread-1 (]: Finished running node model.build_lab2.macd_calculation
[0m16:19:04.875272 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:19:04.875706 [debug] [MainThread]: Connection 'model.build_lab2.macd_calculation' was properly closed.
[0m16:19:04.876091 [info ] [MainThread]: 
[0m16:19:04.876474 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.25 seconds (4.25s).
[0m16:19:04.877251 [debug] [MainThread]: Command end result
[0m16:19:04.903012 [info ] [MainThread]: 
[0m16:19:04.903301 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:19:04.903478 [info ] [MainThread]: 
[0m16:19:04.903663 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m16:19:04.905976 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.6052504, "process_user_time": 1.912902, "process_kernel_time": 0.281114, "process_mem_max_rss": "176111616", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:19:04.906384 [debug] [MainThread]: Command `dbt run` succeeded at 16:19:04.906320 after 5.61 seconds
[0m16:19:04.906649 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1083cb080>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c489c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c669a00>]}
[0m16:19:04.906872 [debug] [MainThread]: Flushing usage events
[0m16:24:01.223470 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a37d40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113139820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1131395e0>]}


============================== 16:24:01.226220 | 0d51a85f-fc8f-4844-aea3-d8fd4fa78dc3 ==============================
[0m16:24:01.226220 [info ] [MainThread]: Running with dbt=1.8.7
[0m16:24:01.226549 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/gayatripatil/Documents/dwprojects/sjsu-data226/week8/airflow/lab/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/gayatripatil/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m16:24:01.780502 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0d51a85f-fc8f-4844-aea3-d8fd4fa78dc3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113628e30>]}
[0m16:24:01.801587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0d51a85f-fc8f-4844-aea3-d8fd4fa78dc3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11315c200>]}
[0m16:24:01.802158 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m16:24:01.814507 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m16:24:01.885658 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m16:24:01.885953 [debug] [MainThread]: Partial parsing: added file: build_lab2://models/output/RSI_Calculation.sql
[0m16:24:01.984818 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0d51a85f-fc8f-4844-aea3-d8fd4fa78dc3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1209f5850>]}
[0m16:24:02.034593 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0d51a85f-fc8f-4844-aea3-d8fd4fa78dc3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120a024e0>]}
[0m16:24:02.034834 [info ] [MainThread]: Found 3 models, 1 snapshot, 1 test, 2 sources, 459 macros
[0m16:24:02.034993 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0d51a85f-fc8f-4844-aea3-d8fd4fa78dc3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12072e480>]}
[0m16:24:02.035818 [info ] [MainThread]: 
[0m16:24:02.036087 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:24:02.037907 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m16:24:02.044087 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m16:24:02.044262 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m16:24:02.044399 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:24:02.672618 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.628 seconds
[0m16:24:02.677046 [debug] [ThreadPool]: On list_dev: Close
[0m16:24:02.812351 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_snapshot)
[0m16:24:02.823109 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m16:24:02.823435 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m16:24:02.823680 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:24:03.341392 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01b84f78-0004-26b9-0000-000262e746a1
[0m16:24:03.342033 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m16:24:03.342564 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m16:24:03.342909 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m16:24:03.343312 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m16:24:03.483056 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m16:24:03.486459 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m16:24:03.486834 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m16:24:03.487103 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:24:04.060467 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.573 seconds
[0m16:24:04.064568 [debug] [ThreadPool]: On list_dev_stock: Close
[0m16:24:04.204289 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0d51a85f-fc8f-4844-aea3-d8fd4fa78dc3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120389ee0>]}
[0m16:24:04.205607 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:24:04.206077 [info ] [MainThread]: 
[0m16:24:04.210571 [debug] [Thread-1 (]: Began running node model.build_lab2.RSI_Calculation
[0m16:24:04.211397 [info ] [Thread-1 (]: 1 of 2 START sql table model stock.RSI_Calculation ............................. [RUN]
[0m16:24:04.211986 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now model.build_lab2.RSI_Calculation)
[0m16:24:04.212404 [debug] [Thread-1 (]: Began compiling node model.build_lab2.RSI_Calculation
[0m16:24:04.221885 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_lab2.RSI_Calculation"
[0m16:24:04.223009 [debug] [Thread-1 (]: Began executing node model.build_lab2.RSI_Calculation
[0m16:24:04.245599 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_lab2.RSI_Calculation"
[0m16:24:04.247163 [debug] [Thread-1 (]: Using snowflake connection "model.build_lab2.RSI_Calculation"
[0m16:24:04.247465 [debug] [Thread-1 (]: On model.build_lab2.RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "model.build_lab2.RSI_Calculation"} */
create or replace transient table dev.stock.RSI_Calculation
         as
        (-- models/rsi_calculation.sql

WITH PriceChanges AS (
    SELECT
        date,
        symbol,
        close,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM
        dev.stock.stock_price_analysis  -- Replace 'stock' and 'stock_price_analysis' with your actual source name and table
),
PriceGainsLosses AS (
    SELECT
        date,
        symbol,
        close,
        next_close,
        CASE 
            WHEN next_close > close THEN next_close - close
            ELSE 0 
        END AS gain,
        CASE 
            WHEN next_close < close THEN close - next_close
            ELSE 0 
        END AS loss
    FROM
        PriceChanges
),
AverageGainsLosses AS (
    SELECT
        date,
        symbol,
        AVG(gain) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain,
        AVG(loss) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss
    FROM
        PriceGainsLosses
),
RSI_Calculation AS (
    SELECT
        date,
        symbol,
        avg_gain,
        avg_loss,
        CASE 
            WHEN avg_loss = 0 THEN 100
            ELSE 100 - (100 / (1 + (avg_gain / avg_loss)))
        END AS rsi
    FROM
        AverageGainsLosses
)
SELECT 
    date, 
    symbol, 
    rsi
FROM 
    RSI_Calculation
WHERE
    date >= (SELECT MIN(date) FROM dev.stock.stock_price_analysis) + INTERVAL '14 DAY'
ORDER BY
    symbol, date
        );
[0m16:24:04.247730 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:24:05.865904 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.618 seconds
[0m16:24:05.893366 [debug] [Thread-1 (]: On model.build_lab2.RSI_Calculation: Close
[0m16:24:06.036232 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0d51a85f-fc8f-4844-aea3-d8fd4fa78dc3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12034db80>]}
[0m16:24:06.037569 [info ] [Thread-1 (]: 1 of 2 OK created sql table model stock.RSI_Calculation ........................ [[32mSUCCESS 1[0m in 1.82s]
[0m16:24:06.038471 [debug] [Thread-1 (]: Finished running node model.build_lab2.RSI_Calculation
[0m16:24:06.039013 [debug] [Thread-1 (]: Began running node model.build_lab2.stock_price_analysis
[0m16:24:06.039666 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_lab2.RSI_Calculation, now model.build_lab2.stock_price_analysis)
[0m16:24:06.040175 [debug] [Thread-1 (]: Began compiling node model.build_lab2.stock_price_analysis
[0m16:24:06.045641 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_lab2.stock_price_analysis"
[0m16:24:06.046822 [debug] [Thread-1 (]: Finished running node model.build_lab2.stock_price_analysis
[0m16:24:06.047621 [debug] [Thread-1 (]: Began running node model.build_lab2.macd_calculation
[0m16:24:06.048062 [info ] [Thread-1 (]: 2 of 2 START sql table model stock.macd_calculation ............................ [RUN]
[0m16:24:06.048461 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_lab2.stock_price_analysis, now model.build_lab2.macd_calculation)
[0m16:24:06.048774 [debug] [Thread-1 (]: Began compiling node model.build_lab2.macd_calculation
[0m16:24:06.068474 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_lab2.macd_calculation"
[0m16:24:06.068939 [debug] [Thread-1 (]: Began executing node model.build_lab2.macd_calculation
[0m16:24:06.070982 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_lab2.macd_calculation"
[0m16:24:06.072720 [debug] [Thread-1 (]: Using snowflake connection "model.build_lab2.macd_calculation"
[0m16:24:06.073032 [debug] [Thread-1 (]: On model.build_lab2.macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "model.build_lab2.macd_calculation"} */
create or replace transient table dev.stock.macd_calculation
         as
        (WITH  __dbt__cte__stock_price_analysis as (
WITH stock_data AS (
    SELECT
        *
    FROM dev.stock.stock_price_analysis
)

-- Now you can query the CTE
SELECT * FROM stock_data
), stock_data AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE,
        ROW_NUMBER() OVER (PARTITION BY SYMBOL ORDER BY DATE) AS rn
    FROM __dbt__cte__stock_price_analysis  -- Replace with the reference to your actual source table in DBT
),

-- Calculate 12-day EMA
ema_12 AS (
    SELECT
        SYMBOL,
        DATE,
        CLOSE AS EMA_12,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (12 + 1))) + (e.EMA_12 * (1 - (2.0 / (12 + 1)))) AS EMA_12,
        sd.rn
    FROM stock_data sd
    JOIN ema_12 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate 26-day EMA
ema_26 AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE AS EMA_26,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (26 + 1))) + (e.EMA_26 * (1 - (2.0 / (26 + 1)))) AS EMA_26,
        sd.rn
    FROM stock_data sd
    JOIN ema_26 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate MACD by subtracting 26-day EMA from 12-day EMA
macd_calculation AS (
    SELECT 
        e12.SYMBOL,
        e12.DATE,
        e12.EMA_12 - e26.EMA_26 AS MACD,
        e12.rn
    FROM ema_12 e12
    JOIN ema_26 e26 ON e12.SYMBOL = e26.SYMBOL AND e12.DATE = e26.DATE
),

-- Calculate 9-day EMA of MACD as Signal Line
signal_line AS (
    SELECT 
        SYMBOL,
        DATE,
        MACD,
        MACD AS Signal,
        rn
    FROM macd_calculation
    WHERE rn = 1

    UNION ALL

    SELECT 
        mc.SYMBOL,
        mc.DATE,
        mc.MACD,
        (mc.MACD * (2.0 / (9 + 1))) + (sl.Signal * (1 - (2.0 / (9 + 1)))) AS Signal,
        mc.rn
    FROM macd_calculation mc
    JOIN signal_line sl ON mc.SYMBOL = sl.SYMBOL AND mc.rn = sl.rn + 1
)

-- Final output
SELECT 
    SYMBOL,
    DATE,
    MACD,
    Signal,
    MACD - Signal AS Histogram
FROM signal_line
ORDER BY SYMBOL, DATE
        );
[0m16:24:06.073320 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:24:07.464654 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.391 seconds
[0m16:24:07.470124 [debug] [Thread-1 (]: On model.build_lab2.macd_calculation: Close
[0m16:24:07.607737 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0d51a85f-fc8f-4844-aea3-d8fd4fa78dc3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121849c40>]}
[0m16:24:07.608659 [info ] [Thread-1 (]: 2 of 2 OK created sql table model stock.macd_calculation ....................... [[32mSUCCESS 1[0m in 1.56s]
[0m16:24:07.609363 [debug] [Thread-1 (]: Finished running node model.build_lab2.macd_calculation
[0m16:24:07.610677 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:24:07.611012 [debug] [MainThread]: Connection 'model.build_lab2.macd_calculation' was properly closed.
[0m16:24:07.611410 [info ] [MainThread]: 
[0m16:24:07.611775 [info ] [MainThread]: Finished running 2 table models in 0 hours 0 minutes and 5.58 seconds (5.58s).
[0m16:24:07.612657 [debug] [MainThread]: Command end result
[0m16:24:07.637811 [info ] [MainThread]: 
[0m16:24:07.638112 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:24:07.638308 [info ] [MainThread]: 
[0m16:24:07.638502 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m16:24:07.640720 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.454752, "process_user_time": 1.493469, "process_kernel_time": 0.275166, "process_mem_max_rss": "173817856", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:24:07.641164 [debug] [MainThread]: Command `dbt run` succeeded at 16:24:07.641094 after 6.46 seconds
[0m16:24:07.641430 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1128bf860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1128bef90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121890b90>]}
[0m16:24:07.641661 [debug] [MainThread]: Flushing usage events
[0m03:25:48.937410 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9baa9340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98ffe9c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98ffe780>]}


============================== 03:25:48.941282 | 6ad8e3fb-5166-4b95-ac06-3371c25d64a2 ==============================
[0m03:25:48.941282 [info ] [MainThread]: Running with dbt=1.8.7
[0m03:25:48.941722 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/lab/logs', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/lab', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m03:25:48.943308 [error] [MainThread]: Encountered an error:
Runtime Error
  Could not find profile named 'build_lab2'
[0m03:25:48.944083 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.04798075, "process_user_time": 0.907087, "process_kernel_time": 0.115265, "process_mem_max_rss": "96756", "process_in_blocks": "40", "process_out_blocks": "2", "command_success": false}
[0m03:25:48.944432 [debug] [MainThread]: Command `dbt run` failed at 03:25:48.944384 after 0.05 seconds
[0m03:25:48.944645 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff99cc2690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff992ec5f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff99332e70>]}
[0m03:25:48.944848 [debug] [MainThread]: Flushing usage events
[0m03:31:01.412863 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8ff451c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8dea7d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8d507470>]}


============================== 03:31:01.416926 | b4be098e-0123-4045-9442-16411bbbda26 ==============================
[0m03:31:01.416926 [info ] [MainThread]: Running with dbt=1.8.7
[0m03:31:01.417326 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/lab/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/lab', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m03:31:01.439495 [error] [MainThread]: Encountered an error:
Parsing Error
  Env var required but not provided: 'DBT_ACCOUNT'
[0m03:31:01.440318 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.050503876, "process_user_time": 0.965078, "process_kernel_time": 0.127877, "process_mem_max_rss": "97084", "process_in_blocks": "16", "process_out_blocks": "2202", "command_success": false}
[0m03:31:01.440695 [debug] [MainThread]: Command `dbt run` failed at 03:31:01.440627 after 0.05 seconds
[0m03:31:01.441021 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8ff451c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e013260>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91c10740>]}
[0m03:31:01.441285 [debug] [MainThread]: Flushing usage events
[0m03:32:15.166937 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa2b17260>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa47e6c30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa1d6a360>]}


============================== 03:32:15.171225 | b7502cfc-a206-4475-bec5-9809e71e167c ==============================
[0m03:32:15.171225 [info ] [MainThread]: Running with dbt=1.8.7
[0m03:32:15.172331 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/lab/logs', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/lab', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'send_anonymous_usage_stats': 'True'}
[0m03:32:15.174660 [error] [MainThread]: Encountered an error:
Parsing Error
  Env var required but not provided: 'DBT_ACCOUNT'
[0m03:32:15.175389 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.050153792, "process_user_time": 0.9444, "process_kernel_time": 0.157066, "process_mem_max_rss": "96772", "process_in_blocks": "16", "process_out_blocks": "2", "command_success": false}
[0m03:32:15.175699 [debug] [MainThread]: Command `dbt run` failed at 03:32:15.175644 after 0.05 seconds
[0m03:32:15.175962 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa1dde8d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa1946bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa1d6a360>]}
[0m03:32:15.176326 [debug] [MainThread]: Flushing usage events
[0m03:43:16.331813 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb665fc80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb665f8f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb665e3f0>]}


============================== 03:43:16.338063 | 074bb951-451e-4162-9ed1-0023dd0944ec ==============================
[0m03:43:16.338063 [info ] [MainThread]: Running with dbt=1.8.7
[0m03:43:16.338639 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/opt/airflow/lab', 'log_path': '/opt/airflow/lab/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m03:43:16.965564 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '074bb951-451e-4162-9ed1-0023dd0944ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb5fd93d0>]}
[0m03:43:16.989261 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '074bb951-451e-4162-9ed1-0023dd0944ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa0bf0920>]}
[0m03:43:16.989729 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m03:43:17.038771 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m03:43:17.102985 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m03:43:17.103569 [info ] [MainThread]: Unable to do partial parsing because a project dependency has been added
[0m03:43:17.103897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '074bb951-451e-4162-9ed1-0023dd0944ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95f3faa0>]}
[0m03:43:17.727358 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '074bb951-451e-4162-9ed1-0023dd0944ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95934c80>]}
[0m03:43:17.787198 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '074bb951-451e-4162-9ed1-0023dd0944ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95deaae0>]}
[0m03:43:17.787807 [info ] [MainThread]: Found 3 models, 1 snapshot, 1 test, 2 sources, 459 macros
[0m03:43:17.788559 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '074bb951-451e-4162-9ed1-0023dd0944ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb7110140>]}
[0m03:43:17.790250 [info ] [MainThread]: 
[0m03:43:17.791644 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m03:43:17.794463 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m03:43:17.804998 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m03:43:17.805634 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m03:43:17.806018 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:43:18.600763 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.794 seconds
[0m03:43:18.606204 [debug] [ThreadPool]: On list_dev: Close
[0m03:43:18.754941 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_stock)
[0m03:43:18.764891 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m03:43:18.765424 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m03:43:18.765821 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:43:19.297716 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.532 seconds
[0m03:43:19.303623 [debug] [ThreadPool]: On list_dev_stock: Close
[0m03:43:19.441370 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_stock, now list_dev_snapshot)
[0m03:43:19.445661 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m03:43:19.446368 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m03:43:19.447069 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:43:19.919537 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01b8503f-0004-26b9-0000-000262e7e781
[0m03:43:19.920984 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m03:43:19.921991 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m03:43:19.922651 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m03:43:19.923350 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m03:43:20.103273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '074bb951-451e-4162-9ed1-0023dd0944ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95d8d070>]}
[0m03:43:20.105325 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m03:43:20.108315 [info ] [MainThread]: 
[0m03:43:20.123468 [debug] [Thread-1 (]: Began running node model.lab.RSI_Calculation
[0m03:43:20.124445 [info ] [Thread-1 (]: 1 of 2 START sql table model stock.RSI_Calculation ............................. [RUN]
[0m03:43:20.125585 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_snapshot, now model.lab.RSI_Calculation)
[0m03:43:20.126090 [debug] [Thread-1 (]: Began compiling node model.lab.RSI_Calculation
[0m03:43:20.133833 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.RSI_Calculation"
[0m03:43:20.139332 [debug] [Thread-1 (]: Began executing node model.lab.RSI_Calculation
[0m03:43:20.164038 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.RSI_Calculation"
[0m03:43:20.167397 [debug] [Thread-1 (]: Using snowflake connection "model.lab.RSI_Calculation"
[0m03:43:20.168881 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.RSI_Calculation"} */
create or replace transient table dev.stock.RSI_Calculation
         as
        (-- models/rsi_calculation.sql

WITH PriceChanges AS (
    SELECT
        date,
        symbol,
        close,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM
        dev.stock.stock_price_analysis  -- Replace 'stock' and 'stock_price_analysis' with your actual source name and table
),
PriceGainsLosses AS (
    SELECT
        date,
        symbol,
        close,
        next_close,
        CASE 
            WHEN next_close > close THEN next_close - close
            ELSE 0 
        END AS gain,
        CASE 
            WHEN next_close < close THEN close - next_close
            ELSE 0 
        END AS loss
    FROM
        PriceChanges
),
AverageGainsLosses AS (
    SELECT
        date,
        symbol,
        AVG(gain) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain,
        AVG(loss) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss
    FROM
        PriceGainsLosses
),
RSI_Calculation AS (
    SELECT
        date,
        symbol,
        avg_gain,
        avg_loss,
        CASE 
            WHEN avg_loss = 0 THEN 100
            ELSE 100 - (100 / (1 + (avg_gain / avg_loss)))
        END AS rsi
    FROM
        AverageGainsLosses
)
SELECT 
    date, 
    symbol, 
    rsi
FROM 
    RSI_Calculation
WHERE
    date >= (SELECT MIN(date) FROM dev.stock.stock_price_analysis) + INTERVAL '14 DAY'
ORDER BY
    symbol, date
        );
[0m03:43:20.169165 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:43:22.050335 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.880 seconds
[0m03:43:22.067446 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: Close
[0m03:43:22.211104 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '074bb951-451e-4162-9ed1-0023dd0944ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb6b0a3c0>]}
[0m03:43:22.213350 [info ] [Thread-1 (]: 1 of 2 OK created sql table model stock.RSI_Calculation ........................ [[32mSUCCESS 1[0m in 2.08s]
[0m03:43:22.218426 [debug] [Thread-1 (]: Finished running node model.lab.RSI_Calculation
[0m03:43:22.219467 [debug] [Thread-1 (]: Began running node model.lab.stock_price_analysis
[0m03:43:22.220577 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.RSI_Calculation, now model.lab.stock_price_analysis)
[0m03:43:22.221374 [debug] [Thread-1 (]: Began compiling node model.lab.stock_price_analysis
[0m03:43:22.226245 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.stock_price_analysis"
[0m03:43:22.228891 [debug] [Thread-1 (]: Finished running node model.lab.stock_price_analysis
[0m03:43:22.230628 [debug] [Thread-1 (]: Began running node model.lab.macd_calculation
[0m03:43:22.231238 [info ] [Thread-1 (]: 2 of 2 START sql table model stock.macd_calculation ............................ [RUN]
[0m03:43:22.232078 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.stock_price_analysis, now model.lab.macd_calculation)
[0m03:43:22.232538 [debug] [Thread-1 (]: Began compiling node model.lab.macd_calculation
[0m03:43:22.250965 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.macd_calculation"
[0m03:43:22.252031 [debug] [Thread-1 (]: Began executing node model.lab.macd_calculation
[0m03:43:22.254207 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.macd_calculation"
[0m03:43:22.256455 [debug] [Thread-1 (]: Using snowflake connection "model.lab.macd_calculation"
[0m03:43:22.256826 [debug] [Thread-1 (]: On model.lab.macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.macd_calculation"} */
create or replace transient table dev.stock.macd_calculation
         as
        (WITH  __dbt__cte__stock_price_analysis as (
WITH stock_data AS (
    SELECT
        *
    FROM dev.stock.stock_price_analysis
)

-- Now you can query the CTE
SELECT * FROM stock_data
), stock_data AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE,
        ROW_NUMBER() OVER (PARTITION BY SYMBOL ORDER BY DATE) AS rn
    FROM __dbt__cte__stock_price_analysis  -- Replace with the reference to your actual source table in DBT
),

-- Calculate 12-day EMA
ema_12 AS (
    SELECT
        SYMBOL,
        DATE,
        CLOSE AS EMA_12,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (12 + 1))) + (e.EMA_12 * (1 - (2.0 / (12 + 1)))) AS EMA_12,
        sd.rn
    FROM stock_data sd
    JOIN ema_12 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate 26-day EMA
ema_26 AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE AS EMA_26,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (26 + 1))) + (e.EMA_26 * (1 - (2.0 / (26 + 1)))) AS EMA_26,
        sd.rn
    FROM stock_data sd
    JOIN ema_26 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate MACD by subtracting 26-day EMA from 12-day EMA
macd_calculation AS (
    SELECT 
        e12.SYMBOL,
        e12.DATE,
        e12.EMA_12 - e26.EMA_26 AS MACD,
        e12.rn
    FROM ema_12 e12
    JOIN ema_26 e26 ON e12.SYMBOL = e26.SYMBOL AND e12.DATE = e26.DATE
),

-- Calculate 9-day EMA of MACD as Signal Line
signal_line AS (
    SELECT 
        SYMBOL,
        DATE,
        MACD,
        MACD AS Signal,
        rn
    FROM macd_calculation
    WHERE rn = 1

    UNION ALL

    SELECT 
        mc.SYMBOL,
        mc.DATE,
        mc.MACD,
        (mc.MACD * (2.0 / (9 + 1))) + (sl.Signal * (1 - (2.0 / (9 + 1)))) AS Signal,
        mc.rn
    FROM macd_calculation mc
    JOIN signal_line sl ON mc.SYMBOL = sl.SYMBOL AND mc.rn = sl.rn + 1
)

-- Final output
SELECT 
    SYMBOL,
    DATE,
    MACD,
    Signal,
    MACD - Signal AS Histogram
FROM signal_line
ORDER BY SYMBOL, DATE
        );
[0m03:43:22.257260 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:43:23.954381 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.697 seconds
[0m03:43:23.957072 [debug] [Thread-1 (]: On model.lab.macd_calculation: Close
[0m03:43:24.093721 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '074bb951-451e-4162-9ed1-0023dd0944ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb7804680>]}
[0m03:43:24.095591 [info ] [Thread-1 (]: 2 of 2 OK created sql table model stock.macd_calculation ....................... [[32mSUCCESS 1[0m in 1.86s]
[0m03:43:24.097946 [debug] [Thread-1 (]: Finished running node model.lab.macd_calculation
[0m03:43:24.102010 [debug] [MainThread]: Connection 'master' was properly closed.
[0m03:43:24.102758 [debug] [MainThread]: Connection 'model.lab.macd_calculation' was properly closed.
[0m03:43:24.103622 [info ] [MainThread]: 
[0m03:43:24.105041 [info ] [MainThread]: Finished running 2 table models in 0 hours 0 minutes and 6.31 seconds (6.31s).
[0m03:43:24.106971 [debug] [MainThread]: Command end result
[0m03:43:24.144895 [info ] [MainThread]: 
[0m03:43:24.145383 [info ] [MainThread]: [32mCompleted successfully[0m
[0m03:43:24.145773 [info ] [MainThread]: 
[0m03:43:24.146285 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m03:43:24.148255 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.856779, "process_user_time": 3.082168, "process_kernel_time": 0.705617, "process_mem_max_rss": "213376", "process_in_blocks": "5408", "process_out_blocks": "4305"}
[0m03:43:24.148795 [debug] [MainThread]: Command `dbt run` succeeded at 03:43:24.148737 after 7.86 seconds
[0m03:43:24.149198 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb68c7860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95d86210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb64f2f60>]}
[0m03:43:24.149480 [debug] [MainThread]: Flushing usage events
[0m03:43:26.410970 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87bcd370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86b3bb00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8789ecc0>]}


============================== 03:43:26.414687 | 28e195ab-5843-44f5-b77d-801a8ac153d7 ==============================
[0m03:43:26.414687 [info ] [MainThread]: Running with dbt=1.8.7
[0m03:43:26.415554 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/lab/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/lab', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m03:43:26.876140 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '28e195ab-5843-44f5-b77d-801a8ac153d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6cb38ce0>]}
[0m03:43:26.898278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '28e195ab-5843-44f5-b77d-801a8ac153d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86873bc0>]}
[0m03:43:26.898823 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m03:43:26.945888 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m03:43:27.007217 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m03:43:27.007505 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m03:43:27.029754 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '28e195ab-5843-44f5-b77d-801a8ac153d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6694aed0>]}
[0m03:43:27.088096 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '28e195ab-5843-44f5-b77d-801a8ac153d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff667ee2a0>]}
[0m03:43:27.088446 [info ] [MainThread]: Found 3 models, 1 snapshot, 1 test, 2 sources, 459 macros
[0m03:43:27.088900 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '28e195ab-5843-44f5-b77d-801a8ac153d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff66a9e9f0>]}
[0m03:43:27.089739 [info ] [MainThread]: 
[0m03:43:27.090216 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m03:43:27.092232 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev_snapshot'
[0m03:43:27.100771 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m03:43:27.101017 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m03:43:27.101244 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:43:27.525273 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01b8503f-0004-26b9-0000-000262e7e785
[0m03:43:27.526953 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m03:43:27.528104 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m03:43:27.528816 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m03:43:27.529531 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m03:43:27.683669 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m03:43:27.691740 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m03:43:27.692796 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m03:43:27.693414 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:43:28.223232 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.529 seconds
[0m03:43:28.228561 [debug] [ThreadPool]: On list_dev_stock: Close
[0m03:43:28.349988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '28e195ab-5843-44f5-b77d-801a8ac153d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6694a360>]}
[0m03:43:28.351523 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m03:43:28.352959 [info ] [MainThread]: 
[0m03:43:28.365247 [debug] [Thread-1 (]: Began running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m03:43:28.365862 [info ] [Thread-1 (]: 1 of 1 START test not_null_macd_calculation_date ............................... [RUN]
[0m03:43:28.366649 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now test.lab.not_null_macd_calculation_date.1954e908c9)
[0m03:43:28.367287 [debug] [Thread-1 (]: Began compiling node test.lab.not_null_macd_calculation_date.1954e908c9
[0m03:43:28.381600 [debug] [Thread-1 (]: Writing injected SQL for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m03:43:28.383311 [debug] [Thread-1 (]: Began executing node test.lab.not_null_macd_calculation_date.1954e908c9
[0m03:43:28.396030 [debug] [Thread-1 (]: Writing runtime sql for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m03:43:28.397391 [debug] [Thread-1 (]: Using snowflake connection "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m03:43:28.397700 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "test.lab.not_null_macd_calculation_date.1954e908c9"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from dev.stock.macd_calculation
where date is null



      
    ) dbt_internal_test
[0m03:43:28.397966 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:43:29.204705 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.806 seconds
[0m03:43:29.221891 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: Close
[0m03:43:29.358761 [info ] [Thread-1 (]: 1 of 1 PASS not_null_macd_calculation_date ..................................... [[32mPASS[0m in 0.99s]
[0m03:43:29.361116 [debug] [Thread-1 (]: Finished running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m03:43:29.363831 [debug] [MainThread]: Connection 'master' was properly closed.
[0m03:43:29.364582 [debug] [MainThread]: Connection 'test.lab.not_null_macd_calculation_date.1954e908c9' was properly closed.
[0m03:43:29.365217 [info ] [MainThread]: 
[0m03:43:29.366367 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 2.27 seconds (2.27s).
[0m03:43:29.368052 [debug] [MainThread]: Command end result
[0m03:43:29.401355 [info ] [MainThread]: 
[0m03:43:29.402026 [info ] [MainThread]: [32mCompleted successfully[0m
[0m03:43:29.402577 [info ] [MainThread]: 
[0m03:43:29.403033 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m03:43:29.404122 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.0317273, "process_user_time": 2.321884, "process_kernel_time": 0.203833, "process_mem_max_rss": "208668", "process_out_blocks": "1850", "process_in_blocks": "0"}
[0m03:43:29.404669 [debug] [MainThread]: Command `dbt test` succeeded at 03:43:29.404590 after 3.03 seconds
[0m03:43:29.405020 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff870ec740>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86976db0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86cd2b10>]}
[0m03:43:29.405334 [debug] [MainThread]: Flushing usage events
[0m03:43:31.493390 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8437cce0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8437ff50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87ec19a0>]}


============================== 03:43:31.496959 | ec1d4365-dcd0-43c0-8641-83edba1db2d0 ==============================
[0m03:43:31.496959 [info ] [MainThread]: Running with dbt=1.8.7
[0m03:43:31.497668 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/lab', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/lab/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'send_anonymous_usage_stats': 'True'}
[0m03:43:31.920674 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ec1d4365-dcd0-43c0-8641-83edba1db2d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85293740>]}
[0m03:43:31.943318 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ec1d4365-dcd0-43c0-8641-83edba1db2d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6a42fb30>]}
[0m03:43:31.943767 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m03:43:31.989808 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m03:43:32.065635 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m03:43:32.065958 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m03:43:32.088341 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ec1d4365-dcd0-43c0-8641-83edba1db2d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff68145f10>]}
[0m03:43:32.144550 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ec1d4365-dcd0-43c0-8641-83edba1db2d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff68161ee0>]}
[0m03:43:32.144868 [info ] [MainThread]: Found 3 models, 1 snapshot, 1 test, 2 sources, 459 macros
[0m03:43:32.145536 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ec1d4365-dcd0-43c0-8641-83edba1db2d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff68146990>]}
[0m03:43:32.146359 [info ] [MainThread]: 
[0m03:43:32.146775 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m03:43:32.147337 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m03:43:32.156376 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m03:43:32.156625 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m03:43:32.156816 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:43:32.670077 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.513 seconds
[0m03:43:32.674475 [debug] [ThreadPool]: On list_dev: Close
[0m03:43:32.803380 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now create_dev_snapshot)
[0m03:43:32.805215 [debug] [ThreadPool]: Creating schema "database: "dev"
schema: "snapshot"
"
[0m03:43:32.809093 [debug] [ThreadPool]: Using snowflake connection "create_dev_snapshot"
[0m03:43:32.810001 [debug] [ThreadPool]: On create_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "create_dev_snapshot"} */
create schema if not exists dev.snapshot
[0m03:43:32.810315 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:43:33.297981 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.487 seconds
[0m03:43:33.301342 [debug] [ThreadPool]: On create_dev_snapshot: Close
[0m03:43:33.442074 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_dev_snapshot, now list_dev_snapshot)
[0m03:43:33.454621 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m03:43:33.455354 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m03:43:33.455921 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:43:33.869966 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.414 seconds
[0m03:43:33.874222 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m03:43:33.999127 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m03:43:34.002724 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m03:43:34.003369 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m03:43:34.003873 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:43:34.531278 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.527 seconds
[0m03:43:34.537216 [debug] [ThreadPool]: On list_dev_stock: Close
[0m03:43:34.659618 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ec1d4365-dcd0-43c0-8641-83edba1db2d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff842f64b0>]}
[0m03:43:34.660717 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m03:43:34.662636 [info ] [MainThread]: 
[0m03:43:34.681310 [debug] [Thread-1 (]: Began running node snapshot.lab.snapshot_session_summary
[0m03:43:34.681954 [info ] [Thread-1 (]: 1 of 1 START snapshot snapshot.snapshot_session_summary ........................ [RUN]
[0m03:43:34.682692 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now snapshot.lab.snapshot_session_summary)
[0m03:43:34.683104 [debug] [Thread-1 (]: Began compiling node snapshot.lab.snapshot_session_summary
[0m03:43:34.690358 [debug] [Thread-1 (]: Began executing node snapshot.lab.snapshot_session_summary
[0m03:43:34.730368 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_session_summary"
[0m03:43:34.730644 [debug] [Thread-1 (]: On snapshot.lab.snapshot_session_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_session_summary"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_session_summary"} */
select * from (
        
    

    select *,
        md5(coalesce(cast(date as varchar ), '')
         || '|' || coalesce(cast(ts as varchar ), '')
        ) as dbt_scd_id,
        ts as dbt_updated_at,
        ts as dbt_valid_from,
        
  
  coalesce(nullif(ts, ts), null)
  as dbt_valid_to

    from (
        

SELECT * FROM dev.stock.macd_calculation
    ) sbq



    ) as __dbt_sbq
    where false
    limit 0
[0m03:43:34.730883 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:43:35.145675 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b8503f-0004-26b2-0000-000262e7a8f9
[0m03:43:35.146254 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 7 at position 33
invalid identifier 'TS'
[0m03:43:35.146712 [debug] [Thread-1 (]: On snapshot.lab.snapshot_session_summary: Close
[0m03:43:35.260477 [debug] [Thread-1 (]: Database Error in snapshot snapshot_session_summary (snapshots/snapshot.macd_calculation.sql)
  000904 (42000): SQL compilation error: error line 7 at position 33
  invalid identifier 'TS'
[0m03:43:35.261914 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ec1d4365-dcd0-43c0-8641-83edba1db2d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84ada270>]}
[0m03:43:35.262741 [error] [Thread-1 (]: 1 of 1 ERROR snapshotting snapshot.snapshot_session_summary .................... [[31mERROR[0m in 0.58s]
[0m03:43:35.263750 [debug] [Thread-1 (]: Finished running node snapshot.lab.snapshot_session_summary
[0m03:43:35.266384 [debug] [MainThread]: Connection 'master' was properly closed.
[0m03:43:35.266699 [debug] [MainThread]: Connection 'snapshot.lab.snapshot_session_summary' was properly closed.
[0m03:43:35.267029 [info ] [MainThread]: 
[0m03:43:35.267480 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 3.12 seconds (3.12s).
[0m03:43:35.268237 [debug] [MainThread]: Command end result
[0m03:43:35.289137 [info ] [MainThread]: 
[0m03:43:35.289576 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m03:43:35.289889 [info ] [MainThread]: 
[0m03:43:35.290213 [error] [MainThread]:   Database Error in snapshot snapshot_session_summary (snapshots/snapshot.macd_calculation.sql)
  000904 (42000): SQL compilation error: error line 7 at position 33
  invalid identifier 'TS'
[0m03:43:35.290471 [info ] [MainThread]: 
[0m03:43:35.290736 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m03:43:35.291690 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 3.843014, "process_user_time": 2.437695, "process_kernel_time": 0.219603, "process_mem_max_rss": "206624", "process_out_blocks": "1852", "command_success": false, "process_in_blocks": "0"}
[0m03:43:35.292052 [debug] [MainThread]: Command `dbt snapshot` failed at 03:43:35.292008 after 3.84 seconds
[0m03:43:35.292339 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff841c36e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff682bbef0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff63e57c80>]}
[0m03:43:35.292555 [debug] [MainThread]: Flushing usage events
[0m04:04:14.177585 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa2e770b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa337c7a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa391acf0>]}


============================== 04:04:14.181382 | 4f4237cc-1342-455f-95bb-112abdccc265 ==============================
[0m04:04:14.181382 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:04:14.181757 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/lab/logs', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/lab', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'send_anonymous_usage_stats': 'True'}
[0m04:04:14.680677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4f4237cc-1342-455f-95bb-112abdccc265', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8c5a4a10>]}
[0m04:04:14.702703 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4f4237cc-1342-455f-95bb-112abdccc265', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa2e290d0>]}
[0m04:04:14.703163 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:04:14.751017 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:04:14.817982 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:04:14.818311 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:04:14.840593 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4f4237cc-1342-455f-95bb-112abdccc265', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8295eed0>]}
[0m04:04:14.892210 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4f4237cc-1342-455f-95bb-112abdccc265', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8264ffb0>]}
[0m04:04:14.892517 [info ] [MainThread]: Found 3 models, 1 snapshot, 1 test, 2 sources, 459 macros
[0m04:04:14.892786 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4f4237cc-1342-455f-95bb-112abdccc265', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa3902000>]}
[0m04:04:14.893690 [info ] [MainThread]: 
[0m04:04:14.894172 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:04:14.896342 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m04:04:14.903121 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m04:04:14.903349 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m04:04:14.903543 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:04:15.823772 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.920 seconds
[0m04:04:15.827438 [debug] [ThreadPool]: On list_dev: Close
[0m04:04:15.958479 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev_stock'
[0m04:04:15.966380 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m04:04:15.966766 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m04:04:15.967059 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:04:16.594433 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.627 seconds
[0m04:04:16.599383 [debug] [ThreadPool]: On list_dev_stock: Close
[0m04:04:16.741374 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_stock, now list_dev_snapshot)
[0m04:04:16.748576 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m04:04:16.749471 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m04:04:16.750215 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:04:17.180624 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.430 seconds
[0m04:04:17.184732 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m04:04:17.311106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4f4237cc-1342-455f-95bb-112abdccc265', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa2a234a0>]}
[0m04:04:17.312845 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:04:17.315080 [info ] [MainThread]: 
[0m04:04:17.329704 [debug] [Thread-1 (]: Began running node model.lab.RSI_Calculation
[0m04:04:17.330546 [info ] [Thread-1 (]: 1 of 2 START sql table model stock.RSI_Calculation ............................. [RUN]
[0m04:04:17.331415 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_snapshot, now model.lab.RSI_Calculation)
[0m04:04:17.331900 [debug] [Thread-1 (]: Began compiling node model.lab.RSI_Calculation
[0m04:04:17.338731 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.RSI_Calculation"
[0m04:04:17.341150 [debug] [Thread-1 (]: Began executing node model.lab.RSI_Calculation
[0m04:04:17.360833 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.RSI_Calculation"
[0m04:04:17.362578 [debug] [Thread-1 (]: Using snowflake connection "model.lab.RSI_Calculation"
[0m04:04:17.362902 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.RSI_Calculation"} */
create or replace transient table dev.stock.RSI_Calculation
         as
        (-- models/rsi_calculation.sql

WITH PriceChanges AS (
    SELECT
        date,
        symbol,
        close,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM
        dev.stock.stock_price_analysis  -- Replace 'stock' and 'stock_price_analysis' with your actual source name and table
),
PriceGainsLosses AS (
    SELECT
        date,
        symbol,
        close,
        next_close,
        CASE 
            WHEN next_close > close THEN next_close - close
            ELSE 0 
        END AS gain,
        CASE 
            WHEN next_close < close THEN close - next_close
            ELSE 0 
        END AS loss
    FROM
        PriceChanges
),
AverageGainsLosses AS (
    SELECT
        date,
        symbol,
        AVG(gain) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain,
        AVG(loss) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss
    FROM
        PriceGainsLosses
),
RSI_Calculation AS (
    SELECT
        date,
        symbol,
        avg_gain,
        avg_loss,
        CASE 
            WHEN avg_loss = 0 THEN 100
            ELSE 100 - (100 / (1 + (avg_gain / avg_loss)))
        END AS rsi
    FROM
        AverageGainsLosses
)
SELECT 
    date, 
    symbol, 
    rsi
FROM 
    RSI_Calculation
WHERE
    date >= (SELECT MIN(date) FROM dev.stock.stock_price_analysis) + INTERVAL '14 DAY'
ORDER BY
    symbol, date
        );
[0m04:04:17.363176 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:04:19.417654 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.054 seconds
[0m04:04:19.441802 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: Close
[0m04:04:19.582367 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f4237cc-1342-455f-95bb-112abdccc265', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa33271a0>]}
[0m04:04:19.583995 [info ] [Thread-1 (]: 1 of 2 OK created sql table model stock.RSI_Calculation ........................ [[32mSUCCESS 1[0m in 2.25s]
[0m04:04:19.586676 [debug] [Thread-1 (]: Finished running node model.lab.RSI_Calculation
[0m04:04:19.587745 [debug] [Thread-1 (]: Began running node model.lab.stock_price_analysis
[0m04:04:19.588634 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.RSI_Calculation, now model.lab.stock_price_analysis)
[0m04:04:19.589268 [debug] [Thread-1 (]: Began compiling node model.lab.stock_price_analysis
[0m04:04:19.592749 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.stock_price_analysis"
[0m04:04:19.594761 [debug] [Thread-1 (]: Finished running node model.lab.stock_price_analysis
[0m04:04:19.595908 [debug] [Thread-1 (]: Began running node model.lab.macd_calculation
[0m04:04:19.596534 [info ] [Thread-1 (]: 2 of 2 START sql table model stock.macd_calculation ............................ [RUN]
[0m04:04:19.597766 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.stock_price_analysis, now model.lab.macd_calculation)
[0m04:04:19.598210 [debug] [Thread-1 (]: Began compiling node model.lab.macd_calculation
[0m04:04:19.617148 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.macd_calculation"
[0m04:04:19.618241 [debug] [Thread-1 (]: Began executing node model.lab.macd_calculation
[0m04:04:19.620261 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.macd_calculation"
[0m04:04:19.622146 [debug] [Thread-1 (]: Using snowflake connection "model.lab.macd_calculation"
[0m04:04:19.622472 [debug] [Thread-1 (]: On model.lab.macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.macd_calculation"} */
create or replace transient table dev.stock.macd_calculation
         as
        (WITH  __dbt__cte__stock_price_analysis as (
WITH stock_data AS (
    SELECT
        *
    FROM dev.stock.stock_price_analysis
)

-- Now you can query the CTE
SELECT * FROM stock_data
), stock_data AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE,
        ROW_NUMBER() OVER (PARTITION BY SYMBOL ORDER BY DATE) AS rn
    FROM __dbt__cte__stock_price_analysis  -- Replace with the reference to your actual source table in DBT
),

-- Calculate 12-day EMA
ema_12 AS (
    SELECT
        SYMBOL,
        DATE,
        CLOSE AS EMA_12,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (12 + 1))) + (e.EMA_12 * (1 - (2.0 / (12 + 1)))) AS EMA_12,
        sd.rn
    FROM stock_data sd
    JOIN ema_12 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate 26-day EMA
ema_26 AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE AS EMA_26,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (26 + 1))) + (e.EMA_26 * (1 - (2.0 / (26 + 1)))) AS EMA_26,
        sd.rn
    FROM stock_data sd
    JOIN ema_26 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate MACD by subtracting 26-day EMA from 12-day EMA
macd_calculation AS (
    SELECT 
        e12.SYMBOL,
        e12.DATE,
        e12.EMA_12 - e26.EMA_26 AS MACD,
        e12.rn
    FROM ema_12 e12
    JOIN ema_26 e26 ON e12.SYMBOL = e26.SYMBOL AND e12.DATE = e26.DATE
),

-- Calculate 9-day EMA of MACD as Signal Line
signal_line AS (
    SELECT 
        SYMBOL,
        DATE,
        MACD,
        MACD AS Signal,
        rn
    FROM macd_calculation
    WHERE rn = 1

    UNION ALL

    SELECT 
        mc.SYMBOL,
        mc.DATE,
        mc.MACD,
        (mc.MACD * (2.0 / (9 + 1))) + (sl.Signal * (1 - (2.0 / (9 + 1)))) AS Signal,
        mc.rn
    FROM macd_calculation mc
    JOIN signal_line sl ON mc.SYMBOL = sl.SYMBOL AND mc.rn = sl.rn + 1
)

-- Final output
SELECT 
    SYMBOL,
    DATE,
    MACD,
    Signal,
    MACD - Signal AS Histogram
FROM signal_line
ORDER BY SYMBOL, DATE
        );
[0m04:04:19.622854 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:04:21.672852 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.050 seconds
[0m04:04:21.678725 [debug] [Thread-1 (]: On model.lab.macd_calculation: Close
[0m04:04:21.810425 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f4237cc-1342-455f-95bb-112abdccc265', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff826bcb00>]}
[0m04:04:21.812748 [info ] [Thread-1 (]: 2 of 2 OK created sql table model stock.macd_calculation ....................... [[32mSUCCESS 1[0m in 2.21s]
[0m04:04:21.816158 [debug] [Thread-1 (]: Finished running node model.lab.macd_calculation
[0m04:04:21.819421 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:04:21.820242 [debug] [MainThread]: Connection 'list_dev' was properly closed.
[0m04:04:21.820885 [debug] [MainThread]: Connection 'model.lab.macd_calculation' was properly closed.
[0m04:04:21.821728 [info ] [MainThread]: 
[0m04:04:21.822543 [info ] [MainThread]: Finished running 2 table models in 0 hours 0 minutes and 6.93 seconds (6.93s).
[0m04:04:21.824520 [debug] [MainThread]: Command end result
[0m04:04:21.855328 [info ] [MainThread]: 
[0m04:04:21.856009 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:04:21.856412 [info ] [MainThread]: 
[0m04:04:21.856836 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m04:04:21.858254 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.702643, "process_user_time": 2.691403, "process_kernel_time": 0.313878, "process_mem_max_rss": "207668", "process_out_blocks": "5573", "process_in_blocks": "0"}
[0m04:04:21.858724 [debug] [MainThread]: Command `dbt run` succeeded at 04:04:21.858663 after 7.70 seconds
[0m04:04:21.859062 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa2bdb140>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa2bdb020>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82a8ba70>]}
[0m04:04:21.859355 [debug] [MainThread]: Flushing usage events
[0m04:04:24.094804 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91679670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91ce8680>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9250df70>]}


============================== 04:04:24.098497 | ed0e8137-aedc-4794-be98-303e69274eba ==============================
[0m04:04:24.098497 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:04:24.099174 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/lab', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/lab/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m04:04:24.557563 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ed0e8137-aedc-4794-be98-303e69274eba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff911a9430>]}
[0m04:04:24.579899 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ed0e8137-aedc-4794-be98-303e69274eba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff76328290>]}
[0m04:04:24.580377 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:04:24.623144 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:04:24.685366 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:04:24.685678 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:04:24.708653 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ed0e8137-aedc-4794-be98-303e69274eba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff754a3650>]}
[0m04:04:24.770641 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ed0e8137-aedc-4794-be98-303e69274eba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff753262a0>]}
[0m04:04:24.770966 [info ] [MainThread]: Found 3 models, 1 snapshot, 1 test, 2 sources, 459 macros
[0m04:04:24.771460 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ed0e8137-aedc-4794-be98-303e69274eba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff766eea80>]}
[0m04:04:24.772256 [info ] [MainThread]: 
[0m04:04:24.772711 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:04:24.774792 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev_snapshot'
[0m04:04:24.783327 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m04:04:24.783606 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m04:04:24.783854 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:04:25.298203 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.514 seconds
[0m04:04:25.302378 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m04:04:25.428693 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m04:04:25.434361 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m04:04:25.436133 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m04:04:25.437646 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:04:26.279858 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.842 seconds
[0m04:04:26.286409 [debug] [ThreadPool]: On list_dev_stock: Close
[0m04:04:26.433867 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ed0e8137-aedc-4794-be98-303e69274eba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff74db1190>]}
[0m04:04:26.437218 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:04:26.439731 [info ] [MainThread]: 
[0m04:04:26.454591 [debug] [Thread-1 (]: Began running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:04:26.455376 [info ] [Thread-1 (]: 1 of 1 START test not_null_macd_calculation_date ............................... [RUN]
[0m04:04:26.456429 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now test.lab.not_null_macd_calculation_date.1954e908c9)
[0m04:04:26.456938 [debug] [Thread-1 (]: Began compiling node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:04:26.474907 [debug] [Thread-1 (]: Writing injected SQL for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m04:04:26.476243 [debug] [Thread-1 (]: Began executing node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:04:26.488892 [debug] [Thread-1 (]: Writing runtime sql for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m04:04:26.490156 [debug] [Thread-1 (]: Using snowflake connection "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m04:04:26.490466 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "test.lab.not_null_macd_calculation_date.1954e908c9"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from dev.stock.macd_calculation
where date is null



      
    ) dbt_internal_test
[0m04:04:26.490750 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:04:27.021747 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.531 seconds
[0m04:04:27.038004 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: Close
[0m04:04:27.174505 [info ] [Thread-1 (]: 1 of 1 PASS not_null_macd_calculation_date ..................................... [[32mPASS[0m in 0.72s]
[0m04:04:27.176842 [debug] [Thread-1 (]: Finished running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:04:27.179266 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:04:27.179974 [debug] [MainThread]: Connection 'test.lab.not_null_macd_calculation_date.1954e908c9' was properly closed.
[0m04:04:27.180625 [info ] [MainThread]: 
[0m04:04:27.181620 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 2.41 seconds (2.41s).
[0m04:04:27.182819 [debug] [MainThread]: Command end result
[0m04:04:27.216225 [info ] [MainThread]: 
[0m04:04:27.216756 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:04:27.217177 [info ] [MainThread]: 
[0m04:04:27.217581 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m04:04:27.218568 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.1621096, "process_user_time": 2.339353, "process_kernel_time": 0.229487, "process_mem_max_rss": "208152", "process_out_blocks": "1849", "process_in_blocks": "0"}
[0m04:04:27.218996 [debug] [MainThread]: Command `dbt test` succeeded at 04:04:27.218933 after 3.16 seconds
[0m04:04:27.219315 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff92615220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9155b920>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91559430>]}
[0m04:04:27.219629 [debug] [MainThread]: Flushing usage events
[0m04:04:29.010097 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98033da0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98f73ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98033dd0>]}


============================== 04:04:29.013562 | 8db612c1-6ca2-4019-9b3e-ca3447a9316d ==============================
[0m04:04:29.013562 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:04:29.014176 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/lab', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/lab/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m04:04:29.392975 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8db612c1-6ca2-4019-9b3e-ca3447a9316d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff988b3230>]}
[0m04:04:29.414885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8db612c1-6ca2-4019-9b3e-ca3447a9316d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7cab1d60>]}
[0m04:04:29.415335 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:04:29.458373 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:04:29.521189 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:04:29.521522 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:04:29.548920 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8db612c1-6ca2-4019-9b3e-ca3447a9316d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff77f3de50>]}
[0m04:04:29.606735 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8db612c1-6ca2-4019-9b3e-ca3447a9316d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff77d47590>]}
[0m04:04:29.607103 [info ] [MainThread]: Found 3 models, 1 snapshot, 1 test, 2 sources, 459 macros
[0m04:04:29.607561 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8db612c1-6ca2-4019-9b3e-ca3447a9316d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e316480>]}
[0m04:04:29.608557 [info ] [MainThread]: 
[0m04:04:29.609019 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:04:29.609564 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m04:04:29.616694 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m04:04:29.616932 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m04:04:29.617125 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:04:30.210485 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.593 seconds
[0m04:04:30.214779 [debug] [ThreadPool]: On list_dev: Close
[0m04:04:30.392068 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_snapshot)
[0m04:04:30.402762 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m04:04:30.403251 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m04:04:30.403627 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:04:30.883619 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.480 seconds
[0m04:04:30.885102 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m04:04:31.011936 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m04:04:31.014199 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m04:04:31.014535 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m04:04:31.014863 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:04:31.477600 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.462 seconds
[0m04:04:31.482107 [debug] [ThreadPool]: On list_dev_stock: Close
[0m04:04:31.612202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8db612c1-6ca2-4019-9b3e-ca3447a9316d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff77c60fe0>]}
[0m04:04:31.613671 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:04:31.616491 [info ] [MainThread]: 
[0m04:04:31.630953 [debug] [Thread-1 (]: Began running node snapshot.lab.snapshot_session_summary
[0m04:04:31.631746 [info ] [Thread-1 (]: 1 of 1 START snapshot snapshot.snapshot_session_summary ........................ [RUN]
[0m04:04:31.632647 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now snapshot.lab.snapshot_session_summary)
[0m04:04:31.633137 [debug] [Thread-1 (]: Began compiling node snapshot.lab.snapshot_session_summary
[0m04:04:31.640360 [debug] [Thread-1 (]: Began executing node snapshot.lab.snapshot_session_summary
[0m04:04:31.683461 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_session_summary"
[0m04:04:31.683760 [debug] [Thread-1 (]: On snapshot.lab.snapshot_session_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_session_summary"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_session_summary"} */
select * from (
        
    

    select *,
        md5(coalesce(cast(date as varchar ), '')
         || '|' || coalesce(cast(ts as varchar ), '')
        ) as dbt_scd_id,
        ts as dbt_updated_at,
        ts as dbt_valid_from,
        
  
  coalesce(nullif(ts, ts), null)
  as dbt_valid_to

    from (
        

SELECT * FROM dev.stock.macd_calculation
    ) sbq



    ) as __dbt_sbq
    where false
    limit 0
[0m04:04:31.684037 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:04:32.166732 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b85054-0004-26b2-0000-000262e7a919
[0m04:04:32.169776 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 7 at position 33
invalid identifier 'TS'
[0m04:04:32.171018 [debug] [Thread-1 (]: On snapshot.lab.snapshot_session_summary: Close
[0m04:04:32.315380 [debug] [Thread-1 (]: Database Error in snapshot snapshot_session_summary (snapshots/snapshot.macd_calculation.sql)
  000904 (42000): SQL compilation error: error line 7 at position 33
  invalid identifier 'TS'
[0m04:04:32.319081 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8db612c1-6ca2-4019-9b3e-ca3447a9316d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9883e060>]}
[0m04:04:32.320556 [error] [Thread-1 (]: 1 of 1 ERROR snapshotting snapshot.snapshot_session_summary .................... [[31mERROR[0m in 0.68s]
[0m04:04:32.322713 [debug] [Thread-1 (]: Finished running node snapshot.lab.snapshot_session_summary
[0m04:04:32.326277 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:04:32.326806 [debug] [MainThread]: Connection 'snapshot.lab.snapshot_session_summary' was properly closed.
[0m04:04:32.327238 [info ] [MainThread]: 
[0m04:04:32.328035 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 2.72 seconds (2.72s).
[0m04:04:32.329184 [debug] [MainThread]: Command end result
[0m04:04:32.361197 [info ] [MainThread]: 
[0m04:04:32.362037 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m04:04:32.362350 [info ] [MainThread]: 
[0m04:04:32.362801 [error] [MainThread]:   Database Error in snapshot snapshot_session_summary (snapshots/snapshot.macd_calculation.sql)
  000904 (42000): SQL compilation error: error line 7 at position 33
  invalid identifier 'TS'
[0m04:04:32.363152 [info ] [MainThread]: 
[0m04:04:32.363618 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m04:04:32.364949 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 3.3939102, "process_user_time": 2.339308, "process_kernel_time": 0.140258, "process_mem_max_rss": "206752", "process_out_blocks": "1851", "command_success": false, "process_in_blocks": "0"}
[0m04:04:32.365377 [debug] [MainThread]: Command `dbt snapshot` failed at 04:04:32.365319 after 3.39 seconds
[0m04:04:32.365727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9c80aa20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d934620>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff989d5c70>]}
[0m04:04:32.365997 [debug] [MainThread]: Flushing usage events
[0m04:10:05.127499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffae626ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb0609730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaede9040>]}


============================== 04:10:05.133064 | dec50c18-c383-4fb9-bc6a-effb169be7fd ==============================
[0m04:10:05.133064 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:10:05.136095 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/lab/logs', 'profiles_dir': '/opt/airflow/lab', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m04:10:05.634631 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dec50c18-c383-4fb9-bc6a-effb169be7fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff941503b0>]}
[0m04:10:05.657019 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dec50c18-c383-4fb9-bc6a-effb169be7fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaec36db0>]}
[0m04:10:05.657542 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:10:05.705239 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:10:05.770940 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:10:05.771255 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:10:05.793553 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dec50c18-c383-4fb9-bc6a-effb169be7fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff97f10f80>]}
[0m04:10:05.847483 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dec50c18-c383-4fb9-bc6a-effb169be7fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e0bc0b0>]}
[0m04:10:05.847783 [info ] [MainThread]: Found 3 models, 1 snapshot, 1 test, 2 sources, 459 macros
[0m04:10:05.848231 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dec50c18-c383-4fb9-bc6a-effb169be7fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8ef07440>]}
[0m04:10:05.849124 [info ] [MainThread]: 
[0m04:10:05.849813 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:10:05.852895 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m04:10:05.860172 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m04:10:05.860499 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m04:10:05.860831 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:10:06.865944 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 1.005 seconds
[0m04:10:06.870490 [debug] [ThreadPool]: On list_dev: Close
[0m04:10:07.000938 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_snapshot)
[0m04:10:07.013592 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m04:10:07.014135 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m04:10:07.014602 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:10:07.558272 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.543 seconds
[0m04:10:07.562695 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m04:10:07.705167 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m04:10:07.707749 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m04:10:07.708272 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m04:10:07.708785 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:10:08.252997 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.544 seconds
[0m04:10:08.256489 [debug] [ThreadPool]: On list_dev_stock: Close
[0m04:10:08.383973 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dec50c18-c383-4fb9-bc6a-effb169be7fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e482300>]}
[0m04:10:08.385681 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:10:08.388375 [info ] [MainThread]: 
[0m04:10:08.405097 [debug] [Thread-1 (]: Began running node model.lab.RSI_Calculation
[0m04:10:08.406029 [info ] [Thread-1 (]: 1 of 2 START sql table model stock.RSI_Calculation ............................. [RUN]
[0m04:10:08.407206 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now model.lab.RSI_Calculation)
[0m04:10:08.407750 [debug] [Thread-1 (]: Began compiling node model.lab.RSI_Calculation
[0m04:10:08.415721 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.RSI_Calculation"
[0m04:10:08.418170 [debug] [Thread-1 (]: Began executing node model.lab.RSI_Calculation
[0m04:10:08.438590 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.RSI_Calculation"
[0m04:10:08.440589 [debug] [Thread-1 (]: Using snowflake connection "model.lab.RSI_Calculation"
[0m04:10:08.440959 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.RSI_Calculation"} */
create or replace transient table dev.stock.RSI_Calculation
         as
        (-- models/rsi_calculation.sql

WITH PriceChanges AS (
    SELECT
        date,
        symbol,
        close,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM
        dev.stock.stock_price_analysis  -- Replace 'stock' and 'stock_price_analysis' with your actual source name and table
),
PriceGainsLosses AS (
    SELECT
        date,
        symbol,
        close,
        next_close,
        CASE 
            WHEN next_close > close THEN next_close - close
            ELSE 0 
        END AS gain,
        CASE 
            WHEN next_close < close THEN close - next_close
            ELSE 0 
        END AS loss
    FROM
        PriceChanges
),
AverageGainsLosses AS (
    SELECT
        date,
        symbol,
        AVG(gain) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain,
        AVG(loss) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss
    FROM
        PriceGainsLosses
),
RSI_Calculation AS (
    SELECT
        date,
        symbol,
        avg_gain,
        avg_loss,
        CASE 
            WHEN avg_loss = 0 THEN 100
            ELSE 100 - (100 / (1 + (avg_gain / avg_loss)))
        END AS rsi
    FROM
        AverageGainsLosses
)
SELECT 
    date, 
    symbol, 
    rsi
FROM 
    RSI_Calculation
WHERE
    date >= (SELECT MIN(date) FROM dev.stock.stock_price_analysis) + INTERVAL '14 DAY'
ORDER BY
    symbol, date
        );
[0m04:10:08.441283 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:10:10.228368 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.787 seconds
[0m04:10:10.252677 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: Close
[0m04:10:10.381629 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dec50c18-c383-4fb9-bc6a-effb169be7fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaed72b10>]}
[0m04:10:10.383607 [info ] [Thread-1 (]: 1 of 2 OK created sql table model stock.RSI_Calculation ........................ [[32mSUCCESS 1[0m in 1.97s]
[0m04:10:10.385798 [debug] [Thread-1 (]: Finished running node model.lab.RSI_Calculation
[0m04:10:10.386571 [debug] [Thread-1 (]: Began running node model.lab.stock_price_analysis
[0m04:10:10.387510 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.RSI_Calculation, now model.lab.stock_price_analysis)
[0m04:10:10.388268 [debug] [Thread-1 (]: Began compiling node model.lab.stock_price_analysis
[0m04:10:10.391931 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.stock_price_analysis"
[0m04:10:10.394647 [debug] [Thread-1 (]: Finished running node model.lab.stock_price_analysis
[0m04:10:10.395947 [debug] [Thread-1 (]: Began running node model.lab.macd_calculation
[0m04:10:10.396608 [info ] [Thread-1 (]: 2 of 2 START sql table model stock.macd_calculation ............................ [RUN]
[0m04:10:10.397887 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.stock_price_analysis, now model.lab.macd_calculation)
[0m04:10:10.398392 [debug] [Thread-1 (]: Began compiling node model.lab.macd_calculation
[0m04:10:10.418029 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.macd_calculation"
[0m04:10:10.419245 [debug] [Thread-1 (]: Began executing node model.lab.macd_calculation
[0m04:10:10.421376 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.macd_calculation"
[0m04:10:10.423487 [debug] [Thread-1 (]: Using snowflake connection "model.lab.macd_calculation"
[0m04:10:10.423916 [debug] [Thread-1 (]: On model.lab.macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.macd_calculation"} */
create or replace transient table dev.stock.macd_calculation
         as
        (WITH  __dbt__cte__stock_price_analysis as (
WITH stock_data AS (
    SELECT
        *
    FROM dev.stock.stock_price_analysis
)

-- Now you can query the CTE
SELECT * FROM stock_data
), stock_data AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE,
        ROW_NUMBER() OVER (PARTITION BY SYMBOL ORDER BY DATE) AS rn
    FROM __dbt__cte__stock_price_analysis  -- Replace with the reference to your actual source table in DBT
),

-- Calculate 12-day EMA
ema_12 AS (
    SELECT
        SYMBOL,
        DATE,
        CLOSE AS EMA_12,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (12 + 1))) + (e.EMA_12 * (1 - (2.0 / (12 + 1)))) AS EMA_12,
        sd.rn
    FROM stock_data sd
    JOIN ema_12 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate 26-day EMA
ema_26 AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE AS EMA_26,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (26 + 1))) + (e.EMA_26 * (1 - (2.0 / (26 + 1)))) AS EMA_26,
        sd.rn
    FROM stock_data sd
    JOIN ema_26 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate MACD by subtracting 26-day EMA from 12-day EMA
macd_calculation AS (
    SELECT 
        e12.SYMBOL,
        e12.DATE,
        e12.EMA_12 - e26.EMA_26 AS MACD,
        e12.rn
    FROM ema_12 e12
    JOIN ema_26 e26 ON e12.SYMBOL = e26.SYMBOL AND e12.DATE = e26.DATE
),

-- Calculate 9-day EMA of MACD as Signal Line
signal_line AS (
    SELECT 
        SYMBOL,
        DATE,
        MACD,
        MACD AS Signal,
        rn
    FROM macd_calculation
    WHERE rn = 1

    UNION ALL

    SELECT 
        mc.SYMBOL,
        mc.DATE,
        mc.MACD,
        (mc.MACD * (2.0 / (9 + 1))) + (sl.Signal * (1 - (2.0 / (9 + 1)))) AS Signal,
        mc.rn
    FROM macd_calculation mc
    JOIN signal_line sl ON mc.SYMBOL = sl.SYMBOL AND mc.rn = sl.rn + 1
)

-- Final output
SELECT 
    SYMBOL,
    DATE,
    MACD,
    Signal,
    MACD - Signal AS Histogram
FROM signal_line
ORDER BY SYMBOL, DATE
        );
[0m04:10:10.424395 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:10:12.294184 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.869 seconds
[0m04:10:12.298679 [debug] [Thread-1 (]: On model.lab.macd_calculation: Close
[0m04:10:12.431629 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dec50c18-c383-4fb9-bc6a-effb169be7fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffafa70da0>]}
[0m04:10:12.434108 [info ] [Thread-1 (]: 2 of 2 OK created sql table model stock.macd_calculation ....................... [[32mSUCCESS 1[0m in 2.03s]
[0m04:10:12.436887 [debug] [Thread-1 (]: Finished running node model.lab.macd_calculation
[0m04:10:12.440659 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:10:12.441516 [debug] [MainThread]: Connection 'model.lab.macd_calculation' was properly closed.
[0m04:10:12.442293 [info ] [MainThread]: 
[0m04:10:12.443512 [info ] [MainThread]: Finished running 2 table models in 0 hours 0 minutes and 6.59 seconds (6.59s).
[0m04:10:12.445404 [debug] [MainThread]: Command end result
[0m04:10:12.481618 [info ] [MainThread]: 
[0m04:10:12.482180 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:10:12.482651 [info ] [MainThread]: 
[0m04:10:12.483102 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m04:10:12.484241 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.383564, "process_user_time": 2.633145, "process_kernel_time": 0.338045, "process_mem_max_rss": "207680", "process_out_blocks": "5572", "process_in_blocks": "0"}
[0m04:10:12.484663 [debug] [MainThread]: Command `dbt run` succeeded at 04:10:12.484599 after 7.38 seconds
[0m04:10:12.484951 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf2e15b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffae8c7ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e541790>]}
[0m04:10:12.485232 [debug] [MainThread]: Flushing usage events
[0m04:10:14.904712 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff92e09df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff919da630>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff936ac470>]}


============================== 04:10:14.908605 | 0fb19861-cb48-4224-8ee6-c03e53a9b2f3 ==============================
[0m04:10:14.908605 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:10:14.909277 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/lab', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/lab/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'send_anonymous_usage_stats': 'True'}
[0m04:10:15.357304 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0fb19861-cb48-4224-8ee6-c03e53a9b2f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff74ff8440>]}
[0m04:10:15.379565 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0fb19861-cb48-4224-8ee6-c03e53a9b2f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff759e8860>]}
[0m04:10:15.380051 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:10:15.424312 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:10:15.504257 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:10:15.504732 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:10:15.532248 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0fb19861-cb48-4224-8ee6-c03e53a9b2f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff74c25fa0>]}
[0m04:10:15.595715 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0fb19861-cb48-4224-8ee6-c03e53a9b2f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff746be1e0>]}
[0m04:10:15.596061 [info ] [MainThread]: Found 3 models, 1 snapshot, 1 test, 2 sources, 459 macros
[0m04:10:15.596563 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0fb19861-cb48-4224-8ee6-c03e53a9b2f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff749290a0>]}
[0m04:10:15.597418 [info ] [MainThread]: 
[0m04:10:15.597883 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:10:15.599882 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev_snapshot'
[0m04:10:15.610343 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m04:10:15.610688 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m04:10:15.610938 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:10:16.147251 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.536 seconds
[0m04:10:16.150480 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m04:10:16.292045 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m04:10:16.297760 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m04:10:16.298587 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m04:10:16.299168 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:10:16.965475 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.666 seconds
[0m04:10:16.968858 [debug] [ThreadPool]: On list_dev_stock: Close
[0m04:10:17.141879 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0fb19861-cb48-4224-8ee6-c03e53a9b2f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff748fecf0>]}
[0m04:10:17.143886 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:10:17.146586 [info ] [MainThread]: 
[0m04:10:17.161329 [debug] [Thread-1 (]: Began running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:10:17.162131 [info ] [Thread-1 (]: 1 of 1 START test not_null_macd_calculation_date ............................... [RUN]
[0m04:10:17.163248 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now test.lab.not_null_macd_calculation_date.1954e908c9)
[0m04:10:17.163812 [debug] [Thread-1 (]: Began compiling node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:10:17.178384 [debug] [Thread-1 (]: Writing injected SQL for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m04:10:17.179870 [debug] [Thread-1 (]: Began executing node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:10:17.193569 [debug] [Thread-1 (]: Writing runtime sql for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m04:10:17.194857 [debug] [Thread-1 (]: Using snowflake connection "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m04:10:17.195185 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "test.lab.not_null_macd_calculation_date.1954e908c9"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from dev.stock.macd_calculation
where date is null



      
    ) dbt_internal_test
[0m04:10:17.195551 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:10:17.861074 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.665 seconds
[0m04:10:17.868514 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: Close
[0m04:10:17.993742 [info ] [Thread-1 (]: 1 of 1 PASS not_null_macd_calculation_date ..................................... [[32mPASS[0m in 0.83s]
[0m04:10:17.996491 [debug] [Thread-1 (]: Finished running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:10:17.999527 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:10:18.000429 [debug] [MainThread]: Connection 'test.lab.not_null_macd_calculation_date.1954e908c9' was properly closed.
[0m04:10:18.001062 [info ] [MainThread]: 
[0m04:10:18.002186 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 2.40 seconds (2.40s).
[0m04:10:18.003458 [debug] [MainThread]: Command end result
[0m04:10:18.036218 [info ] [MainThread]: 
[0m04:10:18.036745 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:10:18.037061 [info ] [MainThread]: 
[0m04:10:18.037473 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m04:10:18.038623 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.1724238, "process_user_time": 2.347234, "process_kernel_time": 0.194678, "process_mem_max_rss": "208028", "process_out_blocks": "1849", "process_in_blocks": "0"}
[0m04:10:18.038993 [debug] [MainThread]: Command `dbt test` succeeded at 04:10:18.038935 after 3.17 seconds
[0m04:10:18.039281 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff92e09df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff753e1100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90a8c4d0>]}
[0m04:10:18.039592 [debug] [MainThread]: Flushing usage events
[0m04:10:20.013554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f41d1c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d4acf50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d4adf10>]}


============================== 04:10:20.017390 | 56c65ea9-d5b8-46e4-883c-67b0614f58ef ==============================
[0m04:10:20.017390 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:10:20.018061 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/lab/logs', 'profiles_dir': '/opt/airflow/lab', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'send_anonymous_usage_stats': 'True'}
[0m04:10:20.473470 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '56c65ea9-d5b8-46e4-883c-67b0614f58ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff62c844a0>]}
[0m04:10:20.496366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '56c65ea9-d5b8-46e4-883c-67b0614f58ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff60c62c90>]}
[0m04:10:20.496969 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:10:20.541963 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:10:20.626047 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:10:20.626483 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:10:20.652857 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '56c65ea9-d5b8-46e4-883c-67b0614f58ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff60953440>]}
[0m04:10:20.706884 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '56c65ea9-d5b8-46e4-883c-67b0614f58ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6073ef30>]}
[0m04:10:20.707189 [info ] [MainThread]: Found 3 models, 1 snapshot, 1 test, 2 sources, 459 macros
[0m04:10:20.707915 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '56c65ea9-d5b8-46e4-883c-67b0614f58ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff606591c0>]}
[0m04:10:20.708776 [info ] [MainThread]: 
[0m04:10:20.709245 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:10:20.709772 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m04:10:20.716814 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m04:10:20.717048 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m04:10:20.717247 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:10:21.219507 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.502 seconds
[0m04:10:21.224532 [debug] [ThreadPool]: On list_dev: Close
[0m04:10:21.380264 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_snapshot)
[0m04:10:21.391240 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m04:10:21.391752 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m04:10:21.392161 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:10:21.930045 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.538 seconds
[0m04:10:21.932490 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m04:10:22.058545 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m04:10:22.064604 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m04:10:22.065477 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m04:10:22.066273 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:10:22.603797 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.537 seconds
[0m04:10:22.606988 [debug] [ThreadPool]: On list_dev_stock: Close
[0m04:10:22.736556 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '56c65ea9-d5b8-46e4-883c-67b0614f58ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6063ec30>]}
[0m04:10:22.737875 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:10:22.739836 [info ] [MainThread]: 
[0m04:10:22.753074 [debug] [Thread-1 (]: Began running node snapshot.lab.snapshot_session_summary
[0m04:10:22.754038 [info ] [Thread-1 (]: 1 of 1 START snapshot snapshot.snapshot_session_summary ........................ [RUN]
[0m04:10:22.754632 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now snapshot.lab.snapshot_session_summary)
[0m04:10:22.754992 [debug] [Thread-1 (]: Began compiling node snapshot.lab.snapshot_session_summary
[0m04:10:22.761003 [debug] [Thread-1 (]: Began executing node snapshot.lab.snapshot_session_summary
[0m04:10:22.802257 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_session_summary"
[0m04:10:22.802624 [debug] [Thread-1 (]: On snapshot.lab.snapshot_session_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_session_summary"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_session_summary"} */
select * from (
        
    

    select *,
        md5(coalesce(cast(date as varchar ), '')
         || '|' || coalesce(cast(ts as varchar ), '')
        ) as dbt_scd_id,
        ts as dbt_updated_at,
        ts as dbt_valid_from,
        
  
  coalesce(nullif(ts, ts), null)
  as dbt_valid_to

    from (
        

SELECT * FROM dev.stock.macd_calculation
    ) sbq



    ) as __dbt_sbq
    where false
    limit 0
[0m04:10:22.802924 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:10:23.328367 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b8505a-0004-26ad-0000-000262e76865
[0m04:10:23.331490 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 7 at position 33
invalid identifier 'TS'
[0m04:10:23.332893 [debug] [Thread-1 (]: On snapshot.lab.snapshot_session_summary: Close
[0m04:10:23.465585 [debug] [Thread-1 (]: Database Error in snapshot snapshot_session_summary (snapshots/snapshot.macd_calculation.sql)
  000904 (42000): SQL compilation error: error line 7 at position 33
  invalid identifier 'TS'
[0m04:10:23.468212 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '56c65ea9-d5b8-46e4-883c-67b0614f58ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d30dee0>]}
[0m04:10:23.469592 [error] [Thread-1 (]: 1 of 1 ERROR snapshotting snapshot.snapshot_session_summary .................... [[31mERROR[0m in 0.71s]
[0m04:10:23.471225 [debug] [Thread-1 (]: Finished running node snapshot.lab.snapshot_session_summary
[0m04:10:23.473802 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:10:23.474290 [debug] [MainThread]: Connection 'snapshot.lab.snapshot_session_summary' was properly closed.
[0m04:10:23.474764 [info ] [MainThread]: 
[0m04:10:23.475553 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 2.77 seconds (2.77s).
[0m04:10:23.476779 [debug] [MainThread]: Command end result
[0m04:10:23.508438 [info ] [MainThread]: 
[0m04:10:23.508958 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m04:10:23.509413 [info ] [MainThread]: 
[0m04:10:23.509896 [error] [MainThread]:   Database Error in snapshot snapshot_session_summary (snapshots/snapshot.macd_calculation.sql)
  000904 (42000): SQL compilation error: error line 7 at position 33
  invalid identifier 'TS'
[0m04:10:23.510248 [info ] [MainThread]: 
[0m04:10:23.510596 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m04:10:23.511570 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 3.5407255, "process_user_time": 2.481504, "process_kernel_time": 0.2412, "process_mem_max_rss": "206624", "process_out_blocks": "1851", "command_success": false, "process_in_blocks": "0"}
[0m04:10:23.511970 [debug] [MainThread]: Command `dbt snapshot` failed at 04:10:23.511900 after 3.54 seconds
[0m04:10:23.512278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d6c3080>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d4af9e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff606c3e00>]}
[0m04:10:23.512595 [debug] [MainThread]: Flushing usage events
[0m04:11:44.216932 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb3c79970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb63226f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb376c740>]}


============================== 04:11:44.221227 | 7ecdbb55-04c5-44eb-bc48-4608bd9bf88a ==============================
[0m04:11:44.221227 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:11:44.222424 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/lab/logs', 'profiles_dir': '/opt/airflow/lab', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m04:11:44.685544 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7ecdbb55-04c5-44eb-bc48-4608bd9bf88a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9396bdd0>]}
[0m04:11:44.709670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7ecdbb55-04c5-44eb-bc48-4608bd9bf88a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb3177d10>]}
[0m04:11:44.710270 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:11:44.761266 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:11:44.826302 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m04:11:44.826715 [debug] [MainThread]: Partial parsing: updated file: lab://snapshots/snapshot.macd_calculation.sql
[0m04:11:44.938597 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7ecdbb55-04c5-44eb-bc48-4608bd9bf88a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff99f8ca70>]}
[0m04:11:44.991905 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7ecdbb55-04c5-44eb-bc48-4608bd9bf88a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff930931d0>]}
[0m04:11:44.992229 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m04:11:44.992728 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7ecdbb55-04c5-44eb-bc48-4608bd9bf88a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff93152810>]}
[0m04:11:44.993620 [info ] [MainThread]: 
[0m04:11:44.994051 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:11:44.996495 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m04:11:45.003100 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m04:11:45.003329 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m04:11:45.003511 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:11:45.705108 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.701 seconds
[0m04:11:45.707940 [debug] [ThreadPool]: On list_dev: Close
[0m04:11:45.857765 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_stock)
[0m04:11:45.874918 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m04:11:45.875527 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m04:11:45.875999 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:11:46.443723 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.567 seconds
[0m04:11:46.446097 [debug] [ThreadPool]: On list_dev_stock: Close
[0m04:11:46.583421 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_stock, now list_dev_snapshot)
[0m04:11:46.585832 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m04:11:46.586142 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m04:11:46.586429 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:11:47.076387 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.489 seconds
[0m04:11:47.080675 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m04:11:47.259842 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7ecdbb55-04c5-44eb-bc48-4608bd9bf88a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff92f1cb90>]}
[0m04:11:47.260977 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:11:47.263905 [info ] [MainThread]: 
[0m04:11:47.273410 [debug] [Thread-1 (]: Began running node model.lab.RSI_Calculation
[0m04:11:47.273988 [info ] [Thread-1 (]: 1 of 2 START sql table model stock.RSI_Calculation ............................. [RUN]
[0m04:11:47.274543 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_snapshot, now model.lab.RSI_Calculation)
[0m04:11:47.274837 [debug] [Thread-1 (]: Began compiling node model.lab.RSI_Calculation
[0m04:11:47.280411 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.RSI_Calculation"
[0m04:11:47.281482 [debug] [Thread-1 (]: Began executing node model.lab.RSI_Calculation
[0m04:11:47.297498 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.RSI_Calculation"
[0m04:11:47.299482 [debug] [Thread-1 (]: Using snowflake connection "model.lab.RSI_Calculation"
[0m04:11:47.299867 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.RSI_Calculation"} */
create or replace transient table dev.stock.RSI_Calculation
         as
        (-- models/rsi_calculation.sql

WITH PriceChanges AS (
    SELECT
        date,
        symbol,
        close,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM
        dev.stock.stock_price_analysis  -- Replace 'stock' and 'stock_price_analysis' with your actual source name and table
),
PriceGainsLosses AS (
    SELECT
        date,
        symbol,
        close,
        next_close,
        CASE 
            WHEN next_close > close THEN next_close - close
            ELSE 0 
        END AS gain,
        CASE 
            WHEN next_close < close THEN close - next_close
            ELSE 0 
        END AS loss
    FROM
        PriceChanges
),
AverageGainsLosses AS (
    SELECT
        date,
        symbol,
        AVG(gain) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain,
        AVG(loss) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss
    FROM
        PriceGainsLosses
),
RSI_Calculation AS (
    SELECT
        date,
        symbol,
        avg_gain,
        avg_loss,
        CASE 
            WHEN avg_loss = 0 THEN 100
            ELSE 100 - (100 / (1 + (avg_gain / avg_loss)))
        END AS rsi
    FROM
        AverageGainsLosses
)
SELECT 
    date, 
    symbol, 
    rsi
FROM 
    RSI_Calculation
WHERE
    date >= (SELECT MIN(date) FROM dev.stock.stock_price_analysis) + INTERVAL '14 DAY'
ORDER BY
    symbol, date
        );
[0m04:11:47.300236 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:11:48.646080 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.346 seconds
[0m04:11:48.662192 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: Close
[0m04:11:48.784246 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7ecdbb55-04c5-44eb-bc48-4608bd9bf88a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff936284a0>]}
[0m04:11:48.785234 [info ] [Thread-1 (]: 1 of 2 OK created sql table model stock.RSI_Calculation ........................ [[32mSUCCESS 1[0m in 1.51s]
[0m04:11:48.787454 [debug] [Thread-1 (]: Finished running node model.lab.RSI_Calculation
[0m04:11:48.788107 [debug] [Thread-1 (]: Began running node model.lab.stock_price_analysis
[0m04:11:48.788956 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.RSI_Calculation, now model.lab.stock_price_analysis)
[0m04:11:48.789395 [debug] [Thread-1 (]: Began compiling node model.lab.stock_price_analysis
[0m04:11:48.797142 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.stock_price_analysis"
[0m04:11:48.799905 [debug] [Thread-1 (]: Finished running node model.lab.stock_price_analysis
[0m04:11:48.801179 [debug] [Thread-1 (]: Began running node model.lab.macd_calculation
[0m04:11:48.801612 [info ] [Thread-1 (]: 2 of 2 START sql table model stock.macd_calculation ............................ [RUN]
[0m04:11:48.802406 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.stock_price_analysis, now model.lab.macd_calculation)
[0m04:11:48.802734 [debug] [Thread-1 (]: Began compiling node model.lab.macd_calculation
[0m04:11:48.819419 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.macd_calculation"
[0m04:11:48.820605 [debug] [Thread-1 (]: Began executing node model.lab.macd_calculation
[0m04:11:48.822608 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.macd_calculation"
[0m04:11:48.824630 [debug] [Thread-1 (]: Using snowflake connection "model.lab.macd_calculation"
[0m04:11:48.825032 [debug] [Thread-1 (]: On model.lab.macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.macd_calculation"} */
create or replace transient table dev.stock.macd_calculation
         as
        (WITH  __dbt__cte__stock_price_analysis as (
WITH stock_data AS (
    SELECT
        *
    FROM dev.stock.stock_price_analysis
)

-- Now you can query the CTE
SELECT * FROM stock_data
), stock_data AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE,
        ROW_NUMBER() OVER (PARTITION BY SYMBOL ORDER BY DATE) AS rn
    FROM __dbt__cte__stock_price_analysis  -- Replace with the reference to your actual source table in DBT
),

-- Calculate 12-day EMA
ema_12 AS (
    SELECT
        SYMBOL,
        DATE,
        CLOSE AS EMA_12,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (12 + 1))) + (e.EMA_12 * (1 - (2.0 / (12 + 1)))) AS EMA_12,
        sd.rn
    FROM stock_data sd
    JOIN ema_12 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate 26-day EMA
ema_26 AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE AS EMA_26,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (26 + 1))) + (e.EMA_26 * (1 - (2.0 / (26 + 1)))) AS EMA_26,
        sd.rn
    FROM stock_data sd
    JOIN ema_26 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate MACD by subtracting 26-day EMA from 12-day EMA
macd_calculation AS (
    SELECT 
        e12.SYMBOL,
        e12.DATE,
        e12.EMA_12 - e26.EMA_26 AS MACD,
        e12.rn
    FROM ema_12 e12
    JOIN ema_26 e26 ON e12.SYMBOL = e26.SYMBOL AND e12.DATE = e26.DATE
),

-- Calculate 9-day EMA of MACD as Signal Line
signal_line AS (
    SELECT 
        SYMBOL,
        DATE,
        MACD,
        MACD AS Signal,
        rn
    FROM macd_calculation
    WHERE rn = 1

    UNION ALL

    SELECT 
        mc.SYMBOL,
        mc.DATE,
        mc.MACD,
        (mc.MACD * (2.0 / (9 + 1))) + (sl.Signal * (1 - (2.0 / (9 + 1)))) AS Signal,
        mc.rn
    FROM macd_calculation mc
    JOIN signal_line sl ON mc.SYMBOL = sl.SYMBOL AND mc.rn = sl.rn + 1
)

-- Final output
SELECT 
    SYMBOL,
    DATE,
    MACD,
    Signal,
    MACD - Signal AS Histogram
FROM signal_line
ORDER BY SYMBOL, DATE
        );
[0m04:11:48.825395 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:11:50.184236 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.358 seconds
[0m04:11:50.187660 [debug] [Thread-1 (]: On model.lab.macd_calculation: Close
[0m04:11:50.328984 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7ecdbb55-04c5-44eb-bc48-4608bd9bf88a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff92c87c80>]}
[0m04:11:50.330420 [info ] [Thread-1 (]: 2 of 2 OK created sql table model stock.macd_calculation ....................... [[32mSUCCESS 1[0m in 1.53s]
[0m04:11:50.331862 [debug] [Thread-1 (]: Finished running node model.lab.macd_calculation
[0m04:11:50.334102 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:11:50.334778 [debug] [MainThread]: Connection 'model.lab.macd_calculation' was properly closed.
[0m04:11:50.335443 [info ] [MainThread]: 
[0m04:11:50.336252 [info ] [MainThread]: Finished running 2 table models in 0 hours 0 minutes and 5.34 seconds (5.34s).
[0m04:11:50.337541 [debug] [MainThread]: Command end result
[0m04:11:50.379039 [info ] [MainThread]: 
[0m04:11:50.379699 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:11:50.380189 [info ] [MainThread]: 
[0m04:11:50.380652 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m04:11:50.382403 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.20485, "process_user_time": 2.588266, "process_kernel_time": 0.308393, "process_mem_max_rss": "208548", "process_out_blocks": "2809", "process_in_blocks": "0"}
[0m04:11:50.382907 [debug] [MainThread]: Command `dbt run` succeeded at 04:11:50.382830 after 6.21 seconds
[0m04:11:50.383299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb4823e30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb3a29040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff932437a0>]}
[0m04:11:50.383577 [debug] [MainThread]: Flushing usage events
[0m04:11:52.735996 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa2b1fc20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa35c71a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa4d24860>]}


============================== 04:11:52.740738 | 07d60bc2-bc23-449f-b80f-b49c78e22084 ==============================
[0m04:11:52.740738 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:11:52.743518 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/lab', 'log_path': '/opt/airflow/lab/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m04:11:53.206775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '07d60bc2-bc23-449f-b80f-b49c78e22084', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa2363980>]}
[0m04:11:53.228835 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '07d60bc2-bc23-449f-b80f-b49c78e22084', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa442fb30>]}
[0m04:11:53.229313 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:11:53.274488 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:11:53.337262 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:11:53.337560 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:11:53.359473 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '07d60bc2-bc23-449f-b80f-b49c78e22084', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa2cccaa0>]}
[0m04:11:53.418903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '07d60bc2-bc23-449f-b80f-b49c78e22084', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8255c920>]}
[0m04:11:53.419206 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m04:11:53.419670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '07d60bc2-bc23-449f-b80f-b49c78e22084', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82728d70>]}
[0m04:11:53.420547 [info ] [MainThread]: 
[0m04:11:53.421011 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:11:53.423058 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev_snapshot'
[0m04:11:53.431466 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m04:11:53.431709 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m04:11:53.431916 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:11:54.030275 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.598 seconds
[0m04:11:54.032638 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m04:11:54.195973 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m04:11:54.199554 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m04:11:54.200196 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m04:11:54.200746 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:11:54.754371 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.554 seconds
[0m04:11:54.757452 [debug] [ThreadPool]: On list_dev_stock: Close
[0m04:11:54.914805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '07d60bc2-bc23-449f-b80f-b49c78e22084', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82bf6f60>]}
[0m04:11:54.915687 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:11:54.917245 [info ] [MainThread]: 
[0m04:11:54.929729 [debug] [Thread-1 (]: Began running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:11:54.930301 [info ] [Thread-1 (]: 1 of 1 START test not_null_macd_calculation_date ............................... [RUN]
[0m04:11:54.931047 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now test.lab.not_null_macd_calculation_date.1954e908c9)
[0m04:11:54.931494 [debug] [Thread-1 (]: Began compiling node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:11:54.944955 [debug] [Thread-1 (]: Writing injected SQL for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m04:11:54.946513 [debug] [Thread-1 (]: Began executing node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:11:54.958897 [debug] [Thread-1 (]: Writing runtime sql for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m04:11:54.960021 [debug] [Thread-1 (]: Using snowflake connection "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m04:11:54.960352 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "test.lab.not_null_macd_calculation_date.1954e908c9"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from dev.stock.macd_calculation
where date is null



      
    ) dbt_internal_test
[0m04:11:54.960640 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:11:55.715359 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.754 seconds
[0m04:11:55.732354 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: Close
[0m04:11:55.887948 [info ] [Thread-1 (]: 1 of 1 PASS not_null_macd_calculation_date ..................................... [[32mPASS[0m in 0.96s]
[0m04:11:55.889334 [debug] [Thread-1 (]: Finished running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:11:55.891043 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:11:55.891471 [debug] [MainThread]: Connection 'test.lab.not_null_macd_calculation_date.1954e908c9' was properly closed.
[0m04:11:55.891833 [info ] [MainThread]: 
[0m04:11:55.892402 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 2.47 seconds (2.47s).
[0m04:11:55.893211 [debug] [MainThread]: Command end result
[0m04:11:55.920711 [info ] [MainThread]: 
[0m04:11:55.921181 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:11:55.921577 [info ] [MainThread]: 
[0m04:11:55.921984 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m04:11:55.922850 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.23161, "process_user_time": 2.316904, "process_kernel_time": 0.202038, "process_mem_max_rss": "208172", "process_out_blocks": "1849", "process_in_blocks": "0"}
[0m04:11:55.923272 [debug] [MainThread]: Command `dbt test` succeeded at 04:11:55.923187 after 3.23 seconds
[0m04:11:55.923565 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa3a1ed50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa700f0e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81b6d2e0>]}
[0m04:11:55.923849 [debug] [MainThread]: Flushing usage events
[0m04:11:57.690481 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff878eb110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87782cf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff878eb0e0>]}


============================== 04:11:57.693993 | 063aad0d-b083-4587-a7a9-8357bb289499 ==============================
[0m04:11:57.693993 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:11:57.694606 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/lab/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/lab', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m04:11:58.108221 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '063aad0d-b083-4587-a7a9-8357bb289499', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff67573fb0>]}
[0m04:11:58.130187 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '063aad0d-b083-4587-a7a9-8357bb289499', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6cca2ae0>]}
[0m04:11:58.130625 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:11:58.173235 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:11:58.234183 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:11:58.234472 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:11:58.256617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '063aad0d-b083-4587-a7a9-8357bb289499', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8763a090>]}
[0m04:11:58.308549 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '063aad0d-b083-4587-a7a9-8357bb289499', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff67a0d0d0>]}
[0m04:11:58.308851 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m04:11:58.309332 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '063aad0d-b083-4587-a7a9-8357bb289499', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff673ca330>]}
[0m04:11:58.310184 [info ] [MainThread]: 
[0m04:11:58.310626 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:11:58.311129 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m04:11:58.318348 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m04:11:58.318624 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m04:11:58.318843 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:11:58.795108 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.476 seconds
[0m04:11:58.797254 [debug] [ThreadPool]: On list_dev: Close
[0m04:11:58.915562 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_stock)
[0m04:11:58.920866 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m04:11:58.921185 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m04:11:58.921456 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:11:59.332895 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.411 seconds
[0m04:11:59.337880 [debug] [ThreadPool]: On list_dev_stock: Close
[0m04:11:59.458285 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_stock, now list_dev_snapshot)
[0m04:11:59.464887 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m04:11:59.465657 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m04:11:59.466219 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:12:00.163527 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.697 seconds
[0m04:12:00.167326 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m04:12:00.340274 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '063aad0d-b083-4587-a7a9-8357bb289499', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff674c4830>]}
[0m04:12:00.342907 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:12:00.344829 [info ] [MainThread]: 
[0m04:12:00.359002 [debug] [Thread-1 (]: Began running node snapshot.lab.snapshot_macd_calculation
[0m04:12:00.359888 [info ] [Thread-1 (]: 1 of 1 START snapshot snapshot.snapshot_macd_calculation ....................... [RUN]
[0m04:12:00.360827 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_snapshot, now snapshot.lab.snapshot_macd_calculation)
[0m04:12:00.361311 [debug] [Thread-1 (]: Began compiling node snapshot.lab.snapshot_macd_calculation
[0m04:12:00.368630 [debug] [Thread-1 (]: Began executing node snapshot.lab.snapshot_macd_calculation
[0m04:12:00.412524 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m04:12:00.412833 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
select * from (
        
    

    select *,
        md5(coalesce(cast(date as varchar ), '')
         || '|' || coalesce(cast(ts as varchar ), '')
        ) as dbt_scd_id,
        ts as dbt_updated_at,
        ts as dbt_valid_from,
        
  
  coalesce(nullif(ts, ts), null)
  as dbt_valid_to

    from (
        

SELECT * FROM dev.stock.macd_calculation
    ) sbq



    ) as __dbt_sbq
    where false
    limit 0
[0m04:12:00.413114 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:12:00.887074 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b8505c-0004-26b5-0000-000262e778c1
[0m04:12:00.888024 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 7 at position 33
invalid identifier 'TS'
[0m04:12:00.888843 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: Close
[0m04:12:01.036390 [debug] [Thread-1 (]: Database Error in snapshot snapshot_macd_calculation (snapshots/snapshot.macd_calculation.sql)
  000904 (42000): SQL compilation error: error line 7 at position 33
  invalid identifier 'TS'
[0m04:12:01.038391 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '063aad0d-b083-4587-a7a9-8357bb289499', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87d95f70>]}
[0m04:12:01.039463 [error] [Thread-1 (]: 1 of 1 ERROR snapshotting snapshot.snapshot_macd_calculation ................... [[31mERROR[0m in 0.68s]
[0m04:12:01.040766 [debug] [Thread-1 (]: Finished running node snapshot.lab.snapshot_macd_calculation
[0m04:12:01.043057 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:12:01.043567 [debug] [MainThread]: Connection 'snapshot.lab.snapshot_macd_calculation' was properly closed.
[0m04:12:01.044022 [info ] [MainThread]: 
[0m04:12:01.044740 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 2.73 seconds (2.73s).
[0m04:12:01.045828 [debug] [MainThread]: Command end result
[0m04:12:01.075295 [info ] [MainThread]: 
[0m04:12:01.075750 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m04:12:01.076119 [info ] [MainThread]: 
[0m04:12:01.076503 [error] [MainThread]:   Database Error in snapshot snapshot_macd_calculation (snapshots/snapshot.macd_calculation.sql)
  000904 (42000): SQL compilation error: error line 7 at position 33
  invalid identifier 'TS'
[0m04:12:01.076778 [info ] [MainThread]: 
[0m04:12:01.077022 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m04:12:01.077723 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 3.4262733, "process_user_time": 2.340768, "process_kernel_time": 0.139777, "process_mem_max_rss": "206624", "process_out_blocks": "1851", "command_success": false, "process_in_blocks": "0"}
[0m04:12:01.078066 [debug] [MainThread]: Command `dbt snapshot` failed at 04:12:01.078013 after 3.43 seconds
[0m04:12:01.078347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87782cf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff677e9730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6c10c710>]}
[0m04:12:01.078595 [debug] [MainThread]: Flushing usage events
[0m04:12:58.665573 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ee2c2c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ee2c350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ee2d760>]}


============================== 04:12:58.669823 | 5fce4726-d9db-4a5b-bb20-30eb3bf16810 ==============================
[0m04:12:58.669823 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:12:58.670247 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/lab', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/lab/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'send_anonymous_usage_stats': 'True'}
[0m04:12:59.129685 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5fce4726-d9db-4a5b-bb20-30eb3bf16810', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6485fce0>]}
[0m04:12:59.153422 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5fce4726-d9db-4a5b-bb20-30eb3bf16810', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f61de80>]}
[0m04:12:59.153951 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:12:59.199129 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:12:59.260197 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:12:59.260431 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:12:59.282296 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5fce4726-d9db-4a5b-bb20-30eb3bf16810', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5e53e180>]}
[0m04:12:59.336411 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5fce4726-d9db-4a5b-bb20-30eb3bf16810', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5e53f6b0>]}
[0m04:12:59.336702 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m04:12:59.336999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5fce4726-d9db-4a5b-bb20-30eb3bf16810', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5ea3b080>]}
[0m04:12:59.337908 [info ] [MainThread]: 
[0m04:12:59.338347 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:12:59.341253 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m04:12:59.351359 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m04:12:59.351705 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m04:12:59.352009 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:12:59.935213 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.583 seconds
[0m04:12:59.938794 [debug] [ThreadPool]: On list_dev: Close
[0m04:13:00.088588 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_stock)
[0m04:13:00.102713 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m04:13:00.103499 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m04:13:00.104016 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:13:00.558695 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.455 seconds
[0m04:13:00.561764 [debug] [ThreadPool]: On list_dev_stock: Close
[0m04:13:00.675121 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_stock, now list_dev_snapshot)
[0m04:13:00.681401 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m04:13:00.682121 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m04:13:00.682643 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:13:01.206346 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.524 seconds
[0m04:13:01.208621 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m04:13:01.331066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5fce4726-d9db-4a5b-bb20-30eb3bf16810', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5e239040>]}
[0m04:13:01.332767 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:13:01.335318 [info ] [MainThread]: 
[0m04:13:01.349866 [debug] [Thread-1 (]: Began running node model.lab.RSI_Calculation
[0m04:13:01.350716 [info ] [Thread-1 (]: 1 of 2 START sql table model stock.RSI_Calculation ............................. [RUN]
[0m04:13:01.351680 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_snapshot, now model.lab.RSI_Calculation)
[0m04:13:01.352137 [debug] [Thread-1 (]: Began compiling node model.lab.RSI_Calculation
[0m04:13:01.359518 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.RSI_Calculation"
[0m04:13:01.361794 [debug] [Thread-1 (]: Began executing node model.lab.RSI_Calculation
[0m04:13:01.382722 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.RSI_Calculation"
[0m04:13:01.384298 [debug] [Thread-1 (]: Using snowflake connection "model.lab.RSI_Calculation"
[0m04:13:01.384598 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.RSI_Calculation"} */
create or replace transient table dev.stock.RSI_Calculation
         as
        (-- models/rsi_calculation.sql

WITH PriceChanges AS (
    SELECT
        date,
        symbol,
        close,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM
        dev.stock.stock_price_analysis  -- Replace 'stock' and 'stock_price_analysis' with your actual source name and table
),
PriceGainsLosses AS (
    SELECT
        date,
        symbol,
        close,
        next_close,
        CASE 
            WHEN next_close > close THEN next_close - close
            ELSE 0 
        END AS gain,
        CASE 
            WHEN next_close < close THEN close - next_close
            ELSE 0 
        END AS loss
    FROM
        PriceChanges
),
AverageGainsLosses AS (
    SELECT
        date,
        symbol,
        AVG(gain) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain,
        AVG(loss) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss
    FROM
        PriceGainsLosses
),
RSI_Calculation AS (
    SELECT
        date,
        symbol,
        avg_gain,
        avg_loss,
        CASE 
            WHEN avg_loss = 0 THEN 100
            ELSE 100 - (100 / (1 + (avg_gain / avg_loss)))
        END AS rsi
    FROM
        AverageGainsLosses
)
SELECT 
    date, 
    symbol, 
    rsi
FROM 
    RSI_Calculation
WHERE
    date >= (SELECT MIN(date) FROM dev.stock.stock_price_analysis) + INTERVAL '14 DAY'
ORDER BY
    symbol, date
        );
[0m04:13:01.384920 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:13:02.893021 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.507 seconds
[0m04:13:02.920102 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: Close
[0m04:13:03.050534 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5fce4726-d9db-4a5b-bb20-30eb3bf16810', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ee2ddc0>]}
[0m04:13:03.052499 [info ] [Thread-1 (]: 1 of 2 OK created sql table model stock.RSI_Calculation ........................ [[32mSUCCESS 1[0m in 1.70s]
[0m04:13:03.054070 [debug] [Thread-1 (]: Finished running node model.lab.RSI_Calculation
[0m04:13:03.055011 [debug] [Thread-1 (]: Began running node model.lab.stock_price_analysis
[0m04:13:03.055874 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.RSI_Calculation, now model.lab.stock_price_analysis)
[0m04:13:03.056400 [debug] [Thread-1 (]: Began compiling node model.lab.stock_price_analysis
[0m04:13:03.061885 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.stock_price_analysis"
[0m04:13:03.064255 [debug] [Thread-1 (]: Finished running node model.lab.stock_price_analysis
[0m04:13:03.065440 [debug] [Thread-1 (]: Began running node model.lab.macd_calculation
[0m04:13:03.066169 [info ] [Thread-1 (]: 2 of 2 START sql table model stock.macd_calculation ............................ [RUN]
[0m04:13:03.067573 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.stock_price_analysis, now model.lab.macd_calculation)
[0m04:13:03.068016 [debug] [Thread-1 (]: Began compiling node model.lab.macd_calculation
[0m04:13:03.088327 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.macd_calculation"
[0m04:13:03.089417 [debug] [Thread-1 (]: Began executing node model.lab.macd_calculation
[0m04:13:03.091401 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.macd_calculation"
[0m04:13:03.093325 [debug] [Thread-1 (]: Using snowflake connection "model.lab.macd_calculation"
[0m04:13:03.093644 [debug] [Thread-1 (]: On model.lab.macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.macd_calculation"} */
create or replace transient table dev.stock.macd_calculation
         as
        (WITH  __dbt__cte__stock_price_analysis as (
WITH stock_data AS (
    SELECT
        *
    FROM dev.stock.stock_price_analysis
)

-- Now you can query the CTE
SELECT * FROM stock_data
), stock_data AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE,
        ROW_NUMBER() OVER (PARTITION BY SYMBOL ORDER BY DATE) AS rn
    FROM __dbt__cte__stock_price_analysis  -- Replace with the reference to your actual source table in DBT
),

-- Calculate 12-day EMA
ema_12 AS (
    SELECT
        SYMBOL,
        DATE,
        CLOSE AS EMA_12,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (12 + 1))) + (e.EMA_12 * (1 - (2.0 / (12 + 1)))) AS EMA_12,
        sd.rn
    FROM stock_data sd
    JOIN ema_12 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate 26-day EMA
ema_26 AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE AS EMA_26,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (26 + 1))) + (e.EMA_26 * (1 - (2.0 / (26 + 1)))) AS EMA_26,
        sd.rn
    FROM stock_data sd
    JOIN ema_26 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate MACD by subtracting 26-day EMA from 12-day EMA
macd_calculation AS (
    SELECT 
        e12.SYMBOL,
        e12.DATE,
        e12.EMA_12 - e26.EMA_26 AS MACD,
        e12.rn
    FROM ema_12 e12
    JOIN ema_26 e26 ON e12.SYMBOL = e26.SYMBOL AND e12.DATE = e26.DATE
),

-- Calculate 9-day EMA of MACD as Signal Line
signal_line AS (
    SELECT 
        SYMBOL,
        DATE,
        MACD,
        MACD AS Signal,
        rn
    FROM macd_calculation
    WHERE rn = 1

    UNION ALL

    SELECT 
        mc.SYMBOL,
        mc.DATE,
        mc.MACD,
        (mc.MACD * (2.0 / (9 + 1))) + (sl.Signal * (1 - (2.0 / (9 + 1)))) AS Signal,
        mc.rn
    FROM macd_calculation mc
    JOIN signal_line sl ON mc.SYMBOL = sl.SYMBOL AND mc.rn = sl.rn + 1
)

-- Final output
SELECT 
    SYMBOL,
    DATE,
    MACD,
    Signal,
    MACD - Signal AS Histogram
FROM signal_line
ORDER BY SYMBOL, DATE
        );
[0m04:13:03.094081 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:13:04.428126 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.334 seconds
[0m04:13:04.432603 [debug] [Thread-1 (]: On model.lab.macd_calculation: Close
[0m04:13:04.564834 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5fce4726-d9db-4a5b-bb20-30eb3bf16810', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7fb28590>]}
[0m04:13:04.566598 [info ] [Thread-1 (]: 2 of 2 OK created sql table model stock.macd_calculation ....................... [[32mSUCCESS 1[0m in 1.50s]
[0m04:13:04.568983 [debug] [Thread-1 (]: Finished running node model.lab.macd_calculation
[0m04:13:04.571481 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:13:04.572345 [debug] [MainThread]: Connection 'model.lab.macd_calculation' was properly closed.
[0m04:13:04.573165 [info ] [MainThread]: 
[0m04:13:04.573792 [info ] [MainThread]: Finished running 2 table models in 0 hours 0 minutes and 5.23 seconds (5.23s).
[0m04:13:04.575408 [debug] [MainThread]: Command end result
[0m04:13:04.610155 [info ] [MainThread]: 
[0m04:13:04.610875 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:13:04.611324 [info ] [MainThread]: 
[0m04:13:04.611751 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m04:13:04.613093 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.9918694, "process_user_time": 2.516804, "process_kernel_time": 0.30522, "process_mem_max_rss": "205720", "process_out_blocks": "1893", "process_in_blocks": "0"}
[0m04:13:04.613534 [debug] [MainThread]: Command `dbt run` succeeded at 04:13:04.613463 after 5.99 seconds
[0m04:13:04.613901 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e9193a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5eb4bbf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff78578a10>]}
[0m04:13:04.614281 [debug] [MainThread]: Flushing usage events
[0m04:13:06.447506 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9af40530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9afcc740>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9d987c80>]}


============================== 04:13:06.451096 | 6e91f67a-6bb8-4a31-935f-2ce3b17d9e07 ==============================
[0m04:13:06.451096 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:13:06.451699 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/lab', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/lab/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'send_anonymous_usage_stats': 'True'}
[0m04:13:06.951940 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6e91f67a-6bb8-4a31-935f-2ce3b17d9e07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80e60ce0>]}
[0m04:13:06.973941 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6e91f67a-6bb8-4a31-935f-2ce3b17d9e07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9ad78dd0>]}
[0m04:13:06.974555 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:13:07.023981 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:13:07.092620 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:13:07.092958 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:13:07.115103 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6e91f67a-6bb8-4a31-935f-2ce3b17d9e07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b2e51f0>]}
[0m04:13:07.175380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6e91f67a-6bb8-4a31-935f-2ce3b17d9e07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a6049e0>]}
[0m04:13:07.175693 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m04:13:07.176251 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6e91f67a-6bb8-4a31-935f-2ce3b17d9e07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a817410>]}
[0m04:13:07.177128 [info ] [MainThread]: 
[0m04:13:07.177567 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:13:07.179604 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev_snapshot'
[0m04:13:07.188325 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m04:13:07.188577 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m04:13:07.188825 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:13:07.669131 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.480 seconds
[0m04:13:07.671879 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m04:13:07.803020 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m04:13:07.804964 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m04:13:07.805345 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m04:13:07.805649 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:13:08.258452 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.452 seconds
[0m04:13:08.263129 [debug] [ThreadPool]: On list_dev_stock: Close
[0m04:13:08.400589 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6e91f67a-6bb8-4a31-935f-2ce3b17d9e07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a548410>]}
[0m04:13:08.401790 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:13:08.403470 [info ] [MainThread]: 
[0m04:13:08.414146 [debug] [Thread-1 (]: Began running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:13:08.414692 [info ] [Thread-1 (]: 1 of 1 START test not_null_macd_calculation_date ............................... [RUN]
[0m04:13:08.415419 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now test.lab.not_null_macd_calculation_date.1954e908c9)
[0m04:13:08.415862 [debug] [Thread-1 (]: Began compiling node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:13:08.428423 [debug] [Thread-1 (]: Writing injected SQL for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m04:13:08.429626 [debug] [Thread-1 (]: Began executing node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:13:08.443440 [debug] [Thread-1 (]: Writing runtime sql for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m04:13:08.444716 [debug] [Thread-1 (]: Using snowflake connection "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m04:13:08.445056 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "test.lab.not_null_macd_calculation_date.1954e908c9"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from dev.stock.macd_calculation
where date is null



      
    ) dbt_internal_test
[0m04:13:08.445358 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:13:08.967589 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.522 seconds
[0m04:13:08.983562 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: Close
[0m04:13:09.109627 [info ] [Thread-1 (]: 1 of 1 PASS not_null_macd_calculation_date ..................................... [[32mPASS[0m in 0.69s]
[0m04:13:09.112270 [debug] [Thread-1 (]: Finished running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:13:09.114981 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:13:09.115584 [debug] [MainThread]: Connection 'test.lab.not_null_macd_calculation_date.1954e908c9' was properly closed.
[0m04:13:09.116253 [info ] [MainThread]: 
[0m04:13:09.117397 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 1.94 seconds (1.94s).
[0m04:13:09.118891 [debug] [MainThread]: Command end result
[0m04:13:09.152837 [info ] [MainThread]: 
[0m04:13:09.153200 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:13:09.153513 [info ] [MainThread]: 
[0m04:13:09.153958 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m04:13:09.154766 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 2.7454765, "process_user_time": 2.300907, "process_kernel_time": 0.224789, "process_mem_max_rss": "207880", "process_out_blocks": "1849", "process_in_blocks": "0"}
[0m04:13:09.155210 [debug] [MainThread]: Command `dbt test` succeeded at 04:13:09.155139 after 2.75 seconds
[0m04:13:09.155517 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e7f5190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9acf5f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9abc24b0>]}
[0m04:13:09.155821 [debug] [MainThread]: Flushing usage events
[0m04:13:11.509044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87ea5b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87f530b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff875ae150>]}


============================== 04:13:11.512547 | e455cfda-a0aa-43ba-bfed-020992deae9d ==============================
[0m04:13:11.512547 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:13:11.513250 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/lab', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/lab/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'send_anonymous_usage_stats': 'True'}
[0m04:13:11.892478 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e455cfda-a0aa-43ba-bfed-020992deae9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff71df0ce0>]}
[0m04:13:11.914325 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e455cfda-a0aa-43ba-bfed-020992deae9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff71df0ce0>]}
[0m04:13:11.914811 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:13:11.961793 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:13:12.022191 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:13:12.022489 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:13:12.044410 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e455cfda-a0aa-43ba-bfed-020992deae9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff67340b90>]}
[0m04:13:12.096356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e455cfda-a0aa-43ba-bfed-020992deae9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6712f080>]}
[0m04:13:12.096636 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m04:13:12.097038 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e455cfda-a0aa-43ba-bfed-020992deae9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff67355bb0>]}
[0m04:13:12.097852 [info ] [MainThread]: 
[0m04:13:12.098267 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:13:12.098761 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m04:13:12.106072 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m04:13:12.106307 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m04:13:12.106500 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:13:12.565085 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.458 seconds
[0m04:13:12.569372 [debug] [ThreadPool]: On list_dev: Close
[0m04:13:12.730672 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_snapshot)
[0m04:13:12.737497 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m04:13:12.737860 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m04:13:12.738145 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:13:13.222216 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.483 seconds
[0m04:13:13.227440 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m04:13:13.352042 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m04:13:13.358514 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m04:13:13.359439 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m04:13:13.360231 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:13:13.860859 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.500 seconds
[0m04:13:13.879651 [debug] [ThreadPool]: On list_dev_stock: Close
[0m04:13:14.012224 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e455cfda-a0aa-43ba-bfed-020992deae9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff670b77d0>]}
[0m04:13:14.014832 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:13:14.019542 [info ] [MainThread]: 
[0m04:13:14.036206 [debug] [Thread-1 (]: Began running node snapshot.lab.snapshot_macd_calculation
[0m04:13:14.037115 [info ] [Thread-1 (]: 1 of 1 START snapshot snapshot.snapshot_macd_calculation ....................... [RUN]
[0m04:13:14.037992 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now snapshot.lab.snapshot_macd_calculation)
[0m04:13:14.038533 [debug] [Thread-1 (]: Began compiling node snapshot.lab.snapshot_macd_calculation
[0m04:13:14.046413 [debug] [Thread-1 (]: Began executing node snapshot.lab.snapshot_macd_calculation
[0m04:13:14.088958 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m04:13:14.089258 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
select * from (
        
    

    select *,
        md5(coalesce(cast(date as varchar ), '')
         || '|' || coalesce(cast(ts as varchar ), '')
        ) as dbt_scd_id,
        ts as dbt_updated_at,
        ts as dbt_valid_from,
        
  
  coalesce(nullif(ts, ts), null)
  as dbt_valid_to

    from (
        

SELECT * FROM dev.stock.macd_calculation
    ) sbq



    ) as __dbt_sbq
    where false
    limit 0
[0m04:13:14.089526 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:13:14.522725 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b8505d-0004-26cb-0000-000262e7b889
[0m04:13:14.523883 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 7 at position 33
invalid identifier 'TS'
[0m04:13:14.524698 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: Close
[0m04:13:14.654919 [debug] [Thread-1 (]: Database Error in snapshot snapshot_macd_calculation (snapshots/snapshot.macd_calculation.sql)
  000904 (42000): SQL compilation error: error line 7 at position 33
  invalid identifier 'TS'
[0m04:13:14.658005 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e455cfda-a0aa-43ba-bfed-020992deae9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87d09f40>]}
[0m04:13:14.659445 [error] [Thread-1 (]: 1 of 1 ERROR snapshotting snapshot.snapshot_macd_calculation ................... [[31mERROR[0m in 0.62s]
[0m04:13:14.661193 [debug] [Thread-1 (]: Finished running node snapshot.lab.snapshot_macd_calculation
[0m04:13:14.664942 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:13:14.665515 [debug] [MainThread]: Connection 'snapshot.lab.snapshot_macd_calculation' was properly closed.
[0m04:13:14.666088 [info ] [MainThread]: 
[0m04:13:14.666906 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 2.57 seconds (2.57s).
[0m04:13:14.668115 [debug] [MainThread]: Command end result
[0m04:13:14.701511 [info ] [MainThread]: 
[0m04:13:14.702057 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m04:13:14.702464 [info ] [MainThread]: 
[0m04:13:14.702907 [error] [MainThread]:   Database Error in snapshot snapshot_macd_calculation (snapshots/snapshot.macd_calculation.sql)
  000904 (42000): SQL compilation error: error line 7 at position 33
  invalid identifier 'TS'
[0m04:13:14.703361 [info ] [MainThread]: 
[0m04:13:14.703755 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m04:13:14.705252 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 3.2337341, "process_user_time": 2.364253, "process_kernel_time": 0.131123, "process_mem_max_rss": "206744", "process_out_blocks": "1851", "command_success": false, "process_in_blocks": "0"}
[0m04:13:14.705721 [debug] [MainThread]: Command `dbt snapshot` failed at 04:13:14.705667 after 3.23 seconds
[0m04:13:14.706100 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff880bee40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff871f4890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff67474290>]}
[0m04:13:14.706355 [debug] [MainThread]: Flushing usage events
[0m04:16:12.419942 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e253e00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa0741730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9da7b2f0>]}


============================== 04:16:12.424159 | 9f1fbd3e-da10-4925-b341-f7d380400511 ==============================
[0m04:16:12.424159 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:16:12.424616 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/lab', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/lab/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'send_anonymous_usage_stats': 'True'}
[0m04:16:12.892981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9f1fbd3e-da10-4925-b341-f7d380400511', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83a70ce0>]}
[0m04:16:12.914761 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9f1fbd3e-da10-4925-b341-f7d380400511', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9a1478c0>]}
[0m04:16:12.915178 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:16:12.965291 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:16:13.027737 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m04:16:13.028128 [debug] [MainThread]: Partial parsing: updated file: lab://snapshots/snapshot.macd_calculation.sql
[0m04:16:13.135043 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9f1fbd3e-da10-4925-b341-f7d380400511', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff816f2990>]}
[0m04:16:13.187949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9f1fbd3e-da10-4925-b341-f7d380400511', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff814ff350>]}
[0m04:16:13.188208 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m04:16:13.188411 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9f1fbd3e-da10-4925-b341-f7d380400511', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81495df0>]}
[0m04:16:13.189323 [info ] [MainThread]: 
[0m04:16:13.189722 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:16:13.192066 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m04:16:13.198282 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m04:16:13.198539 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m04:16:13.198732 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:16:13.837654 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.639 seconds
[0m04:16:13.841171 [debug] [ThreadPool]: On list_dev: Close
[0m04:16:13.973524 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_stock)
[0m04:16:13.982694 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m04:16:13.983171 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m04:16:13.983545 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:16:14.514679 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.531 seconds
[0m04:16:14.525439 [debug] [ThreadPool]: On list_dev_stock: Close
[0m04:16:14.690021 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_stock, now list_dev_snapshot)
[0m04:16:14.697703 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m04:16:14.698672 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m04:16:14.699322 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:16:15.121428 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.422 seconds
[0m04:16:15.125186 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m04:16:15.275718 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9f1fbd3e-da10-4925-b341-f7d380400511', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9ef25280>]}
[0m04:16:15.277300 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:16:15.279796 [info ] [MainThread]: 
[0m04:16:15.292926 [debug] [Thread-1 (]: Began running node model.lab.RSI_Calculation
[0m04:16:15.294086 [info ] [Thread-1 (]: 1 of 2 START sql table model stock.RSI_Calculation ............................. [RUN]
[0m04:16:15.295895 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_snapshot, now model.lab.RSI_Calculation)
[0m04:16:15.296466 [debug] [Thread-1 (]: Began compiling node model.lab.RSI_Calculation
[0m04:16:15.303322 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.RSI_Calculation"
[0m04:16:15.304771 [debug] [Thread-1 (]: Began executing node model.lab.RSI_Calculation
[0m04:16:15.327787 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.RSI_Calculation"
[0m04:16:15.330572 [debug] [Thread-1 (]: Using snowflake connection "model.lab.RSI_Calculation"
[0m04:16:15.331189 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.RSI_Calculation"} */
create or replace transient table dev.stock.RSI_Calculation
         as
        (-- models/rsi_calculation.sql

WITH PriceChanges AS (
    SELECT
        date,
        symbol,
        close,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM
        dev.stock.stock_price_analysis  -- Replace 'stock' and 'stock_price_analysis' with your actual source name and table
),
PriceGainsLosses AS (
    SELECT
        date,
        symbol,
        close,
        next_close,
        CASE 
            WHEN next_close > close THEN next_close - close
            ELSE 0 
        END AS gain,
        CASE 
            WHEN next_close < close THEN close - next_close
            ELSE 0 
        END AS loss
    FROM
        PriceChanges
),
AverageGainsLosses AS (
    SELECT
        date,
        symbol,
        AVG(gain) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain,
        AVG(loss) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss
    FROM
        PriceGainsLosses
),
RSI_Calculation AS (
    SELECT
        date,
        symbol,
        avg_gain,
        avg_loss,
        CASE 
            WHEN avg_loss = 0 THEN 100
            ELSE 100 - (100 / (1 + (avg_gain / avg_loss)))
        END AS rsi
    FROM
        AverageGainsLosses
)
SELECT 
    date, 
    symbol, 
    rsi
FROM 
    RSI_Calculation
WHERE
    date >= (SELECT MIN(date) FROM dev.stock.stock_price_analysis) + INTERVAL '14 DAY'
ORDER BY
    symbol, date
        );
[0m04:16:15.331542 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:16:16.530956 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.199 seconds
[0m04:16:16.564485 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: Close
[0m04:16:16.731340 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9f1fbd3e-da10-4925-b341-f7d380400511', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81a541d0>]}
[0m04:16:16.733151 [info ] [Thread-1 (]: 1 of 2 OK created sql table model stock.RSI_Calculation ........................ [[32mSUCCESS 1[0m in 1.43s]
[0m04:16:16.735570 [debug] [Thread-1 (]: Finished running node model.lab.RSI_Calculation
[0m04:16:16.736401 [debug] [Thread-1 (]: Began running node model.lab.stock_price_analysis
[0m04:16:16.737298 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.RSI_Calculation, now model.lab.stock_price_analysis)
[0m04:16:16.737942 [debug] [Thread-1 (]: Began compiling node model.lab.stock_price_analysis
[0m04:16:16.741333 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.stock_price_analysis"
[0m04:16:16.743366 [debug] [Thread-1 (]: Finished running node model.lab.stock_price_analysis
[0m04:16:16.744702 [debug] [Thread-1 (]: Began running node model.lab.macd_calculation
[0m04:16:16.745402 [info ] [Thread-1 (]: 2 of 2 START sql table model stock.macd_calculation ............................ [RUN]
[0m04:16:16.746226 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.stock_price_analysis, now model.lab.macd_calculation)
[0m04:16:16.746634 [debug] [Thread-1 (]: Began compiling node model.lab.macd_calculation
[0m04:16:16.765856 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.macd_calculation"
[0m04:16:16.766960 [debug] [Thread-1 (]: Began executing node model.lab.macd_calculation
[0m04:16:16.769012 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.macd_calculation"
[0m04:16:16.770809 [debug] [Thread-1 (]: Using snowflake connection "model.lab.macd_calculation"
[0m04:16:16.771212 [debug] [Thread-1 (]: On model.lab.macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.macd_calculation"} */
create or replace transient table dev.stock.macd_calculation
         as
        (WITH  __dbt__cte__stock_price_analysis as (
WITH stock_data AS (
    SELECT
        *
    FROM dev.stock.stock_price_analysis
)

-- Now you can query the CTE
SELECT * FROM stock_data
), stock_data AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE,
        ROW_NUMBER() OVER (PARTITION BY SYMBOL ORDER BY DATE) AS rn
    FROM __dbt__cte__stock_price_analysis  -- Replace with the reference to your actual source table in DBT
),

-- Calculate 12-day EMA
ema_12 AS (
    SELECT
        SYMBOL,
        DATE,
        CLOSE AS EMA_12,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (12 + 1))) + (e.EMA_12 * (1 - (2.0 / (12 + 1)))) AS EMA_12,
        sd.rn
    FROM stock_data sd
    JOIN ema_12 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate 26-day EMA
ema_26 AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE AS EMA_26,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (26 + 1))) + (e.EMA_26 * (1 - (2.0 / (26 + 1)))) AS EMA_26,
        sd.rn
    FROM stock_data sd
    JOIN ema_26 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate MACD by subtracting 26-day EMA from 12-day EMA
macd_calculation AS (
    SELECT 
        e12.SYMBOL,
        e12.DATE,
        e12.EMA_12 - e26.EMA_26 AS MACD,
        e12.rn
    FROM ema_12 e12
    JOIN ema_26 e26 ON e12.SYMBOL = e26.SYMBOL AND e12.DATE = e26.DATE
),

-- Calculate 9-day EMA of MACD as Signal Line
signal_line AS (
    SELECT 
        SYMBOL,
        DATE,
        MACD,
        MACD AS Signal,
        rn
    FROM macd_calculation
    WHERE rn = 1

    UNION ALL

    SELECT 
        mc.SYMBOL,
        mc.DATE,
        mc.MACD,
        (mc.MACD * (2.0 / (9 + 1))) + (sl.Signal * (1 - (2.0 / (9 + 1)))) AS Signal,
        mc.rn
    FROM macd_calculation mc
    JOIN signal_line sl ON mc.SYMBOL = sl.SYMBOL AND mc.rn = sl.rn + 1
)

-- Final output
SELECT 
    SYMBOL,
    DATE,
    MACD,
    Signal,
    MACD - Signal AS Histogram
FROM signal_line
ORDER BY SYMBOL, DATE
        );
[0m04:16:16.771536 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:16:18.473010 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.701 seconds
[0m04:16:18.476224 [debug] [Thread-1 (]: On model.lab.macd_calculation: Close
[0m04:16:18.614537 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9f1fbd3e-da10-4925-b341-f7d380400511', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81324350>]}
[0m04:16:18.616590 [info ] [Thread-1 (]: 2 of 2 OK created sql table model stock.macd_calculation ....................... [[32mSUCCESS 1[0m in 1.87s]
[0m04:16:18.620211 [debug] [Thread-1 (]: Finished running node model.lab.macd_calculation
[0m04:16:18.623181 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:16:18.623984 [debug] [MainThread]: Connection 'model.lab.macd_calculation' was properly closed.
[0m04:16:18.625087 [info ] [MainThread]: 
[0m04:16:18.626201 [info ] [MainThread]: Finished running 2 table models in 0 hours 0 minutes and 5.43 seconds (5.43s).
[0m04:16:18.628091 [debug] [MainThread]: Command end result
[0m04:16:18.663617 [info ] [MainThread]: 
[0m04:16:18.664326 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:16:18.664814 [info ] [MainThread]: 
[0m04:16:18.665264 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m04:16:18.666513 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.28628, "process_user_time": 2.541511, "process_kernel_time": 0.300305, "process_mem_max_rss": "208532", "process_out_blocks": "2808", "process_in_blocks": "0"}
[0m04:16:18.666912 [debug] [MainThread]: Command `dbt run` succeeded at 04:16:18.666853 after 6.29 seconds
[0m04:16:18.667191 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e2519d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e2522d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e251af0>]}
[0m04:16:18.667504 [debug] [MainThread]: Flushing usage events
[0m04:16:21.354413 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff932c3ef0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff96252450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff96394860>]}


============================== 04:16:21.358250 | 0bd0272c-5cf0-4837-82a3-d6507b60d43b ==============================
[0m04:16:21.358250 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:16:21.359300 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/lab', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/lab/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m04:16:21.834665 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0bd0272c-5cf0-4837-82a3-d6507b60d43b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff73322930>]}
[0m04:16:21.857037 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0bd0272c-5cf0-4837-82a3-d6507b60d43b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff94bd3860>]}
[0m04:16:21.857531 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:16:21.904048 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:16:21.969126 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:16:21.969454 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:16:21.991768 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0bd0272c-5cf0-4837-82a3-d6507b60d43b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff78aba8d0>]}
[0m04:16:22.054346 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0bd0272c-5cf0-4837-82a3-d6507b60d43b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff72cc0c80>]}
[0m04:16:22.054641 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m04:16:22.055127 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0bd0272c-5cf0-4837-82a3-d6507b60d43b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7358fd70>]}
[0m04:16:22.055950 [info ] [MainThread]: 
[0m04:16:22.056424 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:16:22.058522 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev_snapshot'
[0m04:16:22.067472 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m04:16:22.067718 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m04:16:22.067948 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:16:22.527211 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.459 seconds
[0m04:16:22.530849 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m04:16:22.690329 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m04:16:22.692732 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m04:16:22.693199 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m04:16:22.693607 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:16:23.491149 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.797 seconds
[0m04:16:23.493815 [debug] [ThreadPool]: On list_dev_stock: Close
[0m04:16:23.619751 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0bd0272c-5cf0-4837-82a3-d6507b60d43b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff732010a0>]}
[0m04:16:23.621402 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:16:23.624388 [info ] [MainThread]: 
[0m04:16:23.638805 [debug] [Thread-1 (]: Began running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:16:23.639484 [info ] [Thread-1 (]: 1 of 1 START test not_null_macd_calculation_date ............................... [RUN]
[0m04:16:23.640368 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now test.lab.not_null_macd_calculation_date.1954e908c9)
[0m04:16:23.640824 [debug] [Thread-1 (]: Began compiling node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:16:23.654866 [debug] [Thread-1 (]: Writing injected SQL for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m04:16:23.656135 [debug] [Thread-1 (]: Began executing node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:16:23.669005 [debug] [Thread-1 (]: Writing runtime sql for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m04:16:23.670352 [debug] [Thread-1 (]: Using snowflake connection "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m04:16:23.670639 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "test.lab.not_null_macd_calculation_date.1954e908c9"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from dev.stock.macd_calculation
where date is null



      
    ) dbt_internal_test
[0m04:16:23.670913 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:16:24.320821 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.649 seconds
[0m04:16:24.336207 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: Close
[0m04:16:24.478037 [info ] [Thread-1 (]: 1 of 1 PASS not_null_macd_calculation_date ..................................... [[32mPASS[0m in 0.84s]
[0m04:16:24.480664 [debug] [Thread-1 (]: Finished running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:16:24.483201 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:16:24.483823 [debug] [MainThread]: Connection 'test.lab.not_null_macd_calculation_date.1954e908c9' was properly closed.
[0m04:16:24.484471 [info ] [MainThread]: 
[0m04:16:24.485528 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 2.43 seconds (2.43s).
[0m04:16:24.486920 [debug] [MainThread]: Command end result
[0m04:16:24.520231 [info ] [MainThread]: 
[0m04:16:24.520741 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:16:24.521136 [info ] [MainThread]: 
[0m04:16:24.521540 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m04:16:24.522654 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.2063434, "process_user_time": 2.3205, "process_kernel_time": 0.276663, "process_mem_max_rss": "207880", "process_out_blocks": "1849", "process_in_blocks": "0"}
[0m04:16:24.523150 [debug] [MainThread]: Command `dbt test` succeeded at 04:16:24.523086 after 3.21 seconds
[0m04:16:24.523492 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff933ee420>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff93bd1ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff93bd39e0>]}
[0m04:16:24.523756 [debug] [MainThread]: Flushing usage events
[0m04:16:27.290002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffbb2251c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb8bfef00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb8bfed50>]}


============================== 04:16:27.293573 | c3f99cff-196f-4077-9cd8-80e82073301d ==============================
[0m04:16:27.293573 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:16:27.294262 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/lab', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/lab/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m04:16:27.742660 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c3f99cff-196f-4077-9cd8-80e82073301d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb8956c30>]}
[0m04:16:27.764655 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c3f99cff-196f-4077-9cd8-80e82073301d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9ca62b10>]}
[0m04:16:27.765144 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:16:27.809669 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:16:27.898450 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:16:27.898876 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:16:27.921892 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c3f99cff-196f-4077-9cd8-80e82073301d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9c764b00>]}
[0m04:16:27.977301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c3f99cff-196f-4077-9cd8-80e82073301d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb47c90a0>]}
[0m04:16:27.977627 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m04:16:27.978124 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c3f99cff-196f-4077-9cd8-80e82073301d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb989c170>]}
[0m04:16:27.979003 [info ] [MainThread]: 
[0m04:16:27.979456 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:16:27.980005 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m04:16:27.987178 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m04:16:27.987409 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m04:16:27.987616 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:16:28.470740 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.483 seconds
[0m04:16:28.476204 [debug] [ThreadPool]: On list_dev: Close
[0m04:16:28.604242 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_stock)
[0m04:16:28.614523 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m04:16:28.615096 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m04:16:28.615537 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:16:29.173799 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.558 seconds
[0m04:16:29.177549 [debug] [ThreadPool]: On list_dev_stock: Close
[0m04:16:29.309471 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_stock, now list_dev_snapshot)
[0m04:16:29.315788 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m04:16:29.316534 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m04:16:29.317185 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:16:29.822893 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.505 seconds
[0m04:16:29.828383 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m04:16:29.949422 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c3f99cff-196f-4077-9cd8-80e82073301d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9c43cda0>]}
[0m04:16:29.950874 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:16:29.953069 [info ] [MainThread]: 
[0m04:16:29.967273 [debug] [Thread-1 (]: Began running node snapshot.lab.snapshot_macd_calculation
[0m04:16:29.968119 [info ] [Thread-1 (]: 1 of 1 START snapshot snapshot.snapshot_macd_calculation ....................... [RUN]
[0m04:16:29.969007 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_snapshot, now snapshot.lab.snapshot_macd_calculation)
[0m04:16:29.969522 [debug] [Thread-1 (]: Began compiling node snapshot.lab.snapshot_macd_calculation
[0m04:16:29.977501 [debug] [Thread-1 (]: Began executing node snapshot.lab.snapshot_macd_calculation
[0m04:16:30.004752 [debug] [Thread-1 (]: Compilation Error in snapshot snapshot_macd_calculation (snapshots/snapshot.macd_calculation.sql)
  The specified strategy macro 'date' was not found in package 'None'
  
  > in macro strategy_dispatch (macros/materializations/snapshots/strategies.sql)
  > called by macro materialization_snapshot_default (macros/materializations/snapshots/snapshot.sql)
  > called by macro materialization_snapshot_snowflake (macros/materializations/snapshot.sql)
  > called by snapshot snapshot_macd_calculation (snapshots/snapshot.macd_calculation.sql)
[0m04:16:30.005763 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c3f99cff-196f-4077-9cd8-80e82073301d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb9109e50>]}
[0m04:16:30.006328 [error] [Thread-1 (]: 1 of 1 ERROR snapshotting snapshot.snapshot_macd_calculation ................... [[31mERROR[0m in 0.04s]
[0m04:16:30.006883 [debug] [Thread-1 (]: Finished running node snapshot.lab.snapshot_macd_calculation
[0m04:16:30.008086 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:16:30.008334 [debug] [MainThread]: Connection 'snapshot.lab.snapshot_macd_calculation' was properly closed.
[0m04:16:30.008591 [info ] [MainThread]: 
[0m04:16:30.008939 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 2.03 seconds (2.03s).
[0m04:16:30.009461 [debug] [MainThread]: Command end result
[0m04:16:30.028756 [info ] [MainThread]: 
[0m04:16:30.029148 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m04:16:30.029461 [info ] [MainThread]: 
[0m04:16:30.029858 [error] [MainThread]:   Compilation Error in snapshot snapshot_macd_calculation (snapshots/snapshot.macd_calculation.sql)
  The specified strategy macro 'date' was not found in package 'None'
  
  > in macro strategy_dispatch (macros/materializations/snapshots/strategies.sql)
  > called by macro materialization_snapshot_default (macros/materializations/snapshots/snapshot.sql)
  > called by macro materialization_snapshot_snowflake (macros/materializations/snapshot.sql)
  > called by snapshot snapshot_macd_calculation (snapshots/snapshot.macd_calculation.sql)
[0m04:16:30.030135 [info ] [MainThread]: 
[0m04:16:30.030448 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m04:16:30.031244 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 2.7795913, "process_user_time": 2.343837, "process_kernel_time": 0.237824, "process_mem_max_rss": "206096", "process_out_blocks": "1850", "command_success": false, "process_in_blocks": "0"}
[0m04:16:30.031563 [debug] [MainThread]: Command `dbt snapshot` failed at 04:16:30.031510 after 2.78 seconds
[0m04:16:30.031814 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffbd00aa20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9c884d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb89ae090>]}
[0m04:16:30.032020 [debug] [MainThread]: Flushing usage events
[0m04:24:11.383441 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb072ad20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf96efc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb16d3650>]}


============================== 04:24:11.387539 | 77dcad65-755a-4a1a-b259-15a9cb5ee762 ==============================
[0m04:24:11.387539 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:24:11.387940 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/lab/logs', 'profiles_dir': '/opt/airflow/lab', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m04:24:11.841618 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '77dcad65-755a-4a1a-b259-15a9cb5ee762', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff96170ce0>]}
[0m04:24:11.864176 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '77dcad65-755a-4a1a-b259-15a9cb5ee762', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8f817020>]}
[0m04:24:11.864894 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:24:11.911766 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:24:11.973763 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m04:24:11.974142 [debug] [MainThread]: Partial parsing: updated file: lab://snapshots/snapshot.macd_calculation.sql
[0m04:24:12.083095 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '77dcad65-755a-4a1a-b259-15a9cb5ee762', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8f25ab10>]}
[0m04:24:12.135991 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '77dcad65-755a-4a1a-b259-15a9cb5ee762', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8f2c3ad0>]}
[0m04:24:12.136288 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m04:24:12.136490 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '77dcad65-755a-4a1a-b259-15a9cb5ee762', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8f4b6450>]}
[0m04:24:12.137389 [info ] [MainThread]: 
[0m04:24:12.137815 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:24:12.140132 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m04:24:12.146208 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m04:24:12.146464 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m04:24:12.146722 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:24:12.935643 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.789 seconds
[0m04:24:12.939432 [debug] [ThreadPool]: On list_dev: Close
[0m04:24:13.081321 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_stock)
[0m04:24:13.092344 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m04:24:13.092825 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m04:24:13.093270 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:24:13.521242 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.428 seconds
[0m04:24:13.524444 [debug] [ThreadPool]: On list_dev_stock: Close
[0m04:24:13.714680 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_stock, now list_dev_snapshot)
[0m04:24:13.717511 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m04:24:13.718011 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m04:24:13.718329 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:24:14.268978 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.551 seconds
[0m04:24:14.271503 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m04:24:14.411036 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '77dcad65-755a-4a1a-b259-15a9cb5ee762', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8f4d4aa0>]}
[0m04:24:14.412661 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:24:14.416249 [info ] [MainThread]: 
[0m04:24:14.431139 [debug] [Thread-1 (]: Began running node model.lab.RSI_Calculation
[0m04:24:14.431973 [info ] [Thread-1 (]: 1 of 2 START sql table model stock.RSI_Calculation ............................. [RUN]
[0m04:24:14.433076 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_snapshot, now model.lab.RSI_Calculation)
[0m04:24:14.433663 [debug] [Thread-1 (]: Began compiling node model.lab.RSI_Calculation
[0m04:24:14.441400 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.RSI_Calculation"
[0m04:24:14.443994 [debug] [Thread-1 (]: Began executing node model.lab.RSI_Calculation
[0m04:24:14.463981 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.RSI_Calculation"
[0m04:24:14.465587 [debug] [Thread-1 (]: Using snowflake connection "model.lab.RSI_Calculation"
[0m04:24:14.465883 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.RSI_Calculation"} */
create or replace transient table dev.stock.RSI_Calculation
         as
        (-- models/rsi_calculation.sql

WITH PriceChanges AS (
    SELECT
        date,
        symbol,
        close,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM
        dev.stock.stock_price_analysis  -- Replace 'stock' and 'stock_price_analysis' with your actual source name and table
),
PriceGainsLosses AS (
    SELECT
        date,
        symbol,
        close,
        next_close,
        CASE 
            WHEN next_close > close THEN next_close - close
            ELSE 0 
        END AS gain,
        CASE 
            WHEN next_close < close THEN close - next_close
            ELSE 0 
        END AS loss
    FROM
        PriceChanges
),
AverageGainsLosses AS (
    SELECT
        date,
        symbol,
        AVG(gain) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain,
        AVG(loss) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss
    FROM
        PriceGainsLosses
),
RSI_Calculation AS (
    SELECT
        date,
        symbol,
        avg_gain,
        avg_loss,
        CASE 
            WHEN avg_loss = 0 THEN 100
            ELSE 100 - (100 / (1 + (avg_gain / avg_loss)))
        END AS rsi
    FROM
        AverageGainsLosses
)
SELECT 
    date, 
    symbol, 
    rsi
FROM 
    RSI_Calculation
WHERE
    date >= (SELECT MIN(date) FROM dev.stock.stock_price_analysis) + INTERVAL '14 DAY'
ORDER BY
    symbol, date
        );
[0m04:24:14.466171 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:24:15.973070 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.506 seconds
[0m04:24:16.005235 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: Close
[0m04:24:16.146850 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '77dcad65-755a-4a1a-b259-15a9cb5ee762', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8f8144d0>]}
[0m04:24:16.154161 [info ] [Thread-1 (]: 1 of 2 OK created sql table model stock.RSI_Calculation ........................ [[32mSUCCESS 1[0m in 1.71s]
[0m04:24:16.157629 [debug] [Thread-1 (]: Finished running node model.lab.RSI_Calculation
[0m04:24:16.158373 [debug] [Thread-1 (]: Began running node model.lab.stock_price_analysis
[0m04:24:16.159087 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.RSI_Calculation, now model.lab.stock_price_analysis)
[0m04:24:16.159680 [debug] [Thread-1 (]: Began compiling node model.lab.stock_price_analysis
[0m04:24:16.162770 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.stock_price_analysis"
[0m04:24:16.166596 [debug] [Thread-1 (]: Finished running node model.lab.stock_price_analysis
[0m04:24:16.168802 [debug] [Thread-1 (]: Began running node model.lab.macd_calculation
[0m04:24:16.169729 [info ] [Thread-1 (]: 2 of 2 START sql table model stock.macd_calculation ............................ [RUN]
[0m04:24:16.170777 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.stock_price_analysis, now model.lab.macd_calculation)
[0m04:24:16.171388 [debug] [Thread-1 (]: Began compiling node model.lab.macd_calculation
[0m04:24:16.193133 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.macd_calculation"
[0m04:24:16.194534 [debug] [Thread-1 (]: Began executing node model.lab.macd_calculation
[0m04:24:16.197011 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.macd_calculation"
[0m04:24:16.199219 [debug] [Thread-1 (]: Using snowflake connection "model.lab.macd_calculation"
[0m04:24:16.199725 [debug] [Thread-1 (]: On model.lab.macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.macd_calculation"} */
create or replace transient table dev.stock.macd_calculation
         as
        (WITH  __dbt__cte__stock_price_analysis as (
WITH stock_data AS (
    SELECT
        *
    FROM dev.stock.stock_price_analysis
)

-- Now you can query the CTE
SELECT * FROM stock_data
), stock_data AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE,
        ROW_NUMBER() OVER (PARTITION BY SYMBOL ORDER BY DATE) AS rn
    FROM __dbt__cte__stock_price_analysis  -- Replace with the reference to your actual source table in DBT
),

-- Calculate 12-day EMA
ema_12 AS (
    SELECT
        SYMBOL,
        DATE,
        CLOSE AS EMA_12,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (12 + 1))) + (e.EMA_12 * (1 - (2.0 / (12 + 1)))) AS EMA_12,
        sd.rn
    FROM stock_data sd
    JOIN ema_12 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate 26-day EMA
ema_26 AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE AS EMA_26,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (26 + 1))) + (e.EMA_26 * (1 - (2.0 / (26 + 1)))) AS EMA_26,
        sd.rn
    FROM stock_data sd
    JOIN ema_26 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate MACD by subtracting 26-day EMA from 12-day EMA
macd_calculation AS (
    SELECT 
        e12.SYMBOL,
        e12.DATE,
        e12.EMA_12 - e26.EMA_26 AS MACD,
        e12.rn
    FROM ema_12 e12
    JOIN ema_26 e26 ON e12.SYMBOL = e26.SYMBOL AND e12.DATE = e26.DATE
),

-- Calculate 9-day EMA of MACD as Signal Line
signal_line AS (
    SELECT 
        SYMBOL,
        DATE,
        MACD,
        MACD AS Signal,
        rn
    FROM macd_calculation
    WHERE rn = 1

    UNION ALL

    SELECT 
        mc.SYMBOL,
        mc.DATE,
        mc.MACD,
        (mc.MACD * (2.0 / (9 + 1))) + (sl.Signal * (1 - (2.0 / (9 + 1)))) AS Signal,
        mc.rn
    FROM macd_calculation mc
    JOIN signal_line sl ON mc.SYMBOL = sl.SYMBOL AND mc.rn = sl.rn + 1
)

-- Final output
SELECT 
    SYMBOL,
    DATE,
    MACD,
    Signal,
    MACD - Signal AS Histogram
FROM signal_line
ORDER BY SYMBOL, DATE
        );
[0m04:24:16.200090 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:24:17.506762 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.306 seconds
[0m04:24:17.511818 [debug] [Thread-1 (]: On model.lab.macd_calculation: Close
[0m04:24:17.637793 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '77dcad65-755a-4a1a-b259-15a9cb5ee762', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8f0e7200>]}
[0m04:24:17.639649 [info ] [Thread-1 (]: 2 of 2 OK created sql table model stock.macd_calculation ....................... [[32mSUCCESS 1[0m in 1.47s]
[0m04:24:17.642100 [debug] [Thread-1 (]: Finished running node model.lab.macd_calculation
[0m04:24:17.644544 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:24:17.645090 [debug] [MainThread]: Connection 'model.lab.macd_calculation' was properly closed.
[0m04:24:17.646034 [info ] [MainThread]: 
[0m04:24:17.646801 [info ] [MainThread]: Finished running 2 table models in 0 hours 0 minutes and 5.51 seconds (5.51s).
[0m04:24:17.648330 [debug] [MainThread]: Command end result
[0m04:24:17.683142 [info ] [MainThread]: 
[0m04:24:17.683728 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:24:17.684074 [info ] [MainThread]: 
[0m04:24:17.684437 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m04:24:17.685467 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.341803, "process_user_time": 2.568847, "process_kernel_time": 0.27233, "process_mem_max_rss": "208648", "process_out_blocks": "2808", "process_in_blocks": "0"}
[0m04:24:17.685817 [debug] [MainThread]: Command `dbt run` succeeded at 04:24:17.685759 after 6.34 seconds
[0m04:24:17.686070 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb04b4770>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8eeb2120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8eeb1e50>]}
[0m04:24:17.686303 [debug] [MainThread]: Flushing usage events
[0m04:24:20.225260 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff994662a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff993e0530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9c141370>]}


============================== 04:24:20.229204 | 9255ed8e-d8df-44d1-8df9-b090d1cb8b5e ==============================
[0m04:24:20.229204 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:24:20.229879 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/lab/logs', 'profiles_dir': '/opt/airflow/lab', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m04:24:20.726710 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9255ed8e-d8df-44d1-8df9-b090d1cb8b5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f590ce0>]}
[0m04:24:20.748526 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9255ed8e-d8df-44d1-8df9-b090d1cb8b5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d98dbb0>]}
[0m04:24:20.748995 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:24:20.796358 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:24:20.868413 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:24:20.868790 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:24:20.896943 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9255ed8e-d8df-44d1-8df9-b090d1cb8b5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d4fc830>]}
[0m04:24:20.960886 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9255ed8e-d8df-44d1-8df9-b090d1cb8b5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d1d1c70>]}
[0m04:24:20.961216 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m04:24:20.961823 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9255ed8e-d8df-44d1-8df9-b090d1cb8b5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ced7710>]}
[0m04:24:20.962689 [info ] [MainThread]: 
[0m04:24:20.963163 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:24:20.965239 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev_snapshot'
[0m04:24:20.973828 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m04:24:20.974089 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m04:24:20.974321 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:24:21.529986 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.555 seconds
[0m04:24:21.532560 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m04:24:21.658585 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m04:24:21.664203 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m04:24:21.665151 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m04:24:21.665663 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:24:22.115094 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.449 seconds
[0m04:24:22.119513 [debug] [ThreadPool]: On list_dev_stock: Close
[0m04:24:22.266526 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9255ed8e-d8df-44d1-8df9-b090d1cb8b5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d32a450>]}
[0m04:24:22.267796 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:24:22.268903 [info ] [MainThread]: 
[0m04:24:22.279183 [debug] [Thread-1 (]: Began running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:24:22.279791 [info ] [Thread-1 (]: 1 of 1 START test not_null_macd_calculation_date ............................... [RUN]
[0m04:24:22.280578 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now test.lab.not_null_macd_calculation_date.1954e908c9)
[0m04:24:22.281151 [debug] [Thread-1 (]: Began compiling node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:24:22.293539 [debug] [Thread-1 (]: Writing injected SQL for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m04:24:22.294782 [debug] [Thread-1 (]: Began executing node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:24:22.308337 [debug] [Thread-1 (]: Writing runtime sql for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m04:24:22.309542 [debug] [Thread-1 (]: Using snowflake connection "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m04:24:22.310001 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "test.lab.not_null_macd_calculation_date.1954e908c9"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from dev.stock.macd_calculation
where date is null



      
    ) dbt_internal_test
[0m04:24:22.310368 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:24:22.949528 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.639 seconds
[0m04:24:22.964527 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: Close
[0m04:24:23.099545 [info ] [Thread-1 (]: 1 of 1 PASS not_null_macd_calculation_date ..................................... [[32mPASS[0m in 0.82s]
[0m04:24:23.102220 [debug] [Thread-1 (]: Finished running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:24:23.104553 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:24:23.105263 [debug] [MainThread]: Connection 'test.lab.not_null_macd_calculation_date.1954e908c9' was properly closed.
[0m04:24:23.105890 [info ] [MainThread]: 
[0m04:24:23.106752 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 2.14 seconds (2.14s).
[0m04:24:23.107901 [debug] [MainThread]: Command end result
[0m04:24:23.142294 [info ] [MainThread]: 
[0m04:24:23.142865 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:24:23.143276 [info ] [MainThread]: 
[0m04:24:23.143707 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m04:24:23.144472 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 2.962738, "process_user_time": 2.328546, "process_kernel_time": 0.275072, "process_mem_max_rss": "207888", "process_out_blocks": "1849", "process_in_blocks": "0"}
[0m04:24:23.144824 [debug] [MainThread]: Command `dbt test` succeeded at 04:24:23.144758 after 2.96 seconds
[0m04:24:23.145090 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff99663140>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff99744fe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff996b3080>]}
[0m04:24:23.145349 [debug] [MainThread]: Flushing usage events
[0m04:24:25.363239 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb34b9af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb34ba840>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb34b8770>]}


============================== 04:24:25.367208 | a8a5e876-6bfc-4fa6-8a30-b7b0bbf69867 ==============================
[0m04:24:25.367208 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:24:25.367936 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/lab', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/lab/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m04:24:25.760793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a8a5e876-6bfc-4fa6-8a30-b7b0bbf69867', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98f88ce0>]}
[0m04:24:25.782523 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a8a5e876-6bfc-4fa6-8a30-b7b0bbf69867', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb252ac60>]}
[0m04:24:25.783010 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:24:25.826519 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:24:25.886368 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:24:25.886666 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:24:25.908788 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a8a5e876-6bfc-4fa6-8a30-b7b0bbf69867', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff92efe9c0>]}
[0m04:24:25.962163 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a8a5e876-6bfc-4fa6-8a30-b7b0bbf69867', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff929ab770>]}
[0m04:24:25.962455 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m04:24:25.962886 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a8a5e876-6bfc-4fa6-8a30-b7b0bbf69867', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa76cabd0>]}
[0m04:24:25.963743 [info ] [MainThread]: 
[0m04:24:25.964209 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:24:25.964712 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m04:24:25.971646 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m04:24:25.971881 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m04:24:25.972068 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:24:26.486135 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.514 seconds
[0m04:24:26.490313 [debug] [ThreadPool]: On list_dev: Close
[0m04:24:26.617136 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_snapshot)
[0m04:24:26.629017 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m04:24:26.629607 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m04:24:26.630060 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:24:27.121441 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.491 seconds
[0m04:24:27.125200 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m04:24:27.265229 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m04:24:27.267719 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m04:24:27.268184 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m04:24:27.268563 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:24:27.720683 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.452 seconds
[0m04:24:27.724928 [debug] [ThreadPool]: On list_dev_stock: Close
[0m04:24:27.867442 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a8a5e876-6bfc-4fa6-8a30-b7b0bbf69867', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff92933680>]}
[0m04:24:27.868718 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:24:27.870317 [info ] [MainThread]: 
[0m04:24:27.882625 [debug] [Thread-1 (]: Began running node snapshot.lab.snapshot_macd_calculation
[0m04:24:27.883329 [info ] [Thread-1 (]: 1 of 1 START snapshot snapshot.snapshot_macd_calculation ....................... [RUN]
[0m04:24:27.884120 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now snapshot.lab.snapshot_macd_calculation)
[0m04:24:27.884561 [debug] [Thread-1 (]: Began compiling node snapshot.lab.snapshot_macd_calculation
[0m04:24:27.892030 [debug] [Thread-1 (]: Began executing node snapshot.lab.snapshot_macd_calculation
[0m04:24:27.919881 [debug] [Thread-1 (]: Compilation Error in snapshot snapshot_macd_calculation (snapshots/snapshot.macd_calculation.sql)
  The specified strategy macro 'date' was not found in package 'None'
  
  > in macro strategy_dispatch (macros/materializations/snapshots/strategies.sql)
  > called by macro materialization_snapshot_default (macros/materializations/snapshots/snapshot.sql)
  > called by macro materialization_snapshot_snowflake (macros/materializations/snapshot.sql)
  > called by snapshot snapshot_macd_calculation (snapshots/snapshot.macd_calculation.sql)
[0m04:24:27.920784 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8a5e876-6bfc-4fa6-8a30-b7b0bbf69867', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff92ea1250>]}
[0m04:24:27.921331 [error] [Thread-1 (]: 1 of 1 ERROR snapshotting snapshot.snapshot_macd_calculation ................... [[31mERROR[0m in 0.04s]
[0m04:24:27.921900 [debug] [Thread-1 (]: Finished running node snapshot.lab.snapshot_macd_calculation
[0m04:24:27.922968 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:24:27.923188 [debug] [MainThread]: Connection 'snapshot.lab.snapshot_macd_calculation' was properly closed.
[0m04:24:27.923421 [info ] [MainThread]: 
[0m04:24:27.923799 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 1.96 seconds (1.96s).
[0m04:24:27.924311 [debug] [MainThread]: Command end result
[0m04:24:27.940876 [info ] [MainThread]: 
[0m04:24:27.941188 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m04:24:27.941410 [info ] [MainThread]: 
[0m04:24:27.941733 [error] [MainThread]:   Compilation Error in snapshot snapshot_macd_calculation (snapshots/snapshot.macd_calculation.sql)
  The specified strategy macro 'date' was not found in package 'None'
  
  > in macro strategy_dispatch (macros/materializations/snapshots/strategies.sql)
  > called by macro materialization_snapshot_default (macros/materializations/snapshots/snapshot.sql)
  > called by macro materialization_snapshot_snowflake (macros/materializations/snapshot.sql)
  > called by snapshot snapshot_macd_calculation (snapshots/snapshot.macd_calculation.sql)
[0m04:24:27.942015 [info ] [MainThread]: 
[0m04:24:27.942248 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m04:24:27.942805 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 2.6397126, "process_user_time": 2.241401, "process_kernel_time": 0.160608, "process_mem_max_rss": "205996", "process_out_blocks": "1850", "command_success": false, "process_in_blocks": "0"}
[0m04:24:27.943113 [debug] [MainThread]: Command `dbt snapshot` failed at 04:24:27.943056 after 2.64 seconds
[0m04:24:27.943357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb4917410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff93964ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb2a94ec0>]}
[0m04:24:27.943569 [debug] [MainThread]: Flushing usage events
[0m04:25:03.994947 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86d923f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84709bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff847095e0>]}


============================== 04:25:03.999586 | 942b6f2c-0504-47ea-8726-a50470101819 ==============================
[0m04:25:03.999586 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:25:04.000312 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/lab', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/lab/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m04:25:04.429218 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '942b6f2c-0504-47ea-8726-a50470101819', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff63e97b90>]}
[0m04:25:04.450908 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '942b6f2c-0504-47ea-8726-a50470101819', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84fde1b0>]}
[0m04:25:04.451362 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:25:04.495937 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:25:04.561149 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m04:25:04.561532 [debug] [MainThread]: Partial parsing: updated file: lab://snapshots/snapshot.macd_calculation.sql
[0m04:25:04.675457 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '942b6f2c-0504-47ea-8726-a50470101819', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff63aa2900>]}
[0m04:25:04.729829 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '942b6f2c-0504-47ea-8726-a50470101819', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff63b12db0>]}
[0m04:25:04.730147 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m04:25:04.730590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '942b6f2c-0504-47ea-8726-a50470101819', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff639615b0>]}
[0m04:25:04.731462 [info ] [MainThread]: 
[0m04:25:04.731892 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:25:04.734313 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m04:25:04.740346 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m04:25:04.740571 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m04:25:04.740760 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:25:05.265029 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.524 seconds
[0m04:25:05.267820 [debug] [ThreadPool]: On list_dev: Close
[0m04:25:05.416616 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_stock)
[0m04:25:05.431730 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m04:25:05.432301 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m04:25:05.432841 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:25:05.897069 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.464 seconds
[0m04:25:05.900543 [debug] [ThreadPool]: On list_dev_stock: Close
[0m04:25:06.053873 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_stock, now list_dev_snapshot)
[0m04:25:06.060969 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m04:25:06.061878 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m04:25:06.062459 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:25:06.646536 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.584 seconds
[0m04:25:06.649110 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m04:25:06.765015 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '942b6f2c-0504-47ea-8726-a50470101819', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85100a10>]}
[0m04:25:06.765861 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:25:06.768635 [info ] [MainThread]: 
[0m04:25:06.779331 [debug] [Thread-1 (]: Began running node model.lab.RSI_Calculation
[0m04:25:06.780038 [info ] [Thread-1 (]: 1 of 2 START sql table model stock.RSI_Calculation ............................. [RUN]
[0m04:25:06.780943 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_snapshot, now model.lab.RSI_Calculation)
[0m04:25:06.781340 [debug] [Thread-1 (]: Began compiling node model.lab.RSI_Calculation
[0m04:25:06.787403 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.RSI_Calculation"
[0m04:25:06.789481 [debug] [Thread-1 (]: Began executing node model.lab.RSI_Calculation
[0m04:25:06.806595 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.RSI_Calculation"
[0m04:25:06.808280 [debug] [Thread-1 (]: Using snowflake connection "model.lab.RSI_Calculation"
[0m04:25:06.808582 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.RSI_Calculation"} */
create or replace transient table dev.stock.RSI_Calculation
         as
        (-- models/rsi_calculation.sql

WITH PriceChanges AS (
    SELECT
        date,
        symbol,
        close,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM
        dev.stock.stock_price_analysis  -- Replace 'stock' and 'stock_price_analysis' with your actual source name and table
),
PriceGainsLosses AS (
    SELECT
        date,
        symbol,
        close,
        next_close,
        CASE 
            WHEN next_close > close THEN next_close - close
            ELSE 0 
        END AS gain,
        CASE 
            WHEN next_close < close THEN close - next_close
            ELSE 0 
        END AS loss
    FROM
        PriceChanges
),
AverageGainsLosses AS (
    SELECT
        date,
        symbol,
        AVG(gain) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain,
        AVG(loss) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss
    FROM
        PriceGainsLosses
),
RSI_Calculation AS (
    SELECT
        date,
        symbol,
        avg_gain,
        avg_loss,
        CASE 
            WHEN avg_loss = 0 THEN 100
            ELSE 100 - (100 / (1 + (avg_gain / avg_loss)))
        END AS rsi
    FROM
        AverageGainsLosses
)
SELECT 
    date, 
    symbol, 
    rsi
FROM 
    RSI_Calculation
WHERE
    date >= (SELECT MIN(date) FROM dev.stock.stock_price_analysis) + INTERVAL '14 DAY'
ORDER BY
    symbol, date
        );
[0m04:25:06.808930 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:25:08.017591 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.208 seconds
[0m04:25:08.043012 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: Close
[0m04:25:08.163154 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '942b6f2c-0504-47ea-8726-a50470101819', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff63fc0800>]}
[0m04:25:08.163808 [info ] [Thread-1 (]: 1 of 2 OK created sql table model stock.RSI_Calculation ........................ [[32mSUCCESS 1[0m in 1.38s]
[0m04:25:08.164798 [debug] [Thread-1 (]: Finished running node model.lab.RSI_Calculation
[0m04:25:08.165116 [debug] [Thread-1 (]: Began running node model.lab.stock_price_analysis
[0m04:25:08.165458 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.RSI_Calculation, now model.lab.stock_price_analysis)
[0m04:25:08.165752 [debug] [Thread-1 (]: Began compiling node model.lab.stock_price_analysis
[0m04:25:08.167337 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.stock_price_analysis"
[0m04:25:08.168315 [debug] [Thread-1 (]: Finished running node model.lab.stock_price_analysis
[0m04:25:08.168971 [debug] [Thread-1 (]: Began running node model.lab.macd_calculation
[0m04:25:08.169257 [info ] [Thread-1 (]: 2 of 2 START sql table model stock.macd_calculation ............................ [RUN]
[0m04:25:08.169822 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.stock_price_analysis, now model.lab.macd_calculation)
[0m04:25:08.170037 [debug] [Thread-1 (]: Began compiling node model.lab.macd_calculation
[0m04:25:08.180848 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.macd_calculation"
[0m04:25:08.181826 [debug] [Thread-1 (]: Began executing node model.lab.macd_calculation
[0m04:25:08.183350 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.macd_calculation"
[0m04:25:08.184856 [debug] [Thread-1 (]: Using snowflake connection "model.lab.macd_calculation"
[0m04:25:08.185186 [debug] [Thread-1 (]: On model.lab.macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.macd_calculation"} */
create or replace transient table dev.stock.macd_calculation
         as
        (WITH  __dbt__cte__stock_price_analysis as (
WITH stock_data AS (
    SELECT
        *
    FROM dev.stock.stock_price_analysis
)

-- Now you can query the CTE
SELECT * FROM stock_data
), stock_data AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE,
        ROW_NUMBER() OVER (PARTITION BY SYMBOL ORDER BY DATE) AS rn
    FROM __dbt__cte__stock_price_analysis  -- Replace with the reference to your actual source table in DBT
),

-- Calculate 12-day EMA
ema_12 AS (
    SELECT
        SYMBOL,
        DATE,
        CLOSE AS EMA_12,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (12 + 1))) + (e.EMA_12 * (1 - (2.0 / (12 + 1)))) AS EMA_12,
        sd.rn
    FROM stock_data sd
    JOIN ema_12 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate 26-day EMA
ema_26 AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE AS EMA_26,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (26 + 1))) + (e.EMA_26 * (1 - (2.0 / (26 + 1)))) AS EMA_26,
        sd.rn
    FROM stock_data sd
    JOIN ema_26 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate MACD by subtracting 26-day EMA from 12-day EMA
macd_calculation AS (
    SELECT 
        e12.SYMBOL,
        e12.DATE,
        e12.EMA_12 - e26.EMA_26 AS MACD,
        e12.rn
    FROM ema_12 e12
    JOIN ema_26 e26 ON e12.SYMBOL = e26.SYMBOL AND e12.DATE = e26.DATE
),

-- Calculate 9-day EMA of MACD as Signal Line
signal_line AS (
    SELECT 
        SYMBOL,
        DATE,
        MACD,
        MACD AS Signal,
        rn
    FROM macd_calculation
    WHERE rn = 1

    UNION ALL

    SELECT 
        mc.SYMBOL,
        mc.DATE,
        mc.MACD,
        (mc.MACD * (2.0 / (9 + 1))) + (sl.Signal * (1 - (2.0 / (9 + 1)))) AS Signal,
        mc.rn
    FROM macd_calculation mc
    JOIN signal_line sl ON mc.SYMBOL = sl.SYMBOL AND mc.rn = sl.rn + 1
)

-- Final output
SELECT 
    SYMBOL,
    DATE,
    MACD,
    Signal,
    MACD - Signal AS Histogram
FROM signal_line
ORDER BY SYMBOL, DATE
        );
[0m04:25:08.185491 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:25:09.526097 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.340 seconds
[0m04:25:09.532393 [debug] [Thread-1 (]: On model.lab.macd_calculation: Close
[0m04:25:09.688378 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '942b6f2c-0504-47ea-8726-a50470101819', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff636fcec0>]}
[0m04:25:09.690740 [info ] [Thread-1 (]: 2 of 2 OK created sql table model stock.macd_calculation ....................... [[32mSUCCESS 1[0m in 1.52s]
[0m04:25:09.693309 [debug] [Thread-1 (]: Finished running node model.lab.macd_calculation
[0m04:25:09.697447 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:25:09.698177 [debug] [MainThread]: Connection 'model.lab.macd_calculation' was properly closed.
[0m04:25:09.698964 [info ] [MainThread]: 
[0m04:25:09.700173 [info ] [MainThread]: Finished running 2 table models in 0 hours 0 minutes and 4.97 seconds (4.97s).
[0m04:25:09.701843 [debug] [MainThread]: Command end result
[0m04:25:09.736108 [info ] [MainThread]: 
[0m04:25:09.736683 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:25:09.737042 [info ] [MainThread]: 
[0m04:25:09.737460 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m04:25:09.739285 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.7962775, "process_user_time": 2.531229, "process_kernel_time": 0.262371, "process_mem_max_rss": "208540", "process_out_blocks": "2808", "process_in_blocks": "0"}
[0m04:25:09.739797 [debug] [MainThread]: Command `dbt run` succeeded at 04:25:09.739739 after 5.80 seconds
[0m04:25:09.740179 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83bd95b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff63a97e30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff855d58e0>]}
[0m04:25:09.740456 [debug] [MainThread]: Flushing usage events
[0m04:25:12.480482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88941f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88941880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88942b40>]}


============================== 04:25:12.484084 | ba0795db-34bd-40e4-b628-ded50884cf92 ==============================
[0m04:25:12.484084 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:25:12.484788 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/lab/logs', 'profiles_dir': '/opt/airflow/lab', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m04:25:12.929407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ba0795db-34bd-40e4-b628-ded50884cf92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff884f14f0>]}
[0m04:25:12.951366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ba0795db-34bd-40e4-b628-ded50884cf92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff67ef0bf0>]}
[0m04:25:12.951853 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:25:12.995637 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:25:13.058737 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:25:13.059045 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:25:13.080941 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ba0795db-34bd-40e4-b628-ded50884cf92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff67977b00>]}
[0m04:25:13.140874 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ba0795db-34bd-40e4-b628-ded50884cf92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff67461010>]}
[0m04:25:13.141183 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m04:25:13.141587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ba0795db-34bd-40e4-b628-ded50884cf92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6762d610>]}
[0m04:25:13.142401 [info ] [MainThread]: 
[0m04:25:13.142795 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:25:13.144857 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev_stock'
[0m04:25:13.153273 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m04:25:13.153511 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m04:25:13.153696 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:25:13.658441 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.505 seconds
[0m04:25:13.660849 [debug] [ThreadPool]: On list_dev_stock: Close
[0m04:25:13.785502 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_stock, now list_dev_snapshot)
[0m04:25:13.790100 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m04:25:13.790743 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m04:25:13.791282 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:25:14.261786 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.470 seconds
[0m04:25:14.266475 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m04:25:14.417038 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ba0795db-34bd-40e4-b628-ded50884cf92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff67a68d10>]}
[0m04:25:14.418894 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:25:14.420763 [info ] [MainThread]: 
[0m04:25:14.435118 [debug] [Thread-1 (]: Began running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:25:14.435904 [info ] [Thread-1 (]: 1 of 1 START test not_null_macd_calculation_date ............................... [RUN]
[0m04:25:14.436866 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_snapshot, now test.lab.not_null_macd_calculation_date.1954e908c9)
[0m04:25:14.437394 [debug] [Thread-1 (]: Began compiling node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:25:14.451562 [debug] [Thread-1 (]: Writing injected SQL for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m04:25:14.452900 [debug] [Thread-1 (]: Began executing node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:25:14.466004 [debug] [Thread-1 (]: Writing runtime sql for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m04:25:14.467048 [debug] [Thread-1 (]: Using snowflake connection "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m04:25:14.467366 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "test.lab.not_null_macd_calculation_date.1954e908c9"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from dev.stock.macd_calculation
where date is null



      
    ) dbt_internal_test
[0m04:25:14.467674 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:25:14.963655 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.496 seconds
[0m04:25:14.970156 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: Close
[0m04:25:15.097021 [info ] [Thread-1 (]: 1 of 1 PASS not_null_macd_calculation_date ..................................... [[32mPASS[0m in 0.66s]
[0m04:25:15.099654 [debug] [Thread-1 (]: Finished running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:25:15.102369 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:25:15.102973 [debug] [MainThread]: Connection 'test.lab.not_null_macd_calculation_date.1954e908c9' was properly closed.
[0m04:25:15.103520 [info ] [MainThread]: 
[0m04:25:15.104375 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 1.96 seconds (1.96s).
[0m04:25:15.105931 [debug] [MainThread]: Command end result
[0m04:25:15.142760 [info ] [MainThread]: 
[0m04:25:15.143323 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:25:15.143668 [info ] [MainThread]: 
[0m04:25:15.144035 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m04:25:15.144852 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 2.7020123, "process_user_time": 2.297188, "process_kernel_time": 0.209018, "process_mem_max_rss": "208036", "process_out_blocks": "1849", "process_in_blocks": "0"}
[0m04:25:15.145246 [debug] [MainThread]: Command `dbt test` succeeded at 04:25:15.145185 after 2.70 seconds
[0m04:25:15.145567 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff884f1940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6d337fe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87eaa150>]}
[0m04:25:15.145881 [debug] [MainThread]: Flushing usage events
[0m04:25:16.836575 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7df73320>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7efb1fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e0e9700>]}


============================== 04:25:16.840093 | 60400ace-2fd6-4ee5-af91-eaef1d2fa65c ==============================
[0m04:25:16.840093 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:25:16.840688 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/lab/logs', 'version_check': 'True', 'profiles_dir': '/opt/airflow/lab', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m04:25:17.241797 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '60400ace-2fd6-4ee5-af91-eaef1d2fa65c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff60415640>]}
[0m04:25:17.263620 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '60400ace-2fd6-4ee5-af91-eaef1d2fa65c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff605bf800>]}
[0m04:25:17.264092 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:25:17.306542 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:25:17.366442 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:25:17.366745 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:25:17.388729 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '60400ace-2fd6-4ee5-af91-eaef1d2fa65c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5bf34aa0>]}
[0m04:25:17.440224 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '60400ace-2fd6-4ee5-af91-eaef1d2fa65c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5bc07830>]}
[0m04:25:17.440508 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m04:25:17.440914 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '60400ace-2fd6-4ee5-af91-eaef1d2fa65c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5bf227e0>]}
[0m04:25:17.441747 [info ] [MainThread]: 
[0m04:25:17.442126 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:25:17.442621 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m04:25:17.449568 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m04:25:17.449804 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m04:25:17.450004 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:25:17.923374 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.473 seconds
[0m04:25:17.927734 [debug] [ThreadPool]: On list_dev: Close
[0m04:25:18.064762 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_stock)
[0m04:25:18.074537 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m04:25:18.075073 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m04:25:18.075424 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:25:18.524250 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.449 seconds
[0m04:25:18.526342 [debug] [ThreadPool]: On list_dev_stock: Close
[0m04:25:18.642430 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_stock, now list_dev_snapshot)
[0m04:25:18.645971 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m04:25:18.646369 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m04:25:18.646780 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:25:19.076312 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.429 seconds
[0m04:25:19.080574 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m04:25:19.205155 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '60400ace-2fd6-4ee5-af91-eaef1d2fa65c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff600bfad0>]}
[0m04:25:19.206876 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:25:19.208960 [info ] [MainThread]: 
[0m04:25:19.221838 [debug] [Thread-1 (]: Began running node snapshot.lab.snapshot_macd_calculation
[0m04:25:19.222513 [info ] [Thread-1 (]: 1 of 1 START snapshot snapshot.snapshot_macd_calculation ....................... [RUN]
[0m04:25:19.223176 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_snapshot, now snapshot.lab.snapshot_macd_calculation)
[0m04:25:19.223585 [debug] [Thread-1 (]: Began compiling node snapshot.lab.snapshot_macd_calculation
[0m04:25:19.230370 [debug] [Thread-1 (]: Began executing node snapshot.lab.snapshot_macd_calculation
[0m04:25:19.257184 [debug] [Thread-1 (]: Compilation Error in snapshot snapshot_macd_calculation (snapshots/snapshot.macd_calculation.sql)
  The specified strategy macro 'date' was not found in package 'None'
  
  > in macro strategy_dispatch (macros/materializations/snapshots/strategies.sql)
  > called by macro materialization_snapshot_default (macros/materializations/snapshots/snapshot.sql)
  > called by macro materialization_snapshot_snowflake (macros/materializations/snapshot.sql)
  > called by snapshot snapshot_macd_calculation (snapshots/snapshot.macd_calculation.sql)
[0m04:25:19.258210 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60400ace-2fd6-4ee5-af91-eaef1d2fa65c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5bbfad20>]}
[0m04:25:19.258788 [error] [Thread-1 (]: 1 of 1 ERROR snapshotting snapshot.snapshot_macd_calculation ................... [[31mERROR[0m in 0.03s]
[0m04:25:19.259326 [debug] [Thread-1 (]: Finished running node snapshot.lab.snapshot_macd_calculation
[0m04:25:19.260521 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:25:19.260782 [debug] [MainThread]: Connection 'snapshot.lab.snapshot_macd_calculation' was properly closed.
[0m04:25:19.261075 [info ] [MainThread]: 
[0m04:25:19.261436 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 1.82 seconds (1.82s).
[0m04:25:19.261990 [debug] [MainThread]: Command end result
[0m04:25:19.281062 [info ] [MainThread]: 
[0m04:25:19.281475 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m04:25:19.281771 [info ] [MainThread]: 
[0m04:25:19.282070 [error] [MainThread]:   Compilation Error in snapshot snapshot_macd_calculation (snapshots/snapshot.macd_calculation.sql)
  The specified strategy macro 'date' was not found in package 'None'
  
  > in macro strategy_dispatch (macros/materializations/snapshots/strategies.sql)
  > called by macro materialization_snapshot_default (macros/materializations/snapshots/snapshot.sql)
  > called by macro materialization_snapshot_snowflake (macros/materializations/snapshot.sql)
  > called by snapshot snapshot_macd_calculation (snapshots/snapshot.macd_calculation.sql)
[0m04:25:19.282334 [info ] [MainThread]: 
[0m04:25:19.282574 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m04:25:19.283396 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 2.486019, "process_user_time": 2.219083, "process_kernel_time": 0.155075, "process_mem_max_rss": "206000", "process_out_blocks": "1850", "command_success": false, "process_in_blocks": "0"}
[0m04:25:19.283738 [debug] [MainThread]: Command `dbt snapshot` failed at 04:25:19.283678 after 2.49 seconds
[0m04:25:19.284037 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7df73320>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c3b05f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ce55370>]}
[0m04:25:19.284266 [debug] [MainThread]: Flushing usage events
[0m04:27:38.293098 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9cdbe2d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9ddb1880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9c073890>]}


============================== 04:27:38.297296 | 184d5a62-ae96-4c6a-be81-515747e892a8 ==============================
[0m04:27:38.297296 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:27:38.297869 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/lab', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/lab/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m04:27:38.774657 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '184d5a62-ae96-4c6a-be81-515747e892a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82ba0ce0>]}
[0m04:27:38.797666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '184d5a62-ae96-4c6a-be81-515747e892a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9c071070>]}
[0m04:27:38.798097 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:27:38.842565 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:27:38.909025 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m04:27:38.909453 [debug] [MainThread]: Partial parsing: updated file: lab://snapshots/snapshot.macd_calculation.sql
[0m04:27:39.016136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '184d5a62-ae96-4c6a-be81-515747e892a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7bb51ca0>]}
[0m04:27:39.067726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '184d5a62-ae96-4c6a-be81-515747e892a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7bb80c80>]}
[0m04:27:39.068043 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m04:27:39.068638 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '184d5a62-ae96-4c6a-be81-515747e892a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7bb2fcb0>]}
[0m04:27:39.069528 [info ] [MainThread]: 
[0m04:27:39.069967 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:27:39.072304 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m04:27:39.080157 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m04:27:39.080431 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m04:27:39.080685 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:27:39.597750 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.517 seconds
[0m04:27:39.600196 [debug] [ThreadPool]: On list_dev: Close
[0m04:27:39.729400 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_stock)
[0m04:27:39.748232 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m04:27:39.748964 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m04:27:39.749425 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:27:40.672881 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.923 seconds
[0m04:27:40.679031 [debug] [ThreadPool]: On list_dev_stock: Close
[0m04:27:40.808642 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_stock, now list_dev_snapshot)
[0m04:27:40.814907 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m04:27:40.815748 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m04:27:40.816294 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:27:41.320967 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.504 seconds
[0m04:27:41.325140 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m04:27:41.493805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '184d5a62-ae96-4c6a-be81-515747e892a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ba0e300>]}
[0m04:27:41.495925 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:27:41.499138 [info ] [MainThread]: 
[0m04:27:41.513257 [debug] [Thread-1 (]: Began running node model.lab.RSI_Calculation
[0m04:27:41.514057 [info ] [Thread-1 (]: 1 of 2 START sql table model stock.RSI_Calculation ............................. [RUN]
[0m04:27:41.515015 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_snapshot, now model.lab.RSI_Calculation)
[0m04:27:41.515513 [debug] [Thread-1 (]: Began compiling node model.lab.RSI_Calculation
[0m04:27:41.522966 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.RSI_Calculation"
[0m04:27:41.525188 [debug] [Thread-1 (]: Began executing node model.lab.RSI_Calculation
[0m04:27:41.544615 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.RSI_Calculation"
[0m04:27:41.546116 [debug] [Thread-1 (]: Using snowflake connection "model.lab.RSI_Calculation"
[0m04:27:41.546424 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.RSI_Calculation"} */
create or replace transient table dev.stock.RSI_Calculation
         as
        (-- models/rsi_calculation.sql

WITH PriceChanges AS (
    SELECT
        date,
        symbol,
        close,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM
        dev.stock.stock_price_analysis  -- Replace 'stock' and 'stock_price_analysis' with your actual source name and table
),
PriceGainsLosses AS (
    SELECT
        date,
        symbol,
        close,
        next_close,
        CASE 
            WHEN next_close > close THEN next_close - close
            ELSE 0 
        END AS gain,
        CASE 
            WHEN next_close < close THEN close - next_close
            ELSE 0 
        END AS loss
    FROM
        PriceChanges
),
AverageGainsLosses AS (
    SELECT
        date,
        symbol,
        AVG(gain) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain,
        AVG(loss) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss
    FROM
        PriceGainsLosses
),
RSI_Calculation AS (
    SELECT
        date,
        symbol,
        avg_gain,
        avg_loss,
        CASE 
            WHEN avg_loss = 0 THEN 100
            ELSE 100 - (100 / (1 + (avg_gain / avg_loss)))
        END AS rsi
    FROM
        AverageGainsLosses
)
SELECT 
    date, 
    symbol, 
    rsi
FROM 
    RSI_Calculation
WHERE
    date >= (SELECT MIN(date) FROM dev.stock.stock_price_analysis) + INTERVAL '14 DAY'
ORDER BY
    symbol, date
        );
[0m04:27:41.546747 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:27:42.921443 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.374 seconds
[0m04:27:42.943042 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: Close
[0m04:27:43.067144 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '184d5a62-ae96-4c6a-be81-515747e892a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8015c830>]}
[0m04:27:43.068284 [info ] [Thread-1 (]: 1 of 2 OK created sql table model stock.RSI_Calculation ........................ [[32mSUCCESS 1[0m in 1.55s]
[0m04:27:43.069826 [debug] [Thread-1 (]: Finished running node model.lab.RSI_Calculation
[0m04:27:43.070497 [debug] [Thread-1 (]: Began running node model.lab.stock_price_analysis
[0m04:27:43.071155 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.RSI_Calculation, now model.lab.stock_price_analysis)
[0m04:27:43.071715 [debug] [Thread-1 (]: Began compiling node model.lab.stock_price_analysis
[0m04:27:43.074607 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.stock_price_analysis"
[0m04:27:43.076858 [debug] [Thread-1 (]: Finished running node model.lab.stock_price_analysis
[0m04:27:43.077965 [debug] [Thread-1 (]: Began running node model.lab.macd_calculation
[0m04:27:43.078448 [info ] [Thread-1 (]: 2 of 2 START sql table model stock.macd_calculation ............................ [RUN]
[0m04:27:43.079485 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.stock_price_analysis, now model.lab.macd_calculation)
[0m04:27:43.079860 [debug] [Thread-1 (]: Began compiling node model.lab.macd_calculation
[0m04:27:43.097502 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.macd_calculation"
[0m04:27:43.098604 [debug] [Thread-1 (]: Began executing node model.lab.macd_calculation
[0m04:27:43.100540 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.macd_calculation"
[0m04:27:43.102417 [debug] [Thread-1 (]: Using snowflake connection "model.lab.macd_calculation"
[0m04:27:43.102793 [debug] [Thread-1 (]: On model.lab.macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.macd_calculation"} */
create or replace transient table dev.stock.macd_calculation
         as
        (WITH  __dbt__cte__stock_price_analysis as (
WITH stock_data AS (
    SELECT
        *
    FROM dev.stock.stock_price_analysis
)

-- Now you can query the CTE
SELECT * FROM stock_data
), stock_data AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE,
        ROW_NUMBER() OVER (PARTITION BY SYMBOL ORDER BY DATE) AS rn
    FROM __dbt__cte__stock_price_analysis  -- Replace with the reference to your actual source table in DBT
),

-- Calculate 12-day EMA
ema_12 AS (
    SELECT
        SYMBOL,
        DATE,
        CLOSE AS EMA_12,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (12 + 1))) + (e.EMA_12 * (1 - (2.0 / (12 + 1)))) AS EMA_12,
        sd.rn
    FROM stock_data sd
    JOIN ema_12 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate 26-day EMA
ema_26 AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE AS EMA_26,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (26 + 1))) + (e.EMA_26 * (1 - (2.0 / (26 + 1)))) AS EMA_26,
        sd.rn
    FROM stock_data sd
    JOIN ema_26 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate MACD by subtracting 26-day EMA from 12-day EMA
macd_calculation AS (
    SELECT 
        e12.SYMBOL,
        e12.DATE,
        e12.EMA_12 - e26.EMA_26 AS MACD,
        e12.rn
    FROM ema_12 e12
    JOIN ema_26 e26 ON e12.SYMBOL = e26.SYMBOL AND e12.DATE = e26.DATE
),

-- Calculate 9-day EMA of MACD as Signal Line
signal_line AS (
    SELECT 
        SYMBOL,
        DATE,
        MACD,
        MACD AS Signal,
        rn
    FROM macd_calculation
    WHERE rn = 1

    UNION ALL

    SELECT 
        mc.SYMBOL,
        mc.DATE,
        mc.MACD,
        (mc.MACD * (2.0 / (9 + 1))) + (sl.Signal * (1 - (2.0 / (9 + 1)))) AS Signal,
        mc.rn
    FROM macd_calculation mc
    JOIN signal_line sl ON mc.SYMBOL = sl.SYMBOL AND mc.rn = sl.rn + 1
)

-- Final output
SELECT 
    SYMBOL,
    DATE,
    MACD,
    Signal,
    MACD - Signal AS Histogram
FROM signal_line
ORDER BY SYMBOL, DATE
        );
[0m04:27:43.103111 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:27:44.358574 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.255 seconds
[0m04:27:44.364096 [debug] [Thread-1 (]: On model.lab.macd_calculation: Close
[0m04:27:44.518567 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '184d5a62-ae96-4c6a-be81-515747e892a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7af35970>]}
[0m04:27:44.520170 [info ] [Thread-1 (]: 2 of 2 OK created sql table model stock.macd_calculation ....................... [[32mSUCCESS 1[0m in 1.44s]
[0m04:27:44.522042 [debug] [Thread-1 (]: Finished running node model.lab.macd_calculation
[0m04:27:44.524112 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:27:44.524742 [debug] [MainThread]: Connection 'model.lab.macd_calculation' was properly closed.
[0m04:27:44.525437 [info ] [MainThread]: 
[0m04:27:44.526369 [info ] [MainThread]: Finished running 2 table models in 0 hours 0 minutes and 5.46 seconds (5.46s).
[0m04:27:44.527776 [debug] [MainThread]: Command end result
[0m04:27:44.559063 [info ] [MainThread]: 
[0m04:27:44.559654 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:27:44.560073 [info ] [MainThread]: 
[0m04:27:44.560487 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m04:27:44.561964 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.30881, "process_user_time": 2.586683, "process_kernel_time": 0.302761, "process_mem_max_rss": "208508", "process_out_blocks": "2808", "process_in_blocks": "0"}
[0m04:27:44.562458 [debug] [MainThread]: Command `dbt run` succeeded at 04:27:44.562390 after 6.31 seconds
[0m04:27:44.562818 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9cdbe2d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8012f2c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9c070d70>]}
[0m04:27:44.563079 [debug] [MainThread]: Flushing usage events
[0m04:27:47.478080 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8734d7c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86d2fb60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86d2f8c0>]}


============================== 04:27:47.481890 | c6fef45f-6796-4500-a754-e9b38b3ba714 ==============================
[0m04:27:47.481890 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:27:47.482691 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/lab/logs', 'profiles_dir': '/opt/airflow/lab', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m04:27:47.934131 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c6fef45f-6796-4500-a754-e9b38b3ba714', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff837fb080>]}
[0m04:27:47.956256 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c6fef45f-6796-4500-a754-e9b38b3ba714', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff837f82f0>]}
[0m04:27:47.956713 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:27:48.001160 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:27:48.070702 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:27:48.071046 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:27:48.093509 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c6fef45f-6796-4500-a754-e9b38b3ba714', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff66ef4d10>]}
[0m04:27:48.170967 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c6fef45f-6796-4500-a754-e9b38b3ba714', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff669b8bc0>]}
[0m04:27:48.175143 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m04:27:48.178270 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c6fef45f-6796-4500-a754-e9b38b3ba714', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff66ee6210>]}
[0m04:27:48.179836 [info ] [MainThread]: 
[0m04:27:48.181554 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:27:48.184921 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev_snapshot'
[0m04:27:48.194070 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m04:27:48.194360 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m04:27:48.194617 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:27:48.713163 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.518 seconds
[0m04:27:48.715473 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m04:27:48.843539 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m04:27:48.847346 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m04:27:48.847992 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m04:27:48.848596 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:27:49.469768 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.621 seconds
[0m04:27:49.475689 [debug] [ThreadPool]: On list_dev_stock: Close
[0m04:27:49.619653 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c6fef45f-6796-4500-a754-e9b38b3ba714', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff66991940>]}
[0m04:27:49.621385 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:27:49.624443 [info ] [MainThread]: 
[0m04:27:49.638319 [debug] [Thread-1 (]: Began running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:27:49.638915 [info ] [Thread-1 (]: 1 of 1 START test not_null_macd_calculation_date ............................... [RUN]
[0m04:27:49.639713 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now test.lab.not_null_macd_calculation_date.1954e908c9)
[0m04:27:49.640150 [debug] [Thread-1 (]: Began compiling node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:27:49.653949 [debug] [Thread-1 (]: Writing injected SQL for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m04:27:49.655889 [debug] [Thread-1 (]: Began executing node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:27:49.668298 [debug] [Thread-1 (]: Writing runtime sql for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m04:27:49.669333 [debug] [Thread-1 (]: Using snowflake connection "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m04:27:49.669659 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "test.lab.not_null_macd_calculation_date.1954e908c9"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from dev.stock.macd_calculation
where date is null



      
    ) dbt_internal_test
[0m04:27:49.669931 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:27:50.187629 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.518 seconds
[0m04:27:50.195807 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: Close
[0m04:27:50.339836 [info ] [Thread-1 (]: 1 of 1 PASS not_null_macd_calculation_date ..................................... [[32mPASS[0m in 0.70s]
[0m04:27:50.342141 [debug] [Thread-1 (]: Finished running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:27:50.344035 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:27:50.344489 [debug] [MainThread]: Connection 'test.lab.not_null_macd_calculation_date.1954e908c9' was properly closed.
[0m04:27:50.344986 [info ] [MainThread]: 
[0m04:27:50.345745 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 2.16 seconds (2.16s).
[0m04:27:50.346801 [debug] [MainThread]: Command end result
[0m04:27:50.375593 [info ] [MainThread]: 
[0m04:27:50.376070 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:27:50.376462 [info ] [MainThread]: 
[0m04:27:50.376847 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m04:27:50.377845 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 2.921165, "process_user_time": 2.290313, "process_kernel_time": 0.223568, "process_mem_max_rss": "208020", "process_out_blocks": "1849", "process_in_blocks": "0"}
[0m04:27:50.378232 [debug] [MainThread]: Command `dbt test` succeeded at 04:27:50.378175 after 2.92 seconds
[0m04:27:50.378539 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8734d7c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86d4c290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86f62780>]}
[0m04:27:50.378807 [debug] [MainThread]: Flushing usage events
[0m04:27:53.203493 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb42c32f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb40f0800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb58f9a00>]}


============================== 04:27:53.207219 | c0c484e8-4e67-4444-a8a2-2be26ab4a028 ==============================
[0m04:27:53.207219 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:27:53.207918 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/lab', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/lab/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m04:27:53.637768 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c0c484e8-4e67-4444-a8a2-2be26ab4a028', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9902e0c0>]}
[0m04:27:53.660983 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c0c484e8-4e67-4444-a8a2-2be26ab4a028', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb48324b0>]}
[0m04:27:53.661485 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:27:53.705644 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:27:53.771279 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:27:53.771643 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:27:53.793780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c0c484e8-4e67-4444-a8a2-2be26ab4a028', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff93826c30>]}
[0m04:27:53.845811 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c0c484e8-4e67-4444-a8a2-2be26ab4a028', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff934b0950>]}
[0m04:27:53.846135 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m04:27:53.846631 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c0c484e8-4e67-4444-a8a2-2be26ab4a028', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9367a7b0>]}
[0m04:27:53.847487 [info ] [MainThread]: 
[0m04:27:53.847879 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:27:53.848367 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m04:27:53.855483 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m04:27:53.855708 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m04:27:53.855918 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:27:54.388529 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.532 seconds
[0m04:27:54.392675 [debug] [ThreadPool]: On list_dev: Close
[0m04:27:54.542306 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_snapshot)
[0m04:27:54.555241 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m04:27:54.555913 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m04:27:54.556387 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:27:55.006377 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.450 seconds
[0m04:27:55.008687 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m04:27:55.155613 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m04:27:55.160029 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m04:27:55.160644 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m04:27:55.161244 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:27:55.798675 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.637 seconds
[0m04:27:55.805518 [debug] [ThreadPool]: On list_dev_stock: Close
[0m04:27:55.930448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c0c484e8-4e67-4444-a8a2-2be26ab4a028', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff934b0710>]}
[0m04:27:55.932153 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:27:55.934965 [info ] [MainThread]: 
[0m04:27:55.952168 [debug] [Thread-1 (]: Began running node snapshot.lab.snapshot_macd_calculation
[0m04:27:55.952972 [info ] [Thread-1 (]: 1 of 1 START snapshot snapshot.snapshot_macd_calculation ....................... [RUN]
[0m04:27:55.954000 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now snapshot.lab.snapshot_macd_calculation)
[0m04:27:55.954518 [debug] [Thread-1 (]: Began compiling node snapshot.lab.snapshot_macd_calculation
[0m04:27:55.962868 [debug] [Thread-1 (]: Began executing node snapshot.lab.snapshot_macd_calculation
[0m04:27:55.991206 [debug] [Thread-1 (]: Compilation Error in snapshot snapshot_macd_calculation (snapshots/snapshot.macd_calculation.sql)
  The specified strategy macro 'date' was not found in package 'None'
  
  > in macro strategy_dispatch (macros/materializations/snapshots/strategies.sql)
  > called by macro materialization_snapshot_default (macros/materializations/snapshots/snapshot.sql)
  > called by macro materialization_snapshot_snowflake (macros/materializations/snapshot.sql)
  > called by snapshot snapshot_macd_calculation (snapshots/snapshot.macd_calculation.sql)
[0m04:27:55.992260 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c0c484e8-4e67-4444-a8a2-2be26ab4a028', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb407a1b0>]}
[0m04:27:55.992813 [error] [Thread-1 (]: 1 of 1 ERROR snapshotting snapshot.snapshot_macd_calculation ................... [[31mERROR[0m in 0.04s]
[0m04:27:55.993371 [debug] [Thread-1 (]: Finished running node snapshot.lab.snapshot_macd_calculation
[0m04:27:55.994679 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:27:55.995002 [debug] [MainThread]: Connection 'snapshot.lab.snapshot_macd_calculation' was properly closed.
[0m04:27:55.995246 [info ] [MainThread]: 
[0m04:27:55.995601 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 2.15 seconds (2.15s).
[0m04:27:55.996127 [debug] [MainThread]: Command end result
[0m04:27:56.016499 [info ] [MainThread]: 
[0m04:27:56.016937 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m04:27:56.017252 [info ] [MainThread]: 
[0m04:27:56.017582 [error] [MainThread]:   Compilation Error in snapshot snapshot_macd_calculation (snapshots/snapshot.macd_calculation.sql)
  The specified strategy macro 'date' was not found in package 'None'
  
  > in macro strategy_dispatch (macros/materializations/snapshots/strategies.sql)
  > called by macro materialization_snapshot_default (macros/materializations/snapshots/snapshot.sql)
  > called by macro materialization_snapshot_snowflake (macros/materializations/snapshot.sql)
  > called by snapshot snapshot_macd_calculation (snapshots/snapshot.macd_calculation.sql)
[0m04:27:56.017860 [info ] [MainThread]: 
[0m04:27:56.018160 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m04:27:56.019050 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 2.8541636, "process_user_time": 2.30078, "process_kernel_time": 0.228077, "process_mem_max_rss": "206108", "process_out_blocks": "1850", "command_success": false, "process_in_blocks": "0"}
[0m04:27:56.019357 [debug] [MainThread]: Command `dbt snapshot` failed at 04:27:56.019312 after 2.85 seconds
[0m04:27:56.019596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb354d400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb407a630>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb3a67ef0>]}
[0m04:27:56.019826 [debug] [MainThread]: Flushing usage events
[0m04:29:09.122250 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89655250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85e1adb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85baca40>]}


============================== 04:29:09.126172 | ce8a43d1-ee44-4b0d-bb8d-e0ecab3f40f9 ==============================
[0m04:29:09.126172 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:29:09.126825 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/lab', 'log_path': '/opt/airflow/lab/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'send_anonymous_usage_stats': 'True'}
[0m04:29:09.587673 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ce8a43d1-ee44-4b0d-bb8d-e0ecab3f40f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff859f1670>]}
[0m04:29:09.610536 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ce8a43d1-ee44-4b0d-bb8d-e0ecab3f40f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff69a57170>]}
[0m04:29:09.611019 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:29:09.656764 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:29:09.721634 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:29:09.721944 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:29:09.745480 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ce8a43d1-ee44-4b0d-bb8d-e0ecab3f40f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff699472f0>]}
[0m04:29:09.798804 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ce8a43d1-ee44-4b0d-bb8d-e0ecab3f40f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8230efc0>]}
[0m04:29:09.799097 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m04:29:09.799686 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ce8a43d1-ee44-4b0d-bb8d-e0ecab3f40f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6965b2c0>]}
[0m04:29:09.800594 [info ] [MainThread]: 
[0m04:29:09.801061 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:29:09.803399 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m04:29:09.810257 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m04:29:09.810491 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m04:29:09.810682 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:29:10.361567 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.550 seconds
[0m04:29:10.366644 [debug] [ThreadPool]: On list_dev: Close
[0m04:29:10.519963 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_stock)
[0m04:29:10.536147 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m04:29:10.537013 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m04:29:10.537519 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:29:11.024684 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.487 seconds
[0m04:29:11.028052 [debug] [ThreadPool]: On list_dev_stock: Close
[0m04:29:11.175678 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_stock, now list_dev_snapshot)
[0m04:29:11.181707 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m04:29:11.182468 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m04:29:11.183046 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:29:11.671556 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.488 seconds
[0m04:29:11.674225 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m04:29:11.794967 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ce8a43d1-ee44-4b0d-bb8d-e0ecab3f40f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff69aba3f0>]}
[0m04:29:11.797041 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:29:11.799785 [info ] [MainThread]: 
[0m04:29:11.817516 [debug] [Thread-1 (]: Began running node model.lab.RSI_Calculation
[0m04:29:11.818496 [info ] [Thread-1 (]: 1 of 2 START sql table model stock.RSI_Calculation ............................. [RUN]
[0m04:29:11.819579 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_snapshot, now model.lab.RSI_Calculation)
[0m04:29:11.820083 [debug] [Thread-1 (]: Began compiling node model.lab.RSI_Calculation
[0m04:29:11.828209 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.RSI_Calculation"
[0m04:29:11.830567 [debug] [Thread-1 (]: Began executing node model.lab.RSI_Calculation
[0m04:29:11.851673 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.RSI_Calculation"
[0m04:29:11.853408 [debug] [Thread-1 (]: Using snowflake connection "model.lab.RSI_Calculation"
[0m04:29:11.853745 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.RSI_Calculation"} */
create or replace transient table dev.stock.RSI_Calculation
         as
        (-- models/rsi_calculation.sql

WITH PriceChanges AS (
    SELECT
        date,
        symbol,
        close,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM
        dev.stock.stock_price_analysis  -- Replace 'stock' and 'stock_price_analysis' with your actual source name and table
),
PriceGainsLosses AS (
    SELECT
        date,
        symbol,
        close,
        next_close,
        CASE 
            WHEN next_close > close THEN next_close - close
            ELSE 0 
        END AS gain,
        CASE 
            WHEN next_close < close THEN close - next_close
            ELSE 0 
        END AS loss
    FROM
        PriceChanges
),
AverageGainsLosses AS (
    SELECT
        date,
        symbol,
        AVG(gain) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain,
        AVG(loss) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss
    FROM
        PriceGainsLosses
),
RSI_Calculation AS (
    SELECT
        date,
        symbol,
        avg_gain,
        avg_loss,
        CASE 
            WHEN avg_loss = 0 THEN 100
            ELSE 100 - (100 / (1 + (avg_gain / avg_loss)))
        END AS rsi
    FROM
        AverageGainsLosses
)
SELECT 
    date, 
    symbol, 
    rsi
FROM 
    RSI_Calculation
WHERE
    date >= (SELECT MIN(date) FROM dev.stock.stock_price_analysis) + INTERVAL '14 DAY'
ORDER BY
    symbol, date
        );
[0m04:29:11.854130 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:29:13.170554 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.316 seconds
[0m04:29:13.188391 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: Close
[0m04:29:13.313781 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ce8a43d1-ee44-4b0d-bb8d-e0ecab3f40f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff69c90830>]}
[0m04:29:13.315125 [info ] [Thread-1 (]: 1 of 2 OK created sql table model stock.RSI_Calculation ........................ [[32mSUCCESS 1[0m in 1.49s]
[0m04:29:13.316595 [debug] [Thread-1 (]: Finished running node model.lab.RSI_Calculation
[0m04:29:13.317255 [debug] [Thread-1 (]: Began running node model.lab.stock_price_analysis
[0m04:29:13.317970 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.RSI_Calculation, now model.lab.stock_price_analysis)
[0m04:29:13.318566 [debug] [Thread-1 (]: Began compiling node model.lab.stock_price_analysis
[0m04:29:13.321914 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.stock_price_analysis"
[0m04:29:13.323663 [debug] [Thread-1 (]: Finished running node model.lab.stock_price_analysis
[0m04:29:13.324780 [debug] [Thread-1 (]: Began running node model.lab.macd_calculation
[0m04:29:13.325323 [info ] [Thread-1 (]: 2 of 2 START sql table model stock.macd_calculation ............................ [RUN]
[0m04:29:13.326339 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.stock_price_analysis, now model.lab.macd_calculation)
[0m04:29:13.326704 [debug] [Thread-1 (]: Began compiling node model.lab.macd_calculation
[0m04:29:13.343287 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.macd_calculation"
[0m04:29:13.344422 [debug] [Thread-1 (]: Began executing node model.lab.macd_calculation
[0m04:29:13.346685 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.macd_calculation"
[0m04:29:13.348522 [debug] [Thread-1 (]: Using snowflake connection "model.lab.macd_calculation"
[0m04:29:13.348836 [debug] [Thread-1 (]: On model.lab.macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.macd_calculation"} */
create or replace transient table dev.stock.macd_calculation
         as
        (WITH  __dbt__cte__stock_price_analysis as (
WITH stock_data AS (
    SELECT
        *
    FROM dev.stock.stock_price_analysis
)

-- Now you can query the CTE
SELECT * FROM stock_data
), stock_data AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE,
        ROW_NUMBER() OVER (PARTITION BY SYMBOL ORDER BY DATE) AS rn
    FROM __dbt__cte__stock_price_analysis  -- Replace with the reference to your actual source table in DBT
),

-- Calculate 12-day EMA
ema_12 AS (
    SELECT
        SYMBOL,
        DATE,
        CLOSE AS EMA_12,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (12 + 1))) + (e.EMA_12 * (1 - (2.0 / (12 + 1)))) AS EMA_12,
        sd.rn
    FROM stock_data sd
    JOIN ema_12 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate 26-day EMA
ema_26 AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE AS EMA_26,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (26 + 1))) + (e.EMA_26 * (1 - (2.0 / (26 + 1)))) AS EMA_26,
        sd.rn
    FROM stock_data sd
    JOIN ema_26 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate MACD by subtracting 26-day EMA from 12-day EMA
macd_calculation AS (
    SELECT 
        e12.SYMBOL,
        e12.DATE,
        e12.EMA_12 - e26.EMA_26 AS MACD,
        e12.rn
    FROM ema_12 e12
    JOIN ema_26 e26 ON e12.SYMBOL = e26.SYMBOL AND e12.DATE = e26.DATE
),

-- Calculate 9-day EMA of MACD as Signal Line
signal_line AS (
    SELECT 
        SYMBOL,
        DATE,
        MACD,
        MACD AS Signal,
        rn
    FROM macd_calculation
    WHERE rn = 1

    UNION ALL

    SELECT 
        mc.SYMBOL,
        mc.DATE,
        mc.MACD,
        (mc.MACD * (2.0 / (9 + 1))) + (sl.Signal * (1 - (2.0 / (9 + 1)))) AS Signal,
        mc.rn
    FROM macd_calculation mc
    JOIN signal_line sl ON mc.SYMBOL = sl.SYMBOL AND mc.rn = sl.rn + 1
)

-- Final output
SELECT 
    SYMBOL,
    DATE,
    MACD,
    Signal,
    MACD - Signal AS Histogram
FROM signal_line
ORDER BY SYMBOL, DATE
        );
[0m04:29:13.349276 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:29:14.796769 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.447 seconds
[0m04:29:14.803244 [debug] [Thread-1 (]: On model.lab.macd_calculation: Close
[0m04:29:14.941485 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ce8a43d1-ee44-4b0d-bb8d-e0ecab3f40f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff870045f0>]}
[0m04:29:14.943518 [info ] [Thread-1 (]: 2 of 2 OK created sql table model stock.macd_calculation ....................... [[32mSUCCESS 1[0m in 1.61s]
[0m04:29:14.946021 [debug] [Thread-1 (]: Finished running node model.lab.macd_calculation
[0m04:29:14.948910 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:29:14.949711 [debug] [MainThread]: Connection 'model.lab.macd_calculation' was properly closed.
[0m04:29:14.950521 [info ] [MainThread]: 
[0m04:29:14.951608 [info ] [MainThread]: Finished running 2 table models in 0 hours 0 minutes and 5.15 seconds (5.15s).
[0m04:29:14.953124 [debug] [MainThread]: Command end result
[0m04:29:14.990550 [info ] [MainThread]: 
[0m04:29:14.991105 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:29:14.991566 [info ] [MainThread]: 
[0m04:29:14.992017 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m04:29:14.993477 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.9128494, "process_user_time": 2.581879, "process_kernel_time": 0.27761, "process_mem_max_rss": "205840", "process_out_blocks": "1892", "process_in_blocks": "0"}
[0m04:29:14.993972 [debug] [MainThread]: Command `dbt run` succeeded at 04:29:14.993912 after 5.91 seconds
[0m04:29:14.994361 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89655250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6a2d6c30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8538a090>]}
[0m04:29:14.994628 [debug] [MainThread]: Flushing usage events
[0m04:29:17.907642 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffad5362a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb10ed1c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaca543e0>]}


============================== 04:29:17.911340 | 3a5dc4ff-5a2a-4e03-91ee-956ab0d735f0 ==============================
[0m04:29:17.911340 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:29:17.912081 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/lab', 'log_path': '/opt/airflow/lab/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m04:29:18.355925 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3a5dc4ff-5a2a-4e03-91ee-956ab0d735f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff92f90ce0>]}
[0m04:29:18.377824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3a5dc4ff-5a2a-4e03-91ee-956ab0d735f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90d03500>]}
[0m04:29:18.378329 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:29:18.421969 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:29:18.487397 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:29:18.487704 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:29:18.510045 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3a5dc4ff-5a2a-4e03-91ee-956ab0d735f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90be7290>]}
[0m04:29:18.569028 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3a5dc4ff-5a2a-4e03-91ee-956ab0d735f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff908eb650>]}
[0m04:29:18.569350 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m04:29:18.569833 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3a5dc4ff-5a2a-4e03-91ee-956ab0d735f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90d8ea20>]}
[0m04:29:18.570663 [info ] [MainThread]: 
[0m04:29:18.571094 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:29:18.573108 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev_stock'
[0m04:29:18.581476 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m04:29:18.581727 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m04:29:18.581955 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:29:19.095477 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.513 seconds
[0m04:29:19.100622 [debug] [ThreadPool]: On list_dev_stock: Close
[0m04:29:19.225019 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_stock, now list_dev_snapshot)
[0m04:29:19.229710 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m04:29:19.230262 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m04:29:19.230827 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:29:19.693253 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.462 seconds
[0m04:29:19.695331 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m04:29:19.828406 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3a5dc4ff-5a2a-4e03-91ee-956ab0d735f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffae2e8e00>]}
[0m04:29:19.830325 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:29:19.832732 [info ] [MainThread]: 
[0m04:29:19.848581 [debug] [Thread-1 (]: Began running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:29:19.849400 [info ] [Thread-1 (]: 1 of 1 START test not_null_macd_calculation_date ............................... [RUN]
[0m04:29:19.850483 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_snapshot, now test.lab.not_null_macd_calculation_date.1954e908c9)
[0m04:29:19.850930 [debug] [Thread-1 (]: Began compiling node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:29:19.865244 [debug] [Thread-1 (]: Writing injected SQL for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m04:29:19.867308 [debug] [Thread-1 (]: Began executing node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:29:19.880411 [debug] [Thread-1 (]: Writing runtime sql for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m04:29:19.881682 [debug] [Thread-1 (]: Using snowflake connection "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m04:29:19.882027 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "test.lab.not_null_macd_calculation_date.1954e908c9"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from dev.stock.macd_calculation
where date is null



      
    ) dbt_internal_test
[0m04:29:19.882360 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:29:20.490207 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.607 seconds
[0m04:29:20.502723 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: Close
[0m04:29:20.658400 [info ] [Thread-1 (]: 1 of 1 PASS not_null_macd_calculation_date ..................................... [[32mPASS[0m in 0.81s]
[0m04:29:20.660031 [debug] [Thread-1 (]: Finished running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:29:20.661876 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:29:20.662344 [debug] [MainThread]: Connection 'test.lab.not_null_macd_calculation_date.1954e908c9' was properly closed.
[0m04:29:20.662818 [info ] [MainThread]: 
[0m04:29:20.663474 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 2.09 seconds (2.09s).
[0m04:29:20.664446 [debug] [MainThread]: Command end result
[0m04:29:20.693844 [info ] [MainThread]: 
[0m04:29:20.694290 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:29:20.694639 [info ] [MainThread]: 
[0m04:29:20.694923 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m04:29:20.695957 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 2.8259635, "process_user_time": 2.275272, "process_kernel_time": 0.208414, "process_mem_max_rss": "208008", "process_out_blocks": "1849", "process_in_blocks": "0"}
[0m04:29:20.696353 [debug] [MainThread]: Command `dbt test` succeeded at 04:29:20.696300 after 2.83 seconds
[0m04:29:20.696674 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfffface25f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffacf7e540>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffad5362a0>]}
[0m04:29:20.697038 [debug] [MainThread]: Flushing usage events
[0m04:29:22.932101 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8c48e000>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8c1531d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8c212030>]}


============================== 04:29:22.935894 | 09ab54d2-5099-4ac4-bf5a-549f6581d507 ==============================
[0m04:29:22.935894 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:29:22.936697 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/lab', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/lab/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'send_anonymous_usage_stats': 'True'}
[0m04:29:23.343064 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '09ab54d2-5099-4ac4-bf5a-549f6581d507', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8c896240>]}
[0m04:29:23.364790 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '09ab54d2-5099-4ac4-bf5a-549f6581d507', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff70313ad0>]}
[0m04:29:23.365254 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:29:23.408613 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:29:23.470139 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:29:23.470439 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:29:23.492382 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '09ab54d2-5099-4ac4-bf5a-549f6581d507', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6bafb440>]}
[0m04:29:23.545729 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '09ab54d2-5099-4ac4-bf5a-549f6581d507', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6b833ad0>]}
[0m04:29:23.546048 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m04:29:23.546507 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '09ab54d2-5099-4ac4-bf5a-549f6581d507', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6bafbd40>]}
[0m04:29:23.547354 [info ] [MainThread]: 
[0m04:29:23.547772 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:29:23.548268 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m04:29:23.555118 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m04:29:23.555346 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m04:29:23.555544 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:29:24.038328 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.482 seconds
[0m04:29:24.042661 [debug] [ThreadPool]: On list_dev: Close
[0m04:29:24.206638 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_stock)
[0m04:29:24.214191 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m04:29:24.214554 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m04:29:24.214873 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:29:24.711478 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.496 seconds
[0m04:29:24.716307 [debug] [ThreadPool]: On list_dev_stock: Close
[0m04:29:24.864681 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_stock, now list_dev_snapshot)
[0m04:29:24.872575 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m04:29:24.873575 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m04:29:24.874517 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:29:25.313454 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.439 seconds
[0m04:29:25.317325 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m04:29:25.430316 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '09ab54d2-5099-4ac4-bf5a-549f6581d507', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6b986cc0>]}
[0m04:29:25.430863 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:29:25.431460 [info ] [MainThread]: 
[0m04:29:25.438127 [debug] [Thread-1 (]: Began running node snapshot.lab.snapshot_macd_calculation
[0m04:29:25.438578 [info ] [Thread-1 (]: 1 of 1 START snapshot snapshot.snapshot_macd_calculation ....................... [RUN]
[0m04:29:25.439067 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_snapshot, now snapshot.lab.snapshot_macd_calculation)
[0m04:29:25.439324 [debug] [Thread-1 (]: Began compiling node snapshot.lab.snapshot_macd_calculation
[0m04:29:25.443857 [debug] [Thread-1 (]: Began executing node snapshot.lab.snapshot_macd_calculation
[0m04:29:25.464189 [debug] [Thread-1 (]: Compilation Error in snapshot snapshot_macd_calculation (snapshots/snapshot.macd_calculation.sql)
  The specified strategy macro 'date' was not found in package 'None'
  
  > in macro strategy_dispatch (macros/materializations/snapshots/strategies.sql)
  > called by macro materialization_snapshot_default (macros/materializations/snapshots/snapshot.sql)
  > called by macro materialization_snapshot_snowflake (macros/materializations/snapshot.sql)
  > called by snapshot snapshot_macd_calculation (snapshots/snapshot.macd_calculation.sql)
[0m04:29:25.465070 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '09ab54d2-5099-4ac4-bf5a-549f6581d507', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6bb9ef60>]}
[0m04:29:25.465926 [error] [Thread-1 (]: 1 of 1 ERROR snapshotting snapshot.snapshot_macd_calculation ................... [[31mERROR[0m in 0.03s]
[0m04:29:25.466688 [debug] [Thread-1 (]: Finished running node snapshot.lab.snapshot_macd_calculation
[0m04:29:25.468445 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:29:25.468753 [debug] [MainThread]: Connection 'snapshot.lab.snapshot_macd_calculation' was properly closed.
[0m04:29:25.469026 [info ] [MainThread]: 
[0m04:29:25.469490 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 1.92 seconds (1.92s).
[0m04:29:25.470265 [debug] [MainThread]: Command end result
[0m04:29:25.488334 [info ] [MainThread]: 
[0m04:29:25.488828 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m04:29:25.489196 [info ] [MainThread]: 
[0m04:29:25.489554 [error] [MainThread]:   Compilation Error in snapshot snapshot_macd_calculation (snapshots/snapshot.macd_calculation.sql)
  The specified strategy macro 'date' was not found in package 'None'
  
  > in macro strategy_dispatch (macros/materializations/snapshots/strategies.sql)
  > called by macro materialization_snapshot_default (macros/materializations/snapshots/snapshot.sql)
  > called by macro materialization_snapshot_snowflake (macros/materializations/snapshot.sql)
  > called by snapshot snapshot_macd_calculation (snapshots/snapshot.macd_calculation.sql)
[0m04:29:25.489854 [info ] [MainThread]: 
[0m04:29:25.490147 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m04:29:25.490891 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 2.59668, "process_user_time": 2.330085, "process_kernel_time": 0.159469, "process_mem_max_rss": "206092", "process_out_blocks": "1850", "command_success": false, "process_in_blocks": "0"}
[0m04:29:25.491207 [debug] [MainThread]: Command `dbt snapshot` failed at 04:29:25.491153 after 2.60 seconds
[0m04:29:25.491471 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8c48e000>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff761b6390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8bd32570>]}
[0m04:29:25.491698 [debug] [MainThread]: Flushing usage events
[0m04:29:59.465126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff96054860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff93557f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9338a030>]}


============================== 04:29:59.469345 | eaa3165d-523f-4618-8aec-5c457b5d1756 ==============================
[0m04:29:59.469345 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:29:59.470077 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/lab/logs', 'version_check': 'True', 'profiles_dir': '/opt/airflow/lab', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m04:29:59.938355 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'eaa3165d-523f-4618-8aec-5c457b5d1756', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9434e120>]}
[0m04:29:59.960248 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'eaa3165d-523f-4618-8aec-5c457b5d1756', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9308e000>]}
[0m04:29:59.960722 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:30:00.006254 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:30:00.072172 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m04:30:00.072597 [debug] [MainThread]: Partial parsing: updated file: lab://snapshots/snapshot.macd_calculation.sql
[0m04:30:00.180348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'eaa3165d-523f-4618-8aec-5c457b5d1756', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff72f64f80>]}
[0m04:30:00.232810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'eaa3165d-523f-4618-8aec-5c457b5d1756', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff72f43a40>]}
[0m04:30:00.233139 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m04:30:00.233627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eaa3165d-523f-4618-8aec-5c457b5d1756', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff73118590>]}
[0m04:30:00.234521 [info ] [MainThread]: 
[0m04:30:00.234951 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:30:00.237199 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m04:30:00.243350 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m04:30:00.243610 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m04:30:00.243833 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:30:00.836465 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.592 seconds
[0m04:30:00.839323 [debug] [ThreadPool]: On list_dev: Close
[0m04:30:00.974095 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_snapshot)
[0m04:30:00.991342 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m04:30:00.992070 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m04:30:00.992630 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:30:01.503184 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.510 seconds
[0m04:30:01.505101 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m04:30:01.648743 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m04:30:01.654554 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m04:30:01.655308 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m04:30:01.655887 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:30:02.179136 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.523 seconds
[0m04:30:02.183762 [debug] [ThreadPool]: On list_dev_stock: Close
[0m04:30:02.323652 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eaa3165d-523f-4618-8aec-5c457b5d1756', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff732c0aa0>]}
[0m04:30:02.325133 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:30:02.327309 [info ] [MainThread]: 
[0m04:30:02.340994 [debug] [Thread-1 (]: Began running node model.lab.RSI_Calculation
[0m04:30:02.341776 [info ] [Thread-1 (]: 1 of 2 START sql table model stock.RSI_Calculation ............................. [RUN]
[0m04:30:02.342572 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now model.lab.RSI_Calculation)
[0m04:30:02.343085 [debug] [Thread-1 (]: Began compiling node model.lab.RSI_Calculation
[0m04:30:02.350464 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.RSI_Calculation"
[0m04:30:02.352837 [debug] [Thread-1 (]: Began executing node model.lab.RSI_Calculation
[0m04:30:02.372299 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.RSI_Calculation"
[0m04:30:02.374034 [debug] [Thread-1 (]: Using snowflake connection "model.lab.RSI_Calculation"
[0m04:30:02.374372 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.RSI_Calculation"} */
create or replace transient table dev.stock.RSI_Calculation
         as
        (-- models/rsi_calculation.sql

WITH PriceChanges AS (
    SELECT
        date,
        symbol,
        close,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM
        dev.stock.stock_price_analysis  -- Replace 'stock' and 'stock_price_analysis' with your actual source name and table
),
PriceGainsLosses AS (
    SELECT
        date,
        symbol,
        close,
        next_close,
        CASE 
            WHEN next_close > close THEN next_close - close
            ELSE 0 
        END AS gain,
        CASE 
            WHEN next_close < close THEN close - next_close
            ELSE 0 
        END AS loss
    FROM
        PriceChanges
),
AverageGainsLosses AS (
    SELECT
        date,
        symbol,
        AVG(gain) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain,
        AVG(loss) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss
    FROM
        PriceGainsLosses
),
RSI_Calculation AS (
    SELECT
        date,
        symbol,
        avg_gain,
        avg_loss,
        CASE 
            WHEN avg_loss = 0 THEN 100
            ELSE 100 - (100 / (1 + (avg_gain / avg_loss)))
        END AS rsi
    FROM
        AverageGainsLosses
)
SELECT 
    date, 
    symbol, 
    rsi
FROM 
    RSI_Calculation
WHERE
    date >= (SELECT MIN(date) FROM dev.stock.stock_price_analysis) + INTERVAL '14 DAY'
ORDER BY
    symbol, date
        );
[0m04:30:02.374761 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:30:03.652940 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.278 seconds
[0m04:30:03.671656 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: Close
[0m04:30:03.827042 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eaa3165d-523f-4618-8aec-5c457b5d1756', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff735208f0>]}
[0m04:30:03.828411 [info ] [Thread-1 (]: 1 of 2 OK created sql table model stock.RSI_Calculation ........................ [[32mSUCCESS 1[0m in 1.48s]
[0m04:30:03.831382 [debug] [Thread-1 (]: Finished running node model.lab.RSI_Calculation
[0m04:30:03.832101 [debug] [Thread-1 (]: Began running node model.lab.stock_price_analysis
[0m04:30:03.832831 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.RSI_Calculation, now model.lab.stock_price_analysis)
[0m04:30:03.833438 [debug] [Thread-1 (]: Began compiling node model.lab.stock_price_analysis
[0m04:30:03.836565 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.stock_price_analysis"
[0m04:30:03.838571 [debug] [Thread-1 (]: Finished running node model.lab.stock_price_analysis
[0m04:30:03.839629 [debug] [Thread-1 (]: Began running node model.lab.macd_calculation
[0m04:30:03.840250 [info ] [Thread-1 (]: 2 of 2 START sql table model stock.macd_calculation ............................ [RUN]
[0m04:30:03.841317 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.stock_price_analysis, now model.lab.macd_calculation)
[0m04:30:03.841770 [debug] [Thread-1 (]: Began compiling node model.lab.macd_calculation
[0m04:30:03.861012 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.macd_calculation"
[0m04:30:03.862309 [debug] [Thread-1 (]: Began executing node model.lab.macd_calculation
[0m04:30:03.864497 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.macd_calculation"
[0m04:30:03.866367 [debug] [Thread-1 (]: Using snowflake connection "model.lab.macd_calculation"
[0m04:30:03.866796 [debug] [Thread-1 (]: On model.lab.macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.macd_calculation"} */
create or replace transient table dev.stock.macd_calculation
         as
        (WITH  __dbt__cte__stock_price_analysis as (
WITH stock_data AS (
    SELECT
        *
    FROM dev.stock.stock_price_analysis
)

-- Now you can query the CTE
SELECT * FROM stock_data
), stock_data AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE,
        ROW_NUMBER() OVER (PARTITION BY SYMBOL ORDER BY DATE) AS rn
    FROM __dbt__cte__stock_price_analysis  -- Replace with the reference to your actual source table in DBT
),

-- Calculate 12-day EMA
ema_12 AS (
    SELECT
        SYMBOL,
        DATE,
        CLOSE AS EMA_12,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (12 + 1))) + (e.EMA_12 * (1 - (2.0 / (12 + 1)))) AS EMA_12,
        sd.rn
    FROM stock_data sd
    JOIN ema_12 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate 26-day EMA
ema_26 AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE AS EMA_26,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (26 + 1))) + (e.EMA_26 * (1 - (2.0 / (26 + 1)))) AS EMA_26,
        sd.rn
    FROM stock_data sd
    JOIN ema_26 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate MACD by subtracting 26-day EMA from 12-day EMA
macd_calculation AS (
    SELECT 
        e12.SYMBOL,
        e12.DATE,
        e12.EMA_12 - e26.EMA_26 AS MACD,
        e12.rn
    FROM ema_12 e12
    JOIN ema_26 e26 ON e12.SYMBOL = e26.SYMBOL AND e12.DATE = e26.DATE
),

-- Calculate 9-day EMA of MACD as Signal Line
signal_line AS (
    SELECT 
        SYMBOL,
        DATE,
        MACD,
        MACD AS Signal,
        rn
    FROM macd_calculation
    WHERE rn = 1

    UNION ALL

    SELECT 
        mc.SYMBOL,
        mc.DATE,
        mc.MACD,
        (mc.MACD * (2.0 / (9 + 1))) + (sl.Signal * (1 - (2.0 / (9 + 1)))) AS Signal,
        mc.rn
    FROM macd_calculation mc
    JOIN signal_line sl ON mc.SYMBOL = sl.SYMBOL AND mc.rn = sl.rn + 1
)

-- Final output
SELECT 
    SYMBOL,
    DATE,
    MACD,
    Signal,
    MACD - Signal AS Histogram
FROM signal_line
ORDER BY SYMBOL, DATE
        );
[0m04:30:03.867189 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:30:05.297900 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.430 seconds
[0m04:30:05.304757 [debug] [Thread-1 (]: On model.lab.macd_calculation: Close
[0m04:30:05.434250 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eaa3165d-523f-4618-8aec-5c457b5d1756', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff723265d0>]}
[0m04:30:05.437414 [info ] [Thread-1 (]: 2 of 2 OK created sql table model stock.macd_calculation ....................... [[32mSUCCESS 1[0m in 1.59s]
[0m04:30:05.440110 [debug] [Thread-1 (]: Finished running node model.lab.macd_calculation
[0m04:30:05.442739 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:30:05.443499 [debug] [MainThread]: Connection 'model.lab.macd_calculation' was properly closed.
[0m04:30:05.444388 [info ] [MainThread]: 
[0m04:30:05.445401 [info ] [MainThread]: Finished running 2 table models in 0 hours 0 minutes and 5.21 seconds (5.21s).
[0m04:30:05.446839 [debug] [MainThread]: Command end result
[0m04:30:05.484472 [info ] [MainThread]: 
[0m04:30:05.485129 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:30:05.485406 [info ] [MainThread]: 
[0m04:30:05.485797 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m04:30:05.486979 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.0618305, "process_user_time": 2.569783, "process_kernel_time": 0.274826, "process_mem_max_rss": "208520", "process_out_blocks": "2809", "process_in_blocks": "0"}
[0m04:30:05.487458 [debug] [MainThread]: Command `dbt run` succeeded at 04:30:05.487391 after 6.06 seconds
[0m04:30:05.487825 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff94185640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff936eb140>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff96054860>]}
[0m04:30:05.488162 [debug] [MainThread]: Flushing usage events
[0m04:30:08.363431 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9d322450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9d7be6c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9ebf8e60>]}


============================== 04:30:08.367257 | 6ba378a7-33f9-40ab-a505-b5ae0f4e42fd ==============================
[0m04:30:08.367257 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:30:08.367884 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/lab/logs', 'profiles_dir': '/opt/airflow/lab', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m04:30:08.828679 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6ba378a7-33f9-40ab-a505-b5ae0f4e42fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82099b20>]}
[0m04:30:08.850770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6ba378a7-33f9-40ab-a505-b5ae0f4e42fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8136b620>]}
[0m04:30:08.851239 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:30:08.899376 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:30:08.976651 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:30:08.977040 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:30:09.003803 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6ba378a7-33f9-40ab-a505-b5ae0f4e42fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8156dee0>]}
[0m04:30:09.068265 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6ba378a7-33f9-40ab-a505-b5ae0f4e42fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80d38980>]}
[0m04:30:09.068602 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m04:30:09.069127 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6ba378a7-33f9-40ab-a505-b5ae0f4e42fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8142e210>]}
[0m04:30:09.069978 [info ] [MainThread]: 
[0m04:30:09.070441 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:30:09.072438 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev_stock'
[0m04:30:09.081015 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m04:30:09.081271 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m04:30:09.081553 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:30:09.663904 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.582 seconds
[0m04:30:09.668817 [debug] [ThreadPool]: On list_dev_stock: Close
[0m04:30:09.877488 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_stock, now list_dev_snapshot)
[0m04:30:09.880467 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m04:30:09.880873 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m04:30:09.881186 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:30:10.329744 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.448 seconds
[0m04:30:10.333058 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m04:30:10.475569 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6ba378a7-33f9-40ab-a505-b5ae0f4e42fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff99bf9100>]}
[0m04:30:10.477498 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:30:10.480644 [info ] [MainThread]: 
[0m04:30:10.495798 [debug] [Thread-1 (]: Began running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:30:10.496517 [info ] [Thread-1 (]: 1 of 1 START test not_null_macd_calculation_date ............................... [RUN]
[0m04:30:10.497610 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_snapshot, now test.lab.not_null_macd_calculation_date.1954e908c9)
[0m04:30:10.498184 [debug] [Thread-1 (]: Began compiling node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:30:10.513531 [debug] [Thread-1 (]: Writing injected SQL for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m04:30:10.514958 [debug] [Thread-1 (]: Began executing node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:30:10.527621 [debug] [Thread-1 (]: Writing runtime sql for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m04:30:10.528787 [debug] [Thread-1 (]: Using snowflake connection "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m04:30:10.529149 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "test.lab.not_null_macd_calculation_date.1954e908c9"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from dev.stock.macd_calculation
where date is null



      
    ) dbt_internal_test
[0m04:30:10.529495 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:30:11.193608 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.664 seconds
[0m04:30:11.204814 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: Close
[0m04:30:11.333241 [info ] [Thread-1 (]: 1 of 1 PASS not_null_macd_calculation_date ..................................... [[32mPASS[0m in 0.83s]
[0m04:30:11.336680 [debug] [Thread-1 (]: Finished running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:30:11.339996 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:30:11.340646 [debug] [MainThread]: Connection 'test.lab.not_null_macd_calculation_date.1954e908c9' was properly closed.
[0m04:30:11.341780 [info ] [MainThread]: 
[0m04:30:11.343120 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 2.27 seconds (2.27s).
[0m04:30:11.344364 [debug] [MainThread]: Command end result
[0m04:30:11.379780 [info ] [MainThread]: 
[0m04:30:11.380307 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:30:11.380711 [info ] [MainThread]: 
[0m04:30:11.381110 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m04:30:11.382054 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.0566924, "process_user_time": 2.332687, "process_kernel_time": 0.23998, "process_mem_max_rss": "208044", "process_out_blocks": "1849", "process_in_blocks": "0"}
[0m04:30:11.382540 [debug] [MainThread]: Command `dbt test` succeeded at 04:30:11.382456 after 3.06 seconds
[0m04:30:11.382914 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9d7be6c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa036ac00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9d711fa0>]}
[0m04:30:11.383206 [debug] [MainThread]: Flushing usage events
[0m04:30:13.375435 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e55a1e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e6f9be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9c71e150>]}


============================== 04:30:13.379285 | 6f644c80-a13b-4ec7-98f2-1711677b9033 ==============================
[0m04:30:13.379285 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:30:13.380221 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/lab', 'log_path': '/opt/airflow/lab/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'send_anonymous_usage_stats': 'True'}
[0m04:30:13.847072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6f644c80-a13b-4ec7-98f2-1711677b9033', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83120ce0>]}
[0m04:30:13.869633 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6f644c80-a13b-4ec7-98f2-1711677b9033', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81e47170>]}
[0m04:30:13.870129 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:30:13.915507 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:30:13.977642 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:30:13.977946 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:30:14.000177 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6f644c80-a13b-4ec7-98f2-1711677b9033', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80506a50>]}
[0m04:30:14.054491 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6f644c80-a13b-4ec7-98f2-1711677b9033', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff802f3950>]}
[0m04:30:14.054896 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m04:30:14.055398 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6f644c80-a13b-4ec7-98f2-1711677b9033', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9d4664b0>]}
[0m04:30:14.056566 [info ] [MainThread]: 
[0m04:30:14.057113 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:30:14.057724 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m04:30:14.065540 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m04:30:14.065791 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m04:30:14.066003 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:30:14.534049 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.468 seconds
[0m04:30:14.540082 [debug] [ThreadPool]: On list_dev: Close
[0m04:30:14.682304 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_snapshot)
[0m04:30:14.692881 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m04:30:14.693399 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m04:30:14.693808 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:30:15.196242 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.502 seconds
[0m04:30:15.198521 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m04:30:15.380169 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m04:30:15.385684 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m04:30:15.386957 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m04:30:15.387548 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:30:15.882890 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.495 seconds
[0m04:30:15.887833 [debug] [ThreadPool]: On list_dev_stock: Close
[0m04:30:16.016666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6f644c80-a13b-4ec7-98f2-1711677b9033', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80277380>]}
[0m04:30:16.017622 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:30:16.019393 [info ] [MainThread]: 
[0m04:30:16.028632 [debug] [Thread-1 (]: Began running node snapshot.lab.snapshot_macd_calculation
[0m04:30:16.029338 [info ] [Thread-1 (]: 1 of 1 START snapshot snapshot.snapshot_macd_calculation ....................... [RUN]
[0m04:30:16.030169 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now snapshot.lab.snapshot_macd_calculation)
[0m04:30:16.030616 [debug] [Thread-1 (]: Began compiling node snapshot.lab.snapshot_macd_calculation
[0m04:30:16.038055 [debug] [Thread-1 (]: Began executing node snapshot.lab.snapshot_macd_calculation
[0m04:30:16.078319 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m04:30:16.078668 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
select * from (
        
    

    select *,
        md5(coalesce(cast(date as varchar ), '')
         || '|' || coalesce(cast(ts as varchar ), '')
        ) as dbt_scd_id,
        ts as dbt_updated_at,
        ts as dbt_valid_from,
        
  
  coalesce(nullif(ts, ts), null)
  as dbt_valid_to

    from (
        

SELECT * FROM dev.stock.macd_calculation
    ) sbq



    ) as __dbt_sbq
    where false
    limit 0
[0m04:30:16.078942 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:30:16.537558 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b8506e-0004-26af-0000-000262e7d475
[0m04:30:16.539094 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 7 at position 33
invalid identifier 'TS'
[0m04:30:16.540135 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: Close
[0m04:30:16.668032 [debug] [Thread-1 (]: Database Error in snapshot snapshot_macd_calculation (snapshots/snapshot.macd_calculation.sql)
  000904 (42000): SQL compilation error: error line 7 at position 33
  invalid identifier 'TS'
[0m04:30:16.671062 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6f644c80-a13b-4ec7-98f2-1711677b9033', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80197f80>]}
[0m04:30:16.672220 [error] [Thread-1 (]: 1 of 1 ERROR snapshotting snapshot.snapshot_macd_calculation ................... [[31mERROR[0m in 0.64s]
[0m04:30:16.673881 [debug] [Thread-1 (]: Finished running node snapshot.lab.snapshot_macd_calculation
[0m04:30:16.676596 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:30:16.677096 [debug] [MainThread]: Connection 'snapshot.lab.snapshot_macd_calculation' was properly closed.
[0m04:30:16.677500 [info ] [MainThread]: 
[0m04:30:16.678276 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 2.62 seconds (2.62s).
[0m04:30:16.679292 [debug] [MainThread]: Command end result
[0m04:30:16.712243 [info ] [MainThread]: 
[0m04:30:16.712767 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m04:30:16.713144 [info ] [MainThread]: 
[0m04:30:16.713536 [error] [MainThread]:   Database Error in snapshot snapshot_macd_calculation (snapshots/snapshot.macd_calculation.sql)
  000904 (42000): SQL compilation error: error line 7 at position 33
  invalid identifier 'TS'
[0m04:30:16.713870 [info ] [MainThread]: 
[0m04:30:16.714181 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m04:30:16.715125 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 3.3786435, "process_user_time": 2.433794, "process_kernel_time": 0.257731, "process_mem_max_rss": "206620", "process_out_blocks": "1851", "command_success": false, "process_in_blocks": "0"}
[0m04:30:16.715525 [debug] [MainThread]: Command `dbt snapshot` failed at 04:30:16.715466 after 3.38 seconds
[0m04:30:16.715836 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9c71eb40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8020f050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff806979b0>]}
[0m04:30:16.716102 [debug] [MainThread]: Flushing usage events
[0m04:31:52.232094 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff813761b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff833e1c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81247410>]}


============================== 04:31:52.236310 | 5b3c3ad7-89bb-4447-a628-bd707866beb3 ==============================
[0m04:31:52.236310 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:31:52.236942 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/lab', 'log_path': '/opt/airflow/lab/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m04:31:52.753137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5b3c3ad7-89bb-4447-a628-bd707866beb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6584b8f0>]}
[0m04:31:52.775633 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5b3c3ad7-89bb-4447-a628-bd707866beb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff67549cd0>]}
[0m04:31:52.776100 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:31:52.820690 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:31:52.884402 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m04:31:52.884805 [debug] [MainThread]: Partial parsing: updated file: lab://snapshots/snapshot.macd_calculation.sql
[0m04:31:52.996263 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5b3c3ad7-89bb-4447-a628-bd707866beb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff64f41430>]}
[0m04:31:53.053211 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5b3c3ad7-89bb-4447-a628-bd707866beb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff64fa80b0>]}
[0m04:31:53.053543 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m04:31:53.054001 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5b3c3ad7-89bb-4447-a628-bd707866beb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81028380>]}
[0m04:31:53.054891 [info ] [MainThread]: 
[0m04:31:53.055298 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:31:53.057739 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m04:31:53.063781 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m04:31:53.064004 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m04:31:53.064187 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:31:53.625703 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.561 seconds
[0m04:31:53.629940 [debug] [ThreadPool]: On list_dev: Close
[0m04:31:53.763439 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_snapshot)
[0m04:31:53.780353 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m04:31:53.781079 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m04:31:53.781577 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:31:54.280945 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.499 seconds
[0m04:31:54.284926 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m04:31:54.414621 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m04:31:54.419808 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m04:31:54.420692 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m04:31:54.421422 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:31:55.008975 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.587 seconds
[0m04:31:55.013775 [debug] [ThreadPool]: On list_dev_stock: Close
[0m04:31:55.169086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5b3c3ad7-89bb-4447-a628-bd707866beb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff64f40230>]}
[0m04:31:55.170290 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:31:55.170984 [info ] [MainThread]: 
[0m04:31:55.183756 [debug] [Thread-1 (]: Began running node model.lab.RSI_Calculation
[0m04:31:55.184451 [info ] [Thread-1 (]: 1 of 2 START sql table model stock.RSI_Calculation ............................. [RUN]
[0m04:31:55.185160 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now model.lab.RSI_Calculation)
[0m04:31:55.185560 [debug] [Thread-1 (]: Began compiling node model.lab.RSI_Calculation
[0m04:31:55.192191 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.RSI_Calculation"
[0m04:31:55.193740 [debug] [Thread-1 (]: Began executing node model.lab.RSI_Calculation
[0m04:31:55.212369 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.RSI_Calculation"
[0m04:31:55.213987 [debug] [Thread-1 (]: Using snowflake connection "model.lab.RSI_Calculation"
[0m04:31:55.214324 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.RSI_Calculation"} */
create or replace transient table dev.stock.RSI_Calculation
         as
        (-- models/rsi_calculation.sql

WITH PriceChanges AS (
    SELECT
        date,
        symbol,
        close,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM
        dev.stock.stock_price_analysis  -- Replace 'stock' and 'stock_price_analysis' with your actual source name and table
),
PriceGainsLosses AS (
    SELECT
        date,
        symbol,
        close,
        next_close,
        CASE 
            WHEN next_close > close THEN next_close - close
            ELSE 0 
        END AS gain,
        CASE 
            WHEN next_close < close THEN close - next_close
            ELSE 0 
        END AS loss
    FROM
        PriceChanges
),
AverageGainsLosses AS (
    SELECT
        date,
        symbol,
        AVG(gain) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain,
        AVG(loss) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss
    FROM
        PriceGainsLosses
),
RSI_Calculation AS (
    SELECT
        date,
        symbol,
        avg_gain,
        avg_loss,
        CASE 
            WHEN avg_loss = 0 THEN 100
            ELSE 100 - (100 / (1 + (avg_gain / avg_loss)))
        END AS rsi
    FROM
        AverageGainsLosses
)
SELECT 
    date, 
    symbol, 
    rsi
FROM 
    RSI_Calculation
WHERE
    date >= (SELECT MIN(date) FROM dev.stock.stock_price_analysis) + INTERVAL '14 DAY'
ORDER BY
    symbol, date
        );
[0m04:31:55.214659 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:31:56.406723 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.190 seconds
[0m04:31:56.441830 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: Close
[0m04:31:56.580546 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5b3c3ad7-89bb-4447-a628-bd707866beb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff654fc7d0>]}
[0m04:31:56.582406 [info ] [Thread-1 (]: 1 of 2 OK created sql table model stock.RSI_Calculation ........................ [[32mSUCCESS 1[0m in 1.39s]
[0m04:31:56.586353 [debug] [Thread-1 (]: Finished running node model.lab.RSI_Calculation
[0m04:31:56.587248 [debug] [Thread-1 (]: Began running node model.lab.stock_price_analysis
[0m04:31:56.588297 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.RSI_Calculation, now model.lab.stock_price_analysis)
[0m04:31:56.589906 [debug] [Thread-1 (]: Began compiling node model.lab.stock_price_analysis
[0m04:31:56.594510 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.stock_price_analysis"
[0m04:31:56.596640 [debug] [Thread-1 (]: Finished running node model.lab.stock_price_analysis
[0m04:31:56.598582 [debug] [Thread-1 (]: Began running node model.lab.macd_calculation
[0m04:31:56.599326 [info ] [Thread-1 (]: 2 of 2 START sql table model stock.macd_calculation ............................ [RUN]
[0m04:31:56.600702 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.stock_price_analysis, now model.lab.macd_calculation)
[0m04:31:56.601196 [debug] [Thread-1 (]: Began compiling node model.lab.macd_calculation
[0m04:31:56.624541 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.macd_calculation"
[0m04:31:56.625860 [debug] [Thread-1 (]: Began executing node model.lab.macd_calculation
[0m04:31:56.628281 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.macd_calculation"
[0m04:31:56.630400 [debug] [Thread-1 (]: Using snowflake connection "model.lab.macd_calculation"
[0m04:31:56.630843 [debug] [Thread-1 (]: On model.lab.macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.macd_calculation"} */
create or replace transient table dev.stock.macd_calculation
         as
        (WITH  __dbt__cte__stock_price_analysis as (
WITH stock_data AS (
    SELECT
        *
    FROM dev.stock.stock_price_analysis
)

-- Now you can query the CTE
SELECT * FROM stock_data
), stock_data AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE,
        ROW_NUMBER() OVER (PARTITION BY SYMBOL ORDER BY DATE) AS rn
    FROM __dbt__cte__stock_price_analysis  -- Replace with the reference to your actual source table in DBT
),

-- Calculate 12-day EMA
ema_12 AS (
    SELECT
        SYMBOL,
        DATE,
        CLOSE AS EMA_12,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (12 + 1))) + (e.EMA_12 * (1 - (2.0 / (12 + 1)))) AS EMA_12,
        sd.rn
    FROM stock_data sd
    JOIN ema_12 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate 26-day EMA
ema_26 AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE AS EMA_26,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (26 + 1))) + (e.EMA_26 * (1 - (2.0 / (26 + 1)))) AS EMA_26,
        sd.rn
    FROM stock_data sd
    JOIN ema_26 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate MACD by subtracting 26-day EMA from 12-day EMA
macd_calculation AS (
    SELECT 
        e12.SYMBOL,
        e12.DATE,
        e12.EMA_12 - e26.EMA_26 AS MACD,
        e12.rn
    FROM ema_12 e12
    JOIN ema_26 e26 ON e12.SYMBOL = e26.SYMBOL AND e12.DATE = e26.DATE
),

-- Calculate 9-day EMA of MACD as Signal Line
signal_line AS (
    SELECT 
        SYMBOL,
        DATE,
        MACD,
        MACD AS Signal,
        rn
    FROM macd_calculation
    WHERE rn = 1

    UNION ALL

    SELECT 
        mc.SYMBOL,
        mc.DATE,
        mc.MACD,
        (mc.MACD * (2.0 / (9 + 1))) + (sl.Signal * (1 - (2.0 / (9 + 1)))) AS Signal,
        mc.rn
    FROM macd_calculation mc
    JOIN signal_line sl ON mc.SYMBOL = sl.SYMBOL AND mc.rn = sl.rn + 1
)

-- Final output
SELECT 
    SYMBOL,
    DATE,
    MACD,
    Signal,
    MACD - Signal AS Histogram
FROM signal_line
ORDER BY SYMBOL, DATE
        );
[0m04:31:56.631191 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:31:58.012651 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.381 seconds
[0m04:31:58.019163 [debug] [Thread-1 (]: On model.lab.macd_calculation: Close
[0m04:31:58.165802 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5b3c3ad7-89bb-4447-a628-bd707866beb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff828504a0>]}
[0m04:31:58.167949 [info ] [Thread-1 (]: 2 of 2 OK created sql table model stock.macd_calculation ....................... [[32mSUCCESS 1[0m in 1.56s]
[0m04:31:58.170532 [debug] [Thread-1 (]: Finished running node model.lab.macd_calculation
[0m04:31:58.173994 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:31:58.174754 [debug] [MainThread]: Connection 'model.lab.macd_calculation' was properly closed.
[0m04:31:58.175535 [info ] [MainThread]: 
[0m04:31:58.176512 [info ] [MainThread]: Finished running 2 table models in 0 hours 0 minutes and 5.12 seconds (5.12s).
[0m04:31:58.177877 [debug] [MainThread]: Command end result
[0m04:31:58.213824 [info ] [MainThread]: 
[0m04:31:58.214499 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:31:58.214809 [info ] [MainThread]: 
[0m04:31:58.215325 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m04:31:58.217548 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.023905, "process_user_time": 2.532569, "process_kernel_time": 0.310522, "process_mem_max_rss": "208664", "process_out_blocks": "2809", "process_in_blocks": "0"}
[0m04:31:58.218147 [debug] [MainThread]: Command `dbt run` succeeded at 04:31:58.218073 after 6.02 seconds
[0m04:31:58.218580 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81247410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85ac6ab0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85ac6ae0>]}
[0m04:31:58.219018 [debug] [MainThread]: Flushing usage events
[0m04:32:00.370515 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9735e120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff971ee120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98a097c0>]}


============================== 04:32:00.374306 | 5999aa09-6e46-4691-9502-7c0c8bf95089 ==============================
[0m04:32:00.374306 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:32:00.375388 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/lab/logs', 'profiles_dir': '/opt/airflow/lab', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m04:32:00.810152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5999aa09-6e46-4691-9502-7c0c8bf95089', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9b116ae0>]}
[0m04:32:00.832660 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5999aa09-6e46-4691-9502-7c0c8bf95089', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff76c4ac60>]}
[0m04:32:00.833136 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:32:00.877267 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:32:00.945348 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:32:00.945663 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:32:00.967756 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5999aa09-6e46-4691-9502-7c0c8bf95089', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89fe8620>]}
[0m04:32:01.028009 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5999aa09-6e46-4691-9502-7c0c8bf95089', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff76334ef0>]}
[0m04:32:01.028351 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m04:32:01.028783 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5999aa09-6e46-4691-9502-7c0c8bf95089', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff764e4c50>]}
[0m04:32:01.029693 [info ] [MainThread]: 
[0m04:32:01.030145 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:32:01.032155 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev_stock'
[0m04:32:01.040975 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m04:32:01.041231 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m04:32:01.041417 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:32:01.584479 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.543 seconds
[0m04:32:01.590703 [debug] [ThreadPool]: On list_dev_stock: Close
[0m04:32:01.743144 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_stock, now list_dev_snapshot)
[0m04:32:01.750291 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m04:32:01.751081 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m04:32:01.751626 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:32:02.237440 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.485 seconds
[0m04:32:02.242552 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m04:32:02.387642 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5999aa09-6e46-4691-9502-7c0c8bf95089', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98034e60>]}
[0m04:32:02.390733 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:32:02.392804 [info ] [MainThread]: 
[0m04:32:02.406491 [debug] [Thread-1 (]: Began running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:32:02.407249 [info ] [Thread-1 (]: 1 of 1 START test not_null_macd_calculation_date ............................... [RUN]
[0m04:32:02.408639 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_snapshot, now test.lab.not_null_macd_calculation_date.1954e908c9)
[0m04:32:02.411530 [debug] [Thread-1 (]: Began compiling node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:32:02.431470 [debug] [Thread-1 (]: Writing injected SQL for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m04:32:02.433256 [debug] [Thread-1 (]: Began executing node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:32:02.447377 [debug] [Thread-1 (]: Writing runtime sql for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m04:32:02.448680 [debug] [Thread-1 (]: Using snowflake connection "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m04:32:02.449021 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "test.lab.not_null_macd_calculation_date.1954e908c9"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from dev.stock.macd_calculation
where date is null



      
    ) dbt_internal_test
[0m04:32:02.449379 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:32:02.974078 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.524 seconds
[0m04:32:02.991075 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: Close
[0m04:32:03.110275 [info ] [Thread-1 (]: 1 of 1 PASS not_null_macd_calculation_date ..................................... [[32mPASS[0m in 0.70s]
[0m04:32:03.111507 [debug] [Thread-1 (]: Finished running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m04:32:03.112607 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:32:03.112898 [debug] [MainThread]: Connection 'test.lab.not_null_macd_calculation_date.1954e908c9' was properly closed.
[0m04:32:03.113138 [info ] [MainThread]: 
[0m04:32:03.113537 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 2.08 seconds (2.08s).
[0m04:32:03.114115 [debug] [MainThread]: Command end result
[0m04:32:03.134992 [info ] [MainThread]: 
[0m04:32:03.135446 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:32:03.135769 [info ] [MainThread]: 
[0m04:32:03.136111 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m04:32:03.137044 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 2.8058455, "process_user_time": 2.383516, "process_kernel_time": 0.208708, "process_mem_max_rss": "207992", "process_out_blocks": "1849", "process_in_blocks": "0"}
[0m04:32:03.137371 [debug] [MainThread]: Command `dbt test` succeeded at 04:32:03.137326 after 2.81 seconds
[0m04:32:03.137627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9735e120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff96694320>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff96d1be00>]}
[0m04:32:03.137853 [debug] [MainThread]: Flushing usage events
[0m04:32:05.412627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8960c9b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8960d940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87ece090>]}


============================== 04:32:05.416352 | 0e539cc9-bf2b-44a7-bbfa-21319b27dbe6 ==============================
[0m04:32:05.416352 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:32:05.416982 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/lab', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/lab/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'send_anonymous_usage_stats': 'True'}
[0m04:32:05.860582 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0e539cc9-bf2b-44a7-bbfa-21319b27dbe6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88652d20>]}
[0m04:32:05.882508 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0e539cc9-bf2b-44a7-bbfa-21319b27dbe6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6ca14440>]}
[0m04:32:05.882973 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:32:05.928734 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:32:05.991609 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:32:05.991909 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:32:06.014010 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0e539cc9-bf2b-44a7-bbfa-21319b27dbe6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff67c36510>]}
[0m04:32:06.071268 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0e539cc9-bf2b-44a7-bbfa-21319b27dbe6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff67a268a0>]}
[0m04:32:06.071581 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m04:32:06.071998 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0e539cc9-bf2b-44a7-bbfa-21319b27dbe6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6790fbc0>]}
[0m04:32:06.072860 [info ] [MainThread]: 
[0m04:32:06.073319 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:32:06.073838 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m04:32:06.080859 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m04:32:06.081088 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m04:32:06.081289 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:32:06.620513 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.539 seconds
[0m04:32:06.626826 [debug] [ThreadPool]: On list_dev: Close
[0m04:32:06.865322 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_snapshot)
[0m04:32:06.876331 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m04:32:06.876922 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m04:32:06.877393 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:32:07.373790 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.496 seconds
[0m04:32:07.377295 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m04:32:07.507832 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m04:32:07.513790 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m04:32:07.514639 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m04:32:07.515257 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:32:08.046398 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.531 seconds
[0m04:32:08.050098 [debug] [ThreadPool]: On list_dev_stock: Close
[0m04:32:08.178174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0e539cc9-bf2b-44a7-bbfa-21319b27dbe6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff66fcfaa0>]}
[0m04:32:08.179492 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:32:08.182011 [info ] [MainThread]: 
[0m04:32:08.196233 [debug] [Thread-1 (]: Began running node snapshot.lab.snapshot_macd_calculation
[0m04:32:08.196956 [info ] [Thread-1 (]: 1 of 1 START snapshot snapshot.snapshot_macd_calculation ....................... [RUN]
[0m04:32:08.197686 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now snapshot.lab.snapshot_macd_calculation)
[0m04:32:08.198173 [debug] [Thread-1 (]: Began compiling node snapshot.lab.snapshot_macd_calculation
[0m04:32:08.204587 [debug] [Thread-1 (]: Began executing node snapshot.lab.snapshot_macd_calculation
[0m04:32:08.245282 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m04:32:08.245559 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
select * from (
        
    

    select *,
        md5(coalesce(cast(date as varchar ), '')
         || '|' || coalesce(cast(date as varchar ), '')
        ) as dbt_scd_id,
        date as dbt_updated_at,
        date as dbt_valid_from,
        
  
  coalesce(nullif(date, date), null)
  as dbt_valid_to

    from (
        

SELECT * FROM dev.stock.macd_calculation
    ) sbq



    ) as __dbt_sbq
    where false
    limit 0
[0m04:32:08.245788 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:32:08.767840 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.522 seconds
[0m04:32:08.775134 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m04:32:08.775827 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
select * from (
        select to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_snapshot_time
    ) as __dbt_sbq
    where false
    limit 0
[0m04:32:08.883519 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.107 seconds
[0m04:32:08.885280 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.lab.snapshot_macd_calculation"
[0m04:32:08.889729 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m04:32:08.890456 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
create or replace transient table dev.snapshot.snapshot_macd_calculation
         as
        (
    

    select *,
        md5(coalesce(cast(date as varchar ), '')
         || '|' || coalesce(cast(date as varchar ), '')
        ) as dbt_scd_id,
        date as dbt_updated_at,
        date as dbt_valid_from,
        
  
  coalesce(nullif(date, date), null)
  as dbt_valid_to

    from (
        

SELECT * FROM dev.stock.macd_calculation
    ) sbq



        );
[0m04:32:09.713278 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.822 seconds
[0m04:32:09.737251 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: Close
[0m04:32:09.876070 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e539cc9-bf2b-44a7-bbfa-21319b27dbe6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff67ed4b00>]}
[0m04:32:09.878305 [info ] [Thread-1 (]: 1 of 1 OK snapshotted snapshot.snapshot_macd_calculation ....................... [[32mSUCCESS 1[0m in 1.67s]
[0m04:32:09.882062 [debug] [Thread-1 (]: Finished running node snapshot.lab.snapshot_macd_calculation
[0m04:32:09.885696 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:32:09.886520 [debug] [MainThread]: Connection 'snapshot.lab.snapshot_macd_calculation' was properly closed.
[0m04:32:09.887244 [info ] [MainThread]: 
[0m04:32:09.888429 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 3.81 seconds (3.81s).
[0m04:32:09.889931 [debug] [MainThread]: Command end result
[0m04:32:09.924980 [info ] [MainThread]: 
[0m04:32:09.925586 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:32:09.926065 [info ] [MainThread]: 
[0m04:32:09.926558 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m04:32:09.928272 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 4.555875, "process_user_time": 2.439611, "process_kernel_time": 0.213365, "process_mem_max_rss": "206256", "process_out_blocks": "1853", "process_in_blocks": "0"}
[0m04:32:09.928736 [debug] [MainThread]: Command `dbt snapshot` succeeded at 04:32:09.928668 after 4.56 seconds
[0m04:32:09.929096 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88101460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff66f408c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87af91c0>]}
[0m04:32:09.929378 [debug] [MainThread]: Flushing usage events
[0m19:22:04.290024 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b6e2f00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b6e2db0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b6e2cf0>]}


============================== 19:22:04.293805 | adbe1d7d-8a59-4888-91ce-cb468f067cd4 ==============================
[0m19:22:04.293805 [info ] [MainThread]: Running with dbt=1.8.7
[0m19:22:04.296057 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/lab', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/lab/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m19:22:04.815688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'adbe1d7d-8a59-4888-91ce-cb468f067cd4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ce03bf0>]}
[0m19:22:04.839103 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'adbe1d7d-8a59-4888-91ce-cb468f067cd4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5bd0ffe0>]}
[0m19:22:04.839624 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m19:22:04.892318 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m19:22:04.959851 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:22:04.960228 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:22:04.982519 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'adbe1d7d-8a59-4888-91ce-cb468f067cd4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5b63ef90>]}
[0m19:22:05.035441 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'adbe1d7d-8a59-4888-91ce-cb468f067cd4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5b388590>]}
[0m19:22:05.035746 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m19:22:05.036255 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'adbe1d7d-8a59-4888-91ce-cb468f067cd4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ba3dbb0>]}
[0m19:22:05.037142 [info ] [MainThread]: 
[0m19:22:05.037656 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:22:05.039930 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m19:22:05.047082 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m19:22:05.047316 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m19:22:05.047519 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:22:06.221157 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.173 seconds
[0m19:22:06.223424 [debug] [ThreadPool]: On list_dev: Close
[0m19:22:06.422853 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_snapshot)
[0m19:22:06.429819 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m19:22:06.430224 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m19:22:06.430562 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:22:07.244157 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.813 seconds
[0m19:22:07.246607 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m19:22:07.436396 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m19:22:07.442731 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m19:22:07.443557 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m19:22:07.445357 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:22:08.139382 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.694 seconds
[0m19:22:08.142334 [debug] [ThreadPool]: On list_dev_stock: Close
[0m19:22:08.335222 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'adbe1d7d-8a59-4888-91ce-cb468f067cd4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5b35f200>]}
[0m19:22:08.336599 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:22:08.339231 [info ] [MainThread]: 
[0m19:22:08.352662 [debug] [Thread-1 (]: Began running node model.lab.RSI_Calculation
[0m19:22:08.353381 [info ] [Thread-1 (]: 1 of 2 START sql table model stock.RSI_Calculation ............................. [RUN]
[0m19:22:08.354224 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now model.lab.RSI_Calculation)
[0m19:22:08.354698 [debug] [Thread-1 (]: Began compiling node model.lab.RSI_Calculation
[0m19:22:08.361942 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.RSI_Calculation"
[0m19:22:08.364264 [debug] [Thread-1 (]: Began executing node model.lab.RSI_Calculation
[0m19:22:08.384292 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.RSI_Calculation"
[0m19:22:08.386337 [debug] [Thread-1 (]: Using snowflake connection "model.lab.RSI_Calculation"
[0m19:22:08.386681 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.RSI_Calculation"} */
create or replace transient table dev.stock.RSI_Calculation
         as
        (-- models/rsi_calculation.sql

WITH PriceChanges AS (
    SELECT
        date,
        symbol,
        close,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM
        dev.stock.stock_price_analysis  -- Replace 'stock' and 'stock_price_analysis' with your actual source name and table
),
PriceGainsLosses AS (
    SELECT
        date,
        symbol,
        close,
        next_close,
        CASE 
            WHEN next_close > close THEN next_close - close
            ELSE 0 
        END AS gain,
        CASE 
            WHEN next_close < close THEN close - next_close
            ELSE 0 
        END AS loss
    FROM
        PriceChanges
),
AverageGainsLosses AS (
    SELECT
        date,
        symbol,
        AVG(gain) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain,
        AVG(loss) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss
    FROM
        PriceGainsLosses
),
RSI_Calculation AS (
    SELECT
        date,
        symbol,
        avg_gain,
        avg_loss,
        CASE 
            WHEN avg_loss = 0 THEN 100
            ELSE 100 - (100 / (1 + (avg_gain / avg_loss)))
        END AS rsi
    FROM
        AverageGainsLosses
)
SELECT 
    date, 
    symbol, 
    rsi
FROM 
    RSI_Calculation
WHERE
    date >= (SELECT MIN(date) FROM dev.stock.stock_price_analysis) + INTERVAL '14 DAY'
ORDER BY
    symbol, date
        );
[0m19:22:08.387084 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:22:10.730341 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.342 seconds
[0m19:22:10.761462 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: Close
[0m19:22:10.913410 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'adbe1d7d-8a59-4888-91ce-cb468f067cd4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c02ed50>]}
[0m19:22:10.914172 [info ] [Thread-1 (]: 1 of 2 OK created sql table model stock.RSI_Calculation ........................ [[32mSUCCESS 1[0m in 2.56s]
[0m19:22:10.916201 [debug] [Thread-1 (]: Finished running node model.lab.RSI_Calculation
[0m19:22:10.916632 [debug] [Thread-1 (]: Began running node model.lab.stock_price_analysis
[0m19:22:10.917028 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.RSI_Calculation, now model.lab.stock_price_analysis)
[0m19:22:10.917328 [debug] [Thread-1 (]: Began compiling node model.lab.stock_price_analysis
[0m19:22:10.919252 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.stock_price_analysis"
[0m19:22:10.920399 [debug] [Thread-1 (]: Finished running node model.lab.stock_price_analysis
[0m19:22:10.921085 [debug] [Thread-1 (]: Began running node model.lab.macd_calculation
[0m19:22:10.921405 [info ] [Thread-1 (]: 2 of 2 START sql table model stock.macd_calculation ............................ [RUN]
[0m19:22:10.922122 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.stock_price_analysis, now model.lab.macd_calculation)
[0m19:22:10.922454 [debug] [Thread-1 (]: Began compiling node model.lab.macd_calculation
[0m19:22:10.935872 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.macd_calculation"
[0m19:22:10.936994 [debug] [Thread-1 (]: Began executing node model.lab.macd_calculation
[0m19:22:10.939140 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.macd_calculation"
[0m19:22:10.941204 [debug] [Thread-1 (]: Using snowflake connection "model.lab.macd_calculation"
[0m19:22:10.941613 [debug] [Thread-1 (]: On model.lab.macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.macd_calculation"} */
create or replace transient table dev.stock.macd_calculation
         as
        (WITH  __dbt__cte__stock_price_analysis as (
WITH stock_data AS (
    SELECT
        *
    FROM dev.stock.stock_price_analysis
)

-- Now you can query the CTE
SELECT * FROM stock_data
), stock_data AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE,
        ROW_NUMBER() OVER (PARTITION BY SYMBOL ORDER BY DATE) AS rn
    FROM __dbt__cte__stock_price_analysis  -- Replace with the reference to your actual source table in DBT
),

-- Calculate 12-day EMA
ema_12 AS (
    SELECT
        SYMBOL,
        DATE,
        CLOSE AS EMA_12,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (12 + 1))) + (e.EMA_12 * (1 - (2.0 / (12 + 1)))) AS EMA_12,
        sd.rn
    FROM stock_data sd
    JOIN ema_12 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate 26-day EMA
ema_26 AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE AS EMA_26,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (26 + 1))) + (e.EMA_26 * (1 - (2.0 / (26 + 1)))) AS EMA_26,
        sd.rn
    FROM stock_data sd
    JOIN ema_26 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate MACD by subtracting 26-day EMA from 12-day EMA
macd_calculation AS (
    SELECT 
        e12.SYMBOL,
        e12.DATE,
        e12.EMA_12 - e26.EMA_26 AS MACD,
        e12.rn
    FROM ema_12 e12
    JOIN ema_26 e26 ON e12.SYMBOL = e26.SYMBOL AND e12.DATE = e26.DATE
),

-- Calculate 9-day EMA of MACD as Signal Line
signal_line AS (
    SELECT 
        SYMBOL,
        DATE,
        MACD,
        MACD AS Signal,
        rn
    FROM macd_calculation
    WHERE rn = 1

    UNION ALL

    SELECT 
        mc.SYMBOL,
        mc.DATE,
        mc.MACD,
        (mc.MACD * (2.0 / (9 + 1))) + (sl.Signal * (1 - (2.0 / (9 + 1)))) AS Signal,
        mc.rn
    FROM macd_calculation mc
    JOIN signal_line sl ON mc.SYMBOL = sl.SYMBOL AND mc.rn = sl.rn + 1
)

-- Final output
SELECT 
    SYMBOL,
    DATE,
    MACD,
    Signal,
    MACD - Signal AS Histogram
FROM signal_line
ORDER BY SYMBOL, DATE
        );
[0m19:22:10.942149 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:22:12.761365 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.819 seconds
[0m19:22:12.766414 [debug] [Thread-1 (]: On model.lab.macd_calculation: Close
[0m19:22:12.931896 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'adbe1d7d-8a59-4888-91ce-cb468f067cd4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5b4700b0>]}
[0m19:22:12.933135 [info ] [Thread-1 (]: 2 of 2 OK created sql table model stock.macd_calculation ....................... [[32mSUCCESS 1[0m in 2.01s]
[0m19:22:12.935580 [debug] [Thread-1 (]: Finished running node model.lab.macd_calculation
[0m19:22:12.938412 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:22:12.939129 [debug] [MainThread]: Connection 'model.lab.macd_calculation' was properly closed.
[0m19:22:12.939798 [info ] [MainThread]: 
[0m19:22:12.940635 [info ] [MainThread]: Finished running 2 table models in 0 hours 0 minutes and 7.90 seconds (7.90s).
[0m19:22:12.941905 [debug] [MainThread]: Command end result
[0m19:22:12.975313 [info ] [MainThread]: 
[0m19:22:12.975911 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:22:12.976353 [info ] [MainThread]: 
[0m19:22:12.976915 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m19:22:12.982046 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 8.715025, "process_user_time": 2.819735, "process_kernel_time": 0.345904, "process_mem_max_rss": "207280", "process_in_blocks": "13304", "process_out_blocks": "5613"}
[0m19:22:12.982887 [debug] [MainThread]: Command `dbt run` succeeded at 19:22:12.982818 after 8.72 seconds
[0m19:22:12.983486 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b6e2cf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b7308f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c1be690>]}
[0m19:22:12.983796 [debug] [MainThread]: Flushing usage events
[0m19:22:15.394868 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffada930b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaea314c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffada934d0>]}


============================== 19:22:15.398643 | be327521-3c98-449a-aad8-13dad2d98280 ==============================
[0m19:22:15.398643 [info ] [MainThread]: Running with dbt=1.8.7
[0m19:22:15.399401 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/lab', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/lab/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'send_anonymous_usage_stats': 'True'}
[0m19:22:15.880559 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'be327521-3c98-449a-aad8-13dad2d98280', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffae621ee0>]}
[0m19:22:15.906473 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'be327521-3c98-449a-aad8-13dad2d98280', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91f22480>]}
[0m19:22:15.907038 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m19:22:15.961770 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m19:22:16.030488 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:22:16.030857 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:22:16.057661 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'be327521-3c98-449a-aad8-13dad2d98280', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff915a72f0>]}
[0m19:22:16.126864 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'be327521-3c98-449a-aad8-13dad2d98280', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9108cef0>]}
[0m19:22:16.127289 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m19:22:16.127926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'be327521-3c98-449a-aad8-13dad2d98280', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff92f3bc20>]}
[0m19:22:16.128942 [info ] [MainThread]: 
[0m19:22:16.129474 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:22:16.131754 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev_stock'
[0m19:22:16.142015 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m19:22:16.142290 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m19:22:16.142494 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:22:16.840971 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.698 seconds
[0m19:22:16.857357 [debug] [ThreadPool]: On list_dev_stock: Close
[0m19:22:17.159550 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_stock, now list_dev_snapshot)
[0m19:22:17.166185 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m19:22:17.166900 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m19:22:17.167491 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:22:17.962533 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.795 seconds
[0m19:22:17.966959 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m19:22:18.184184 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'be327521-3c98-449a-aad8-13dad2d98280', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9169c590>]}
[0m19:22:18.185237 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:22:18.191320 [info ] [MainThread]: 
[0m19:22:18.201472 [debug] [Thread-1 (]: Began running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m19:22:18.201991 [info ] [Thread-1 (]: 1 of 1 START test not_null_macd_calculation_date ............................... [RUN]
[0m19:22:18.203784 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_snapshot, now test.lab.not_null_macd_calculation_date.1954e908c9)
[0m19:22:18.204979 [debug] [Thread-1 (]: Began compiling node test.lab.not_null_macd_calculation_date.1954e908c9
[0m19:22:18.217357 [debug] [Thread-1 (]: Writing injected SQL for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m19:22:18.219006 [debug] [Thread-1 (]: Began executing node test.lab.not_null_macd_calculation_date.1954e908c9
[0m19:22:18.231305 [debug] [Thread-1 (]: Writing runtime sql for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m19:22:18.232655 [debug] [Thread-1 (]: Using snowflake connection "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m19:22:18.232999 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "test.lab.not_null_macd_calculation_date.1954e908c9"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from dev.stock.macd_calculation
where date is null



      
    ) dbt_internal_test
[0m19:22:18.233309 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:22:19.172440 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.938 seconds
[0m19:22:19.187543 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: Close
[0m19:22:19.330496 [info ] [Thread-1 (]: 1 of 1 PASS not_null_macd_calculation_date ..................................... [[32mPASS[0m in 1.13s]
[0m19:22:19.333843 [debug] [Thread-1 (]: Finished running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m19:22:19.337825 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:22:19.338471 [debug] [MainThread]: Connection 'test.lab.not_null_macd_calculation_date.1954e908c9' was properly closed.
[0m19:22:19.339100 [info ] [MainThread]: 
[0m19:22:19.340076 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 3.21 seconds (3.21s).
[0m19:22:19.341559 [debug] [MainThread]: Command end result
[0m19:22:19.397812 [info ] [MainThread]: 
[0m19:22:19.398775 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:22:19.399251 [info ] [MainThread]: 
[0m19:22:19.400561 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m19:22:19.402503 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 4.0469155, "process_user_time": 2.355414, "process_kernel_time": 0.234931, "process_mem_max_rss": "208024", "process_out_blocks": "1849", "process_in_blocks": "0"}
[0m19:22:19.403528 [debug] [MainThread]: Command `dbt test` succeeded at 19:22:19.403441 after 4.05 seconds
[0m19:22:19.403983 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffadbea960>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffad93cc20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffad4141a0>]}
[0m19:22:19.404340 [debug] [MainThread]: Flushing usage events
[0m19:22:22.547040 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b501730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e2285c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b223560>]}


============================== 19:22:22.551080 | 0a6622aa-bba4-4036-bae9-110c6dce48a5 ==============================
[0m19:22:22.551080 [info ] [MainThread]: Running with dbt=1.8.7
[0m19:22:22.552045 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/lab/logs', 'profiles_dir': '/opt/airflow/lab', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m19:22:23.029401 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0a6622aa-bba4-4036-bae9-110c6dce48a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7aefc5c0>]}
[0m19:22:23.051822 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0a6622aa-bba4-4036-bae9-110c6dce48a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b2d2090>]}
[0m19:22:23.052304 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m19:22:23.098594 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m19:22:23.163514 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:22:23.163785 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:22:23.187048 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0a6622aa-bba4-4036-bae9-110c6dce48a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5b0cdfa0>]}
[0m19:22:23.246798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0a6622aa-bba4-4036-bae9-110c6dce48a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5aea6f60>]}
[0m19:22:23.247147 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m19:22:23.247576 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0a6622aa-bba4-4036-bae9-110c6dce48a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5ada2a20>]}
[0m19:22:23.248524 [info ] [MainThread]: 
[0m19:22:23.249002 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:22:23.249528 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m19:22:23.257091 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m19:22:23.257350 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m19:22:23.257544 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:22:23.936473 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.679 seconds
[0m19:22:23.939731 [debug] [ThreadPool]: On list_dev: Close
[0m19:22:24.140499 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_stock)
[0m19:22:24.151670 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m19:22:24.152164 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m19:22:24.152579 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:22:24.711133 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.558 seconds
[0m19:22:24.716813 [debug] [ThreadPool]: On list_dev_stock: Close
[0m19:22:24.875178 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_stock, now list_dev_snapshot)
[0m19:22:24.877514 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m19:22:24.877859 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m19:22:24.878283 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:22:25.423384 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.545 seconds
[0m19:22:25.426584 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m19:22:25.565584 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0a6622aa-bba4-4036-bae9-110c6dce48a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5adc0ef0>]}
[0m19:22:25.567233 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:22:25.572779 [info ] [MainThread]: 
[0m19:22:25.588062 [debug] [Thread-1 (]: Began running node snapshot.lab.snapshot_macd_calculation
[0m19:22:25.588928 [info ] [Thread-1 (]: 1 of 1 START snapshot snapshot.snapshot_macd_calculation ....................... [RUN]
[0m19:22:25.590165 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_snapshot, now snapshot.lab.snapshot_macd_calculation)
[0m19:22:25.590682 [debug] [Thread-1 (]: Began compiling node snapshot.lab.snapshot_macd_calculation
[0m19:22:25.598695 [debug] [Thread-1 (]: Began executing node snapshot.lab.snapshot_macd_calculation
[0m19:22:25.634690 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:22:25.635005 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
[0m19:22:25.635287 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:22:26.249947 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.614 seconds
[0m19:22:26.298001 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:22:26.298624 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
create or replace temporary table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp"
         as
        (

    with snapshot_query as (

        

SELECT * FROM dev.stock.macd_calculation

    ),

    snapshotted_data as (

        select *, 
    
        date as dbt_unique_key
    

        from "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            
  
  coalesce(nullif(date, date), null)
  as dbt_valid_to
,
            md5(coalesce(cast(date as varchar ), '')
         || '|' || coalesce(cast(date as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            date as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select *, 
    
        date as dbt_unique_key
    

        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data.dbt_valid_from < source_data.date))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data.dbt_valid_from < source_data.date)
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        source_data.dbt_unique_key is null
    

    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m19:22:27.522430 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.223 seconds
[0m19:22:27.529346 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:22:27.530148 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp"
[0m19:22:27.755056 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.224 seconds
[0m19:22:27.762107 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:22:27.762977 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
[0m19:22:28.035884 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.272 seconds
[0m19:22:28.045108 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:22:28.046168 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp"
[0m19:22:28.182535 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.135 seconds
[0m19:22:28.193653 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:22:28.194468 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
[0m19:22:28.299894 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.105 seconds
[0m19:22:28.308824 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:22:28.309323 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp"
[0m19:22:28.457206 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.147 seconds
[0m19:22:28.486780 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:22:28.487371 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
select * from (
        

    with snapshot_query as (

        

SELECT * FROM dev.stock.macd_calculation

    ),

    snapshotted_data as (

        select *, 
    
        date as dbt_unique_key
    

        from "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            
  
  coalesce(nullif(date, date), null)
  as dbt_valid_to
,
            md5(coalesce(cast(date as varchar ), '')
         || '|' || coalesce(cast(date as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            date as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select *, 
    
        date as dbt_unique_key
    

        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data.dbt_valid_from < source_data.date))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data.dbt_valid_from < source_data.date)
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        source_data.dbt_unique_key is null
    

    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

    ) as __dbt_sbq
    where false
    limit 0
[0m19:22:28.981821 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.494 seconds
[0m19:22:28.987488 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:22:28.988048 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
select * from (
        select to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_snapshot_time
    ) as __dbt_sbq
    where false
    limit 0
[0m19:22:29.072536 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.083 seconds
[0m19:22:29.074588 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.lab.snapshot_macd_calculation"
[0m19:22:29.080783 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:22:29.081591 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
BEGIN
[0m19:22:29.254750 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.172 seconds
[0m19:22:29.256084 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:22:29.256879 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
merge into "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION" as DBT_INTERNAL_DEST
    using "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     
       and DBT_INTERNAL_DEST.dbt_valid_to is null
     
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SYMBOL", "DATE", "MACD", "SIGNAL", "HISTOGRAM", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SYMBOL", "DATE", "MACD", "SIGNAL", "HISTOGRAM", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m19:22:29.876753 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.619 seconds
[0m19:22:29.879948 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:22:29.880975 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
COMMIT
[0m19:22:30.386521 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.505 seconds
[0m19:22:30.407346 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: Close
[0m19:22:30.536287 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0a6622aa-bba4-4036-bae9-110c6dce48a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ba2e150>]}
[0m19:22:30.538601 [info ] [Thread-1 (]: 1 of 1 OK snapshotted snapshot.snapshot_macd_calculation ....................... [[32mSUCCESS 0[0m in 4.94s]
[0m19:22:30.543443 [debug] [Thread-1 (]: Finished running node snapshot.lab.snapshot_macd_calculation
[0m19:22:30.547054 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:22:30.547687 [debug] [MainThread]: Connection 'snapshot.lab.snapshot_macd_calculation' was properly closed.
[0m19:22:30.548289 [info ] [MainThread]: 
[0m19:22:30.549221 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 7.30 seconds (7.30s).
[0m19:22:30.550435 [debug] [MainThread]: Command end result
[0m19:22:30.583701 [info ] [MainThread]: 
[0m19:22:30.584249 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:22:30.584702 [info ] [MainThread]: 
[0m19:22:30.585194 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m19:22:30.586850 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 8.08232, "process_user_time": 2.519049, "process_kernel_time": 0.233282, "process_mem_max_rss": "206656", "process_out_blocks": "1873", "process_in_blocks": "0"}
[0m19:22:30.587356 [debug] [MainThread]: Command `dbt snapshot` succeeded at 19:22:30.587296 after 8.08 seconds
[0m19:22:30.587715 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b501730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7af2b740>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7af28b00>]}
[0m19:22:30.588000 [debug] [MainThread]: Flushing usage events
[0m19:33:54.704788 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffbc1e6c30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffba2b7980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffba878740>]}


============================== 19:33:54.708618 | f3fc8b02-d46c-46dc-a9d7-1a6e281f0b57 ==============================
[0m19:33:54.708618 [info ] [MainThread]: Running with dbt=1.8.7
[0m19:33:54.709143 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/lab', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/lab/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'send_anonymous_usage_stats': 'True'}
[0m19:33:55.168982 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f3fc8b02-d46c-46dc-a9d7-1a6e281f0b57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffbb0e3da0>]}
[0m19:33:55.190873 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f3fc8b02-d46c-46dc-a9d7-1a6e281f0b57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e73f9e0>]}
[0m19:33:55.191340 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m19:33:55.240550 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m19:33:55.307380 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:33:55.307655 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:33:55.329628 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f3fc8b02-d46c-46dc-a9d7-1a6e281f0b57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb93f3050>]}
[0m19:33:55.383015 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f3fc8b02-d46c-46dc-a9d7-1a6e281f0b57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9d73d670>]}
[0m19:33:55.383520 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m19:33:55.384211 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f3fc8b02-d46c-46dc-a9d7-1a6e281f0b57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb95cc980>]}
[0m19:33:55.385693 [info ] [MainThread]: 
[0m19:33:55.386217 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:33:55.388915 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m19:33:55.395616 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m19:33:55.395865 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m19:33:55.396138 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:33:56.373217 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.977 seconds
[0m19:33:56.377330 [debug] [ThreadPool]: On list_dev: Close
[0m19:33:56.506702 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_stock)
[0m19:33:56.512184 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m19:33:56.512528 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m19:33:56.512798 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:33:57.016789 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.504 seconds
[0m19:33:57.022460 [debug] [ThreadPool]: On list_dev_stock: Close
[0m19:33:57.158120 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_stock, now list_dev_snapshot)
[0m19:33:57.165928 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m19:33:57.166597 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m19:33:57.167416 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:33:57.694307 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.527 seconds
[0m19:33:57.698559 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m19:33:57.839902 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f3fc8b02-d46c-46dc-a9d7-1a6e281f0b57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9d6599a0>]}
[0m19:33:57.841353 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:33:57.842849 [info ] [MainThread]: 
[0m19:33:57.855287 [debug] [Thread-1 (]: Began running node model.lab.RSI_Calculation
[0m19:33:57.856010 [info ] [Thread-1 (]: 1 of 2 START sql table model stock.RSI_Calculation ............................. [RUN]
[0m19:33:57.856749 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_snapshot, now model.lab.RSI_Calculation)
[0m19:33:57.857189 [debug] [Thread-1 (]: Began compiling node model.lab.RSI_Calculation
[0m19:33:57.864264 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.RSI_Calculation"
[0m19:33:57.866879 [debug] [Thread-1 (]: Began executing node model.lab.RSI_Calculation
[0m19:33:57.887152 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.RSI_Calculation"
[0m19:33:57.889302 [debug] [Thread-1 (]: Using snowflake connection "model.lab.RSI_Calculation"
[0m19:33:57.889687 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.RSI_Calculation"} */
create or replace transient table dev.stock.RSI_Calculation
         as
        (-- models/rsi_calculation.sql

WITH PriceChanges AS (
    SELECT
        date,
        symbol,
        close,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM
        dev.stock.stock_price_analysis  -- Replace 'stock' and 'stock_price_analysis' with your actual source name and table
),
PriceGainsLosses AS (
    SELECT
        date,
        symbol,
        close,
        next_close,
        CASE 
            WHEN next_close > close THEN next_close - close
            ELSE 0 
        END AS gain,
        CASE 
            WHEN next_close < close THEN close - next_close
            ELSE 0 
        END AS loss
    FROM
        PriceChanges
),
AverageGainsLosses AS (
    SELECT
        date,
        symbol,
        AVG(gain) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain,
        AVG(loss) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss
    FROM
        PriceGainsLosses
),
RSI_Calculation AS (
    SELECT
        date,
        symbol,
        avg_gain,
        avg_loss,
        CASE 
            WHEN avg_loss = 0 THEN 100
            ELSE 100 - (100 / (1 + (avg_gain / avg_loss)))
        END AS rsi
    FROM
        AverageGainsLosses
)
SELECT 
    date, 
    symbol, 
    rsi
FROM 
    RSI_Calculation
WHERE
    date >= (SELECT MIN(date) FROM dev.stock.stock_price_analysis) + INTERVAL '14 DAY'
ORDER BY
    symbol, date
        );
[0m19:33:57.890082 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:33:59.339583 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.449 seconds
[0m19:33:59.365181 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: Close
[0m19:33:59.514498 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f3fc8b02-d46c-46dc-a9d7-1a6e281f0b57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9da61100>]}
[0m19:33:59.516213 [info ] [Thread-1 (]: 1 of 2 OK created sql table model stock.RSI_Calculation ........................ [[32mSUCCESS 1[0m in 1.66s]
[0m19:33:59.518359 [debug] [Thread-1 (]: Finished running node model.lab.RSI_Calculation
[0m19:33:59.519342 [debug] [Thread-1 (]: Began running node model.lab.stock_price_analysis
[0m19:33:59.520189 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.RSI_Calculation, now model.lab.stock_price_analysis)
[0m19:33:59.520829 [debug] [Thread-1 (]: Began compiling node model.lab.stock_price_analysis
[0m19:33:59.524334 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.stock_price_analysis"
[0m19:33:59.526561 [debug] [Thread-1 (]: Finished running node model.lab.stock_price_analysis
[0m19:33:59.527777 [debug] [Thread-1 (]: Began running node model.lab.macd_calculation
[0m19:33:59.528517 [info ] [Thread-1 (]: 2 of 2 START sql table model stock.macd_calculation ............................ [RUN]
[0m19:33:59.529775 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.stock_price_analysis, now model.lab.macd_calculation)
[0m19:33:59.530287 [debug] [Thread-1 (]: Began compiling node model.lab.macd_calculation
[0m19:33:59.548963 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.macd_calculation"
[0m19:33:59.550094 [debug] [Thread-1 (]: Began executing node model.lab.macd_calculation
[0m19:33:59.552146 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.macd_calculation"
[0m19:33:59.554207 [debug] [Thread-1 (]: Using snowflake connection "model.lab.macd_calculation"
[0m19:33:59.554574 [debug] [Thread-1 (]: On model.lab.macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.macd_calculation"} */
create or replace transient table dev.stock.macd_calculation
         as
        (WITH  __dbt__cte__stock_price_analysis as (
WITH stock_data AS (
    SELECT
        *
    FROM dev.stock.stock_price_analysis
)

-- Now you can query the CTE
SELECT * FROM stock_data
), stock_data AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE,
        ROW_NUMBER() OVER (PARTITION BY SYMBOL ORDER BY DATE) AS rn
    FROM __dbt__cte__stock_price_analysis  -- Replace with the reference to your actual source table in DBT
),

-- Calculate 12-day EMA
ema_12 AS (
    SELECT
        SYMBOL,
        DATE,
        CLOSE AS EMA_12,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (12 + 1))) + (e.EMA_12 * (1 - (2.0 / (12 + 1)))) AS EMA_12,
        sd.rn
    FROM stock_data sd
    JOIN ema_12 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate 26-day EMA
ema_26 AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE AS EMA_26,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (26 + 1))) + (e.EMA_26 * (1 - (2.0 / (26 + 1)))) AS EMA_26,
        sd.rn
    FROM stock_data sd
    JOIN ema_26 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate MACD by subtracting 26-day EMA from 12-day EMA
macd_calculation AS (
    SELECT 
        e12.SYMBOL,
        e12.DATE,
        e12.EMA_12 - e26.EMA_26 AS MACD,
        e12.rn
    FROM ema_12 e12
    JOIN ema_26 e26 ON e12.SYMBOL = e26.SYMBOL AND e12.DATE = e26.DATE
),

-- Calculate 9-day EMA of MACD as Signal Line
signal_line AS (
    SELECT 
        SYMBOL,
        DATE,
        MACD,
        MACD AS Signal,
        rn
    FROM macd_calculation
    WHERE rn = 1

    UNION ALL

    SELECT 
        mc.SYMBOL,
        mc.DATE,
        mc.MACD,
        (mc.MACD * (2.0 / (9 + 1))) + (sl.Signal * (1 - (2.0 / (9 + 1)))) AS Signal,
        mc.rn
    FROM macd_calculation mc
    JOIN signal_line sl ON mc.SYMBOL = sl.SYMBOL AND mc.rn = sl.rn + 1
)

-- Final output
SELECT 
    SYMBOL,
    DATE,
    MACD,
    Signal,
    MACD - Signal AS Histogram
FROM signal_line
ORDER BY SYMBOL, DATE
        );
[0m19:33:59.555059 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:34:01.185333 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.630 seconds
[0m19:34:01.189607 [debug] [Thread-1 (]: On model.lab.macd_calculation: Close
[0m19:34:01.344405 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f3fc8b02-d46c-46dc-a9d7-1a6e281f0b57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffbadf8920>]}
[0m19:34:01.345424 [info ] [Thread-1 (]: 2 of 2 OK created sql table model stock.macd_calculation ....................... [[32mSUCCESS 1[0m in 1.81s]
[0m19:34:01.347408 [debug] [Thread-1 (]: Finished running node model.lab.macd_calculation
[0m19:34:01.348881 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:34:01.349270 [debug] [MainThread]: Connection 'model.lab.macd_calculation' was properly closed.
[0m19:34:01.349697 [info ] [MainThread]: 
[0m19:34:01.350268 [info ] [MainThread]: Finished running 2 table models in 0 hours 0 minutes and 5.96 seconds (5.96s).
[0m19:34:01.351239 [debug] [MainThread]: Command end result
[0m19:34:01.380268 [info ] [MainThread]: 
[0m19:34:01.380750 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:34:01.381133 [info ] [MainThread]: 
[0m19:34:01.381508 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m19:34:01.382334 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.703572, "process_user_time": 2.565319, "process_kernel_time": 0.334913, "process_mem_max_rss": "207692", "process_out_blocks": "5613", "process_in_blocks": "0"}
[0m19:34:01.382703 [debug] [MainThread]: Command `dbt run` succeeded at 19:34:01.382650 after 6.70 seconds
[0m19:34:01.382965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffba343080>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffba16aae0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9da61100>]}
[0m19:34:01.383223 [debug] [MainThread]: Flushing usage events
[0m19:34:03.529438 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d7d19d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ce83980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7fcf1fd0>]}


============================== 19:34:03.533200 | 201db360-cd37-416b-b325-9bc4337d33a1 ==============================
[0m19:34:03.533200 [info ] [MainThread]: Running with dbt=1.8.7
[0m19:34:03.533868 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/lab/logs', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/lab', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m19:34:03.936509 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '201db360-cd37-416b-b325-9bc4337d33a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff63998ce0>]}
[0m19:34:03.958328 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '201db360-cd37-416b-b325-9bc4337d33a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff63923950>]}
[0m19:34:03.958797 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m19:34:04.003648 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m19:34:04.064395 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:34:04.064687 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:34:04.086565 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '201db360-cd37-416b-b325-9bc4337d33a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff60c4aea0>]}
[0m19:34:04.144409 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '201db360-cd37-416b-b325-9bc4337d33a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff60738fe0>]}
[0m19:34:04.144730 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m19:34:04.145181 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '201db360-cd37-416b-b325-9bc4337d33a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff60df6030>]}
[0m19:34:04.146023 [info ] [MainThread]: 
[0m19:34:04.146492 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:34:04.148524 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev_snapshot'
[0m19:34:04.157672 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m19:34:04.157929 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m19:34:04.158144 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:34:04.905932 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.747 seconds
[0m19:34:04.910315 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m19:34:05.066105 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m19:34:05.073535 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m19:34:05.074395 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m19:34:05.075510 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:34:05.712526 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.637 seconds
[0m19:34:05.717172 [debug] [ThreadPool]: On list_dev_stock: Close
[0m19:34:05.879088 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '201db360-cd37-416b-b325-9bc4337d33a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff617b08c0>]}
[0m19:34:05.880953 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:34:05.882680 [info ] [MainThread]: 
[0m19:34:05.897991 [debug] [Thread-1 (]: Began running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m19:34:05.898753 [info ] [Thread-1 (]: 1 of 1 START test not_null_macd_calculation_date ............................... [RUN]
[0m19:34:05.899752 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now test.lab.not_null_macd_calculation_date.1954e908c9)
[0m19:34:05.900262 [debug] [Thread-1 (]: Began compiling node test.lab.not_null_macd_calculation_date.1954e908c9
[0m19:34:05.913990 [debug] [Thread-1 (]: Writing injected SQL for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m19:34:05.915498 [debug] [Thread-1 (]: Began executing node test.lab.not_null_macd_calculation_date.1954e908c9
[0m19:34:05.928000 [debug] [Thread-1 (]: Writing runtime sql for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m19:34:05.929149 [debug] [Thread-1 (]: Using snowflake connection "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m19:34:05.929482 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "test.lab.not_null_macd_calculation_date.1954e908c9"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from dev.stock.macd_calculation
where date is null



      
    ) dbt_internal_test
[0m19:34:05.929789 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:34:06.546338 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.616 seconds
[0m19:34:06.554184 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: Close
[0m19:34:06.676799 [info ] [Thread-1 (]: 1 of 1 PASS not_null_macd_calculation_date ..................................... [[32mPASS[0m in 0.78s]
[0m19:34:06.678289 [debug] [Thread-1 (]: Finished running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m19:34:06.680031 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:34:06.680466 [debug] [MainThread]: Connection 'test.lab.not_null_macd_calculation_date.1954e908c9' was properly closed.
[0m19:34:06.680856 [info ] [MainThread]: 
[0m19:34:06.681437 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 2.53 seconds (2.53s).
[0m19:34:06.682272 [debug] [MainThread]: Command end result
[0m19:34:06.711432 [info ] [MainThread]: 
[0m19:34:06.711917 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:34:06.712316 [info ] [MainThread]: 
[0m19:34:06.712737 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m19:34:06.713440 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.2226124, "process_user_time": 2.288472, "process_kernel_time": 0.173262, "process_mem_max_rss": "208028", "process_out_blocks": "1849", "process_in_blocks": "0"}
[0m19:34:06.713810 [debug] [MainThread]: Command `dbt test` succeeded at 19:34:06.713753 after 3.22 seconds
[0m19:34:06.714091 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7df0e210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7cd21460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7fcf1fd0>]}
[0m19:34:06.714406 [debug] [MainThread]: Flushing usage events
[0m19:34:08.414574 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9012fc20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8f8a14c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8f8a0a70>]}


============================== 19:34:08.418890 | d8250467-f2e0-4a2d-b8cd-117a0c0c4913 ==============================
[0m19:34:08.418890 [info ] [MainThread]: Running with dbt=1.8.7
[0m19:34:08.419538 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/lab', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/lab/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m19:34:08.809610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd8250467-f2e0-4a2d-b8cd-117a0c0c4913', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8ed083e0>]}
[0m19:34:08.831429 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd8250467-f2e0-4a2d-b8cd-117a0c0c4913', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6f152b10>]}
[0m19:34:08.831884 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m19:34:08.876614 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m19:34:08.937519 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:34:08.937806 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:34:08.960550 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd8250467-f2e0-4a2d-b8cd-117a0c0c4913', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6ef23440>]}
[0m19:34:09.013352 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd8250467-f2e0-4a2d-b8cd-117a0c0c4913', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6ee51790>]}
[0m19:34:09.013678 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m19:34:09.014107 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd8250467-f2e0-4a2d-b8cd-117a0c0c4913', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6f413740>]}
[0m19:34:09.014918 [info ] [MainThread]: 
[0m19:34:09.015301 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:34:09.015807 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m19:34:09.022601 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m19:34:09.022823 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m19:34:09.023005 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:34:09.525003 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.502 seconds
[0m19:34:09.528588 [debug] [ThreadPool]: On list_dev: Close
[0m19:34:09.686423 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_snapshot)
[0m19:34:09.696981 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m19:34:09.697580 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m19:34:09.698025 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:34:10.246709 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.548 seconds
[0m19:34:10.250803 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m19:34:10.396858 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m19:34:10.398560 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m19:34:10.398825 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m19:34:10.399041 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:34:10.985640 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.586 seconds
[0m19:34:10.990955 [debug] [ThreadPool]: On list_dev_stock: Close
[0m19:34:11.132535 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd8250467-f2e0-4a2d-b8cd-117a0c0c4913', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6efae600>]}
[0m19:34:11.133961 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:34:11.135710 [info ] [MainThread]: 
[0m19:34:11.151752 [debug] [Thread-1 (]: Began running node snapshot.lab.snapshot_macd_calculation
[0m19:34:11.152624 [info ] [Thread-1 (]: 1 of 1 START snapshot snapshot.snapshot_macd_calculation ....................... [RUN]
[0m19:34:11.153694 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now snapshot.lab.snapshot_macd_calculation)
[0m19:34:11.154282 [debug] [Thread-1 (]: Began compiling node snapshot.lab.snapshot_macd_calculation
[0m19:34:11.162163 [debug] [Thread-1 (]: Began executing node snapshot.lab.snapshot_macd_calculation
[0m19:34:11.197232 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:34:11.197543 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
[0m19:34:11.197804 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:34:11.661582 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.464 seconds
[0m19:34:11.685013 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:34:11.685373 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
create or replace temporary table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp"
         as
        (

    with snapshot_query as (

        

SELECT * FROM dev.stock.macd_calculation

    ),

    snapshotted_data as (

        select *, 
    
        date as dbt_unique_key
    

        from "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            
  
  coalesce(nullif(date, date), null)
  as dbt_valid_to
,
            md5(coalesce(cast(date as varchar ), '')
         || '|' || coalesce(cast(date as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            date as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select *, 
    
        date as dbt_unique_key
    

        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data.dbt_valid_from < source_data.date))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data.dbt_valid_from < source_data.date)
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        source_data.dbt_unique_key is null
    

    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m19:34:12.858066 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.172 seconds
[0m19:34:12.866151 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:34:12.867425 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp"
[0m19:34:13.166579 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.298 seconds
[0m19:34:13.176581 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:34:13.177463 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
[0m19:34:13.347684 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.169 seconds
[0m19:34:13.354145 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:34:13.354822 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp"
[0m19:34:13.459876 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.104 seconds
[0m19:34:13.469445 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:34:13.470490 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
[0m19:34:13.627055 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.156 seconds
[0m19:34:13.639648 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:34:13.640552 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp"
[0m19:34:13.809815 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.168 seconds
[0m19:34:13.837788 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:34:13.838530 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
select * from (
        

    with snapshot_query as (

        

SELECT * FROM dev.stock.macd_calculation

    ),

    snapshotted_data as (

        select *, 
    
        date as dbt_unique_key
    

        from "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            
  
  coalesce(nullif(date, date), null)
  as dbt_valid_to
,
            md5(coalesce(cast(date as varchar ), '')
         || '|' || coalesce(cast(date as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            date as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select *, 
    
        date as dbt_unique_key
    

        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data.dbt_valid_from < source_data.date))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data.dbt_valid_from < source_data.date)
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        source_data.dbt_unique_key is null
    

    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

    ) as __dbt_sbq
    where false
    limit 0
[0m19:34:14.292083 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.453 seconds
[0m19:34:14.298719 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:34:14.299554 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
select * from (
        select to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_snapshot_time
    ) as __dbt_sbq
    where false
    limit 0
[0m19:34:14.395786 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.096 seconds
[0m19:34:14.396818 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.lab.snapshot_macd_calculation"
[0m19:34:14.403253 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:34:14.404394 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
BEGIN
[0m19:34:14.531424 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.126 seconds
[0m19:34:14.532327 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:34:14.532917 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
merge into "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION" as DBT_INTERNAL_DEST
    using "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     
       and DBT_INTERNAL_DEST.dbt_valid_to is null
     
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SYMBOL", "DATE", "MACD", "SIGNAL", "HISTOGRAM", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SYMBOL", "DATE", "MACD", "SIGNAL", "HISTOGRAM", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m19:34:15.007339 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.474 seconds
[0m19:34:15.008726 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:34:15.009528 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
COMMIT
[0m19:34:15.415467 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.405 seconds
[0m19:34:15.437851 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: Close
[0m19:34:15.569410 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd8250467-f2e0-4a2d-b8cd-117a0c0c4913', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8f70a0f0>]}
[0m19:34:15.571291 [info ] [Thread-1 (]: 1 of 1 OK snapshotted snapshot.snapshot_macd_calculation ....................... [[32mSUCCESS 0[0m in 4.41s]
[0m19:34:15.575347 [debug] [Thread-1 (]: Finished running node snapshot.lab.snapshot_macd_calculation
[0m19:34:15.578480 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:34:15.578981 [debug] [MainThread]: Connection 'snapshot.lab.snapshot_macd_calculation' was properly closed.
[0m19:34:15.579520 [info ] [MainThread]: 
[0m19:34:15.580312 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 6.56 seconds (6.56s).
[0m19:34:15.581464 [debug] [MainThread]: Command end result
[0m19:34:15.611700 [info ] [MainThread]: 
[0m19:34:15.612239 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:34:15.612538 [info ] [MainThread]: 
[0m19:34:15.612874 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m19:34:15.614349 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 7.2383747, "process_user_time": 2.476007, "process_kernel_time": 0.153, "process_mem_max_rss": "206376", "process_out_blocks": "1873", "process_in_blocks": "0"}
[0m19:34:15.614896 [debug] [MainThread]: Command `dbt snapshot` succeeded at 19:34:15.614830 after 7.24 seconds
[0m19:34:15.615232 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9012fc20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8f8a26f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8f8a0a70>]}
[0m19:34:15.615499 [debug] [MainThread]: Flushing usage events
[0m19:53:07.153984 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb7841c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb744f230>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb704ab70>]}


============================== 19:53:07.157728 | 17d573b1-2c15-436d-aa65-57212b5127f9 ==============================
[0m19:53:07.157728 [info ] [MainThread]: Running with dbt=1.8.7
[0m19:53:07.158350 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/lab/logs', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/lab', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m19:53:07.673405 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '17d573b1-2c15-436d-aa65-57212b5127f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff97354860>]}
[0m19:53:07.696788 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '17d573b1-2c15-436d-aa65-57212b5127f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff97062ff0>]}
[0m19:53:07.697289 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m19:53:07.742063 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m19:53:07.807404 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:53:07.807705 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:53:07.829597 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '17d573b1-2c15-436d-aa65-57212b5127f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff970cd040>]}
[0m19:53:07.882200 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '17d573b1-2c15-436d-aa65-57212b5127f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff96c480b0>]}
[0m19:53:07.882500 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m19:53:07.882921 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '17d573b1-2c15-436d-aa65-57212b5127f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff96f59d00>]}
[0m19:53:07.883825 [info ] [MainThread]: 
[0m19:53:07.884232 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:53:07.886308 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m19:53:07.893239 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m19:53:07.893500 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m19:53:07.893718 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:53:08.758278 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.864 seconds
[0m19:53:08.759399 [debug] [ThreadPool]: On list_dev: Close
[0m19:53:08.881328 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_snapshot)
[0m19:53:08.886905 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m19:53:08.887336 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m19:53:08.887647 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:53:09.332487 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.444 seconds
[0m19:53:09.335961 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m19:53:09.446340 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m19:53:09.449696 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m19:53:09.450228 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m19:53:09.450700 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:53:10.038320 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.587 seconds
[0m19:53:10.042590 [debug] [ThreadPool]: On list_dev_stock: Close
[0m19:53:10.175679 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '17d573b1-2c15-436d-aa65-57212b5127f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb86a5880>]}
[0m19:53:10.197125 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:53:10.199190 [info ] [MainThread]: 
[0m19:53:10.206808 [debug] [Thread-1 (]: Began running node model.lab.RSI_Calculation
[0m19:53:10.207250 [info ] [Thread-1 (]: 1 of 2 START sql table model stock.RSI_Calculation ............................. [RUN]
[0m19:53:10.207830 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now model.lab.RSI_Calculation)
[0m19:53:10.208149 [debug] [Thread-1 (]: Began compiling node model.lab.RSI_Calculation
[0m19:53:10.213358 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.RSI_Calculation"
[0m19:53:10.214848 [debug] [Thread-1 (]: Began executing node model.lab.RSI_Calculation
[0m19:53:10.235619 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.RSI_Calculation"
[0m19:53:10.237875 [debug] [Thread-1 (]: Using snowflake connection "model.lab.RSI_Calculation"
[0m19:53:10.238300 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.RSI_Calculation"} */
create or replace transient table dev.stock.RSI_Calculation
         as
        (-- models/rsi_calculation.sql

WITH PriceChanges AS (
    SELECT
        date,
        symbol,
        close,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM
        dev.stock.stock_price_analysis  -- Replace 'stock' and 'stock_price_analysis' with your actual source name and table
),
PriceGainsLosses AS (
    SELECT
        date,
        symbol,
        close,
        next_close,
        CASE 
            WHEN next_close > close THEN next_close - close
            ELSE 0 
        END AS gain,
        CASE 
            WHEN next_close < close THEN close - next_close
            ELSE 0 
        END AS loss
    FROM
        PriceChanges
),
AverageGainsLosses AS (
    SELECT
        date,
        symbol,
        AVG(gain) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain,
        AVG(loss) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss
    FROM
        PriceGainsLosses
),
RSI_Calculation AS (
    SELECT
        date,
        symbol,
        avg_gain,
        avg_loss,
        CASE 
            WHEN avg_loss = 0 THEN 100
            ELSE 100 - (100 / (1 + (avg_gain / avg_loss)))
        END AS rsi
    FROM
        AverageGainsLosses
)
SELECT 
    date, 
    symbol, 
    rsi
FROM 
    RSI_Calculation
WHERE
    date >= (SELECT MIN(date) FROM dev.stock.stock_price_analysis) + INTERVAL '14 DAY'
ORDER BY
    symbol, date
        );
[0m19:53:10.238743 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:53:12.062360 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.823 seconds
[0m19:53:12.088513 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: Close
[0m19:53:12.206877 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '17d573b1-2c15-436d-aa65-57212b5127f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb7842ff0>]}
[0m19:53:12.208530 [info ] [Thread-1 (]: 1 of 2 OK created sql table model stock.RSI_Calculation ........................ [[32mSUCCESS 1[0m in 2.00s]
[0m19:53:12.211298 [debug] [Thread-1 (]: Finished running node model.lab.RSI_Calculation
[0m19:53:12.212139 [debug] [Thread-1 (]: Began running node model.lab.stock_price_analysis
[0m19:53:12.213039 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.RSI_Calculation, now model.lab.stock_price_analysis)
[0m19:53:12.213550 [debug] [Thread-1 (]: Began compiling node model.lab.stock_price_analysis
[0m19:53:12.217580 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.stock_price_analysis"
[0m19:53:12.219712 [debug] [Thread-1 (]: Finished running node model.lab.stock_price_analysis
[0m19:53:12.221220 [debug] [Thread-1 (]: Began running node model.lab.macd_calculation
[0m19:53:12.221755 [info ] [Thread-1 (]: 2 of 2 START sql table model stock.macd_calculation ............................ [RUN]
[0m19:53:12.222883 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.stock_price_analysis, now model.lab.macd_calculation)
[0m19:53:12.223340 [debug] [Thread-1 (]: Began compiling node model.lab.macd_calculation
[0m19:53:12.240500 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.macd_calculation"
[0m19:53:12.241613 [debug] [Thread-1 (]: Began executing node model.lab.macd_calculation
[0m19:53:12.243687 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.macd_calculation"
[0m19:53:12.245698 [debug] [Thread-1 (]: Using snowflake connection "model.lab.macd_calculation"
[0m19:53:12.246052 [debug] [Thread-1 (]: On model.lab.macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.macd_calculation"} */
create or replace transient table dev.stock.macd_calculation
         as
        (WITH  __dbt__cte__stock_price_analysis as (
WITH stock_data AS (
    SELECT
        *
    FROM dev.stock.stock_price_analysis
)

-- Now you can query the CTE
SELECT * FROM stock_data
), stock_data AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE,
        ROW_NUMBER() OVER (PARTITION BY SYMBOL ORDER BY DATE) AS rn
    FROM __dbt__cte__stock_price_analysis  -- Replace with the reference to your actual source table in DBT
),

-- Calculate 12-day EMA
ema_12 AS (
    SELECT
        SYMBOL,
        DATE,
        CLOSE AS EMA_12,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (12 + 1))) + (e.EMA_12 * (1 - (2.0 / (12 + 1)))) AS EMA_12,
        sd.rn
    FROM stock_data sd
    JOIN ema_12 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate 26-day EMA
ema_26 AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE AS EMA_26,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (26 + 1))) + (e.EMA_26 * (1 - (2.0 / (26 + 1)))) AS EMA_26,
        sd.rn
    FROM stock_data sd
    JOIN ema_26 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate MACD by subtracting 26-day EMA from 12-day EMA
macd_calculation AS (
    SELECT 
        e12.SYMBOL,
        e12.DATE,
        e12.EMA_12 - e26.EMA_26 AS MACD,
        e12.rn
    FROM ema_12 e12
    JOIN ema_26 e26 ON e12.SYMBOL = e26.SYMBOL AND e12.DATE = e26.DATE
),

-- Calculate 9-day EMA of MACD as Signal Line
signal_line AS (
    SELECT 
        SYMBOL,
        DATE,
        MACD,
        MACD AS Signal,
        rn
    FROM macd_calculation
    WHERE rn = 1

    UNION ALL

    SELECT 
        mc.SYMBOL,
        mc.DATE,
        mc.MACD,
        (mc.MACD * (2.0 / (9 + 1))) + (sl.Signal * (1 - (2.0 / (9 + 1)))) AS Signal,
        mc.rn
    FROM macd_calculation mc
    JOIN signal_line sl ON mc.SYMBOL = sl.SYMBOL AND mc.rn = sl.rn + 1
)

-- Final output
SELECT 
    SYMBOL,
    DATE,
    MACD,
    Signal,
    MACD - Signal AS Histogram
FROM signal_line
ORDER BY SYMBOL, DATE
        );
[0m19:53:12.246560 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:53:13.805516 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.559 seconds
[0m19:53:13.811616 [debug] [Thread-1 (]: On model.lab.macd_calculation: Close
[0m19:53:13.933474 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '17d573b1-2c15-436d-aa65-57212b5127f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb8544fb0>]}
[0m19:53:13.935423 [info ] [Thread-1 (]: 2 of 2 OK created sql table model stock.macd_calculation ....................... [[32mSUCCESS 1[0m in 1.71s]
[0m19:53:13.938484 [debug] [Thread-1 (]: Finished running node model.lab.macd_calculation
[0m19:53:13.941255 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:53:13.941870 [debug] [MainThread]: Connection 'model.lab.macd_calculation' was properly closed.
[0m19:53:13.942631 [info ] [MainThread]: 
[0m19:53:13.944078 [info ] [MainThread]: Finished running 2 table models in 0 hours 0 minutes and 6.06 seconds (6.06s).
[0m19:53:13.945809 [debug] [MainThread]: Command end result
[0m19:53:13.981511 [info ] [MainThread]: 
[0m19:53:13.982078 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:53:13.982381 [info ] [MainThread]: 
[0m19:53:13.982784 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m19:53:13.984315 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.85332, "process_user_time": 2.623441, "process_kernel_time": 0.302588, "process_mem_max_rss": "207708", "process_out_blocks": "5613", "process_in_blocks": "0"}
[0m19:53:13.984858 [debug] [MainThread]: Command `dbt run` succeeded at 19:53:13.984775 after 6.85 seconds
[0m19:53:13.985228 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb7166fc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb7202f60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff97731e50>]}
[0m19:53:13.985526 [debug] [MainThread]: Flushing usage events
[0m19:53:16.614408 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffae383da0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffadfe7c80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffae5eb2f0>]}


============================== 19:53:16.618011 | dad7502e-951d-4b07-b1f4-3572b46ad8a1 ==============================
[0m19:53:16.618011 [info ] [MainThread]: Running with dbt=1.8.7
[0m19:53:16.618598 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/opt/airflow/lab', 'log_path': '/opt/airflow/lab/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m19:53:17.038903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dad7502e-951d-4b07-b1f4-3572b46ad8a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e37e780>]}
[0m19:53:17.060669 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dad7502e-951d-4b07-b1f4-3572b46ad8a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf015be0>]}
[0m19:53:17.061123 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m19:53:17.105402 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m19:53:17.166159 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:53:17.166452 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:53:17.188603 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dad7502e-951d-4b07-b1f4-3572b46ad8a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8dfcbc20>]}
[0m19:53:17.247067 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dad7502e-951d-4b07-b1f4-3572b46ad8a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8db9f590>]}
[0m19:53:17.247372 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m19:53:17.247839 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dad7502e-951d-4b07-b1f4-3572b46ad8a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8decd7f0>]}
[0m19:53:17.248679 [info ] [MainThread]: 
[0m19:53:17.249082 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:53:17.251109 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev_snapshot'
[0m19:53:17.259318 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m19:53:17.259583 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m19:53:17.259797 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:53:17.782208 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.522 seconds
[0m19:53:17.786395 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m19:53:17.925378 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m19:53:17.929864 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m19:53:17.930577 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m19:53:17.931113 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:53:18.521131 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.590 seconds
[0m19:53:18.524147 [debug] [ThreadPool]: On list_dev_stock: Close
[0m19:53:18.642881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dad7502e-951d-4b07-b1f4-3572b46ad8a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffadd2a1e0>]}
[0m19:53:18.644237 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:53:18.646204 [info ] [MainThread]: 
[0m19:53:18.661640 [debug] [Thread-1 (]: Began running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m19:53:18.662242 [info ] [Thread-1 (]: 1 of 1 START test not_null_macd_calculation_date ............................... [RUN]
[0m19:53:18.663100 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now test.lab.not_null_macd_calculation_date.1954e908c9)
[0m19:53:18.663605 [debug] [Thread-1 (]: Began compiling node test.lab.not_null_macd_calculation_date.1954e908c9
[0m19:53:18.677798 [debug] [Thread-1 (]: Writing injected SQL for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m19:53:18.679312 [debug] [Thread-1 (]: Began executing node test.lab.not_null_macd_calculation_date.1954e908c9
[0m19:53:18.691795 [debug] [Thread-1 (]: Writing runtime sql for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m19:53:18.693015 [debug] [Thread-1 (]: Using snowflake connection "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m19:53:18.693370 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "test.lab.not_null_macd_calculation_date.1954e908c9"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from dev.stock.macd_calculation
where date is null



      
    ) dbt_internal_test
[0m19:53:18.693691 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:53:19.267424 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.573 seconds
[0m19:53:19.282123 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: Close
[0m19:53:19.422062 [info ] [Thread-1 (]: 1 of 1 PASS not_null_macd_calculation_date ..................................... [[32mPASS[0m in 0.76s]
[0m19:53:19.424277 [debug] [Thread-1 (]: Finished running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m19:53:19.426780 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:53:19.427473 [debug] [MainThread]: Connection 'test.lab.not_null_macd_calculation_date.1954e908c9' was properly closed.
[0m19:53:19.428069 [info ] [MainThread]: 
[0m19:53:19.428937 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 2.18 seconds (2.18s).
[0m19:53:19.430081 [debug] [MainThread]: Command end result
[0m19:53:19.462803 [info ] [MainThread]: 
[0m19:53:19.463306 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:53:19.463725 [info ] [MainThread]: 
[0m19:53:19.464117 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m19:53:19.464873 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 2.888039, "process_user_time": 2.272207, "process_kernel_time": 0.17656, "process_mem_max_rss": "208212", "process_out_blocks": "1849", "process_in_blocks": "0"}
[0m19:53:19.465227 [debug] [MainThread]: Command `dbt test` succeeded at 19:53:19.465170 after 2.89 seconds
[0m19:53:19.465519 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffae5eb2f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffadfe7c80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffadfe78f0>]}
[0m19:53:19.465815 [debug] [MainThread]: Flushing usage events
[0m19:53:21.588928 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffacee85c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffad664470>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfffface3acf0>]}


============================== 19:53:21.592457 | 03b60d4b-aeac-422c-8d41-409e4116c42d ==============================
[0m19:53:21.592457 [info ] [MainThread]: Running with dbt=1.8.7
[0m19:53:21.593199 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/lab/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/lab', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m19:53:21.980017 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '03b60d4b-aeac-422c-8d41-409e4116c42d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffadb8a390>]}
[0m19:53:22.001622 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '03b60d4b-aeac-422c-8d41-409e4116c42d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa34f3aa0>]}
[0m19:53:22.002059 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m19:53:22.044486 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m19:53:22.104481 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:53:22.104766 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:53:22.126803 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '03b60d4b-aeac-422c-8d41-409e4116c42d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff906fb500>]}
[0m19:53:22.182580 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '03b60d4b-aeac-422c-8d41-409e4116c42d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9080b110>]}
[0m19:53:22.182901 [info ] [MainThread]: Found 3 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m19:53:22.183380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '03b60d4b-aeac-422c-8d41-409e4116c42d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90a30b90>]}
[0m19:53:22.184229 [info ] [MainThread]: 
[0m19:53:22.184669 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:53:22.185180 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m19:53:22.192156 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m19:53:22.192404 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m19:53:22.192615 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:53:22.725952 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.533 seconds
[0m19:53:22.729946 [debug] [ThreadPool]: On list_dev: Close
[0m19:53:22.871617 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_snapshot)
[0m19:53:22.881880 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m19:53:22.882418 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m19:53:22.882829 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:53:23.373501 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.490 seconds
[0m19:53:23.377937 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m19:53:23.491864 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m19:53:23.493968 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m19:53:23.494315 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m19:53:23.494652 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:53:23.984242 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.489 seconds
[0m19:53:23.988556 [debug] [ThreadPool]: On list_dev_stock: Close
[0m19:53:24.125035 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '03b60d4b-aeac-422c-8d41-409e4116c42d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff907271d0>]}
[0m19:53:24.126646 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:53:24.128304 [info ] [MainThread]: 
[0m19:53:24.150385 [debug] [Thread-1 (]: Began running node snapshot.lab.snapshot_macd_calculation
[0m19:53:24.152855 [info ] [Thread-1 (]: 1 of 1 START snapshot snapshot.snapshot_macd_calculation ....................... [RUN]
[0m19:53:24.153761 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now snapshot.lab.snapshot_macd_calculation)
[0m19:53:24.155795 [debug] [Thread-1 (]: Began compiling node snapshot.lab.snapshot_macd_calculation
[0m19:53:24.169393 [debug] [Thread-1 (]: Began executing node snapshot.lab.snapshot_macd_calculation
[0m19:53:24.207792 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:53:24.208177 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
[0m19:53:24.208420 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:53:24.641194 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.432 seconds
[0m19:53:24.685680 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:53:24.686190 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
create or replace temporary table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp"
         as
        (

    with snapshot_query as (

        

SELECT * FROM dev.stock.macd_calculation

    ),

    snapshotted_data as (

        select *, 
    
        date as dbt_unique_key
    

        from "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            
  
  coalesce(nullif(date, date), null)
  as dbt_valid_to
,
            md5(coalesce(cast(date as varchar ), '')
         || '|' || coalesce(cast(date as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            date as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select *, 
    
        date as dbt_unique_key
    

        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data.dbt_valid_from < source_data.date))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data.dbt_valid_from < source_data.date)
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        source_data.dbt_unique_key is null
    

    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m19:53:26.198359 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.511 seconds
[0m19:53:26.204153 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:53:26.205014 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp"
[0m19:53:26.318742 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.113 seconds
[0m19:53:26.327185 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:53:26.328171 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
[0m19:53:26.436545 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.108 seconds
[0m19:53:26.441657 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:53:26.442373 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp"
[0m19:53:26.545701 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.103 seconds
[0m19:53:26.553921 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:53:26.554855 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
[0m19:53:26.685300 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.130 seconds
[0m19:53:26.699988 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:53:26.700903 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp"
[0m19:53:26.819924 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.118 seconds
[0m19:53:26.843915 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:53:26.844453 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
select * from (
        

    with snapshot_query as (

        

SELECT * FROM dev.stock.macd_calculation

    ),

    snapshotted_data as (

        select *, 
    
        date as dbt_unique_key
    

        from "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            
  
  coalesce(nullif(date, date), null)
  as dbt_valid_to
,
            md5(coalesce(cast(date as varchar ), '')
         || '|' || coalesce(cast(date as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            date as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select *, 
    
        date as dbt_unique_key
    

        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data.dbt_valid_from < source_data.date))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data.dbt_valid_from < source_data.date)
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        source_data.dbt_unique_key is null
    

    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

    ) as __dbt_sbq
    where false
    limit 0
[0m19:53:27.424449 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.579 seconds
[0m19:53:27.430883 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:53:27.431813 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
select * from (
        select to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_snapshot_time
    ) as __dbt_sbq
    where false
    limit 0
[0m19:53:27.538025 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.105 seconds
[0m19:53:27.540636 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.lab.snapshot_macd_calculation"
[0m19:53:27.545963 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:53:27.546714 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
BEGIN
[0m19:53:27.658456 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.109 seconds
[0m19:53:27.659713 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:53:27.660498 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
merge into "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION" as DBT_INTERNAL_DEST
    using "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     
       and DBT_INTERNAL_DEST.dbt_valid_to is null
     
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SYMBOL", "DATE", "MACD", "SIGNAL", "HISTOGRAM", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SYMBOL", "DATE", "MACD", "SIGNAL", "HISTOGRAM", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m19:53:28.142566 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.481 seconds
[0m19:53:28.144311 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:53:28.144998 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
COMMIT
[0m19:53:28.547900 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.402 seconds
[0m19:53:28.570263 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: Close
[0m19:53:28.691811 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '03b60d4b-aeac-422c-8d41-409e4116c42d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffad3d1d00>]}
[0m19:53:28.693840 [info ] [Thread-1 (]: 1 of 1 OK snapshotted snapshot.snapshot_macd_calculation ....................... [[32mSUCCESS 0[0m in 4.54s]
[0m19:53:28.696042 [debug] [Thread-1 (]: Finished running node snapshot.lab.snapshot_macd_calculation
[0m19:53:28.700174 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:53:28.700852 [debug] [MainThread]: Connection 'snapshot.lab.snapshot_macd_calculation' was properly closed.
[0m19:53:28.701529 [info ] [MainThread]: 
[0m19:53:28.702771 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 6.52 seconds (6.52s).
[0m19:53:28.704050 [debug] [MainThread]: Command end result
[0m19:53:28.738044 [info ] [MainThread]: 
[0m19:53:28.738537 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:53:28.738956 [info ] [MainThread]: 
[0m19:53:28.739333 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m19:53:28.740262 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 7.18946, "process_user_time": 2.581665, "process_kernel_time": 0.133811, "process_mem_max_rss": "206508", "process_out_blocks": "1873", "process_in_blocks": "0"}
[0m19:53:28.740739 [debug] [MainThread]: Command `dbt snapshot` succeeded at 19:53:28.740650 after 7.19 seconds
[0m19:53:28.741065 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffacee85c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff906fcb90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff906fcfe0>]}
[0m19:53:28.741360 [debug] [MainThread]: Flushing usage events
[0m19:58:28.420921 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8ec505f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e1d3110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e036330>]}


============================== 19:58:28.428073 | 0d24978b-f5dd-46e9-a8eb-c6f8c5f2bd08 ==============================
[0m19:58:28.428073 [info ] [MainThread]: Running with dbt=1.8.7
[0m19:58:28.428892 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/lab', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/lab/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'send_anonymous_usage_stats': 'True'}
[0m19:58:28.890604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0d24978b-f5dd-46e9-a8eb-c6f8c5f2bd08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6fb03c50>]}
[0m19:58:28.912314 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0d24978b-f5dd-46e9-a8eb-c6f8c5f2bd08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8f80ba10>]}
[0m19:58:28.912771 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m19:58:28.961792 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m19:58:29.026407 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m19:58:29.026771 [debug] [MainThread]: Partial parsing: added file: lab://snapshots/snapshot.rsi_calculation.sql
[0m19:58:29.104295 [error] [MainThread]: Encountered an error:
Compilation Error
  Snapshot 'snapshot.lab.snapshot_rsi_calculation' (snapshots/snapshot.rsi_calculation.sql) depends on a node named 'RSI_calculation' which was not found
[0m19:58:29.105162 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.7250344, "process_user_time": 2.021319, "process_kernel_time": 0.26075, "process_mem_max_rss": "199268", "process_out_blocks": "5", "command_success": false, "process_in_blocks": "0"}
[0m19:58:29.105501 [debug] [MainThread]: Command `dbt run` failed at 19:58:29.105451 after 0.73 seconds
[0m19:58:29.105758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8ec505f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8db10e00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6dcdc6e0>]}
[0m19:58:29.106098 [debug] [MainThread]: Flushing usage events
[0m20:01:01.773484 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb47c5250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb5eeda00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb3eccbf0>]}


============================== 20:01:01.777414 | e4c299c4-f381-43c3-bc51-d50f02b4d58d ==============================
[0m20:01:01.777414 [info ] [MainThread]: Running with dbt=1.8.7
[0m20:01:01.778099 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/lab', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/lab/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'send_anonymous_usage_stats': 'True'}
[0m20:01:02.225376 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e4c299c4-f381-43c3-bc51-d50f02b4d58d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff980a1250>]}
[0m20:01:02.248759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e4c299c4-f381-43c3-bc51-d50f02b4d58d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff985c39b0>]}
[0m20:01:02.249249 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m20:01:02.292930 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m20:01:02.357136 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m20:01:02.357484 [debug] [MainThread]: Partial parsing: added file: lab://snapshots/snapshot.RSI_calculation.sql
[0m20:01:02.430393 [error] [MainThread]: Encountered an error:
Compilation Error
  Snapshot 'snapshot.lab.snapshot_RSI_calculation' (snapshots/snapshot.RSI_calculation.sql) depends on a node named 'RSI_calculation' which was not found
[0m20:01:02.431195 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.6968019, "process_user_time": 2.028264, "process_kernel_time": 0.229079, "process_mem_max_rss": "199316", "process_out_blocks": "5", "command_success": false, "process_in_blocks": "0"}
[0m20:01:02.431509 [debug] [MainThread]: Command `dbt run` failed at 20:01:02.431461 after 0.70 seconds
[0m20:01:02.431767 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb3ed2030>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff93c890d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb3e52120>]}
[0m20:01:02.432013 [debug] [MainThread]: Flushing usage events
[0m20:04:38.424508 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb4b2fc80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb4b2fe30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb4b2fbc0>]}


============================== 20:04:38.428456 | 46703df4-1354-4685-8970-7bbd9edc0f71 ==============================
[0m20:04:38.428456 [info ] [MainThread]: Running with dbt=1.8.7
[0m20:04:38.429052 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/lab/logs', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/lab', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m20:04:38.869423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '46703df4-1354-4685-8970-7bbd9edc0f71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb4e95fa0>]}
[0m20:04:38.891043 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '46703df4-1354-4685-8970-7bbd9edc0f71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff99047230>]}
[0m20:04:38.892292 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m20:04:38.935846 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m20:04:39.001253 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m20:04:39.001662 [debug] [MainThread]: Partial parsing: added file: lab://snapshots/snapshot.RSI_calculation.sql
[0m20:04:39.076142 [error] [MainThread]: Encountered an error:
Compilation Error
  Snapshot 'snapshot.lab.snapshot_RSI_calculation' (snapshots/snapshot.RSI_calculation.sql) depends on a node named 'RSI_calculation' which was not found
[0m20:04:39.077631 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.6935991, "process_user_time": 2.013369, "process_kernel_time": 0.21188, "process_mem_max_rss": "199268", "process_out_blocks": "5", "command_success": false, "process_in_blocks": "0"}
[0m20:04:39.078117 [debug] [MainThread]: Command `dbt run` failed at 20:04:39.078027 after 0.69 seconds
[0m20:04:39.081888 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb5123e00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb63489e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98e6c3b0>]}
[0m20:04:39.082522 [debug] [MainThread]: Flushing usage events
[0m20:06:56.990475 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff936e9280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9492fe90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9492ff20>]}


============================== 20:06:56.994594 | a184779f-512c-4413-9976-2971491b24c4 ==============================
[0m20:06:56.994594 [info ] [MainThread]: Running with dbt=1.8.7
[0m20:06:56.995321 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/lab/logs', 'profiles_dir': '/opt/airflow/lab', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m20:06:57.458571 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a184779f-512c-4413-9976-2971491b24c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff944d0650>]}
[0m20:06:57.483579 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a184779f-512c-4413-9976-2971491b24c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff739c94c0>]}
[0m20:06:57.484059 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m20:06:57.533678 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m20:06:57.595394 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m20:06:57.595701 [debug] [MainThread]: Partial parsing: added file: lab://snapshots/snapshot.RSI_calculation.sql
[0m20:06:57.668216 [error] [MainThread]: Encountered an error:
Compilation Error
  Snapshot 'snapshot.lab.snapshot_RSI_calculation' (snapshots/snapshot.RSI_calculation.sql) depends on a node named 'RSI_calculation' which was not found
[0m20:06:57.669154 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.71813685, "process_user_time": 2.05362, "process_kernel_time": 0.199838, "process_mem_max_rss": "199260", "process_out_blocks": "5", "command_success": false, "process_in_blocks": "0"}
[0m20:06:57.669462 [debug] [MainThread]: Command `dbt run` failed at 20:06:57.669417 after 0.72 seconds
[0m20:06:57.669721 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff936e9280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff79591820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff731ca390>]}
[0m20:06:57.669997 [debug] [MainThread]: Flushing usage events
[0m20:14:11.620633 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81a89ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82801eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff802b2420>]}


============================== 20:14:11.624814 | 7d3b2f8a-5d27-4105-aca1-fc22ba4c2020 ==============================
[0m20:14:11.624814 [info ] [MainThread]: Running with dbt=1.8.7
[0m20:14:11.625535 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/lab', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/lab/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'send_anonymous_usage_stats': 'True'}
[0m20:14:12.058117 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7d3b2f8a-5d27-4105-aca1-fc22ba4c2020', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f773710>]}
[0m20:14:12.079647 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7d3b2f8a-5d27-4105-aca1-fc22ba4c2020', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6418f3b0>]}
[0m20:14:12.080107 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m20:14:12.127078 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m20:14:12.193528 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 1 files changed.
[0m20:14:12.193916 [debug] [MainThread]: Partial parsing: added file: lab://snapshots/snapshot.RSI_Calculation.sql
[0m20:14:12.194195 [debug] [MainThread]: Partial parsing: updated file: lab://models/output/RSI_Calculation.sql
[0m20:14:12.362519 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7d3b2f8a-5d27-4105-aca1-fc22ba4c2020', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5f760fb0>]}
[0m20:14:12.414876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7d3b2f8a-5d27-4105-aca1-fc22ba4c2020', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5fd56e40>]}
[0m20:14:12.415174 [info ] [MainThread]: Found 3 models, 1 test, 2 snapshots, 2 sources, 459 macros
[0m20:14:12.415612 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7d3b2f8a-5d27-4105-aca1-fc22ba4c2020', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5f79bad0>]}
[0m20:14:12.416475 [info ] [MainThread]: 
[0m20:14:12.416891 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:14:12.419260 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m20:14:12.425612 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m20:14:12.425845 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m20:14:12.426028 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:14:13.121939 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.696 seconds
[0m20:14:13.128357 [debug] [ThreadPool]: On list_dev: Close
[0m20:14:13.258461 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_stock)
[0m20:14:13.266595 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m20:14:13.267032 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m20:14:13.267349 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:14:13.823157 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.556 seconds
[0m20:14:13.827388 [debug] [ThreadPool]: On list_dev_stock: Close
[0m20:14:13.976609 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_stock, now list_dev_snapshot)
[0m20:14:13.980911 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m20:14:13.981591 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m20:14:13.982189 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:14:14.648467 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.666 seconds
[0m20:14:14.654359 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m20:14:14.821417 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7d3b2f8a-5d27-4105-aca1-fc22ba4c2020', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff657af8c0>]}
[0m20:14:14.822219 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:14:14.824704 [info ] [MainThread]: 
[0m20:14:14.833028 [debug] [Thread-1 (]: Began running node model.lab.RSI_Calculation
[0m20:14:14.833561 [info ] [Thread-1 (]: 1 of 2 START sql table model stock.RSI_Calculation ............................. [RUN]
[0m20:14:14.834188 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_snapshot, now model.lab.RSI_Calculation)
[0m20:14:14.834534 [debug] [Thread-1 (]: Began compiling node model.lab.RSI_Calculation
[0m20:14:14.840174 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.RSI_Calculation"
[0m20:14:14.841234 [debug] [Thread-1 (]: Began executing node model.lab.RSI_Calculation
[0m20:14:14.858366 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.RSI_Calculation"
[0m20:14:14.859948 [debug] [Thread-1 (]: Using snowflake connection "model.lab.RSI_Calculation"
[0m20:14:14.860253 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.RSI_Calculation"} */
create or replace transient table dev.stock.RSI_Calculation
         as
        (WITH PriceChanges AS (
    SELECT
        date,
        symbol,
        close,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM
        dev.stock.stock_price_analysis  -- Replace 'stock' and 'stock_price_analysis' with your actual source name and table
),
PriceGainsLosses AS (
    SELECT
        date,
        symbol,
        close,
        next_close,
        CASE 
            WHEN next_close > close THEN next_close - close
            ELSE 0 
        END AS gain,
        CASE 
            WHEN next_close < close THEN close - next_close
            ELSE 0 
        END AS loss
    FROM
        PriceChanges
),
AverageGainsLosses AS (
    SELECT
        date,
        symbol,
        AVG(gain) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain,
        AVG(loss) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss
    FROM
        PriceGainsLosses
),
RSI_Calculation AS (
    SELECT
        date,
        symbol,
        avg_gain,
        avg_loss,
        CASE 
            WHEN avg_loss = 0 THEN 100
            ELSE 100 - (100 / (1 + (avg_gain / avg_loss)))
        END AS rsi
    FROM
        AverageGainsLosses
)
SELECT 
    date, 
    symbol, 
    rsi
FROM 
    RSI_Calculation
WHERE
    date >= (SELECT MIN(date) FROM dev.stock.stock_price_analysis) + INTERVAL '14 DAY'
ORDER BY
    symbol, date
        );
[0m20:14:14.860542 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:14:16.717099 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.856 seconds
[0m20:14:16.749025 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: Close
[0m20:14:16.887622 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7d3b2f8a-5d27-4105-aca1-fc22ba4c2020', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6418c860>]}
[0m20:14:16.888862 [info ] [Thread-1 (]: 1 of 2 OK created sql table model stock.RSI_Calculation ........................ [[32mSUCCESS 1[0m in 2.05s]
[0m20:14:16.890889 [debug] [Thread-1 (]: Finished running node model.lab.RSI_Calculation
[0m20:14:16.891746 [debug] [Thread-1 (]: Began running node model.lab.stock_price_analysis
[0m20:14:16.892546 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.RSI_Calculation, now model.lab.stock_price_analysis)
[0m20:14:16.893113 [debug] [Thread-1 (]: Began compiling node model.lab.stock_price_analysis
[0m20:14:16.896089 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.stock_price_analysis"
[0m20:14:16.898187 [debug] [Thread-1 (]: Finished running node model.lab.stock_price_analysis
[0m20:14:16.899230 [debug] [Thread-1 (]: Began running node model.lab.macd_calculation
[0m20:14:16.899784 [info ] [Thread-1 (]: 2 of 2 START sql table model stock.macd_calculation ............................ [RUN]
[0m20:14:16.900819 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.stock_price_analysis, now model.lab.macd_calculation)
[0m20:14:16.901200 [debug] [Thread-1 (]: Began compiling node model.lab.macd_calculation
[0m20:14:16.919632 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.macd_calculation"
[0m20:14:16.920773 [debug] [Thread-1 (]: Began executing node model.lab.macd_calculation
[0m20:14:16.922779 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.macd_calculation"
[0m20:14:16.924661 [debug] [Thread-1 (]: Using snowflake connection "model.lab.macd_calculation"
[0m20:14:16.925082 [debug] [Thread-1 (]: On model.lab.macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.macd_calculation"} */
create or replace transient table dev.stock.macd_calculation
         as
        (WITH  __dbt__cte__stock_price_analysis as (
WITH stock_data AS (
    SELECT
        *
    FROM dev.stock.stock_price_analysis
)

-- Now you can query the CTE
SELECT * FROM stock_data
), stock_data AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE,
        ROW_NUMBER() OVER (PARTITION BY SYMBOL ORDER BY DATE) AS rn
    FROM __dbt__cte__stock_price_analysis  -- Replace with the reference to your actual source table in DBT
),

-- Calculate 12-day EMA
ema_12 AS (
    SELECT
        SYMBOL,
        DATE,
        CLOSE AS EMA_12,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (12 + 1))) + (e.EMA_12 * (1 - (2.0 / (12 + 1)))) AS EMA_12,
        sd.rn
    FROM stock_data sd
    JOIN ema_12 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate 26-day EMA
ema_26 AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE AS EMA_26,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (26 + 1))) + (e.EMA_26 * (1 - (2.0 / (26 + 1)))) AS EMA_26,
        sd.rn
    FROM stock_data sd
    JOIN ema_26 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate MACD by subtracting 26-day EMA from 12-day EMA
macd_calculation AS (
    SELECT 
        e12.SYMBOL,
        e12.DATE,
        e12.EMA_12 - e26.EMA_26 AS MACD,
        e12.rn
    FROM ema_12 e12
    JOIN ema_26 e26 ON e12.SYMBOL = e26.SYMBOL AND e12.DATE = e26.DATE
),

-- Calculate 9-day EMA of MACD as Signal Line
signal_line AS (
    SELECT 
        SYMBOL,
        DATE,
        MACD,
        MACD AS Signal,
        rn
    FROM macd_calculation
    WHERE rn = 1

    UNION ALL

    SELECT 
        mc.SYMBOL,
        mc.DATE,
        mc.MACD,
        (mc.MACD * (2.0 / (9 + 1))) + (sl.Signal * (1 - (2.0 / (9 + 1)))) AS Signal,
        mc.rn
    FROM macd_calculation mc
    JOIN signal_line sl ON mc.SYMBOL = sl.SYMBOL AND mc.rn = sl.rn + 1
)

-- Final output
SELECT 
    SYMBOL,
    DATE,
    MACD,
    Signal,
    MACD - Signal AS Histogram
FROM signal_line
ORDER BY SYMBOL, DATE
        );
[0m20:14:16.925408 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:14:18.664173 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.738 seconds
[0m20:14:18.668665 [debug] [Thread-1 (]: On model.lab.macd_calculation: Close
[0m20:14:19.181176 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7d3b2f8a-5d27-4105-aca1-fc22ba4c2020', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5f394d40>]}
[0m20:14:19.182997 [info ] [Thread-1 (]: 2 of 2 OK created sql table model stock.macd_calculation ....................... [[32mSUCCESS 1[0m in 2.28s]
[0m20:14:19.185277 [debug] [Thread-1 (]: Finished running node model.lab.macd_calculation
[0m20:14:19.187434 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:14:19.188114 [debug] [MainThread]: Connection 'model.lab.macd_calculation' was properly closed.
[0m20:14:19.188831 [info ] [MainThread]: 
[0m20:14:19.189849 [info ] [MainThread]: Finished running 2 table models in 0 hours 0 minutes and 6.77 seconds (6.77s).
[0m20:14:19.191155 [debug] [MainThread]: Command end result
[0m20:14:19.223520 [info ] [MainThread]: 
[0m20:14:19.224051 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:14:19.224478 [info ] [MainThread]: 
[0m20:14:19.224870 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m20:14:19.225787 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.6451592, "process_user_time": 2.551421, "process_kernel_time": 0.246004, "process_mem_max_rss": "211172", "process_out_blocks": "2824", "process_in_blocks": "0"}
[0m20:14:19.226182 [debug] [MainThread]: Command `dbt run` succeeded at 20:14:19.226117 after 7.65 seconds
[0m20:14:19.226470 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7fce0e00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ffc7e60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ffc7c80>]}
[0m20:14:19.226754 [debug] [MainThread]: Flushing usage events
[0m20:14:21.047582 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaddcb1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf4ed7c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffad722a80>]}


============================== 20:14:21.051255 | 53a0d5d5-d914-4972-907e-94d0e181813f ==============================
[0m20:14:21.051255 [info ] [MainThread]: Running with dbt=1.8.7
[0m20:14:21.051933 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/lab', 'log_path': '/opt/airflow/lab/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m20:14:21.439739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '53a0d5d5-d914-4972-907e-94d0e181813f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff92c39340>]}
[0m20:14:21.461609 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '53a0d5d5-d914-4972-907e-94d0e181813f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff919495b0>]}
[0m20:14:21.462072 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m20:14:21.506564 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m20:14:21.567774 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:14:21.568033 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:14:21.590086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '53a0d5d5-d914-4972-907e-94d0e181813f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff93569c40>]}
[0m20:14:21.647748 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '53a0d5d5-d914-4972-907e-94d0e181813f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90d91100>]}
[0m20:14:21.648083 [info ] [MainThread]: Found 3 models, 1 test, 2 snapshots, 2 sources, 459 macros
[0m20:14:21.648575 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '53a0d5d5-d914-4972-907e-94d0e181813f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff912cd640>]}
[0m20:14:21.649422 [info ] [MainThread]: 
[0m20:14:21.649847 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:14:21.651834 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev_stock'
[0m20:14:21.659979 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m20:14:21.660240 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m20:14:21.660482 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:14:22.177120 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.516 seconds
[0m20:14:22.181024 [debug] [ThreadPool]: On list_dev_stock: Close
[0m20:14:22.333554 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_stock, now list_dev_snapshot)
[0m20:14:22.335986 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m20:14:22.336322 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m20:14:22.336617 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:14:22.962002 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.625 seconds
[0m20:14:22.964560 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m20:14:23.100024 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '53a0d5d5-d914-4972-907e-94d0e181813f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaea9cd70>]}
[0m20:14:23.101863 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:14:23.103737 [info ] [MainThread]: 
[0m20:14:23.119581 [debug] [Thread-1 (]: Began running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m20:14:23.120253 [info ] [Thread-1 (]: 1 of 1 START test not_null_macd_calculation_date ............................... [RUN]
[0m20:14:23.121240 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_snapshot, now test.lab.not_null_macd_calculation_date.1954e908c9)
[0m20:14:23.121693 [debug] [Thread-1 (]: Began compiling node test.lab.not_null_macd_calculation_date.1954e908c9
[0m20:14:23.137432 [debug] [Thread-1 (]: Writing injected SQL for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m20:14:23.138883 [debug] [Thread-1 (]: Began executing node test.lab.not_null_macd_calculation_date.1954e908c9
[0m20:14:23.152059 [debug] [Thread-1 (]: Writing runtime sql for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m20:14:23.153167 [debug] [Thread-1 (]: Using snowflake connection "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m20:14:23.153491 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "test.lab.not_null_macd_calculation_date.1954e908c9"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from dev.stock.macd_calculation
where date is null



      
    ) dbt_internal_test
[0m20:14:23.153803 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:14:23.983480 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.829 seconds
[0m20:14:23.996524 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: Close
[0m20:14:24.126770 [info ] [Thread-1 (]: 1 of 1 PASS not_null_macd_calculation_date ..................................... [[32mPASS[0m in 1.00s]
[0m20:14:24.130250 [debug] [Thread-1 (]: Finished running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m20:14:24.133219 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:14:24.133948 [debug] [MainThread]: Connection 'test.lab.not_null_macd_calculation_date.1954e908c9' was properly closed.
[0m20:14:24.134508 [info ] [MainThread]: 
[0m20:14:24.135797 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 2.48 seconds (2.48s).
[0m20:14:24.137280 [debug] [MainThread]: Command end result
[0m20:14:24.174622 [info ] [MainThread]: 
[0m20:14:24.175113 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:14:24.175508 [info ] [MainThread]: 
[0m20:14:24.175861 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m20:14:24.176773 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.1694462, "process_user_time": 2.26915, "process_kernel_time": 0.104144, "process_mem_max_rss": "208172", "process_out_blocks": "1860", "process_in_blocks": "0"}
[0m20:14:24.177164 [debug] [MainThread]: Command `dbt test` succeeded at 20:14:24.177107 after 3.17 seconds
[0m20:14:24.177476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffad3e77a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffae0e95b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffad782660>]}
[0m20:14:24.177767 [debug] [MainThread]: Flushing usage events
[0m20:14:26.460630 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff830d9ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85587500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff836cdbe0>]}


============================== 20:14:26.464404 | d4058beb-ec82-4690-851e-317d5751ef55 ==============================
[0m20:14:26.464404 [info ] [MainThread]: Running with dbt=1.8.7
[0m20:14:26.464980 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/opt/airflow/lab', 'log_path': '/opt/airflow/lab/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m20:14:26.902961 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd4058beb-ec82-4690-851e-317d5751ef55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff63004860>]}
[0m20:14:26.924931 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd4058beb-ec82-4690-851e-317d5751ef55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6812f6e0>]}
[0m20:14:26.925375 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m20:14:26.968734 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m20:14:27.030315 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:14:27.030615 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:14:27.052778 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd4058beb-ec82-4690-851e-317d5751ef55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff624cbfb0>]}
[0m20:14:27.105128 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd4058beb-ec82-4690-851e-317d5751ef55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff624ff800>]}
[0m20:14:27.105477 [info ] [MainThread]: Found 3 models, 1 test, 2 snapshots, 2 sources, 459 macros
[0m20:14:27.105949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd4058beb-ec82-4690-851e-317d5751ef55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff62801fa0>]}
[0m20:14:27.106809 [info ] [MainThread]: 
[0m20:14:27.107268 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:14:27.109329 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m20:14:27.116256 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m20:14:27.116505 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m20:14:27.116734 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:14:27.602020 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.485 seconds
[0m20:14:27.605753 [debug] [ThreadPool]: On list_dev: Close
[0m20:14:27.742255 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_stock)
[0m20:14:27.757642 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m20:14:27.758372 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m20:14:27.758849 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:14:28.255311 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.496 seconds
[0m20:14:28.259429 [debug] [ThreadPool]: On list_dev_stock: Close
[0m20:14:28.403876 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_stock, now list_dev_snapshot)
[0m20:14:28.414839 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m20:14:28.415436 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m20:14:28.415803 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:14:28.869204 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.453 seconds
[0m20:14:28.873904 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m20:14:29.000027 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd4058beb-ec82-4690-851e-317d5751ef55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83714d40>]}
[0m20:14:29.001598 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:14:29.004051 [info ] [MainThread]: 
[0m20:14:29.021780 [debug] [Thread-1 (]: Began running node snapshot.lab.snapshot_RSI_Calculation
[0m20:14:29.022844 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snapshot_RSI_Calculation ........................ [RUN]
[0m20:14:29.024127 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_snapshot, now snapshot.lab.snapshot_RSI_Calculation)
[0m20:14:29.024663 [debug] [Thread-1 (]: Began compiling node snapshot.lab.snapshot_RSI_Calculation
[0m20:14:29.033064 [debug] [Thread-1 (]: Began executing node snapshot.lab.snapshot_RSI_Calculation
[0m20:14:29.077852 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m20:14:29.078191 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
select * from (
        
    

    select *,
        md5(coalesce(cast(date as varchar ), '')
         || '|' || coalesce(cast(date as varchar ), '')
        ) as dbt_scd_id,
        date as dbt_updated_at,
        date as dbt_valid_from,
        
  
  coalesce(nullif(date, date), null)
  as dbt_valid_to

    from (
        

SELECT * FROM dev.stock.RSI_Calculation
    ) sbq



    ) as __dbt_sbq
    where false
    limit 0
[0m20:14:29.078538 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:14:29.975131 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.896 seconds
[0m20:14:29.982519 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m20:14:29.983096 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
select * from (
        select to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_snapshot_time
    ) as __dbt_sbq
    where false
    limit 0
[0m20:14:30.114950 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.131 seconds
[0m20:14:30.115845 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.lab.snapshot_RSI_Calculation"
[0m20:14:30.118557 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m20:14:30.119145 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
create or replace transient table dev.snapshot.snapshot_RSI_Calculation
         as
        (
    

    select *,
        md5(coalesce(cast(date as varchar ), '')
         || '|' || coalesce(cast(date as varchar ), '')
        ) as dbt_scd_id,
        date as dbt_updated_at,
        date as dbt_valid_from,
        
  
  coalesce(nullif(date, date), null)
  as dbt_valid_to

    from (
        

SELECT * FROM dev.stock.RSI_Calculation
    ) sbq



        );
[0m20:14:31.256213 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.136 seconds
[0m20:14:31.275650 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: Close
[0m20:14:31.436126 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd4058beb-ec82-4690-851e-317d5751ef55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff62b300e0>]}
[0m20:14:31.438355 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snapshot_RSI_Calculation ........................ [[32mSUCCESS 1[0m in 2.41s]
[0m20:14:31.440606 [debug] [Thread-1 (]: Finished running node snapshot.lab.snapshot_RSI_Calculation
[0m20:14:31.441415 [debug] [Thread-1 (]: Began running node snapshot.lab.snapshot_macd_calculation
[0m20:14:31.442273 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snapshot_macd_calculation ....................... [RUN]
[0m20:14:31.443654 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.lab.snapshot_RSI_Calculation, now snapshot.lab.snapshot_macd_calculation)
[0m20:14:31.444378 [debug] [Thread-1 (]: Began compiling node snapshot.lab.snapshot_macd_calculation
[0m20:14:31.448755 [debug] [Thread-1 (]: Began executing node snapshot.lab.snapshot_macd_calculation
[0m20:14:31.458567 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:14:31.459085 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
[0m20:14:31.459506 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:14:31.936332 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.476 seconds
[0m20:14:31.972006 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:14:31.972699 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
create or replace temporary table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp"
         as
        (

    with snapshot_query as (

        

SELECT * FROM dev.stock.macd_calculation

    ),

    snapshotted_data as (

        select *, 
    
        date as dbt_unique_key
    

        from "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            
  
  coalesce(nullif(date, date), null)
  as dbt_valid_to
,
            md5(coalesce(cast(date as varchar ), '')
         || '|' || coalesce(cast(date as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            date as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select *, 
    
        date as dbt_unique_key
    

        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data.dbt_valid_from < source_data.date))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data.dbt_valid_from < source_data.date)
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        source_data.dbt_unique_key is null
    

    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m20:14:32.949752 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.976 seconds
[0m20:14:32.952183 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:14:32.952584 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp"
[0m20:14:33.057177 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.104 seconds
[0m20:14:33.062167 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:14:33.062563 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
[0m20:14:33.281649 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.218 seconds
[0m20:14:33.286991 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:14:33.287598 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp"
[0m20:14:33.419523 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.131 seconds
[0m20:14:33.428033 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:14:33.429103 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
[0m20:14:33.600332 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.170 seconds
[0m20:14:33.610393 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:14:33.611012 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp"
[0m20:14:33.773105 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.161 seconds
[0m20:14:33.795153 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:14:33.795931 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
select * from (
        

    with snapshot_query as (

        

SELECT * FROM dev.stock.macd_calculation

    ),

    snapshotted_data as (

        select *, 
    
        date as dbt_unique_key
    

        from "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            
  
  coalesce(nullif(date, date), null)
  as dbt_valid_to
,
            md5(coalesce(cast(date as varchar ), '')
         || '|' || coalesce(cast(date as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            date as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select *, 
    
        date as dbt_unique_key
    

        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data.dbt_valid_from < source_data.date))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data.dbt_valid_from < source_data.date)
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        source_data.dbt_unique_key is null
    

    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

    ) as __dbt_sbq
    where false
    limit 0
[0m20:14:34.428464 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.632 seconds
[0m20:14:34.430008 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:14:34.430372 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
select * from (
        select to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_snapshot_time
    ) as __dbt_sbq
    where false
    limit 0
[0m20:14:34.570148 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.139 seconds
[0m20:14:34.571062 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.lab.snapshot_macd_calculation"
[0m20:14:34.573473 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:14:34.573943 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
BEGIN
[0m20:14:34.771041 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.196 seconds
[0m20:14:34.772830 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:14:34.773759 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
merge into "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION" as DBT_INTERNAL_DEST
    using "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     
       and DBT_INTERNAL_DEST.dbt_valid_to is null
     
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SYMBOL", "DATE", "MACD", "SIGNAL", "HISTOGRAM", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SYMBOL", "DATE", "MACD", "SIGNAL", "HISTOGRAM", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m20:14:35.362448 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.588 seconds
[0m20:14:35.364135 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:14:35.365007 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
COMMIT
[0m20:14:35.763605 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.397 seconds
[0m20:14:35.776537 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: Close
[0m20:14:35.943480 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd4058beb-ec82-4690-851e-317d5751ef55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff61919430>]}
[0m20:14:35.947417 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snapshot_macd_calculation ....................... [[32mSUCCESS 0[0m in 4.50s]
[0m20:14:35.952481 [debug] [Thread-1 (]: Finished running node snapshot.lab.snapshot_macd_calculation
[0m20:14:35.956056 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:14:35.956486 [debug] [MainThread]: Connection 'snapshot.lab.snapshot_macd_calculation' was properly closed.
[0m20:14:35.956963 [info ] [MainThread]: 
[0m20:14:35.957615 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 8.85 seconds (8.85s).
[0m20:14:35.958787 [debug] [MainThread]: Command end result
[0m20:14:35.996516 [info ] [MainThread]: 
[0m20:14:35.997490 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:14:35.998356 [info ] [MainThread]: 
[0m20:14:35.999055 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m20:14:36.001251 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 9.578127, "process_user_time": 2.627957, "process_kernel_time": 0.19637, "process_mem_max_rss": "206892", "process_out_blocks": "1895", "process_in_blocks": "0"}
[0m20:14:36.001848 [debug] [MainThread]: Command `dbt snapshot` succeeded at 20:14:36.001791 after 9.58 seconds
[0m20:14:36.002314 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82a83980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82d94a40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff62b32360>]}
[0m20:14:36.002565 [debug] [MainThread]: Flushing usage events
[0m20:20:17.042911 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff97ff1400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9a592060>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff996e9760>]}


============================== 20:20:17.046925 | 36d2ea61-4752-48ef-9e5d-9fafd85b7be6 ==============================
[0m20:20:17.046925 [info ] [MainThread]: Running with dbt=1.8.7
[0m20:20:17.047416 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/lab', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/lab/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m20:20:17.474196 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '36d2ea61-4752-48ef-9e5d-9fafd85b7be6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff77d91a60>]}
[0m20:20:17.496706 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '36d2ea61-4752-48ef-9e5d-9fafd85b7be6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff984f6360>]}
[0m20:20:17.497170 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m20:20:17.543330 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m20:20:17.614442 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:20:17.614748 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:20:17.636795 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '36d2ea61-4752-48ef-9e5d-9fafd85b7be6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff977ae180>]}
[0m20:20:17.690677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '36d2ea61-4752-48ef-9e5d-9fafd85b7be6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff77260140>]}
[0m20:20:17.690960 [info ] [MainThread]: Found 3 models, 1 test, 2 snapshots, 2 sources, 459 macros
[0m20:20:17.691200 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '36d2ea61-4752-48ef-9e5d-9fafd85b7be6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff776e1040>]}
[0m20:20:17.692054 [info ] [MainThread]: 
[0m20:20:17.692382 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:20:17.694803 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m20:20:17.701328 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m20:20:17.701589 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m20:20:17.701809 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:20:18.421996 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.720 seconds
[0m20:20:18.425888 [debug] [ThreadPool]: On list_dev: Close
[0m20:20:18.654138 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_snapshot)
[0m20:20:18.666880 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m20:20:18.667561 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m20:20:18.668148 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:20:19.210044 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.542 seconds
[0m20:20:19.214457 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m20:20:19.355759 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m20:20:19.362267 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m20:20:19.363054 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m20:20:19.363589 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:20:19.914063 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.550 seconds
[0m20:20:19.916969 [debug] [ThreadPool]: On list_dev_stock: Close
[0m20:20:20.047512 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '36d2ea61-4752-48ef-9e5d-9fafd85b7be6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff77685eb0>]}
[0m20:20:20.049399 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:20:20.050536 [info ] [MainThread]: 
[0m20:20:20.065728 [debug] [Thread-1 (]: Began running node model.lab.RSI_Calculation
[0m20:20:20.066590 [info ] [Thread-1 (]: 1 of 2 START sql table model stock.RSI_Calculation ............................. [RUN]
[0m20:20:20.067309 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now model.lab.RSI_Calculation)
[0m20:20:20.067806 [debug] [Thread-1 (]: Began compiling node model.lab.RSI_Calculation
[0m20:20:20.075440 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.RSI_Calculation"
[0m20:20:20.076979 [debug] [Thread-1 (]: Began executing node model.lab.RSI_Calculation
[0m20:20:20.097532 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.RSI_Calculation"
[0m20:20:20.099224 [debug] [Thread-1 (]: Using snowflake connection "model.lab.RSI_Calculation"
[0m20:20:20.099542 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.RSI_Calculation"} */
create or replace transient table dev.stock.RSI_Calculation
         as
        (WITH PriceChanges AS (
    SELECT
        date,
        symbol,
        close,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM
        dev.stock.stock_price_analysis  -- Replace 'stock' and 'stock_price_analysis' with your actual source name and table
),
PriceGainsLosses AS (
    SELECT
        date,
        symbol,
        close,
        next_close,
        CASE 
            WHEN next_close > close THEN next_close - close
            ELSE 0 
        END AS gain,
        CASE 
            WHEN next_close < close THEN close - next_close
            ELSE 0 
        END AS loss
    FROM
        PriceChanges
),
AverageGainsLosses AS (
    SELECT
        date,
        symbol,
        AVG(gain) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain,
        AVG(loss) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss
    FROM
        PriceGainsLosses
),
RSI_Calculation AS (
    SELECT
        date,
        symbol,
        avg_gain,
        avg_loss,
        CASE 
            WHEN avg_loss = 0 THEN 100
            ELSE 100 - (100 / (1 + (avg_gain / avg_loss)))
        END AS rsi
    FROM
        AverageGainsLosses
)
SELECT 
    date, 
    symbol, 
    rsi
FROM 
    RSI_Calculation
WHERE
    date >= (SELECT MIN(date) FROM dev.stock.stock_price_analysis) + INTERVAL '14 DAY'
ORDER BY
    symbol, date
        );
[0m20:20:20.099824 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:20:21.574491 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.474 seconds
[0m20:20:21.601036 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: Close
[0m20:20:21.731658 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '36d2ea61-4752-48ef-9e5d-9fafd85b7be6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff97f061b0>]}
[0m20:20:21.734212 [info ] [Thread-1 (]: 1 of 2 OK created sql table model stock.RSI_Calculation ........................ [[32mSUCCESS 1[0m in 1.66s]
[0m20:20:21.735474 [debug] [Thread-1 (]: Finished running node model.lab.RSI_Calculation
[0m20:20:21.736257 [debug] [Thread-1 (]: Began running node model.lab.stock_price_analysis
[0m20:20:21.737035 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.RSI_Calculation, now model.lab.stock_price_analysis)
[0m20:20:21.737559 [debug] [Thread-1 (]: Began compiling node model.lab.stock_price_analysis
[0m20:20:21.741146 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.stock_price_analysis"
[0m20:20:21.743666 [debug] [Thread-1 (]: Finished running node model.lab.stock_price_analysis
[0m20:20:21.744924 [debug] [Thread-1 (]: Began running node model.lab.macd_calculation
[0m20:20:21.745599 [info ] [Thread-1 (]: 2 of 2 START sql table model stock.macd_calculation ............................ [RUN]
[0m20:20:21.746558 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.stock_price_analysis, now model.lab.macd_calculation)
[0m20:20:21.747056 [debug] [Thread-1 (]: Began compiling node model.lab.macd_calculation
[0m20:20:21.766768 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.macd_calculation"
[0m20:20:21.767979 [debug] [Thread-1 (]: Began executing node model.lab.macd_calculation
[0m20:20:21.770096 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.macd_calculation"
[0m20:20:21.772250 [debug] [Thread-1 (]: Using snowflake connection "model.lab.macd_calculation"
[0m20:20:21.772628 [debug] [Thread-1 (]: On model.lab.macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.macd_calculation"} */
create or replace transient table dev.stock.macd_calculation
         as
        (WITH  __dbt__cte__stock_price_analysis as (
WITH stock_data AS (
    SELECT
        *
    FROM dev.stock.stock_price_analysis
)

-- Now you can query the CTE
SELECT * FROM stock_data
), stock_data AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE,
        ROW_NUMBER() OVER (PARTITION BY SYMBOL ORDER BY DATE) AS rn
    FROM __dbt__cte__stock_price_analysis  -- Replace with the reference to your actual source table in DBT
),

-- Calculate 12-day EMA
ema_12 AS (
    SELECT
        SYMBOL,
        DATE,
        CLOSE AS EMA_12,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (12 + 1))) + (e.EMA_12 * (1 - (2.0 / (12 + 1)))) AS EMA_12,
        sd.rn
    FROM stock_data sd
    JOIN ema_12 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate 26-day EMA
ema_26 AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE AS EMA_26,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (26 + 1))) + (e.EMA_26 * (1 - (2.0 / (26 + 1)))) AS EMA_26,
        sd.rn
    FROM stock_data sd
    JOIN ema_26 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate MACD by subtracting 26-day EMA from 12-day EMA
macd_calculation AS (
    SELECT 
        e12.SYMBOL,
        e12.DATE,
        e12.EMA_12 - e26.EMA_26 AS MACD,
        e12.rn
    FROM ema_12 e12
    JOIN ema_26 e26 ON e12.SYMBOL = e26.SYMBOL AND e12.DATE = e26.DATE
),

-- Calculate 9-day EMA of MACD as Signal Line
signal_line AS (
    SELECT 
        SYMBOL,
        DATE,
        MACD,
        MACD AS Signal,
        rn
    FROM macd_calculation
    WHERE rn = 1

    UNION ALL

    SELECT 
        mc.SYMBOL,
        mc.DATE,
        mc.MACD,
        (mc.MACD * (2.0 / (9 + 1))) + (sl.Signal * (1 - (2.0 / (9 + 1)))) AS Signal,
        mc.rn
    FROM macd_calculation mc
    JOIN signal_line sl ON mc.SYMBOL = sl.SYMBOL AND mc.rn = sl.rn + 1
)

-- Final output
SELECT 
    SYMBOL,
    DATE,
    MACD,
    Signal,
    MACD - Signal AS Histogram
FROM signal_line
ORDER BY SYMBOL, DATE
        );
[0m20:20:21.773075 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:20:23.523973 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.751 seconds
[0m20:20:23.528027 [debug] [Thread-1 (]: On model.lab.macd_calculation: Close
[0m20:20:23.672328 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '36d2ea61-4752-48ef-9e5d-9fafd85b7be6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98c048c0>]}
[0m20:20:23.674211 [info ] [Thread-1 (]: 2 of 2 OK created sql table model stock.macd_calculation ....................... [[32mSUCCESS 1[0m in 1.92s]
[0m20:20:23.676844 [debug] [Thread-1 (]: Finished running node model.lab.macd_calculation
[0m20:20:23.679870 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:20:23.680680 [debug] [MainThread]: Connection 'model.lab.macd_calculation' was properly closed.
[0m20:20:23.681474 [info ] [MainThread]: 
[0m20:20:23.682136 [info ] [MainThread]: Finished running 2 table models in 0 hours 0 minutes and 5.99 seconds (5.99s).
[0m20:20:23.683428 [debug] [MainThread]: Command end result
[0m20:20:23.718532 [info ] [MainThread]: 
[0m20:20:23.718879 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:20:23.719155 [info ] [MainThread]: 
[0m20:20:23.719428 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m20:20:23.720411 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.7175136, "process_user_time": 2.435966, "process_kernel_time": 0.229031, "process_mem_max_rss": "205848", "process_out_blocks": "1904", "process_in_blocks": "0"}
[0m20:20:23.720865 [debug] [MainThread]: Command `dbt run` succeeded at 20:20:23.720782 after 6.72 seconds
[0m20:20:23.721204 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff996e9760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff977a9460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff77310a40>]}
[0m20:20:23.721503 [debug] [MainThread]: Flushing usage events
[0m20:20:26.065842 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa001e210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9f3eb800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa35f71d0>]}


============================== 20:20:26.069315 | 111d99b0-af6a-45d2-b9b7-bfa3a056c464 ==============================
[0m20:20:26.069315 [info ] [MainThread]: Running with dbt=1.8.7
[0m20:20:26.069756 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/lab', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/lab/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m20:20:26.502442 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '111d99b0-af6a-45d2-b9b7-bfa3a056c464', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f1cacc0>]}
[0m20:20:26.523997 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '111d99b0-af6a-45d2-b9b7-bfa3a056c464', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa0215d60>]}
[0m20:20:26.524468 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m20:20:26.568518 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m20:20:26.629014 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:20:26.629277 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:20:26.651256 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '111d99b0-af6a-45d2-b9b7-bfa3a056c464', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f066180>]}
[0m20:20:26.709224 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '111d99b0-af6a-45d2-b9b7-bfa3a056c464', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7eb38da0>]}
[0m20:20:26.709545 [info ] [MainThread]: Found 3 models, 1 test, 2 snapshots, 2 sources, 459 macros
[0m20:20:26.709808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '111d99b0-af6a-45d2-b9b7-bfa3a056c464', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f066000>]}
[0m20:20:26.710655 [info ] [MainThread]: 
[0m20:20:26.710993 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:20:26.713043 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev_snapshot'
[0m20:20:26.721158 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m20:20:26.721408 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m20:20:26.721654 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:20:27.224253 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.502 seconds
[0m20:20:27.227167 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m20:20:27.349199 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m20:20:27.351859 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m20:20:27.352225 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m20:20:27.352540 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:20:27.814260 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.462 seconds
[0m20:20:27.817608 [debug] [ThreadPool]: On list_dev_stock: Close
[0m20:20:27.968257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '111d99b0-af6a-45d2-b9b7-bfa3a056c464', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f04a030>]}
[0m20:20:27.969890 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:20:27.970724 [info ] [MainThread]: 
[0m20:20:27.984638 [debug] [Thread-1 (]: Began running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m20:20:27.985384 [info ] [Thread-1 (]: 1 of 1 START test not_null_macd_calculation_date ............................... [RUN]
[0m20:20:27.986067 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now test.lab.not_null_macd_calculation_date.1954e908c9)
[0m20:20:27.986643 [debug] [Thread-1 (]: Began compiling node test.lab.not_null_macd_calculation_date.1954e908c9
[0m20:20:28.001392 [debug] [Thread-1 (]: Writing injected SQL for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m20:20:28.002705 [debug] [Thread-1 (]: Began executing node test.lab.not_null_macd_calculation_date.1954e908c9
[0m20:20:28.015752 [debug] [Thread-1 (]: Writing runtime sql for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m20:20:28.016860 [debug] [Thread-1 (]: Using snowflake connection "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m20:20:28.017186 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "test.lab.not_null_macd_calculation_date.1954e908c9"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from dev.stock.macd_calculation
where date is null



      
    ) dbt_internal_test
[0m20:20:28.017499 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:20:28.570793 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.553 seconds
[0m20:20:28.579887 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: Close
[0m20:20:28.735411 [info ] [Thread-1 (]: 1 of 1 PASS not_null_macd_calculation_date ..................................... [[32mPASS[0m in 0.75s]
[0m20:20:28.737166 [debug] [Thread-1 (]: Finished running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m20:20:28.740055 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:20:28.740743 [debug] [MainThread]: Connection 'test.lab.not_null_macd_calculation_date.1954e908c9' was properly closed.
[0m20:20:28.741339 [info ] [MainThread]: 
[0m20:20:28.742013 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 2.03 seconds (2.03s).
[0m20:20:28.743243 [debug] [MainThread]: Command end result
[0m20:20:28.778191 [info ] [MainThread]: 
[0m20:20:28.778565 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:20:28.778868 [info ] [MainThread]: 
[0m20:20:28.779137 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m20:20:28.779844 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 2.752196, "process_user_time": 2.261755, "process_kernel_time": 0.166065, "process_mem_max_rss": "208200", "process_out_blocks": "1860", "process_in_blocks": "0"}
[0m20:20:28.780203 [debug] [MainThread]: Command `dbt test` succeeded at 20:20:28.780137 after 2.75 seconds
[0m20:20:28.780493 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa20b5190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9f3eb800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9eedf770>]}
[0m20:20:28.780773 [debug] [MainThread]: Flushing usage events
[0m20:20:30.646054 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e651430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e651dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e653e30>]}


============================== 20:20:30.650037 | 61cca6e0-30af-4e30-8d83-fd34f4f63253 ==============================
[0m20:20:30.650037 [info ] [MainThread]: Running with dbt=1.8.7
[0m20:20:30.650656 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/lab', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/lab/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m20:20:31.041809 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '61cca6e0-30af-4e30-8d83-fd34f4f63253', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9ec73770>]}
[0m20:20:31.063802 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '61cca6e0-30af-4e30-8d83-fd34f4f63253', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81dd2810>]}
[0m20:20:31.064279 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m20:20:31.108596 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m20:20:31.169647 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:20:31.169933 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:20:31.191873 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '61cca6e0-30af-4e30-8d83-fd34f4f63253', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81b21ac0>]}
[0m20:20:31.266101 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '61cca6e0-30af-4e30-8d83-fd34f4f63253', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81823560>]}
[0m20:20:31.266523 [info ] [MainThread]: Found 3 models, 1 test, 2 snapshots, 2 sources, 459 macros
[0m20:20:31.266985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '61cca6e0-30af-4e30-8d83-fd34f4f63253', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81e23200>]}
[0m20:20:31.267926 [info ] [MainThread]: 
[0m20:20:31.268387 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:20:31.270647 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m20:20:31.278014 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m20:20:31.278277 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m20:20:31.278503 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:20:31.728054 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.449 seconds
[0m20:20:31.731796 [debug] [ThreadPool]: On list_dev: Close
[0m20:20:31.871778 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_stock)
[0m20:20:31.882788 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m20:20:31.883297 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m20:20:31.883713 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:20:32.367665 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.483 seconds
[0m20:20:32.372727 [debug] [ThreadPool]: On list_dev_stock: Close
[0m20:20:32.502119 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_stock, now list_dev_snapshot)
[0m20:20:32.507161 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m20:20:32.508012 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m20:20:32.510008 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:20:33.081380 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.571 seconds
[0m20:20:33.084573 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m20:20:33.215840 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '61cca6e0-30af-4e30-8d83-fd34f4f63253', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff817f1310>]}
[0m20:20:33.216713 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:20:33.218089 [info ] [MainThread]: 
[0m20:20:33.225875 [debug] [Thread-1 (]: Began running node snapshot.lab.snapshot_RSI_Calculation
[0m20:20:33.226447 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snapshot_RSI_Calculation ........................ [RUN]
[0m20:20:33.227023 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_snapshot, now snapshot.lab.snapshot_RSI_Calculation)
[0m20:20:33.227338 [debug] [Thread-1 (]: Began compiling node snapshot.lab.snapshot_RSI_Calculation
[0m20:20:33.232748 [debug] [Thread-1 (]: Began executing node snapshot.lab.snapshot_RSI_Calculation
[0m20:20:33.262079 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m20:20:33.262375 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_RSI_CALCULATION"
[0m20:20:33.262613 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:20:33.742550 [debug] [Thread-1 (]: SQL status: SUCCESS 7 in 0.480 seconds
[0m20:20:33.784302 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m20:20:33.784871 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
create or replace temporary table "DEV"."SNAPSHOT"."SNAPSHOT_RSI_CALCULATION__dbt_tmp"
         as
        (

    with snapshot_query as (

        

SELECT * FROM dev.stock.RSI_Calculation

    ),

    snapshotted_data as (

        select *, 
    
        date as dbt_unique_key
    

        from "DEV"."SNAPSHOT"."SNAPSHOT_RSI_CALCULATION"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            
  
  coalesce(nullif(date, date), null)
  as dbt_valid_to
,
            md5(coalesce(cast(date as varchar ), '')
         || '|' || coalesce(cast(date as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            date as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select *, 
    
        date as dbt_unique_key
    

        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data.dbt_valid_from < source_data.date))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data.dbt_valid_from < source_data.date)
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        source_data.dbt_unique_key is null
    

    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m20:20:34.780842 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.995 seconds
[0m20:20:34.784914 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m20:20:34.785475 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_RSI_CALCULATION__dbt_tmp"
[0m20:20:34.901564 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.115 seconds
[0m20:20:34.908152 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m20:20:34.908986 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_RSI_CALCULATION"
[0m20:20:35.073532 [debug] [Thread-1 (]: SQL status: SUCCESS 7 in 0.163 seconds
[0m20:20:35.080907 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m20:20:35.081989 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_RSI_CALCULATION__dbt_tmp"
[0m20:20:35.190076 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.107 seconds
[0m20:20:35.195239 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m20:20:35.196002 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_RSI_CALCULATION"
[0m20:20:35.326907 [debug] [Thread-1 (]: SQL status: SUCCESS 7 in 0.130 seconds
[0m20:20:35.340331 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m20:20:35.340933 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_RSI_CALCULATION__dbt_tmp"
[0m20:20:35.432202 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.091 seconds
[0m20:20:35.457321 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m20:20:35.457882 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
select * from (
        

    with snapshot_query as (

        

SELECT * FROM dev.stock.RSI_Calculation

    ),

    snapshotted_data as (

        select *, 
    
        date as dbt_unique_key
    

        from "DEV"."SNAPSHOT"."SNAPSHOT_RSI_CALCULATION"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            
  
  coalesce(nullif(date, date), null)
  as dbt_valid_to
,
            md5(coalesce(cast(date as varchar ), '')
         || '|' || coalesce(cast(date as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            date as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select *, 
    
        date as dbt_unique_key
    

        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data.dbt_valid_from < source_data.date))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data.dbt_valid_from < source_data.date)
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        source_data.dbt_unique_key is null
    

    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

    ) as __dbt_sbq
    where false
    limit 0
[0m20:20:35.721514 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.263 seconds
[0m20:20:35.727954 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m20:20:35.728805 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
select * from (
        select to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_snapshot_time
    ) as __dbt_sbq
    where false
    limit 0
[0m20:20:35.856493 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.127 seconds
[0m20:20:35.857505 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.lab.snapshot_RSI_Calculation"
[0m20:20:35.860774 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m20:20:35.861496 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
BEGIN
[0m20:20:36.042344 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.180 seconds
[0m20:20:36.043178 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m20:20:36.043841 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
merge into "DEV"."SNAPSHOT"."SNAPSHOT_RSI_CALCULATION" as DBT_INTERNAL_DEST
    using "DEV"."SNAPSHOT"."SNAPSHOT_RSI_CALCULATION__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     
       and DBT_INTERNAL_DEST.dbt_valid_to is null
     
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("DATE", "SYMBOL", "RSI", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("DATE", "SYMBOL", "RSI", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m20:20:36.609221 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.565 seconds
[0m20:20:36.610146 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m20:20:36.610777 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
COMMIT
[0m20:20:37.238430 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.627 seconds
[0m20:20:37.265800 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: Close
[0m20:20:37.405769 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '61cca6e0-30af-4e30-8d83-fd34f4f63253', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81e545c0>]}
[0m20:20:37.407530 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snapshot_RSI_Calculation ........................ [[32mSUCCESS 0[0m in 4.18s]
[0m20:20:37.408764 [debug] [Thread-1 (]: Finished running node snapshot.lab.snapshot_RSI_Calculation
[0m20:20:37.409224 [debug] [Thread-1 (]: Began running node snapshot.lab.snapshot_macd_calculation
[0m20:20:37.409719 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snapshot_macd_calculation ....................... [RUN]
[0m20:20:37.410307 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.lab.snapshot_RSI_Calculation, now snapshot.lab.snapshot_macd_calculation)
[0m20:20:37.410648 [debug] [Thread-1 (]: Began compiling node snapshot.lab.snapshot_macd_calculation
[0m20:20:37.412998 [debug] [Thread-1 (]: Began executing node snapshot.lab.snapshot_macd_calculation
[0m20:20:37.415606 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:20:37.415927 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
[0m20:20:37.416245 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:20:37.877315 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.461 seconds
[0m20:20:37.885555 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:20:37.886250 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
create or replace temporary table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp"
         as
        (

    with snapshot_query as (

        

SELECT * FROM dev.stock.macd_calculation

    ),

    snapshotted_data as (

        select *, 
    
        date as dbt_unique_key
    

        from "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            
  
  coalesce(nullif(date, date), null)
  as dbt_valid_to
,
            md5(coalesce(cast(date as varchar ), '')
         || '|' || coalesce(cast(date as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            date as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select *, 
    
        date as dbt_unique_key
    

        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data.dbt_valid_from < source_data.date))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data.dbt_valid_from < source_data.date)
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        source_data.dbt_unique_key is null
    

    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m20:20:38.873435 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.986 seconds
[0m20:20:38.875993 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:20:38.876378 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp"
[0m20:20:39.003354 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.126 seconds
[0m20:20:39.008486 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:20:39.009082 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
[0m20:20:39.133114 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.123 seconds
[0m20:20:39.140069 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:20:39.140723 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp"
[0m20:20:39.269493 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.128 seconds
[0m20:20:39.279549 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:20:39.280213 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
[0m20:20:39.401066 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.120 seconds
[0m20:20:39.408338 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:20:39.409122 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp"
[0m20:20:39.522823 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.113 seconds
[0m20:20:39.531647 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:20:39.532424 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
select * from (
        

    with snapshot_query as (

        

SELECT * FROM dev.stock.macd_calculation

    ),

    snapshotted_data as (

        select *, 
    
        date as dbt_unique_key
    

        from "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            
  
  coalesce(nullif(date, date), null)
  as dbt_valid_to
,
            md5(coalesce(cast(date as varchar ), '')
         || '|' || coalesce(cast(date as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            date as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select *, 
    
        date as dbt_unique_key
    

        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data.dbt_valid_from < source_data.date))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data.dbt_valid_from < source_data.date)
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        source_data.dbt_unique_key is null
    

    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

    ) as __dbt_sbq
    where false
    limit 0
[0m20:20:39.864756 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.331 seconds
[0m20:20:39.869173 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:20:39.870159 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
select * from (
        select to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_snapshot_time
    ) as __dbt_sbq
    where false
    limit 0
[0m20:20:40.004957 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.134 seconds
[0m20:20:40.005683 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.lab.snapshot_macd_calculation"
[0m20:20:40.007219 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:20:40.007639 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
BEGIN
[0m20:20:40.140286 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.132 seconds
[0m20:20:40.140969 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:20:40.141339 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
merge into "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION" as DBT_INTERNAL_DEST
    using "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     
       and DBT_INTERNAL_DEST.dbt_valid_to is null
     
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SYMBOL", "DATE", "MACD", "SIGNAL", "HISTOGRAM", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SYMBOL", "DATE", "MACD", "SIGNAL", "HISTOGRAM", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m20:20:41.027255 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.885 seconds
[0m20:20:41.027748 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:20:41.027999 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
COMMIT
[0m20:20:41.491466 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.463 seconds
[0m20:20:41.496619 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: Close
[0m20:20:41.623381 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '61cca6e0-30af-4e30-8d83-fd34f4f63253', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80c7e3f0>]}
[0m20:20:41.624602 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snapshot_macd_calculation ....................... [[32mSUCCESS 0[0m in 4.21s]
[0m20:20:41.626168 [debug] [Thread-1 (]: Finished running node snapshot.lab.snapshot_macd_calculation
[0m20:20:41.628193 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:20:41.628546 [debug] [MainThread]: Connection 'snapshot.lab.snapshot_macd_calculation' was properly closed.
[0m20:20:41.628883 [info ] [MainThread]: 
[0m20:20:41.629196 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 10.36 seconds (10.36s).
[0m20:20:41.630056 [debug] [MainThread]: Command end result
[0m20:20:41.655296 [info ] [MainThread]: 
[0m20:20:41.655701 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:20:41.655983 [info ] [MainThread]: 
[0m20:20:41.656259 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m20:20:41.657431 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 11.048446, "process_user_time": 2.639635, "process_kernel_time": 0.156274, "process_mem_max_rss": "206624", "process_out_blocks": "1915", "process_in_blocks": "0"}
[0m20:20:41.657830 [debug] [MainThread]: Command `dbt snapshot` succeeded at 20:20:41.657769 after 11.05 seconds
[0m20:20:41.658132 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9df91640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9df93f80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9df92270>]}
[0m20:20:41.658416 [debug] [MainThread]: Flushing usage events
[0m20:29:51.985628 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e5055e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e5043b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e504440>]}


============================== 20:29:51.989674 | b34bc97d-ae05-4118-8ba7-482ac66cf510 ==============================
[0m20:29:51.989674 [info ] [MainThread]: Running with dbt=1.8.7
[0m20:29:51.990209 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/lab', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/lab/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'send_anonymous_usage_stats': 'True'}
[0m20:29:52.450444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b34bc97d-ae05-4118-8ba7-482ac66cf510', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5fe98ce0>]}
[0m20:29:52.477122 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b34bc97d-ae05-4118-8ba7-482ac66cf510', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5e926840>]}
[0m20:29:52.477752 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m20:29:52.526055 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m20:29:52.594488 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:29:52.594783 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:29:52.616852 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b34bc97d-ae05-4118-8ba7-482ac66cf510', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5e664b00>]}
[0m20:29:52.670859 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b34bc97d-ae05-4118-8ba7-482ac66cf510', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5e425280>]}
[0m20:29:52.671195 [info ] [MainThread]: Found 3 models, 1 test, 2 snapshots, 2 sources, 459 macros
[0m20:29:52.671452 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b34bc97d-ae05-4118-8ba7-482ac66cf510', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f1d1af0>]}
[0m20:29:52.672374 [info ] [MainThread]: 
[0m20:29:52.672873 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:29:52.675333 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m20:29:52.681969 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m20:29:52.682244 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m20:29:52.682476 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:29:53.287907 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.605 seconds
[0m20:29:53.293369 [debug] [ThreadPool]: On list_dev: Close
[0m20:29:53.441857 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_snapshot)
[0m20:29:53.456874 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m20:29:53.457674 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m20:29:53.458160 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:29:54.012185 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.554 seconds
[0m20:29:54.018994 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m20:29:54.155053 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m20:29:54.162930 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m20:29:54.163801 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m20:29:54.164425 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:29:54.677721 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.513 seconds
[0m20:29:54.682857 [debug] [ThreadPool]: On list_dev_stock: Close
[0m20:29:54.830420 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b34bc97d-ae05-4118-8ba7-482ac66cf510', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5e7488c0>]}
[0m20:29:54.832469 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:29:54.833405 [info ] [MainThread]: 
[0m20:29:54.851971 [debug] [Thread-1 (]: Began running node model.lab.RSI_Calculation
[0m20:29:54.852864 [info ] [Thread-1 (]: 1 of 2 START sql table model stock.RSI_Calculation ............................. [RUN]
[0m20:29:54.853519 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now model.lab.RSI_Calculation)
[0m20:29:54.853987 [debug] [Thread-1 (]: Began compiling node model.lab.RSI_Calculation
[0m20:29:54.862458 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.RSI_Calculation"
[0m20:29:54.863731 [debug] [Thread-1 (]: Began executing node model.lab.RSI_Calculation
[0m20:29:54.883678 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.RSI_Calculation"
[0m20:29:54.885536 [debug] [Thread-1 (]: Using snowflake connection "model.lab.RSI_Calculation"
[0m20:29:54.885866 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.RSI_Calculation"} */
create or replace transient table dev.stock.RSI_Calculation
         as
        (WITH PriceChanges AS (
    SELECT
        date,
        symbol,
        close,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM
        dev.stock.stock_price_analysis  -- Replace 'stock' and 'stock_price_analysis' with your actual source name and table
),
PriceGainsLosses AS (
    SELECT
        date,
        symbol,
        close,
        next_close,
        CASE 
            WHEN next_close > close THEN next_close - close
            ELSE 0 
        END AS gain,
        CASE 
            WHEN next_close < close THEN close - next_close
            ELSE 0 
        END AS loss
    FROM
        PriceChanges
),
AverageGainsLosses AS (
    SELECT
        date,
        symbol,
        AVG(gain) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain,
        AVG(loss) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss
    FROM
        PriceGainsLosses
),
RSI_Calculation AS (
    SELECT
        date,
        symbol,
        avg_gain,
        avg_loss,
        CASE 
            WHEN avg_loss = 0 THEN 100
            ELSE 100 - (100 / (1 + (avg_gain / avg_loss)))
        END AS rsi
    FROM
        AverageGainsLosses
)
SELECT 
    date, 
    symbol, 
    rsi
FROM 
    RSI_Calculation
WHERE
    date >= (SELECT MIN(date) FROM dev.stock.stock_price_analysis) + INTERVAL '14 DAY'
ORDER BY
    symbol, date
        );
[0m20:29:54.886174 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:29:56.152166 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.265 seconds
[0m20:29:56.179814 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: Close
[0m20:29:56.308946 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b34bc97d-ae05-4118-8ba7-482ac66cf510', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f03a2d0>]}
[0m20:29:56.310735 [info ] [Thread-1 (]: 1 of 2 OK created sql table model stock.RSI_Calculation ........................ [[32mSUCCESS 1[0m in 1.45s]
[0m20:29:56.312327 [debug] [Thread-1 (]: Finished running node model.lab.RSI_Calculation
[0m20:29:56.313006 [debug] [Thread-1 (]: Began running node model.lab.stock_price_analysis
[0m20:29:56.313878 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.RSI_Calculation, now model.lab.stock_price_analysis)
[0m20:29:56.314485 [debug] [Thread-1 (]: Began compiling node model.lab.stock_price_analysis
[0m20:29:56.319182 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.stock_price_analysis"
[0m20:29:56.322751 [debug] [Thread-1 (]: Finished running node model.lab.stock_price_analysis
[0m20:29:56.323968 [debug] [Thread-1 (]: Began running node model.lab.macd_calculation
[0m20:29:56.324771 [info ] [Thread-1 (]: 2 of 2 START sql table model stock.macd_calculation ............................ [RUN]
[0m20:29:56.325629 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.stock_price_analysis, now model.lab.macd_calculation)
[0m20:29:56.326139 [debug] [Thread-1 (]: Began compiling node model.lab.macd_calculation
[0m20:29:56.346462 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.macd_calculation"
[0m20:29:56.347626 [debug] [Thread-1 (]: Began executing node model.lab.macd_calculation
[0m20:29:56.349912 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.macd_calculation"
[0m20:29:56.352128 [debug] [Thread-1 (]: Using snowflake connection "model.lab.macd_calculation"
[0m20:29:56.352524 [debug] [Thread-1 (]: On model.lab.macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.macd_calculation"} */
create or replace transient table dev.stock.macd_calculation
         as
        (WITH  __dbt__cte__stock_price_analysis as (
WITH stock_data AS (
    SELECT
        *
    FROM dev.stock.stock_price_analysis
)

-- Now you can query the CTE
SELECT * FROM stock_data
), stock_data AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE,
        ROW_NUMBER() OVER (PARTITION BY SYMBOL ORDER BY DATE) AS rn
    FROM __dbt__cte__stock_price_analysis  -- Replace with the reference to your actual source table in DBT
),

-- Calculate 12-day EMA
ema_12 AS (
    SELECT
        SYMBOL,
        DATE,
        CLOSE AS EMA_12,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (12 + 1))) + (e.EMA_12 * (1 - (2.0 / (12 + 1)))) AS EMA_12,
        sd.rn
    FROM stock_data sd
    JOIN ema_12 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate 26-day EMA
ema_26 AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE AS EMA_26,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (26 + 1))) + (e.EMA_26 * (1 - (2.0 / (26 + 1)))) AS EMA_26,
        sd.rn
    FROM stock_data sd
    JOIN ema_26 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate MACD by subtracting 26-day EMA from 12-day EMA
macd_calculation AS (
    SELECT 
        e12.SYMBOL,
        e12.DATE,
        e12.EMA_12 - e26.EMA_26 AS MACD,
        e12.rn
    FROM ema_12 e12
    JOIN ema_26 e26 ON e12.SYMBOL = e26.SYMBOL AND e12.DATE = e26.DATE
),

-- Calculate 9-day EMA of MACD as Signal Line
signal_line AS (
    SELECT 
        SYMBOL,
        DATE,
        MACD,
        MACD AS Signal,
        rn
    FROM macd_calculation
    WHERE rn = 1

    UNION ALL

    SELECT 
        mc.SYMBOL,
        mc.DATE,
        mc.MACD,
        (mc.MACD * (2.0 / (9 + 1))) + (sl.Signal * (1 - (2.0 / (9 + 1)))) AS Signal,
        mc.rn
    FROM macd_calculation mc
    JOIN signal_line sl ON mc.SYMBOL = sl.SYMBOL AND mc.rn = sl.rn + 1
)

-- Final output
SELECT 
    SYMBOL,
    DATE,
    MACD,
    Signal,
    MACD - Signal AS Histogram
FROM signal_line
ORDER BY SYMBOL, DATE
        );
[0m20:29:56.353032 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:29:58.091584 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.738 seconds
[0m20:29:58.097889 [debug] [Thread-1 (]: On model.lab.macd_calculation: Close
[0m20:29:58.227468 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b34bc97d-ae05-4118-8ba7-482ac66cf510', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5d9fec90>]}
[0m20:29:58.229294 [info ] [Thread-1 (]: 2 of 2 OK created sql table model stock.macd_calculation ....................... [[32mSUCCESS 1[0m in 1.90s]
[0m20:29:58.230582 [debug] [Thread-1 (]: Finished running node model.lab.macd_calculation
[0m20:29:58.233228 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:29:58.233960 [debug] [MainThread]: Connection 'model.lab.macd_calculation' was properly closed.
[0m20:29:58.234677 [info ] [MainThread]: 
[0m20:29:58.235531 [info ] [MainThread]: Finished running 2 table models in 0 hours 0 minutes and 5.56 seconds (5.56s).
[0m20:29:58.236836 [debug] [MainThread]: Command end result
[0m20:29:58.277509 [info ] [MainThread]: 
[0m20:29:58.277890 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:29:58.278155 [info ] [MainThread]: 
[0m20:29:58.278467 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m20:29:58.280481 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.3410363, "process_user_time": 2.660903, "process_kernel_time": 0.235201, "process_mem_max_rss": "205864", "process_out_blocks": "1904", "process_in_blocks": "0"}
[0m20:29:58.281012 [debug] [MainThread]: Command `dbt run` succeeded at 20:29:58.280907 after 6.34 seconds
[0m20:29:58.281553 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e883e30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5ff66e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5e6452b0>]}
[0m20:29:58.281839 [debug] [MainThread]: Flushing usage events
[0m20:30:01.394836 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b47a3f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d4098b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b614bf0>]}


============================== 20:30:01.399091 | 64dc44d9-a661-4b08-8e35-3e23fa364f42 ==============================
[0m20:30:01.399091 [info ] [MainThread]: Running with dbt=1.8.7
[0m20:30:01.399604 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/lab/logs', 'profiles_dir': '/opt/airflow/lab', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m20:30:01.872860 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '64dc44d9-a661-4b08-8e35-3e23fa364f42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7cb57950>]}
[0m20:30:01.897687 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '64dc44d9-a661-4b08-8e35-3e23fa364f42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5b9ff230>]}
[0m20:30:01.898511 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m20:30:01.948387 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m20:30:02.019269 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:30:02.019591 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:30:02.045365 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '64dc44d9-a661-4b08-8e35-3e23fa364f42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5b25c3b0>]}
[0m20:30:02.112344 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '64dc44d9-a661-4b08-8e35-3e23fa364f42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5ad20b90>]}
[0m20:30:02.112709 [info ] [MainThread]: Found 3 models, 1 test, 2 snapshots, 2 sources, 459 macros
[0m20:30:02.112986 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '64dc44d9-a661-4b08-8e35-3e23fa364f42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5aeed4c0>]}
[0m20:30:02.113961 [info ] [MainThread]: 
[0m20:30:02.114370 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:30:02.116646 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev_snapshot'
[0m20:30:02.126001 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m20:30:02.126264 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m20:30:02.126457 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:30:02.708727 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.582 seconds
[0m20:30:02.711573 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m20:30:02.894641 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m20:30:02.901234 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m20:30:02.902262 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m20:30:02.903001 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:30:03.501432 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.598 seconds
[0m20:30:03.505424 [debug] [ThreadPool]: On list_dev_stock: Close
[0m20:30:03.642945 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '64dc44d9-a661-4b08-8e35-3e23fa364f42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b667e00>]}
[0m20:30:03.644515 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:30:03.645497 [info ] [MainThread]: 
[0m20:30:03.661025 [debug] [Thread-1 (]: Began running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m20:30:03.661781 [info ] [Thread-1 (]: 1 of 1 START test not_null_macd_calculation_date ............................... [RUN]
[0m20:30:03.662613 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now test.lab.not_null_macd_calculation_date.1954e908c9)
[0m20:30:03.663349 [debug] [Thread-1 (]: Began compiling node test.lab.not_null_macd_calculation_date.1954e908c9
[0m20:30:03.678718 [debug] [Thread-1 (]: Writing injected SQL for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m20:30:03.680179 [debug] [Thread-1 (]: Began executing node test.lab.not_null_macd_calculation_date.1954e908c9
[0m20:30:03.694469 [debug] [Thread-1 (]: Writing runtime sql for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m20:30:03.695761 [debug] [Thread-1 (]: Using snowflake connection "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m20:30:03.696131 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "test.lab.not_null_macd_calculation_date.1954e908c9"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from dev.stock.macd_calculation
where date is null



      
    ) dbt_internal_test
[0m20:30:03.696502 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:30:04.335484 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.638 seconds
[0m20:30:04.349007 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: Close
[0m20:30:04.465415 [info ] [Thread-1 (]: 1 of 1 PASS not_null_macd_calculation_date ..................................... [[32mPASS[0m in 0.80s]
[0m20:30:04.469549 [debug] [Thread-1 (]: Finished running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m20:30:04.474034 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:30:04.474534 [debug] [MainThread]: Connection 'test.lab.not_null_macd_calculation_date.1954e908c9' was properly closed.
[0m20:30:04.474913 [info ] [MainThread]: 
[0m20:30:04.475297 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 2.36 seconds (2.36s).
[0m20:30:04.475906 [debug] [MainThread]: Command end result
[0m20:30:04.501284 [info ] [MainThread]: 
[0m20:30:04.501603 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:30:04.501836 [info ] [MainThread]: 
[0m20:30:04.502090 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m20:30:04.502921 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.1468887, "process_user_time": 2.358846, "process_kernel_time": 0.253312, "process_mem_max_rss": "208024", "process_out_blocks": "1860", "process_in_blocks": "0"}
[0m20:30:04.503307 [debug] [MainThread]: Command `dbt test` succeeded at 20:30:04.503238 after 3.15 seconds
[0m20:30:04.503580 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c1422a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c142ba0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5af53e30>]}
[0m20:30:04.503818 [debug] [MainThread]: Flushing usage events
[0m20:30:07.656854 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa95c6030>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffab577140>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaad20350>]}


============================== 20:30:07.660990 | d06ff309-7540-470a-9711-81b38e6680b8 ==============================
[0m20:30:07.660990 [info ] [MainThread]: Running with dbt=1.8.7
[0m20:30:07.662061 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/lab/logs', 'profiles_dir': '/opt/airflow/lab', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m20:30:08.172361 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd06ff309-7540-470a-9711-81b38e6680b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8cec31a0>]}
[0m20:30:08.195383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd06ff309-7540-470a-9711-81b38e6680b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8d2f5eb0>]}
[0m20:30:08.195915 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m20:30:08.241513 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m20:30:08.305478 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:30:08.305779 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:30:08.329478 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd06ff309-7540-470a-9711-81b38e6680b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8caa5ee0>]}
[0m20:30:08.385173 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd06ff309-7540-470a-9711-81b38e6680b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8c8a49e0>]}
[0m20:30:08.385510 [info ] [MainThread]: Found 3 models, 1 test, 2 snapshots, 2 sources, 459 macros
[0m20:30:08.386002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd06ff309-7540-470a-9711-81b38e6680b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8c7c1100>]}
[0m20:30:08.386933 [info ] [MainThread]: 
[0m20:30:08.387360 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:30:08.389696 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m20:30:08.396700 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m20:30:08.396932 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m20:30:08.397119 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:30:09.377819 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.980 seconds
[0m20:30:09.381872 [debug] [ThreadPool]: On list_dev: Close
[0m20:30:09.882503 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_snapshot)
[0m20:30:09.896958 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m20:30:09.897554 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m20:30:09.897978 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:30:10.878706 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.980 seconds
[0m20:30:10.881353 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m20:30:11.009513 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m20:30:11.017860 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m20:30:11.018582 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m20:30:11.019170 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:30:11.673853 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.654 seconds
[0m20:30:11.678776 [debug] [ThreadPool]: On list_dev_stock: Close
[0m20:30:11.808399 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd06ff309-7540-470a-9711-81b38e6680b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8cdfe810>]}
[0m20:30:11.809823 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:30:11.812705 [info ] [MainThread]: 
[0m20:30:11.824654 [debug] [Thread-1 (]: Began running node snapshot.lab.snapshot_RSI_Calculation
[0m20:30:11.825398 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snapshot_RSI_Calculation ........................ [RUN]
[0m20:30:11.826095 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now snapshot.lab.snapshot_RSI_Calculation)
[0m20:30:11.826525 [debug] [Thread-1 (]: Began compiling node snapshot.lab.snapshot_RSI_Calculation
[0m20:30:11.833786 [debug] [Thread-1 (]: Began executing node snapshot.lab.snapshot_RSI_Calculation
[0m20:30:11.866757 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m20:30:11.867123 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_RSI_CALCULATION"
[0m20:30:11.867389 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:30:12.368976 [debug] [Thread-1 (]: SQL status: SUCCESS 7 in 0.501 seconds
[0m20:30:12.424922 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m20:30:12.425624 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
create or replace temporary table "DEV"."SNAPSHOT"."SNAPSHOT_RSI_CALCULATION__dbt_tmp"
         as
        (

    with snapshot_query as (

        

SELECT * FROM dev.stock.RSI_Calculation

    ),

    snapshotted_data as (

        select *, 
    
        date as dbt_unique_key
    

        from "DEV"."SNAPSHOT"."SNAPSHOT_RSI_CALCULATION"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            
  
  coalesce(nullif(date, date), null)
  as dbt_valid_to
,
            md5(coalesce(cast(date as varchar ), '')
         || '|' || coalesce(cast(date as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            date as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select *, 
    
        date as dbt_unique_key
    

        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data.dbt_valid_from < source_data.date))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data.dbt_valid_from < source_data.date)
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        source_data.dbt_unique_key is null
    

    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m20:30:13.450553 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.024 seconds
[0m20:30:13.459070 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m20:30:13.460229 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_RSI_CALCULATION__dbt_tmp"
[0m20:30:13.653049 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.192 seconds
[0m20:30:13.662000 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m20:30:13.663217 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_RSI_CALCULATION"
[0m20:30:13.798135 [debug] [Thread-1 (]: SQL status: SUCCESS 7 in 0.134 seconds
[0m20:30:13.805707 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m20:30:13.807616 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_RSI_CALCULATION__dbt_tmp"
[0m20:30:13.948877 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.140 seconds
[0m20:30:13.958441 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m20:30:13.959621 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_RSI_CALCULATION"
[0m20:30:14.089281 [debug] [Thread-1 (]: SQL status: SUCCESS 7 in 0.129 seconds
[0m20:30:14.100907 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m20:30:14.101800 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_RSI_CALCULATION__dbt_tmp"
[0m20:30:14.271575 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.169 seconds
[0m20:30:14.302117 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m20:30:14.302818 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
select * from (
        

    with snapshot_query as (

        

SELECT * FROM dev.stock.RSI_Calculation

    ),

    snapshotted_data as (

        select *, 
    
        date as dbt_unique_key
    

        from "DEV"."SNAPSHOT"."SNAPSHOT_RSI_CALCULATION"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            
  
  coalesce(nullif(date, date), null)
  as dbt_valid_to
,
            md5(coalesce(cast(date as varchar ), '')
         || '|' || coalesce(cast(date as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            date as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select *, 
    
        date as dbt_unique_key
    

        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data.dbt_valid_from < source_data.date))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data.dbt_valid_from < source_data.date)
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        source_data.dbt_unique_key is null
    

    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

    ) as __dbt_sbq
    where false
    limit 0
[0m20:30:14.678375 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.375 seconds
[0m20:30:14.686305 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m20:30:14.687270 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
select * from (
        select to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_snapshot_time
    ) as __dbt_sbq
    where false
    limit 0
[0m20:30:14.810907 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.123 seconds
[0m20:30:14.812763 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.lab.snapshot_RSI_Calculation"
[0m20:30:14.816903 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m20:30:14.817480 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
BEGIN
[0m20:30:15.059398 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.241 seconds
[0m20:30:15.060552 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m20:30:15.061389 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
merge into "DEV"."SNAPSHOT"."SNAPSHOT_RSI_CALCULATION" as DBT_INTERNAL_DEST
    using "DEV"."SNAPSHOT"."SNAPSHOT_RSI_CALCULATION__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     
       and DBT_INTERNAL_DEST.dbt_valid_to is null
     
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("DATE", "SYMBOL", "RSI", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("DATE", "SYMBOL", "RSI", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m20:30:15.806742 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.744 seconds
[0m20:30:15.808750 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m20:30:15.809565 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
COMMIT
[0m20:30:16.214537 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.404 seconds
[0m20:30:16.244169 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: Close
[0m20:30:16.371165 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd06ff309-7540-470a-9711-81b38e6680b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8cdfc3b0>]}
[0m20:30:16.373066 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snapshot_RSI_Calculation ........................ [[32mSUCCESS 0[0m in 4.54s]
[0m20:30:16.375798 [debug] [Thread-1 (]: Finished running node snapshot.lab.snapshot_RSI_Calculation
[0m20:30:16.376651 [debug] [Thread-1 (]: Began running node snapshot.lab.snapshot_macd_calculation
[0m20:30:16.377737 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snapshot_macd_calculation ....................... [RUN]
[0m20:30:16.378735 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.lab.snapshot_RSI_Calculation, now snapshot.lab.snapshot_macd_calculation)
[0m20:30:16.379363 [debug] [Thread-1 (]: Began compiling node snapshot.lab.snapshot_macd_calculation
[0m20:30:16.383542 [debug] [Thread-1 (]: Began executing node snapshot.lab.snapshot_macd_calculation
[0m20:30:16.387873 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:30:16.388377 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
[0m20:30:16.388798 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:30:16.884223 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.495 seconds
[0m20:30:16.894945 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:30:16.895769 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
create or replace temporary table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp"
         as
        (

    with snapshot_query as (

        

SELECT * FROM dev.stock.macd_calculation

    ),

    snapshotted_data as (

        select *, 
    
        date as dbt_unique_key
    

        from "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            
  
  coalesce(nullif(date, date), null)
  as dbt_valid_to
,
            md5(coalesce(cast(date as varchar ), '')
         || '|' || coalesce(cast(date as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            date as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select *, 
    
        date as dbt_unique_key
    

        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data.dbt_valid_from < source_data.date))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data.dbt_valid_from < source_data.date)
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        source_data.dbt_unique_key is null
    

    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m20:30:17.877397 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.981 seconds
[0m20:30:17.880147 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:30:17.880611 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp"
[0m20:30:17.984430 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.103 seconds
[0m20:30:17.988272 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:30:17.988977 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
[0m20:30:18.082933 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.093 seconds
[0m20:30:18.085984 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:30:18.086298 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp"
[0m20:30:18.210034 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.123 seconds
[0m20:30:18.217366 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:30:18.217974 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
[0m20:30:18.364549 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.146 seconds
[0m20:30:18.371116 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:30:18.371890 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp"
[0m20:30:18.468075 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.095 seconds
[0m20:30:18.476271 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:30:18.477081 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
select * from (
        

    with snapshot_query as (

        

SELECT * FROM dev.stock.macd_calculation

    ),

    snapshotted_data as (

        select *, 
    
        date as dbt_unique_key
    

        from "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            
  
  coalesce(nullif(date, date), null)
  as dbt_valid_to
,
            md5(coalesce(cast(date as varchar ), '')
         || '|' || coalesce(cast(date as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            date as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select *, 
    
        date as dbt_unique_key
    

        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data.dbt_valid_from < source_data.date))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data.dbt_valid_from < source_data.date)
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        source_data.dbt_unique_key is null
    

    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

    ) as __dbt_sbq
    where false
    limit 0
[0m20:30:18.979779 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.501 seconds
[0m20:30:18.983441 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:30:18.984741 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
select * from (
        select to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_snapshot_time
    ) as __dbt_sbq
    where false
    limit 0
[0m20:30:19.080599 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.095 seconds
[0m20:30:19.082691 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.lab.snapshot_macd_calculation"
[0m20:30:19.086980 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:30:19.087888 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
BEGIN
[0m20:30:19.232893 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.144 seconds
[0m20:30:19.234388 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:30:19.235181 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
merge into "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION" as DBT_INTERNAL_DEST
    using "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     
       and DBT_INTERNAL_DEST.dbt_valid_to is null
     
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SYMBOL", "DATE", "MACD", "SIGNAL", "HISTOGRAM", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SYMBOL", "DATE", "MACD", "SIGNAL", "HISTOGRAM", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m20:30:19.799527 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.563 seconds
[0m20:30:19.801395 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m20:30:19.802351 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
COMMIT
[0m20:30:20.413121 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.609 seconds
[0m20:30:20.418029 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: Close
[0m20:30:20.557587 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd06ff309-7540-470a-9711-81b38e6680b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8c7347d0>]}
[0m20:30:20.559024 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snapshot_macd_calculation ....................... [[32mSUCCESS 0[0m in 4.18s]
[0m20:30:20.561457 [debug] [Thread-1 (]: Finished running node snapshot.lab.snapshot_macd_calculation
[0m20:30:20.564730 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:30:20.565261 [debug] [MainThread]: Connection 'snapshot.lab.snapshot_macd_calculation' was properly closed.
[0m20:30:20.565814 [info ] [MainThread]: 
[0m20:30:20.566658 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 12.18 seconds (12.18s).
[0m20:30:20.567892 [debug] [MainThread]: Command end result
[0m20:30:20.601763 [info ] [MainThread]: 
[0m20:30:20.602267 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:30:20.602668 [info ] [MainThread]: 
[0m20:30:20.603073 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m20:30:20.604942 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 12.989484, "process_user_time": 3.012147, "process_kernel_time": 0.310342, "process_mem_max_rss": "206932", "process_out_blocks": "1915", "process_in_blocks": "0"}
[0m20:30:20.605470 [debug] [MainThread]: Command `dbt snapshot` succeeded at 20:30:20.605408 after 12.99 seconds
[0m20:30:20.605890 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffabae5340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa9a67320>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa8f81370>]}
[0m20:30:20.606186 [debug] [MainThread]: Flushing usage events
[0m19:23:11.346196 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88296fc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88294bf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89566630>]}


============================== 19:23:11.350448 | b54b1aef-b5d3-4471-88e0-b6a0c1733f6c ==============================
[0m19:23:11.350448 [info ] [MainThread]: Running with dbt=1.8.7
[0m19:23:11.351187 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/lab', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/lab/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m19:23:11.817608 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b54b1aef-b5d3-4471-88e0-b6a0c1733f6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6c8989e0>]}
[0m19:23:11.840129 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b54b1aef-b5d3-4471-88e0-b6a0c1733f6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6c8989e0>]}
[0m19:23:11.840606 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m19:23:11.885283 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m19:23:11.952201 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:23:11.952476 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:23:11.974675 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b54b1aef-b5d3-4471-88e0-b6a0c1733f6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88536ed0>]}
[0m19:23:12.030074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b54b1aef-b5d3-4471-88e0-b6a0c1733f6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff67d2ec90>]}
[0m19:23:12.030386 [info ] [MainThread]: Found 3 models, 1 test, 2 snapshots, 2 sources, 459 macros
[0m19:23:12.030801 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b54b1aef-b5d3-4471-88e0-b6a0c1733f6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8973a840>]}
[0m19:23:12.031685 [info ] [MainThread]: 
[0m19:23:12.032169 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:23:12.034570 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m19:23:12.042024 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m19:23:12.042320 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m19:23:12.042606 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:23:12.556446 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.514 seconds
[0m19:23:12.560269 [debug] [ThreadPool]: On list_dev: Close
[0m19:23:12.700829 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_snapshot)
[0m19:23:12.714623 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m19:23:12.715273 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m19:23:12.715611 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:23:13.195983 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.480 seconds
[0m19:23:13.199809 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m19:23:13.341633 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m19:23:13.349549 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m19:23:13.350347 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m19:23:13.352790 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:23:13.929330 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.576 seconds
[0m19:23:13.933195 [debug] [ThreadPool]: On list_dev_stock: Close
[0m19:23:14.064876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b54b1aef-b5d3-4471-88e0-b6a0c1733f6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6c19b6b0>]}
[0m19:23:14.065935 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:23:14.067436 [info ] [MainThread]: 
[0m19:23:14.079321 [debug] [Thread-1 (]: Began running node model.lab.RSI_Calculation
[0m19:23:14.080002 [info ] [Thread-1 (]: 1 of 2 START sql table model stock.RSI_Calculation ............................. [RUN]
[0m19:23:14.080671 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now model.lab.RSI_Calculation)
[0m19:23:14.081045 [debug] [Thread-1 (]: Began compiling node model.lab.RSI_Calculation
[0m19:23:14.087843 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.RSI_Calculation"
[0m19:23:14.090016 [debug] [Thread-1 (]: Began executing node model.lab.RSI_Calculation
[0m19:23:14.109193 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.RSI_Calculation"
[0m19:23:14.111200 [debug] [Thread-1 (]: Using snowflake connection "model.lab.RSI_Calculation"
[0m19:23:14.111527 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.RSI_Calculation"} */
create or replace transient table dev.stock.RSI_Calculation
         as
        (WITH PriceChanges AS (
    SELECT
        date,
        symbol,
        close,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM
        dev.stock.stock_price_analysis  -- Replace 'stock' and 'stock_price_analysis' with your actual source name and table
),
PriceGainsLosses AS (
    SELECT
        date,
        symbol,
        close,
        next_close,
        CASE 
            WHEN next_close > close THEN next_close - close
            ELSE 0 
        END AS gain,
        CASE 
            WHEN next_close < close THEN close - next_close
            ELSE 0 
        END AS loss
    FROM
        PriceChanges
),
AverageGainsLosses AS (
    SELECT
        date,
        symbol,
        AVG(gain) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain,
        AVG(loss) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss
    FROM
        PriceGainsLosses
),
RSI_Calculation AS (
    SELECT
        date,
        symbol,
        avg_gain,
        avg_loss,
        CASE 
            WHEN avg_loss = 0 THEN 100
            ELSE 100 - (100 / (1 + (avg_gain / avg_loss)))
        END AS rsi
    FROM
        AverageGainsLosses
)
SELECT 
    date, 
    symbol, 
    rsi
FROM 
    RSI_Calculation
WHERE
    date >= (SELECT MIN(date) FROM dev.stock.stock_price_analysis) + INTERVAL '14 DAY'
ORDER BY
    symbol, date
        );
[0m19:23:14.111864 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:23:15.355751 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.244 seconds
[0m19:23:15.376884 [debug] [Thread-1 (]: On model.lab.RSI_Calculation: Close
[0m19:23:15.500456 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b54b1aef-b5d3-4471-88e0-b6a0c1733f6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff67225c70>]}
[0m19:23:15.502215 [info ] [Thread-1 (]: 1 of 2 OK created sql table model stock.RSI_Calculation ........................ [[32mSUCCESS 1[0m in 1.42s]
[0m19:23:15.504942 [debug] [Thread-1 (]: Finished running node model.lab.RSI_Calculation
[0m19:23:15.505795 [debug] [Thread-1 (]: Began running node model.lab.stock_price_analysis
[0m19:23:15.506737 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.RSI_Calculation, now model.lab.stock_price_analysis)
[0m19:23:15.507906 [debug] [Thread-1 (]: Began compiling node model.lab.stock_price_analysis
[0m19:23:15.512484 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.stock_price_analysis"
[0m19:23:15.516312 [debug] [Thread-1 (]: Finished running node model.lab.stock_price_analysis
[0m19:23:15.517664 [debug] [Thread-1 (]: Began running node model.lab.macd_calculation
[0m19:23:15.518382 [info ] [Thread-1 (]: 2 of 2 START sql table model stock.macd_calculation ............................ [RUN]
[0m19:23:15.520003 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.lab.stock_price_analysis, now model.lab.macd_calculation)
[0m19:23:15.520560 [debug] [Thread-1 (]: Began compiling node model.lab.macd_calculation
[0m19:23:15.539197 [debug] [Thread-1 (]: Writing injected SQL for node "model.lab.macd_calculation"
[0m19:23:15.540430 [debug] [Thread-1 (]: Began executing node model.lab.macd_calculation
[0m19:23:15.542664 [debug] [Thread-1 (]: Writing runtime sql for node "model.lab.macd_calculation"
[0m19:23:15.544683 [debug] [Thread-1 (]: Using snowflake connection "model.lab.macd_calculation"
[0m19:23:15.545040 [debug] [Thread-1 (]: On model.lab.macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "model.lab.macd_calculation"} */
create or replace transient table dev.stock.macd_calculation
         as
        (WITH  __dbt__cte__stock_price_analysis as (
WITH stock_data AS (
    SELECT
        *
    FROM dev.stock.stock_price_analysis
)

-- Now you can query the CTE
SELECT * FROM stock_data
), stock_data AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE,
        ROW_NUMBER() OVER (PARTITION BY SYMBOL ORDER BY DATE) AS rn
    FROM __dbt__cte__stock_price_analysis  -- Replace with the reference to your actual source table in DBT
),

-- Calculate 12-day EMA
ema_12 AS (
    SELECT
        SYMBOL,
        DATE,
        CLOSE AS EMA_12,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (12 + 1))) + (e.EMA_12 * (1 - (2.0 / (12 + 1)))) AS EMA_12,
        sd.rn
    FROM stock_data sd
    JOIN ema_12 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate 26-day EMA
ema_26 AS (
    SELECT 
        SYMBOL,
        DATE,
        CLOSE AS EMA_26,
        rn
    FROM stock_data
    WHERE rn = 1

    UNION ALL

    SELECT 
        sd.SYMBOL,
        sd.DATE,
        (sd.CLOSE * (2.0 / (26 + 1))) + (e.EMA_26 * (1 - (2.0 / (26 + 1)))) AS EMA_26,
        sd.rn
    FROM stock_data sd
    JOIN ema_26 e ON sd.SYMBOL = e.SYMBOL AND sd.rn = e.rn + 1
),

-- Calculate MACD by subtracting 26-day EMA from 12-day EMA
macd_calculation AS (
    SELECT 
        e12.SYMBOL,
        e12.DATE,
        e12.EMA_12 - e26.EMA_26 AS MACD,
        e12.rn
    FROM ema_12 e12
    JOIN ema_26 e26 ON e12.SYMBOL = e26.SYMBOL AND e12.DATE = e26.DATE
),

-- Calculate 9-day EMA of MACD as Signal Line
signal_line AS (
    SELECT 
        SYMBOL,
        DATE,
        MACD,
        MACD AS Signal,
        rn
    FROM macd_calculation
    WHERE rn = 1

    UNION ALL

    SELECT 
        mc.SYMBOL,
        mc.DATE,
        mc.MACD,
        (mc.MACD * (2.0 / (9 + 1))) + (sl.Signal * (1 - (2.0 / (9 + 1)))) AS Signal,
        mc.rn
    FROM macd_calculation mc
    JOIN signal_line sl ON mc.SYMBOL = sl.SYMBOL AND mc.rn = sl.rn + 1
)

-- Final output
SELECT 
    SYMBOL,
    DATE,
    MACD,
    Signal,
    MACD - Signal AS Histogram
FROM signal_line
ORDER BY SYMBOL, DATE
        );
[0m19:23:15.545532 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:23:17.099122 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.553 seconds
[0m19:23:17.102554 [debug] [Thread-1 (]: On model.lab.macd_calculation: Close
[0m19:23:17.212887 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b54b1aef-b5d3-4471-88e0-b6a0c1733f6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff67d60680>]}
[0m19:23:17.213628 [info ] [Thread-1 (]: 2 of 2 OK created sql table model stock.macd_calculation ....................... [[32mSUCCESS 1[0m in 1.69s]
[0m19:23:17.214486 [debug] [Thread-1 (]: Finished running node model.lab.macd_calculation
[0m19:23:17.215832 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:23:17.216141 [debug] [MainThread]: Connection 'model.lab.macd_calculation' was properly closed.
[0m19:23:17.216491 [info ] [MainThread]: 
[0m19:23:17.216978 [info ] [MainThread]: Finished running 2 table models in 0 hours 0 minutes and 5.18 seconds (5.18s).
[0m19:23:17.217787 [debug] [MainThread]: Command end result
[0m19:23:17.243378 [info ] [MainThread]: 
[0m19:23:17.243805 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:23:17.244132 [info ] [MainThread]: 
[0m19:23:17.244517 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m19:23:17.245656 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.922209, "process_user_time": 2.427213, "process_kernel_time": 0.285377, "process_mem_max_rss": "206108", "process_in_blocks": "11072", "process_out_blocks": "4088"}
[0m19:23:17.245990 [debug] [MainThread]: Command `dbt run` succeeded at 19:23:17.245933 after 5.92 seconds
[0m19:23:17.246237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8c916ae0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff885580b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff889e2120>]}
[0m19:23:17.246489 [debug] [MainThread]: Flushing usage events
[0m19:23:20.261427 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87d57c20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87e3d8b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff879acbf0>]}


============================== 19:23:20.265197 | d0353a62-6e93-4947-b4ff-067ec00ddfee ==============================
[0m19:23:20.265197 [info ] [MainThread]: Running with dbt=1.8.7
[0m19:23:20.265637 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/lab', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/lab/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m19:23:20.695302 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd0353a62-6e93-4947-b4ff-067ec00ddfee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87653590>]}
[0m19:23:20.717547 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd0353a62-6e93-4947-b4ff-067ec00ddfee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87866ba0>]}
[0m19:23:20.718032 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m19:23:20.764409 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m19:23:20.829890 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:23:20.830232 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:23:20.851933 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd0353a62-6e93-4947-b4ff-067ec00ddfee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6744f230>]}
[0m19:23:20.914403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd0353a62-6e93-4947-b4ff-067ec00ddfee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff66f31520>]}
[0m19:23:20.914740 [info ] [MainThread]: Found 3 models, 1 test, 2 snapshots, 2 sources, 459 macros
[0m19:23:20.915048 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd0353a62-6e93-4947-b4ff-067ec00ddfee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6d7c7350>]}
[0m19:23:20.916052 [info ] [MainThread]: 
[0m19:23:20.916424 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:23:20.918488 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev_snapshot'
[0m19:23:20.927164 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m19:23:20.927409 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m19:23:20.927675 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:23:21.323061 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.395 seconds
[0m19:23:21.327264 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m19:23:21.458350 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m19:23:21.464488 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m19:23:21.465289 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m19:23:21.465848 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:23:21.953533 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.487 seconds
[0m19:23:21.957546 [debug] [ThreadPool]: On list_dev_stock: Close
[0m19:23:22.095429 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd0353a62-6e93-4947-b4ff-067ec00ddfee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff67538800>]}
[0m19:23:22.096589 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:23:22.097309 [info ] [MainThread]: 
[0m19:23:22.109253 [debug] [Thread-1 (]: Began running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m19:23:22.109886 [info ] [Thread-1 (]: 1 of 1 START test not_null_macd_calculation_date ............................... [RUN]
[0m19:23:22.110427 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now test.lab.not_null_macd_calculation_date.1954e908c9)
[0m19:23:22.110887 [debug] [Thread-1 (]: Began compiling node test.lab.not_null_macd_calculation_date.1954e908c9
[0m19:23:22.123791 [debug] [Thread-1 (]: Writing injected SQL for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m19:23:22.125133 [debug] [Thread-1 (]: Began executing node test.lab.not_null_macd_calculation_date.1954e908c9
[0m19:23:22.137179 [debug] [Thread-1 (]: Writing runtime sql for node "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m19:23:22.138378 [debug] [Thread-1 (]: Using snowflake connection "test.lab.not_null_macd_calculation_date.1954e908c9"
[0m19:23:22.138701 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "test.lab.not_null_macd_calculation_date.1954e908c9"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from dev.stock.macd_calculation
where date is null



      
    ) dbt_internal_test
[0m19:23:22.139014 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:23:22.586027 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.446 seconds
[0m19:23:22.599582 [debug] [Thread-1 (]: On test.lab.not_null_macd_calculation_date.1954e908c9: Close
[0m19:23:22.733890 [info ] [Thread-1 (]: 1 of 1 PASS not_null_macd_calculation_date ..................................... [[32mPASS[0m in 0.62s]
[0m19:23:22.735241 [debug] [Thread-1 (]: Finished running node test.lab.not_null_macd_calculation_date.1954e908c9
[0m19:23:22.738261 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:23:22.740818 [debug] [MainThread]: Connection 'test.lab.not_null_macd_calculation_date.1954e908c9' was properly closed.
[0m19:23:22.741806 [info ] [MainThread]: 
[0m19:23:22.742377 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 1.83 seconds (1.83s).
[0m19:23:22.743573 [debug] [MainThread]: Command end result
[0m19:23:22.780167 [info ] [MainThread]: 
[0m19:23:22.780541 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:23:22.780854 [info ] [MainThread]: 
[0m19:23:22.781135 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m19:23:22.781884 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 2.558245, "process_user_time": 2.292942, "process_kernel_time": 0.196737, "process_mem_max_rss": "208164", "process_out_blocks": "1860", "process_in_blocks": "0"}
[0m19:23:22.782276 [debug] [MainThread]: Command `dbt test` succeeded at 19:23:22.782218 after 2.56 seconds
[0m19:23:22.782582 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff67163650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8767e3c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8767e000>]}
[0m19:23:22.782917 [debug] [MainThread]: Flushing usage events
[0m19:23:25.173072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa34ce090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa3617f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa54095b0>]}


============================== 19:23:25.176899 | e995b8f2-5ac7-4340-ab07-82005cdba1e4 ==============================
[0m19:23:25.176899 [info ] [MainThread]: Running with dbt=1.8.7
[0m19:23:25.177288 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/lab/logs', 'profiles_dir': '/opt/airflow/lab', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/lab --project-dir /opt/airflow/lab', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m19:23:25.553508 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e995b8f2-5ac7-4340-ab07-82005cdba1e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa502edb0>]}
[0m19:23:25.574919 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e995b8f2-5ac7-4340-ab07-82005cdba1e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa4415c40>]}
[0m19:23:25.575372 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m19:23:25.617904 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m19:23:25.677323 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:23:25.677620 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:23:25.699569 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e995b8f2-5ac7-4340-ab07-82005cdba1e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83388230>]}
[0m19:23:25.751800 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e995b8f2-5ac7-4340-ab07-82005cdba1e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82f67890>]}
[0m19:23:25.752096 [info ] [MainThread]: Found 3 models, 1 test, 2 snapshots, 2 sources, 459 macros
[0m19:23:25.752361 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e995b8f2-5ac7-4340-ab07-82005cdba1e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82f5e600>]}
[0m19:23:25.753200 [info ] [MainThread]: 
[0m19:23:25.753584 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:23:25.755556 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m19:23:25.762268 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m19:23:25.762518 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m19:23:25.762723 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:23:26.221339 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.458 seconds
[0m19:23:26.224258 [debug] [ThreadPool]: On list_dev: Close
[0m19:23:26.335431 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_snapshot)
[0m19:23:26.349391 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m19:23:26.349983 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m19:23:26.350462 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:23:26.778326 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.428 seconds
[0m19:23:26.781691 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m19:23:26.903318 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_stock)
[0m19:23:26.907536 [debug] [ThreadPool]: Using snowflake connection "list_dev_stock"
[0m19:23:26.908227 [debug] [ThreadPool]: On list_dev_stock: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "connection_name": "list_dev_stock"} */
show objects in dev.stock limit 10000
[0m19:23:26.908765 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:23:27.344996 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.436 seconds
[0m19:23:27.349756 [debug] [ThreadPool]: On list_dev_stock: Close
[0m19:23:27.465386 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e995b8f2-5ac7-4340-ab07-82005cdba1e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8323e270>]}
[0m19:23:27.466420 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:23:27.467270 [info ] [MainThread]: 
[0m19:23:27.477170 [debug] [Thread-1 (]: Began running node snapshot.lab.snapshot_RSI_Calculation
[0m19:23:27.477814 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snapshot_RSI_Calculation ........................ [RUN]
[0m19:23:27.478320 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_stock, now snapshot.lab.snapshot_RSI_Calculation)
[0m19:23:27.478753 [debug] [Thread-1 (]: Began compiling node snapshot.lab.snapshot_RSI_Calculation
[0m19:23:27.485079 [debug] [Thread-1 (]: Began executing node snapshot.lab.snapshot_RSI_Calculation
[0m19:23:27.516587 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m19:23:27.516869 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_RSI_CALCULATION"
[0m19:23:27.517120 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:23:27.956656 [debug] [Thread-1 (]: SQL status: SUCCESS 7 in 0.439 seconds
[0m19:23:28.003400 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m19:23:28.003898 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
create or replace temporary table "DEV"."SNAPSHOT"."SNAPSHOT_RSI_CALCULATION__dbt_tmp"
         as
        (

    with snapshot_query as (

        

SELECT * FROM dev.stock.RSI_Calculation

    ),

    snapshotted_data as (

        select *, 
    
        date as dbt_unique_key
    

        from "DEV"."SNAPSHOT"."SNAPSHOT_RSI_CALCULATION"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            
  
  coalesce(nullif(date, date), null)
  as dbt_valid_to
,
            md5(coalesce(cast(date as varchar ), '')
         || '|' || coalesce(cast(date as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            date as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select *, 
    
        date as dbt_unique_key
    

        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data.dbt_valid_from < source_data.date))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data.dbt_valid_from < source_data.date)
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        source_data.dbt_unique_key is null
    

    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m19:23:29.265451 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.261 seconds
[0m19:23:29.271430 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m19:23:29.272269 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_RSI_CALCULATION__dbt_tmp"
[0m19:23:29.381994 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.109 seconds
[0m19:23:29.386005 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m19:23:29.386600 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_RSI_CALCULATION"
[0m19:23:29.484105 [debug] [Thread-1 (]: SQL status: SUCCESS 7 in 0.097 seconds
[0m19:23:29.488675 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m19:23:29.489313 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_RSI_CALCULATION__dbt_tmp"
[0m19:23:29.631932 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.142 seconds
[0m19:23:29.634016 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m19:23:29.634342 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_RSI_CALCULATION"
[0m19:23:29.766374 [debug] [Thread-1 (]: SQL status: SUCCESS 7 in 0.132 seconds
[0m19:23:29.773243 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m19:23:29.773786 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_RSI_CALCULATION__dbt_tmp"
[0m19:23:29.874382 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.100 seconds
[0m19:23:29.896416 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m19:23:29.897230 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
select * from (
        

    with snapshot_query as (

        

SELECT * FROM dev.stock.RSI_Calculation

    ),

    snapshotted_data as (

        select *, 
    
        date as dbt_unique_key
    

        from "DEV"."SNAPSHOT"."SNAPSHOT_RSI_CALCULATION"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            
  
  coalesce(nullif(date, date), null)
  as dbt_valid_to
,
            md5(coalesce(cast(date as varchar ), '')
         || '|' || coalesce(cast(date as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            date as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select *, 
    
        date as dbt_unique_key
    

        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data.dbt_valid_from < source_data.date))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data.dbt_valid_from < source_data.date)
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        source_data.dbt_unique_key is null
    

    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

    ) as __dbt_sbq
    where false
    limit 0
[0m19:23:30.212173 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.314 seconds
[0m19:23:30.217663 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m19:23:30.218490 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
select * from (
        select to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_snapshot_time
    ) as __dbt_sbq
    where false
    limit 0
[0m19:23:30.297598 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.078 seconds
[0m19:23:30.298908 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.lab.snapshot_RSI_Calculation"
[0m19:23:30.303426 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m19:23:30.303963 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
BEGIN
[0m19:23:30.509384 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.205 seconds
[0m19:23:30.510385 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m19:23:30.511197 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
merge into "DEV"."SNAPSHOT"."SNAPSHOT_RSI_CALCULATION" as DBT_INTERNAL_DEST
    using "DEV"."SNAPSHOT"."SNAPSHOT_RSI_CALCULATION__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     
       and DBT_INTERNAL_DEST.dbt_valid_to is null
     
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("DATE", "SYMBOL", "RSI", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("DATE", "SYMBOL", "RSI", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m19:23:31.434639 [debug] [Thread-1 (]: SQL status: SUCCESS 4 in 0.922 seconds
[0m19:23:31.436078 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_RSI_Calculation"
[0m19:23:31.436865 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_RSI_Calculation"} */
COMMIT
[0m19:23:31.842208 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.404 seconds
[0m19:23:31.870139 [debug] [Thread-1 (]: On snapshot.lab.snapshot_RSI_Calculation: Close
[0m19:23:31.981091 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e995b8f2-5ac7-4340-ab07-82005cdba1e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8231fe60>]}
[0m19:23:31.984337 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snapshot_RSI_Calculation ........................ [[32mSUCCESS 4[0m in 4.50s]
[0m19:23:31.988304 [debug] [Thread-1 (]: Finished running node snapshot.lab.snapshot_RSI_Calculation
[0m19:23:31.990146 [debug] [Thread-1 (]: Began running node snapshot.lab.snapshot_macd_calculation
[0m19:23:31.994102 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snapshot_macd_calculation ....................... [RUN]
[0m19:23:31.995841 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.lab.snapshot_RSI_Calculation, now snapshot.lab.snapshot_macd_calculation)
[0m19:23:31.996708 [debug] [Thread-1 (]: Began compiling node snapshot.lab.snapshot_macd_calculation
[0m19:23:32.001003 [debug] [Thread-1 (]: Began executing node snapshot.lab.snapshot_macd_calculation
[0m19:23:32.004930 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:23:32.005329 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
[0m19:23:32.005775 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:23:32.500105 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.494 seconds
[0m19:23:32.509984 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:23:32.510776 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
create or replace temporary table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp"
         as
        (

    with snapshot_query as (

        

SELECT * FROM dev.stock.macd_calculation

    ),

    snapshotted_data as (

        select *, 
    
        date as dbt_unique_key
    

        from "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            
  
  coalesce(nullif(date, date), null)
  as dbt_valid_to
,
            md5(coalesce(cast(date as varchar ), '')
         || '|' || coalesce(cast(date as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            date as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select *, 
    
        date as dbt_unique_key
    

        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data.dbt_valid_from < source_data.date))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data.dbt_valid_from < source_data.date)
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        source_data.dbt_unique_key is null
    

    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m19:23:34.199850 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.688 seconds
[0m19:23:34.203394 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:23:34.205472 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp"
[0m19:23:34.287027 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.080 seconds
[0m19:23:34.298393 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:23:34.300137 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
[0m19:23:34.443694 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.141 seconds
[0m19:23:34.447006 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:23:34.447426 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp"
[0m19:23:34.577224 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.129 seconds
[0m19:23:34.582514 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:23:34.583055 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
[0m19:23:34.673510 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.090 seconds
[0m19:23:34.677102 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:23:34.677432 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp"
[0m19:23:34.774916 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.097 seconds
[0m19:23:34.778556 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:23:34.778976 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
select * from (
        

    with snapshot_query as (

        

SELECT * FROM dev.stock.macd_calculation

    ),

    snapshotted_data as (

        select *, 
    
        date as dbt_unique_key
    

        from "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            
  
  coalesce(nullif(date, date), null)
  as dbt_valid_to
,
            md5(coalesce(cast(date as varchar ), '')
         || '|' || coalesce(cast(date as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            date as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select *, 
    
        date as dbt_unique_key
    

        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data.dbt_valid_from < source_data.date))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data.dbt_valid_from < source_data.date)
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        source_data.dbt_unique_key is null
    

    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

    ) as __dbt_sbq
    where false
    limit 0
[0m19:23:35.019974 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.240 seconds
[0m19:23:35.023255 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:23:35.024159 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
select * from (
        select to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_snapshot_time
    ) as __dbt_sbq
    where false
    limit 0
[0m19:23:35.123582 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.098 seconds
[0m19:23:35.126112 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.lab.snapshot_macd_calculation"
[0m19:23:35.130952 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:23:35.131690 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
BEGIN
[0m19:23:35.263198 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.131 seconds
[0m19:23:35.263888 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:23:35.264440 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
merge into "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION" as DBT_INTERNAL_DEST
    using "DEV"."SNAPSHOT"."SNAPSHOT_MACD_CALCULATION__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     
       and DBT_INTERNAL_DEST.dbt_valid_to is null
     
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SYMBOL", "DATE", "MACD", "SIGNAL", "HISTOGRAM", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SYMBOL", "DATE", "MACD", "SIGNAL", "HISTOGRAM", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m19:23:36.039986 [debug] [Thread-1 (]: SQL status: SUCCESS 4 in 0.775 seconds
[0m19:23:36.041213 [debug] [Thread-1 (]: Using snowflake connection "snapshot.lab.snapshot_macd_calculation"
[0m19:23:36.042051 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "lab", "target_name": "dev", "node_id": "snapshot.lab.snapshot_macd_calculation"} */
COMMIT
[0m19:23:36.455214 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.412 seconds
[0m19:23:36.461783 [debug] [Thread-1 (]: On snapshot.lab.snapshot_macd_calculation: Close
[0m19:23:36.570613 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e995b8f2-5ac7-4340-ab07-82005cdba1e4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82fccad0>]}
[0m19:23:36.573263 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snapshot_macd_calculation ....................... [[32mSUCCESS 4[0m in 4.57s]
[0m19:23:36.575199 [debug] [Thread-1 (]: Finished running node snapshot.lab.snapshot_macd_calculation
[0m19:23:36.584853 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:23:36.585585 [debug] [MainThread]: Connection 'snapshot.lab.snapshot_macd_calculation' was properly closed.
[0m19:23:36.586527 [info ] [MainThread]: 
[0m19:23:36.587218 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 10.83 seconds (10.83s).
[0m19:23:36.589392 [debug] [MainThread]: Command end result
[0m19:23:36.631390 [info ] [MainThread]: 
[0m19:23:36.631947 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:23:36.632243 [info ] [MainThread]: 
[0m19:23:36.632569 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m19:23:36.634960 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 11.498738, "process_user_time": 2.661851, "process_kernel_time": 0.133544, "process_mem_max_rss": "206800", "process_out_blocks": "1915", "process_in_blocks": "0"}
[0m19:23:36.635586 [debug] [MainThread]: Command `dbt snapshot` succeeded at 19:23:36.635457 after 11.50 seconds
[0m19:23:36.636015 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa34ce090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83535040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa377e450>]}
[0m19:23:36.636278 [debug] [MainThread]: Flushing usage events
